var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(k){var l=0;return function(){return l<k.length?{done:!1,value:k[l++]}:{done:!0}}};$jscomp.arrayIterator=function(k){return{next:$jscomp.arrayIteratorImpl(k)}};$jscomp.makeIterator=function(k){var l="undefined"!=typeof Symbol&&Symbol.iterator&&k[Symbol.iterator];return l?l.call(k):$jscomp.arrayIterator(k)};
$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,l,g){k!=Array.prototype&&k!=Object.prototype&&(k[l]=g.value)};
$jscomp.polyfill=function(k,l,g,m){if(l){g=$jscomp.global;k=k.split(".");for(m=0;m<k.length-1;m++){var f=k[m];f in g||(g[f]={});g=g[f]}k=k[k.length-1];m=g[k];l=l(m);l!=m&&null!=l&&$jscomp.defineProperty(g,k,{configurable:!0,writable:!0,value:l})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(k){function l(){this.batch_=null}function g(d){return d instanceof f?d:new f(function(f,c){f(d)})}if(k&&!$jscomp.FORCE_POLYFILL_PROMISE)return k;l.prototype.asyncExecute=function(d){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(d)};var m=$jscomp.global.setTimeout;l.prototype.asyncExecuteFunction=function(d){m(d,0)};l.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var d=
this.batch_;this.batch_=[];for(var f=0;f<d.length;++f){var c=d[f];d[f]=null;try{c()}catch(a){this.asyncThrow_(a)}}}this.batch_=null};l.prototype.asyncThrow_=function(d){this.asyncExecuteFunction(function(){throw d;})};var f=function(d){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var f=this.createResolveAndReject_();try{d(f.resolve,f.reject)}catch(c){f.reject(c)}};f.prototype.createResolveAndReject_=function(){function d(a){return function(b){c||(c=!0,a.call(f,b))}}var f=this,c=!1;
return{resolve:d(this.resolveTo_),reject:d(this.reject_)}};f.prototype.resolveTo_=function(d){if(d===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof f)this.settleSameAsPromise_(d);else{a:switch(typeof d){case "object":var n=null!=d;break a;case "function":n=!0;break a;default:n=!1}n?this.resolveToNonPromiseObj_(d):this.fulfill_(d)}};f.prototype.resolveToNonPromiseObj_=function(d){var f=void 0;try{f=d.then}catch(c){this.reject_(c);return}"function"==typeof f?
this.settleSameAsThenable_(f,d):this.fulfill_(d)};f.prototype.reject_=function(d){this.settle_(2,d)};f.prototype.fulfill_=function(d){this.settle_(1,d)};f.prototype.settle_=function(d,f){if(0!=this.state_)throw Error("Cannot settle("+d+", "+f+"): Promise already settled in state"+this.state_);this.state_=d;this.result_=f;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var d=0;d<this.onSettledCallbacks_.length;++d)h.asyncExecute(this.onSettledCallbacks_[d]);
this.onSettledCallbacks_=null}};var h=new l;f.prototype.settleSameAsPromise_=function(d){var f=this.createResolveAndReject_();d.callWhenSettled_(f.resolve,f.reject)};f.prototype.settleSameAsThenable_=function(d,f){var c=this.createResolveAndReject_();try{d.call(f,c.resolve,c.reject)}catch(a){c.reject(a)}};f.prototype.then=function(d,h){function c(e,c){return"function"==typeof e?function(c){try{a(e(c))}catch(p){b(p)}}:c}var a,b,e=new f(function(e,c){a=e;b=c});this.callWhenSettled_(c(d,a),c(h,b));return e};
f.prototype.catch=function(d){return this.then(void 0,d)};f.prototype.callWhenSettled_=function(d,f){function c(){switch(a.state_){case 1:d(a.result_);break;case 2:f(a.result_);break;default:throw Error("Unexpected state: "+a.state_);}}var a=this;null==this.onSettledCallbacks_?h.asyncExecute(c):this.onSettledCallbacks_.push(c)};f.resolve=g;f.reject=function(d){return new f(function(f,c){c(d)})};f.race=function(d){return new f(function(f,c){for(var a=$jscomp.makeIterator(d),b=a.next();!b.done;b=a.next())g(b.value).callWhenSettled_(f,
c)})};f.all=function(d){var h=$jscomp.makeIterator(d),c=h.next();return c.done?g([]):new f(function(a,b){function e(b){return function(e){d[b]=e;f--;0==f&&a(d)}}var d=[],f=0;do d.push(void 0),f++,g(c.value).callWhenSettled_(e(d.length-1),b),c=h.next();while(!c.done)})};return f},"es6","es3");
(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"+Ky4":function(k,l,g){var m=g("oYeq"),f=g("YKqZ");(function(){function h(d,f){void 0===f&&(f=null);if(!h.IsSupported(d))throw"Your browser does not support recording so far.";d=d.getRenderingCanvas();if(!d)throw"The babylon engine must have a canvas to be recorded";this._canvas=d;this._canvas.isRecording=!1;this._options=Object(m.a)(Object(m.a)({},h._defaultOptions),f);f=this._canvas.captureStream(this._options.fps);if(this._options.audioTracks){d=
0;for(var c=this._options.audioTracks;d<c.length;d++)f.addTrack(c[d])}this._mediaRecorder=new MediaRecorder(f,{mimeType:this._options.mimeType});this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this);this._mediaRecorder.onerror=this._handleError.bind(this);this._mediaRecorder.onstop=this._handleStop.bind(this)}h.IsSupported=function(d){d=d.getRenderingCanvas();return!!d&&"function"===typeof d.captureStream};Object.defineProperty(h.prototype,"isRecording",{get:function(){return!!this._canvas&&
this._canvas.isRecording},enumerable:!1,configurable:!0});h.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())};h.prototype.startRecording=function(d,f){var c=this;void 0===d&&(d="babylonjs.webm");void 0===f&&(f=7);if(!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";0<f&&setTimeout(function(){c.stopRecording()},1E3*f);this._fileName=
d;this._recordedChunks=[];this._reject=this._resolve=null;this._canvas.isRecording=!0;this._mediaRecorder.start(this._options.recordChunckSize);return new Promise(function(a,b){c._resolve=a;c._reject=b})};h.prototype.dispose=function(){this._mediaRecorder=this._canvas=null;this._recordedChunks=[];this._reject=this._resolve=this._fileName=null};h.prototype._handleDataAvailable=function(d){0<d.data.size&&this._recordedChunks.push(d.data)};h.prototype._handleError=function(d){this.stopRecording();if(this._reject)this._reject(d.error);
else throw new d.error;};h.prototype._handleStop=function(){this.stopRecording();var d=new Blob(this._recordedChunks);this._resolve&&this._resolve(d);window.URL.createObjectURL(d);this._fileName&&f.b.Download(d,this._fileName)};h._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3E3};return h})()},"/AUW":function(k,l,g){g.d(l,"a",function(){return d});g.d(l,"b",function(){return n});var m=g("oYeq"),f=g("/SR9"),h=g("ywfU"),d;(function(c){c[c.X=0]="X";c[c.Y=1]="Y";c[c.Z=2]="Z"})(d||(d=
{}));var n=function(){function c(a,b){var e=this;b=Object(m.a)(Object(m.a)({},c._GetDefaultOptions()),b);this._leftJoystick=a?!0:!1;c._globalJoystickIndex++;this._axisTargetedByLeftAndRight=d.X;this._axisTargetedByUpAndDown=d.Y;this.reverseUpDown=this.reverseLeftRight=!1;this._touches=new h.a;this.deltaPosition=f.e.Zero();this._joystickSensibility=25;this._inversedSensibility=1/(this._joystickSensibility/1E3);this._onResize=function(b){c.vjCanvasWidth=window.innerWidth;c.vjCanvasHeight=window.innerHeight;
c.Canvas&&(c.Canvas.width=c.vjCanvasWidth,c.Canvas.height=c.vjCanvasHeight);c.halfWidth=c.vjCanvasWidth/2};if(!c.Canvas){window.addEventListener("resize",this._onResize,!1);c.Canvas=document.createElement("canvas");c.vjCanvasWidth=window.innerWidth;c.vjCanvasHeight=window.innerHeight;c.Canvas.width=window.innerWidth;c.Canvas.height=window.innerHeight;c.Canvas.style.width="100%";c.Canvas.style.height="100%";c.Canvas.style.position="absolute";c.Canvas.style.backgroundColor="transparent";c.Canvas.style.top=
"0px";c.Canvas.style.left="0px";c.Canvas.style.zIndex="5";c.Canvas.style.msTouchAction="none";c.Canvas.style.touchAction="none";c.Canvas.setAttribute("touch-action","none");a=c.Canvas.getContext("2d");if(!a)throw Error("Unable to create canvas for virtual joystick");c.vjCanvasContext=a;c.vjCanvasContext.strokeStyle="#ffffff";c.vjCanvasContext.lineWidth=2;document.body.appendChild(c.Canvas)}c.halfWidth=c.Canvas.width/2;this.pressed=!1;this.limitToContainer=b.limitToContainer;this._joystickColor=b.color;
this.containerSize=b.containerSize;this.puckSize=b.puckSize;b.position&&this.setPosition(b.position.x,b.position.y);b.puckImage&&this.setPuckImage(b.puckImage);b.containerImage&&this.setContainerImage(b.containerImage);b.alwaysVisible&&c._alwaysVisibleSticks++;this.alwaysVisible=b.alwaysVisible;this._joystickPointerID=-1;this._joystickPointerPos=new f.d(0,0);this._joystickPreviousPointerPos=new f.d(0,0);this._joystickPointerStartPos=new f.d(0,0);this._deltaJoystickVector=new f.d(0,0);this._onPointerDownHandlerRef=
function(b){e._onPointerDown(b)};this._onPointerMoveHandlerRef=function(b){e._onPointerMove(b)};this._onPointerUpHandlerRef=function(b){e._onPointerUp(b)};c.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1);c.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1);c.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1);c.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1);c.Canvas.addEventListener("contextmenu",function(b){b.preventDefault()},
!1);requestAnimationFrame(function(){e._drawVirtualJoystick()})}c._GetDefaultOptions=function(){return{puckSize:40,containerSize:60,color:"cyan",puckImage:void 0,containerImage:void 0,position:void 0,alwaysVisible:!1,limitToContainer:!1}};c.prototype.setJoystickSensibility=function(a){this._joystickSensibility=a;this._inversedSensibility=1/(this._joystickSensibility/1E3)};c.prototype._onPointerDown=function(a){a.preventDefault();(!0===this._leftJoystick?a.clientX<c.halfWidth:a.clientX>c.halfWidth)&&
0>this._joystickPointerID?(this._joystickPointerID=a.pointerId,this._joystickPosition?(this._joystickPointerStartPos=this._joystickPosition.clone(),this._joystickPointerPos=this._joystickPosition.clone(),this._joystickPreviousPointerPos=this._joystickPosition.clone(),this._onPointerMove(a)):(this._joystickPointerStartPos.x=a.clientX,this._joystickPointerStartPos.y=a.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone()),
this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(a.pointerId.toString(),a)):2>c._globalJoystickIndex&&this._action&&(this._action(),this._touches.add(a.pointerId.toString(),{x:a.clientX,y:a.clientY,prevX:a.clientX,prevY:a.clientY}))};c.prototype._onPointerMove=function(a){if(this._joystickPointerID==a.pointerId){if(this.limitToContainer){a=new f.d(a.clientX-this._joystickPointerStartPos.x,a.clientY-this._joystickPointerStartPos.y);var b=a.length();b>this.containerSize&&
a.scaleInPlace(this.containerSize/b);this._joystickPointerPos.x=this._joystickPointerStartPos.x+a.x;this._joystickPointerPos.y=this._joystickPointerStartPos.y+a.y}else this._joystickPointerPos.x=a.clientX,this._joystickPointerPos.y=a.clientY;this._deltaJoystickVector=this._joystickPointerPos.clone();this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);0<c._alwaysVisibleSticks&&(this._joystickPointerPos.x=this._leftJoystick?Math.min(c.halfWidth,this._joystickPointerPos.x):
Math.max(c.halfWidth,this._joystickPointerPos.x));a=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case d.X:this.deltaPosition.x=Math.min(1,Math.max(-1,a));break;case d.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,a));break;case d.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,a))}a=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case d.X:this.deltaPosition.x=
Math.min(1,Math.max(-1,a));break;case d.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,a));break;case d.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,a))}}else if(b=this._touches.get(a.pointerId.toString()))b.x=a.clientX,b.y=a.clientY};c.prototype._onPointerUp=function(a){if(this._joystickPointerID==a.pointerId)this._clearPreviousDraw(),this._joystickPointerID=-1,this.pressed=!1;else{var b=this._touches.get(a.pointerId.toString());b&&c.vjCanvasContext.clearRect(b.prevX-44,b.prevY-44,88,88)}this._deltaJoystickVector.x=
0;this._deltaJoystickVector.y=0;this._touches.remove(a.pointerId.toString())};c.prototype.setJoystickColor=function(a){this._joystickColor=a};Object.defineProperty(c.prototype,"containerSize",{get:function(){return this._joystickContainerSize},set:function(a){this._joystickContainerSize=a;this._clearContainerSize=~~(2.1*this._joystickContainerSize);this._clearContainerSizeOffset=~~(this._clearContainerSize/2)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"puckSize",{get:function(){return this._joystickPuckSize},
set:function(a){this._joystickPuckSize=a;this._clearPuckSize=~~(2.1*this._joystickPuckSize);this._clearPuckSizeOffset=~~(this._clearPuckSize/2)},enumerable:!1,configurable:!0});c.prototype.clearPosition=function(){this.alwaysVisible=!1;this._joystickPosition=null};Object.defineProperty(c.prototype,"alwaysVisible",{get:function(){return this._alwaysVisible},set:function(a){this._alwaysVisible!==a&&(a&&this._joystickPosition?(c._alwaysVisibleSticks++,this._alwaysVisible=!0):(c._alwaysVisibleSticks--,
this._alwaysVisible=!1))},enumerable:!1,configurable:!0});c.prototype.setPosition=function(a,b){this._joystickPointerStartPos&&this._clearPreviousDraw();this._joystickPosition=new f.d(a,b)};c.prototype.setActionOnTouch=function(a){this._action=a};c.prototype.setAxisForLeftRight=function(a){switch(a){case d.X:case d.Y:case d.Z:this._axisTargetedByLeftAndRight=a;break;default:this._axisTargetedByLeftAndRight=d.X}};c.prototype.setAxisForUpDown=function(a){switch(a){case d.X:case d.Y:case d.Z:this._axisTargetedByUpAndDown=
a;break;default:this._axisTargetedByUpAndDown=d.Y}};c.prototype._clearPreviousDraw=function(){var a=this._joystickPosition||this._joystickPointerStartPos;c.vjCanvasContext.clearRect(a.x-this._clearContainerSizeOffset,a.y-this._clearContainerSizeOffset,this._clearContainerSize,this._clearContainerSize);c.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-this._clearPuckSizeOffset,this._joystickPreviousPointerPos.y-this._clearPuckSizeOffset,this._clearPuckSize,this._clearPuckSize)};c.prototype.setContainerImage=
function(a){var b=this,e=new Image;e.src=a;e.onload=function(){return b._containerImage=e}};c.prototype.setPuckImage=function(a){var b=this,e=new Image;e.src=a;e.onload=function(){return b._puckImage=e}};c.prototype._drawContainer=function(){var a=this._joystickPosition||this._joystickPointerStartPos;this._clearPreviousDraw();this._containerImage?c.vjCanvasContext.drawImage(this._containerImage,a.x-this.containerSize,a.y-this.containerSize,2*this.containerSize,2*this.containerSize):(c.vjCanvasContext.beginPath(),
c.vjCanvasContext.strokeStyle=this._joystickColor,c.vjCanvasContext.lineWidth=2,c.vjCanvasContext.arc(a.x,a.y,this.containerSize,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),c.vjCanvasContext.beginPath(),c.vjCanvasContext.lineWidth=6,c.vjCanvasContext.strokeStyle=this._joystickColor,c.vjCanvasContext.arc(a.x,a.y,this.puckSize,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath())};c.prototype._drawPuck=function(){this._puckImage?c.vjCanvasContext.drawImage(this._puckImage,
this._joystickPointerPos.x-this.puckSize,this._joystickPointerPos.y-this.puckSize,2*this.puckSize,2*this.puckSize):(c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle=this._joystickColor,c.vjCanvasContext.lineWidth=2,c.vjCanvasContext.arc(this._joystickPointerPos.x,this._joystickPointerPos.y,this.puckSize,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath())};c.prototype._drawVirtualJoystick=function(){var a=this;this.alwaysVisible&&this._drawContainer();this.pressed&&
this._touches.forEach(function(b,e){e.pointerId===a._joystickPointerID?(a.alwaysVisible||a._drawContainer(),a._drawPuck(),a._joystickPreviousPointerPos=a._joystickPointerPos.clone()):(c.vjCanvasContext.clearRect(e.prevX-44,e.prevY-44,88,88),c.vjCanvasContext.beginPath(),c.vjCanvasContext.fillStyle="white",c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle="red",c.vjCanvasContext.lineWidth=6,c.vjCanvasContext.arc(e.x,e.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),
e.prevX=e.x,e.prevY=e.y)});requestAnimationFrame(function(){a._drawVirtualJoystick()})};c.prototype.releaseCanvas=function(){c.Canvas&&(c.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),c.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),c.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),c.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(c.Canvas),
c.Canvas=null)};c._globalJoystickIndex=0;c._alwaysVisibleSticks=0;return c}()},"1t4k":function(k,l,g){g.d(l,"a",function(){return n});var m=g("Bfey"),f=g("uyO6"),h=g("e2Mr"),d=g("YSg2"),n=function(){function c(a){void 0===a&&(a=null);this._targets=[];this._targetInfluenceChangedObservers=[];this._targetDataLayoutChangedObservers=[];this._activeTargets=new m.a(16);this._supportsUVs=this._supportsTangents=this._supportsNormals=!1;this._uniqueId=this._vertexCount=0;this._tempInfluences=[];this.enableUVMorphing=
this.enableTangentMorphing=this.enableNormalMorphing=!0;a||(a=h.a.LastCreatedScene);if(this._scene=a)this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId()}Object.defineProperty(c.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&
this.enableNormalMorphing},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"influences",{get:function(){return this._influences},enumerable:!1,configurable:!0});c.prototype.getActiveTarget=function(a){return this._activeTargets.data[a]};c.prototype.getTarget=function(a){return this._targets[a]};c.prototype.addTarget=function(a){var b=this;this._targets.push(a);this._targetInfluenceChangedObservers.push(a.onInfluenceChanged.add(function(e){b._syncActiveTargets(e)}));
this._targetDataLayoutChangedObservers.push(a._onDataLayoutChanged.add(function(){b._syncActiveTargets(!0)}));this._syncActiveTargets(!0)};c.prototype.removeTarget=function(a){var b=this._targets.indexOf(a);0<=b&&(this._targets.splice(b,1),a.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),a._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._syncActiveTargets(!0))};c.prototype.clone=function(){for(var a=new c(this._scene),b=0,e=
this._targets;b<e.length;b++)a.addTarget(e[b].clone());a.enableNormalMorphing=this.enableNormalMorphing;a.enableTangentMorphing=this.enableTangentMorphing;a.enableUVMorphing=this.enableUVMorphing;return a};c.prototype.serialize=function(){var a={};a.id=this.uniqueId;a.targets=[];for(var b=0,e=this._targets;b<e.length;b++)a.targets.push(e[b].serialize());return a};c.prototype._syncActiveTargets=function(a){var b=0;this._activeTargets.reset();this._supportsUVs=this._supportsTangents=this._supportsNormals=
!0;for(var e=this._vertexCount=0,c=this._targets;e<c.length;e++){var d=c[e];if(0!==d.influence&&(this._activeTargets.push(d),this._tempInfluences[b++]=d.influence,this._supportsNormals=this._supportsNormals&&d.hasNormals,this._supportsTangents=this._supportsTangents&&d.hasTangents,this._supportsUVs=this._supportsUVs&&d.hasUVs,d=d.getPositions()))if(d=d.length/3,0===this._vertexCount)this._vertexCount=d;else if(this._vertexCount!==d){f.a.Error("Incompatible target. Targets must all have the same vertices count.");
return}}this._influences&&this._influences.length===b||(this._influences=new Float32Array(b));for(e=0;e<b;e++)this._influences[e]=this._tempInfluences[e];a&&this.synchronize()};c.prototype.synchronize=function(){if(this._scene)for(var a=0,b=this._scene.meshes;a<b.length;a++){var e=b[a];e.morphTargetManager===this&&e._syncGeometryWithMorphTargetManager()}};c.Parse=function(a,b){b=new c(b);b._uniqueId=a.id;var e=0;for(a=a.targets;e<a.length;e++)b.addTarget(d.a.Parse(a[e]));return b};return c}()},Gsbi:function(k,
l,g){g("YSg2");g("1t4k")},Hy5V:function(k,l,g){g.d(l,"a",function(){return m});var m=function(){function f(){}Object.defineProperty(f,"UniqueId",{get:function(){var f=this._UniqueIdCounter;this._UniqueIdCounter++;return f},enumerable:!1,configurable:!0});f._UniqueIdCounter=0;return f}()},INEg:function(k,l,g){var m=g("uyO6"),f=g("UtUh"),h=g("wAMR"),d=g("GR64"),n=g("y4Ty");(function(){function a(b){void 0===b&&(b=Recast);this.bjsRECAST={};this.name="RecastJSPlugin";this._maximumSubStepCount=10;this._timeStep=
1/60;"function"===typeof b?b(this.bjsRECAST):this.bjsRECAST=b;this.isSupported()?this.setTimeStep():m.a.Error("RecastJS is not available. Please make sure you included the js file.")}a.prototype.setTimeStep=function(b){void 0===b&&(b=1/60);this._timeStep=b};a.prototype.getTimeStep=function(){return this._timeStep};a.prototype.setMaximumSubStepCount=function(b){void 0===b&&(b=10);this._maximumSubStepCount=b};a.prototype.getMaximumSubStepCount=function(){return this._maximumSubStepCount};a.prototype.createNavMesh=
function(b,e){var a=new this.bjsRECAST.rcConfig;a.cs=e.cs;a.ch=e.ch;a.borderSize=0;a.tileSize=0;a.walkableSlopeAngle=e.walkableSlopeAngle;a.walkableHeight=e.walkableHeight;a.walkableClimb=e.walkableClimb;a.walkableRadius=e.walkableRadius;a.maxEdgeLen=e.maxEdgeLen;a.maxSimplificationError=e.maxSimplificationError;a.minRegionArea=e.minRegionArea;a.mergeRegionArea=e.mergeRegionArea;a.maxVertsPerPoly=e.maxVertsPerPoly;a.detailSampleDist=e.detailSampleDist;a.detailSampleMaxError=e.detailSampleMaxError;
this.navMesh=new this.bjsRECAST.NavMesh;var c,f,h=[],g=[],k=0;for(e=0;e<b.length;e++)if(b[e]){var l=b[e];if(f=l.getIndices()){var m=l.getVerticesData(n.b.PositionKind,!1,!1);if(m){l=l.computeWorldMatrix(!0);for(c=0;c<f.length;c++)h.push(f[c]+k);c=d.j.Zero();var q=d.j.Zero();for(f=0;f<m.length;f+=3)d.j.FromArrayToRef(m,f,q),d.j.TransformCoordinatesToRef(q,l,c),g.push(c.x,c.y,c.z);k+=m.length/3}}}this.navMesh.build(g,k,h,h.length,a)};a.prototype.createDebugNavMesh=function(b){var e,a,c=this.navMesh.getDebugNavMesh(),
d=c.getTriangleCount(),g=[],k=[];for(e=0;e<3*d;e++)g.push(e);for(e=0;e<d;e++)for(a=0;3>a;a++){var l=c.getTriangle(e).getPoint(a);k.push(l.x,l.y,l.z)}b=new h.a("NavMeshDebug",b);e=new f.a;e.indices=g;e.positions=k;e.applyToMesh(b,!1);return b};a.prototype.getClosestPoint=function(b){b=new this.bjsRECAST.Vec3(b.x,b.y,b.z);b=this.navMesh.getClosestPoint(b);return new d.j(b.x,b.y,b.z)};a.prototype.getClosestPointToRef=function(b,e){b=new this.bjsRECAST.Vec3(b.x,b.y,b.z);b=this.navMesh.getClosestPoint(b);
e.set(b.x,b.y,b.z)};a.prototype.getRandomPointAround=function(b,e){b=new this.bjsRECAST.Vec3(b.x,b.y,b.z);e=this.navMesh.getRandomPointAround(b,e);return new d.j(e.x,e.y,e.z)};a.prototype.getRandomPointAroundToRef=function(b,e,a){b=new this.bjsRECAST.Vec3(b.x,b.y,b.z);e=this.navMesh.getRandomPointAround(b,e);a.set(e.x,e.y,e.z)};a.prototype.moveAlong=function(b,e){b=new this.bjsRECAST.Vec3(b.x,b.y,b.z);e=new this.bjsRECAST.Vec3(e.x,e.y,e.z);e=this.navMesh.moveAlong(b,e);return new d.j(e.x,e.y,e.z)};
a.prototype.moveAlongToRef=function(b,e,a){b=new this.bjsRECAST.Vec3(b.x,b.y,b.z);e=new this.bjsRECAST.Vec3(e.x,e.y,e.z);e=this.navMesh.moveAlong(b,e);a.set(e.x,e.y,e.z)};a.prototype.computePath=function(b,e){b=new this.bjsRECAST.Vec3(b.x,b.y,b.z);e=new this.bjsRECAST.Vec3(e.x,e.y,e.z);b=this.navMesh.computePath(b,e);var a=b.getPointCount(),c=[];for(e=0;e<a;e++){var f=b.getPoint(e);c.push(new d.j(f.x,f.y,f.z))}return c};a.prototype.createCrowd=function(b,e,a){return new c(this,b,e,a)};a.prototype.setDefaultQueryExtent=
function(b){b=new this.bjsRECAST.Vec3(b.x,b.y,b.z);this.navMesh.setDefaultQueryExtent(b)};a.prototype.getDefaultQueryExtent=function(){var b=this.navMesh.getDefaultQueryExtent();return new d.j(b.x,b.y,b.z)};a.prototype.buildFromNavmeshData=function(b){var e=b.length*b.BYTES_PER_ELEMENT,a=this.bjsRECAST._malloc(e);e=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,a,e);e.set(b);a=new this.bjsRECAST.NavmeshData;a.dataPointer=e.byteOffset;a.size=b.length;this.navMesh=new this.bjsRECAST.NavMesh;this.navMesh.buildFromNavmeshData(a);
this.bjsRECAST._free(e.byteOffset)};a.prototype.getNavmeshData=function(){var b=this.navMesh.getNavmeshData(),a=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,b.dataPointer,b.size),c=new Uint8Array(b.size);c.set(a);this.navMesh.freeNavmeshData(b);return c};a.prototype.getDefaultQueryExtentToRef=function(b){var a=this.navMesh.getDefaultQueryExtent();b.set(a.x,a.y,a.z)};a.prototype.dispose=function(){};a.prototype.isSupported=function(){return void 0!==this.bjsRECAST};return a})();var c=function(){function a(b,
a,c,d){var e=this;this.recastCrowd={};this.transforms=[];this.agents=[];this._onBeforeAnimationsObserver=null;this.bjsRECASTPlugin=b;this.recastCrowd=new this.bjsRECASTPlugin.bjsRECAST.Crowd(a,c,this.bjsRECASTPlugin.navMesh.getNavMesh());this._scene=d;this._onBeforeAnimationsObserver=d.onBeforeAnimationsObservable.add(function(){e.update(.001*d.getEngine().getDeltaTime())})}a.prototype.addAgent=function(b,a,c){var e=new this.bjsRECASTPlugin.bjsRECAST.dtCrowdAgentParams;e.radius=a.radius;e.height=
a.height;e.maxAcceleration=a.maxAcceleration;e.maxSpeed=a.maxSpeed;e.collisionQueryRange=a.collisionQueryRange;e.pathOptimizationRange=a.pathOptimizationRange;e.separationWeight=a.separationWeight;e.updateFlags=7;e.obstacleAvoidanceType=0;e.queryFilterType=0;e.userData=0;b=this.recastCrowd.addAgent(new this.bjsRECASTPlugin.bjsRECAST.Vec3(b.x,b.y,b.z),e);this.transforms.push(c);this.agents.push(b);return b};a.prototype.getAgentPosition=function(b){b=this.recastCrowd.getAgentPosition(b);return new d.j(b.x,
b.y,b.z)};a.prototype.getAgentPositionToRef=function(b,a){b=this.recastCrowd.getAgentPosition(b);a.set(b.x,b.y,b.z)};a.prototype.getAgentVelocity=function(b){b=this.recastCrowd.getAgentVelocity(b);return new d.j(b.x,b.y,b.z)};a.prototype.getAgentVelocityToRef=function(b,a){b=this.recastCrowd.getAgentVelocity(b);a.set(b.x,b.y,b.z)};a.prototype.getAgentNextTargetPath=function(b){b=this.recastCrowd.getAgentNextTargetPath(b);return new d.j(b.x,b.y,b.z)};a.prototype.getAgentNextTargetPathToRef=function(b,
a){b=this.recastCrowd.getAgentNextTargetPath(b);a.set(b.x,b.y,b.z)};a.prototype.getAgentState=function(b){return this.recastCrowd.getAgentState(b)};a.prototype.overOffmeshConnection=function(b){return this.recastCrowd.overOffmeshConnection(b)};a.prototype.agentGoto=function(b,a){this.recastCrowd.agentGoto(b,new this.bjsRECASTPlugin.bjsRECAST.Vec3(a.x,a.y,a.z))};a.prototype.agentTeleport=function(b,a){this.recastCrowd.agentTeleport(b,new this.bjsRECASTPlugin.bjsRECAST.Vec3(a.x,a.y,a.z))};a.prototype.updateAgentParameters=
function(b,a){var e=this.recastCrowd.getAgentParameters(b);void 0!==a.radius&&(e.radius=a.radius);void 0!==a.height&&(e.height=a.height);void 0!==a.maxAcceleration&&(e.maxAcceleration=a.maxAcceleration);void 0!==a.maxSpeed&&(e.maxSpeed=a.maxSpeed);void 0!==a.collisionQueryRange&&(e.collisionQueryRange=a.collisionQueryRange);void 0!==a.pathOptimizationRange&&(e.pathOptimizationRange=a.pathOptimizationRange);void 0!==a.separationWeight&&(e.separationWeight=a.separationWeight);this.recastCrowd.setAgentParameters(b,
e)};a.prototype.removeAgent=function(b){this.recastCrowd.removeAgent(b);b=this.agents.indexOf(b);-1<b&&(this.agents.splice(b,1),this.transforms.splice(b,1))};a.prototype.getAgents=function(){return this.agents};a.prototype.update=function(b){var a=this.bjsRECASTPlugin.getTimeStep(),c=this.bjsRECASTPlugin.getMaximumSubStepCount();if(a<=d.d)this.recastCrowd.update(b);else for(b/=a,c&&b>c&&(b=c),1>b&&(b=1),c=0;c<b;c++)this.recastCrowd.update(a);for(a=0;a<this.agents.length;a++)this.transforms[a].position=
this.getAgentPosition(this.agents[a])};a.prototype.setDefaultQueryExtent=function(b){b=new this.bjsRECASTPlugin.bjsRECAST.Vec3(b.x,b.y,b.z);this.recastCrowd.setDefaultQueryExtent(b)};a.prototype.getDefaultQueryExtent=function(){var b=this.recastCrowd.getDefaultQueryExtent();return new d.j(b.x,b.y,b.z)};a.prototype.getDefaultQueryExtentToRef=function(b){var a=this.recastCrowd.getDefaultQueryExtent();b.set(a.x,a.y,a.z)};a.prototype.dispose=function(){this.recastCrowd.destroy();this._scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver);
this._onBeforeAnimationsObserver=null};return a}()},Ksm9:function(k,l,g){g.d(l,"a",function(){return m});var m=function(){function f(){var f="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest;this._xhr=f}f.prototype._injectCustomRequestHeaders=function(){for(var h in f.CustomRequestHeaders){var d=f.CustomRequestHeaders[h];d&&this._xhr.setRequestHeader(h,d)}};Object.defineProperty(f.prototype,"onprogress",{get:function(){return this._xhr.onprogress},
set:function(f){this._xhr.onprogress=f},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"response",{get:function(){return this._xhr.response},
enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(f){this._xhr.responseType=f},enumerable:!1,configurable:!0});f.prototype.addEventListener=function(f,d,g){this._xhr.addEventListener(f,
d,g)};f.prototype.removeEventListener=function(f,d,g){this._xhr.removeEventListener(f,d,g)};f.prototype.abort=function(){this._xhr.abort()};f.prototype.send=function(g){f.CustomRequestHeaders&&this._injectCustomRequestHeaders();this._xhr.send(g)};f.prototype.open=function(g,d){for(var h=0,c=f.CustomRequestModifiers;h<c.length;h++)(0,c[h])(this._xhr,d);d=d.replace("file:http:","http:");d=d.replace("file:https:","https:");return this._xhr.open(g,d,!0)};f.prototype.setRequestHeader=function(f,d){this._xhr.setRequestHeader(f,
d)};f.prototype.getResponseHeader=function(f){return this._xhr.getResponseHeader(f)};f.CustomRequestHeaders={};f.CustomRequestModifiers=[];return f}()},YSg2:function(k,l,g){g.d(l,"a",function(){return a});var m=g("oYeq"),f=g("ps+7"),h=g("e2Mr"),d=g("y4Ty"),n=g("ADVu"),c=g("WHS4"),a=function(){function b(b,a,c){void 0===a&&(a=0);void 0===c&&(c=null);this.name=b;this.animations=[];this._uvs=this._tangents=this._normals=this._positions=null;this._uniqueId=0;this.onInfluenceChanged=new f.a;this._onDataLayoutChanged=
new f.a;this._animationPropertiesOverride=null;this._scene=c||h.a.LastCreatedScene;this.influence=a;this._scene&&(this._uniqueId=this._scene.getUniqueId())}Object.defineProperty(b.prototype,"influence",{get:function(){return this._influence},set:function(b){if(this._influence!==b){var a=this._influence;this._influence=b;this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===a||0===b)}},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"animationPropertiesOverride",
{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(b){this._animationPropertiesOverride=b},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"hasNormals",{get:function(){return!!this._normals},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!1,configurable:!0});b.prototype.setPositions=function(b){var a=this.hasPositions;this._positions=b;a!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)};b.prototype.getPositions=function(){return this._positions};
b.prototype.setNormals=function(b){var a=this.hasNormals;this._normals=b;a!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)};b.prototype.getNormals=function(){return this._normals};b.prototype.setTangents=function(b){var a=this.hasTangents;this._tangents=b;a!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)};b.prototype.getTangents=function(){return this._tangents};b.prototype.setUVs=function(b){var a=this.hasUVs;this._uvs=b;a!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)};
b.prototype.getUVs=function(){return this._uvs};b.prototype.clone=function(){var a=this,c=n.a.Clone(function(){return new b(a.name,a.influence,a._scene)},this);c._positions=this._positions;c._normals=this._normals;c._tangents=this._tangents;c._uvs=this._uvs;return c};b.prototype.serialize=function(){var b={};b.name=this.name;b.influence=this.influence;b.positions=Array.prototype.slice.call(this.getPositions());null!=this.id&&(b.id=this.id);this.hasNormals&&(b.normals=Array.prototype.slice.call(this.getNormals()));
this.hasTangents&&(b.tangents=Array.prototype.slice.call(this.getTangents()));this.hasUVs&&(b.uvs=Array.prototype.slice.call(this.getUVs()));n.a.AppendSerializedAnimations(this,b);return b};b.prototype.getClassName=function(){return"MorphTarget"};b.Parse=function(a){var e=new b(a.name,a.influence);e.setPositions(a.positions);null!=a.id&&(e.id=a.id);a.normals&&e.setNormals(a.normals);a.tangents&&e.setTangents(a.tangents);a.uvs&&e.setUVs(a.uvs);if(a.animations)for(var d=0;d<a.animations.length;d++){var f=
a.animations[d],g=c.a.GetClass("BABYLON.Animation");g&&e.animations.push(g.Parse(f))}return e};b.FromMesh=function(a,c,f){c||(c=a.name);c=new b(c,f,a.getScene());c.setPositions(a.getVerticesData(d.b.PositionKind));a.isVerticesDataPresent(d.b.NormalKind)&&c.setNormals(a.getVerticesData(d.b.NormalKind));a.isVerticesDataPresent(d.b.TangentKind)&&c.setTangents(a.getVerticesData(d.b.TangentKind));a.isVerticesDataPresent(d.b.UVKind)&&c.setUVs(a.getVerticesData(d.b.UVKind));return c};Object(m.c)([Object(n.c)()],
b.prototype,"id",void 0);return b}()},p5Tv:function(k,l,g){g.d(l,"a",function(){return n});var m=g("YKqZ"),f=g("uyO6"),h=g("Pro5");k=g("qUIE");var d=g("Ksm9");k.a.OfflineProviderFactory=function(c,a,b){void 0===b&&(b=!1);return new n(c,a,b)};var n=function(){function c(a,b,e){var d=this;void 0===e&&(e=!1);this._idbFactory="undefined"!==typeof window?window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB:indexedDB;this._callbackManifestChecked=b;this._currentSceneUrl=c._ReturnFullUrlLocation(a);
this._db=null;this._enableTexturesOffline=this._enableSceneOffline=!1;this._manifestVersionFound=0;this._hasReachedQuota=this._mustUpdateRessources=!1;c.IDBStorageEnabled?e?(this._enableTexturesOffline=this._enableSceneOffline=!0,this._manifestVersionFound=1,m.b.SetImmediate(function(){d._callbackManifestChecked(!0)})):this._checkManifestFile():this._callbackManifestChecked(!0)}Object.defineProperty(c.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!1,configurable:!0});c.prototype._checkManifestFile=function(){var a=this,b=function(){a._enableSceneOffline=!1;a._enableTexturesOffline=!1;a._callbackManifestChecked(!1)},e=!1,g=this._currentSceneUrl+".manifest",h=new d.a;navigator.onLine&&(e=!0,g=g+(null==g.match(/\?/)?"?":"&")+Date.now());h.open("GET",g);h.addEventListener("load",function(){if(200===h.status||c._ValidateXHRData(h,
1))try{var e=JSON.parse(h.response);a._enableSceneOffline=e.enableSceneOffline;a._enableTexturesOffline=e.enableTexturesOffline&&c.IsUASupportingBlobStorage;e.version&&!isNaN(parseInt(e.version))&&(a._manifestVersionFound=e.version);a._callbackManifestChecked&&a._callbackManifestChecked(!0)}catch(p){b()}else b()},!1);h.addEventListener("error",function(){e?(e=!1,h.open("GET",a._currentSceneUrl+".manifest"),h.send()):b()},!1);try{h.send()}catch(w){f.a.Error("Error on XHR send request."),this._callbackManifestChecked(!1)}};
c.prototype.open=function(a,b){var c=this,d=function(){c._isSupported=!1;b&&b()};if(this._idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this._db)a&&a();else{this._hasReachedQuota=!1;this._isSupported=!0;var g=this._idbFactory.open("babylonjs",1);g.onerror=function(){d()};g.onblocked=function(){f.a.Error("IDB request blocked. Please reload the page.");d()};g.onsuccess=function(){c._db=g.result;a()};g.onupgradeneeded=function(a){c._db=a.target.result;if(c._db)try{c._db.createObjectStore("scenes",
{keyPath:"sceneUrl"}),c._db.createObjectStore("versions",{keyPath:"sceneUrl"}),c._db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(p){f.a.Error("Error while creating object stores. Exception: "+p.message),d()}}}else this._isSupported=!1,b&&b()};c.prototype.loadImage=function(a,b){var e=this,d=c._ReturnFullUrlLocation(a),f=function(){e._hasReachedQuota||null===e._db?b.src=a:e._saveImageIntoDBAsync(d,b)};this._mustUpdateRessources?f():this._loadImageFromDBAsync(d,b,f)};c.prototype._loadImageFromDBAsync=
function(a,b,c){if(this._isSupported&&null!==this._db){var e,d=this._db.transaction(["textures"]);d.onabort=function(){b.src=a};d.oncomplete=function(){if(e){var d=(window.URL||window.webkitURL).createObjectURL(e.data);b.onerror=function(){f.a.Error("Error loading image from blob URL: "+d+" switching back to web url: "+a);b.src=a};b.src=d}else c()};d=d.objectStore("textures").get(a);d.onsuccess=function(a){e=a.target.result};d.onerror=function(){f.a.Error("Error loading texture "+a+" from DB.");b.src=
a}}else f.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b.src=a};c.prototype._saveImageIntoDBAsync=function(a,b){var e=this;if(this._isSupported){var g=function(){if(k){var a=window.URL||window.webkitURL;try{var c=a.createObjectURL(k)}catch(t){c=a.createObjectURL(k)}}c&&(b.src=c)};if(c.IsUASupportingBlobStorage){var h=new d.a,k;h.open("GET",a);h.responseType="blob";h.addEventListener("load",function(){if(200===h.status&&e._db){k=h.response;var d=e._db.transaction(["textures"],
"readwrite");d.onabort=function(a){try{var b=(a.srcElement||a.target).error;b&&"QuotaExceededError"===b.name&&(e._hasReachedQuota=!0)}catch(q){}g()};d.oncomplete=function(){g()};var f={textureUrl:a,data:k};try{var l=d.objectStore("textures").put(f);l.onsuccess=function(){};l.onerror=function(){g()}}catch(u){25===u.code&&(c.IsUASupportingBlobStorage=!1,e._enableTexturesOffline=!1),b.src=a}}else b.src=a},!1);h.addEventListener("error",function(){f.a.Error("Error in XHR request in BABYLON.Database.");
b.src=a},!1);h.send()}else b.src=a}else f.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),b.src=a};c.prototype._checkVersionFromDB=function(a,b){var c=this;this._loadVersionFromDBAsync(a,b,function(){c._saveVersionIntoDBAsync(a,b)})};c.prototype._loadVersionFromDBAsync=function(a,b,c){var e=this;if(this._isSupported&&this._db){var d;try{var g=this._db.transaction(["versions"]);g.oncomplete=function(){d?e._manifestVersionFound!==d.data?(e._mustUpdateRessources=
!0,c()):b(d.data):(e._mustUpdateRessources=!0,c())};g.onabort=function(){b(-1)};var h=g.objectStore("versions").get(a);h.onsuccess=function(a){d=a.target.result};h.onerror=function(){f.a.Error("Error loading version for scene "+a+" from DB.");b(-1)}}catch(r){f.a.Error("Error while accessing 'versions' object store (READ OP). Exception: "+r.message),b(-1)}}else f.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),b(-1)};c.prototype._saveVersionIntoDBAsync=
function(a,b){var c=this;if(this._isSupported&&!this._hasReachedQuota&&this._db)try{var d=this._db.transaction(["versions"],"readwrite");d.onabort=function(a){try{var d=a.srcElement.error;d&&"QuotaExceededError"===d.name&&(c._hasReachedQuota=!0)}catch(t){}b(-1)};d.oncomplete=function(){b(c._manifestVersionFound)};var g={sceneUrl:a,data:this._manifestVersionFound},h=d.objectStore("versions").put(g);h.onsuccess=function(){};h.onerror=function(){f.a.Error("Error in DB add version request in BABYLON.Database.")}}catch(p){f.a.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+
p.message),b(-1)}else b(-1)};c.prototype.loadFile=function(a,b,d,f,g){var e=this,h=c._ReturnFullUrlLocation(a),k=function(){e._saveFileAsync(h,b,d,g,f)};this._checkVersionFromDB(h,function(a){-1!==a?e._mustUpdateRessources?e._saveFileAsync(h,b,d,g,f):e._loadFileAsync(h,b,k):f&&f()})};c.prototype._loadFileAsync=function(a,b,c){if(this._isSupported&&this._db){var d=-1!==a.indexOf(".babylon")?"scenes":"textures";var e,g=this._db.transaction([d]);g.oncomplete=function(){e?b(e.data):c()};g.onabort=function(){c()};
d=g.objectStore(d).get(a);d.onsuccess=function(a){e=a.target.result};d.onerror=function(){f.a.Error("Error loading file "+a+" from DB.");c()}}else f.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b()};c.prototype._saveFileAsync=function(a,b,e,g,h){var k=this;if(this._isSupported){var l=-1!==a.indexOf(".babylon")?"scenes":"textures";var m=new d.a,n;m.open("GET",a+"?"+Date.now());g&&(m.responseType="arraybuffer");e&&(m.onprogress=e);m.addEventListener("load",
function(){if(200===m.status||400>m.status&&c._ValidateXHRData(m,g?6:1))if(n=g?m.response:m.responseText,!k._hasReachedQuota&&k._db){var d=k._db.transaction([l],"readwrite");d.onabort=function(a){try{var c=a.srcElement.error;c&&"QuotaExceededError"===c.name&&(k._hasReachedQuota=!0)}catch(y){}b(n)};d.oncomplete=function(){b(n)};var e="scenes"===l?{sceneUrl:a,data:n,version:k._manifestVersionFound}:{textureUrl:a,data:n};try{var p=d.objectStore(l).put(e);p.onsuccess=function(){};p.onerror=function(){f.a.Error("Error in DB add file request in BABYLON.Database.")}}catch(x){b(n)}}else b(n);
else 400<=m.status&&h?h(m):b()},!1);m.addEventListener("error",function(){f.a.Error("error on XHR request.");b()},!1);m.send()}else f.a.Error("Error: IndexedDB not supported by your browser or Babylon.js database is not open."),b()};c._ValidateXHRData=function(a,b){void 0===b&&(b=7);try{if(b&1){if(a.responseText&&0<a.responseText.length)return!0;if(1===b)return!1}if(b&2){var c=h.a.GetTGAHeader(a.response);if(c.width&&c.height&&0<c.width&&0<c.height)return!0;if(2===b)return!1}if(b&4){var d=new Uint8Array(a.response,
0,3);if(68===d[0]&&68===d[1]&&83===d[2])return!0}}catch(v){}return!1};c.IsUASupportingBlobStorage=!0;c.IDBStorageEnabled=!1;c._ParseURL=function(a){document.createElement("a").href=a;var b=a.substring(0,a.lastIndexOf("#"));b=a.substring(b.lastIndexOf("/")+1,a.length);return a.substring(0,a.indexOf(b,0))};c._ReturnFullUrlLocation=function(a){return-1===a.indexOf("http:/")&&-1===a.indexOf("https:/")&&"undefined"!==typeof window?c._ParseURL(window.location.href)+a:a};return c}()},yiEH:function(k,l,g){g.d(l,
"a",function(){return m});var m=function(){function f(f){this._pendingActions=[];this._workerInfos=f.map(function(d){return{worker:d,active:!1}})}f.prototype.dispose=function(){for(var f=0,d=this._workerInfos;f<d.length;f++)d[f].worker.terminate();this._workerInfos=[];this._pendingActions=[]};f.prototype.push=function(f){for(var d=0,g=this._workerInfos;d<g.length;d++){var c=g[d];if(!c.active){this._execute(c,f);return}}this._pendingActions.push(f)};f.prototype._execute=function(f,d){var g=this;f.active=
!0;d(f.worker,function(){f.active=!1;var c=g._pendingActions.shift();c&&g._execute(f,c)})};return f}()}}]);
