var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(g){var m=0;return function(){return m<g.length?{done:!1,value:g[m++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.makeIterator=function(g){var m="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];return m?m.call(g):$jscomp.arrayIterator(g)};
$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,m,k){g!=Array.prototype&&g!=Object.prototype&&(g[m]=k.value)};
$jscomp.polyfill=function(g,m,k,l){if(m){k=$jscomp.global;g=g.split(".");for(l=0;l<g.length-1;l++){var d=g[l];d in k||(k[d]={});k=k[d]}g=g[g.length-1];l=k[g];m=m(l);m!=l&&null!=m&&$jscomp.defineProperty(k,g,{configurable:!0,writable:!0,value:m})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(g){function m(){this.batch_=null}function k(e){return e instanceof d?e:new d(function(a,c){a(e)})}if(g&&!$jscomp.FORCE_POLYFILL_PROMISE)return g;m.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})}this.batch_.push(e)};var l=$jscomp.global.setTimeout;m.prototype.asyncExecuteFunction=function(e){l(e,0)};m.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=
this.batch_;this.batch_=[];for(var a=0;a<e.length;++a){var c=e[a];e[a]=null;try{c()}catch(b){this.asyncThrow_(b)}}}this.batch_=null};m.prototype.asyncThrow_=function(e){this.asyncExecuteFunction(function(){throw e;})};var d=function(e){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{e(a.resolve,a.reject)}catch(c){a.reject(c)}};d.prototype.createResolveAndReject_=function(){function e(b){return function(h){c||(c=!0,b.call(a,h))}}var a=this,c=!1;
return{resolve:e(this.resolveTo_),reject:e(this.reject_)}};d.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof d)this.settleSameAsPromise_(e);else{a:switch(typeof e){case "object":var a=null!=e;break a;case "function":a=!0;break a;default:a=!1}a?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}};d.prototype.resolveToNonPromiseObj_=function(e){var a=void 0;try{a=e.then}catch(c){this.reject_(c);return}"function"==typeof a?
this.settleSameAsThenable_(a,e):this.fulfill_(e)};d.prototype.reject_=function(e){this.settle_(2,e)};d.prototype.fulfill_=function(e){this.settle_(1,e)};d.prototype.settle_=function(e,a){if(0!=this.state_)throw Error("Cannot settle("+e+", "+a+"): Promise already settled in state"+this.state_);this.state_=e;this.result_=a;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)f.asyncExecute(this.onSettledCallbacks_[e]);
this.onSettledCallbacks_=null}};var f=new m;d.prototype.settleSameAsPromise_=function(e){var a=this.createResolveAndReject_();e.callWhenSettled_(a.resolve,a.reject)};d.prototype.settleSameAsThenable_=function(e,a){var c=this.createResolveAndReject_();try{e.call(a,c.resolve,c.reject)}catch(b){c.reject(b)}};d.prototype.then=function(e,a){function c(a,c){return"function"==typeof a?function(c){try{b(a(c))}catch(y){h(y)}}:c}var b,h,f=new d(function(a,c){b=a;h=c});this.callWhenSettled_(c(e,b),c(a,h));return f};
d.prototype.catch=function(e){return this.then(void 0,e)};d.prototype.callWhenSettled_=function(e,a){function c(){switch(b.state_){case 1:e(b.result_);break;case 2:a(b.result_);break;default:throw Error("Unexpected state: "+b.state_);}}var b=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(c)};d.resolve=k;d.reject=function(e){return new d(function(a,c){c(e)})};d.race=function(e){return new d(function(a,c){for(var b=$jscomp.makeIterator(e),h=b.next();!h.done;h=b.next())k(h.value).callWhenSettled_(a,
c)})};d.all=function(e){var a=$jscomp.makeIterator(e),c=a.next();return c.done?k([]):new d(function(b,h){function e(a){return function(c){f[a]=c;d--;0==d&&b(f)}}var f=[],d=0;do f.push(void 0),d++,k(c.value).callWhenSettled_(e(f.length-1),h),c=a.next();while(!c.done)})};return d},"es6","es3");
(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"+0P/":function(g,m,k){var l=k("k2R8"),d=k("uyO6");g=k("h13i");g.a.prototype.restoreSingleAttachment=function(){this.bindAttachments([this._gl.BACK])};g.a.prototype.buildTextureLayout=function(f){for(var e=this._gl,a=[],c=0;c<f.length;c++)f[c]?a.push(e["COLOR_ATTACHMENT"+c]):a.push(e.NONE);return a};g.a.prototype.bindAttachments=function(f){this._gl.drawBuffers(f)};g.a.prototype.unBindMultiColorAttachmentFramebuffer=function(f,e,a){void 0===
e&&(e=!1);this._currentRenderTarget=null;var c=this._gl,b=f[0]._attachments,h=b.length;if(f[0]._MSAAFramebuffer){c.bindFramebuffer(c.READ_FRAMEBUFFER,f[0]._MSAAFramebuffer);c.bindFramebuffer(c.DRAW_FRAMEBUFFER,f[0]._framebuffer);for(var d=0;d<h;d++){for(var r=f[d],u=0;u<h;u++)b[u]=c.NONE;b[d]=c[1<this.webGLVersion?"COLOR_ATTACHMENT"+d:"COLOR_ATTACHMENT"+d+"_WEBGL"];c.readBuffer(b[d]);c.drawBuffers(b);c.blitFramebuffer(0,0,r.width,r.height,0,0,r.width,r.height,c.COLOR_BUFFER_BIT,c.NEAREST)}for(d=0;d<
h;d++)b[d]=c[1<this.webGLVersion?"COLOR_ATTACHMENT"+d:"COLOR_ATTACHMENT"+d+"_WEBGL"];c.drawBuffers(b)}for(d=0;d<h;d++)r=f[d],!r.generateMipMaps||e||r.isCube||(this._bindTextureDirectly(c.TEXTURE_2D,r,!0),c.generateMipmap(c.TEXTURE_2D),this._bindTextureDirectly(c.TEXTURE_2D,null));a&&(f[0]._MSAAFramebuffer&&this._bindUnboundFramebuffer(f[0]._framebuffer),a());this._bindUnboundFramebuffer(null)};g.a.prototype.createMultipleRenderTarget=function(f,e){var a=!1,c=!0,b=!1,h=!1,n=1,r=[],u=[];void 0!==e&&
(a=void 0===e.generateMipMaps?!1:e.generateMipMaps,c=void 0===e.generateDepthBuffer?!0:e.generateDepthBuffer,b=void 0===e.generateStencilBuffer?!1:e.generateStencilBuffer,h=void 0===e.generateDepthTexture?!1:e.generateDepthTexture,n=e.textureCount||1,e.types&&(r=e.types),e.samplingModes&&(u=e.samplingModes));e=this._gl;var g=e.createFramebuffer();this._bindUnboundFramebuffer(g);var k=f.width||f;f=f.height||f;for(var w=[],t=[],x=this._setupFramebufferDepthAttachments(b,c,k,f),p=0;p<n;p++){var v=u[p]||
3,A=r[p]||0;1!==A||this._caps.textureFloatLinearFiltering?2!==A||this._caps.textureHalfFloatLinearFiltering||(v=1):v=1;var B=this._getSamplingParameters(v,a);1!==A||this._caps.textureFloat||(A=0,d.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var q=new l.a(this,l.b.MultiRenderTarget),m=e[1<this.webGLVersion?"COLOR_ATTACHMENT"+p:"COLOR_ATTACHMENT"+p+"_WEBGL"];w.push(q);t.push(m);e.activeTexture(e["TEXTURE"+p]);e.bindTexture(e.TEXTURE_2D,q._webGLTexture);
e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,B.mag);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,B.min);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texImage2D(e.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(A),k,f,0,e.RGBA,this._getWebGLTextureType(A),null);e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,m,e.TEXTURE_2D,q._webGLTexture,0);a&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._bindTextureDirectly(e.TEXTURE_2D,
null);q._framebuffer=g;q._depthStencilBuffer=x;q.baseWidth=k;q.baseHeight=f;q.width=k;q.height=f;q.isReady=!0;q.samples=1;q.generateMipMaps=a;q.samplingMode=v;q.type=A;q._generateDepthBuffer=c;q._generateStencilBuffer=b;q._attachments=t;q._textureArray=w;this._internalTexturesCache.push(q)}h&&this._caps.depthTextureExtension&&(h=new l.a(this,l.b.MultiRenderTarget),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,h._webGLTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,
e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,2>this.webGLVersion?e.DEPTH_COMPONENT:e.DEPTH_COMPONENT16,k,f,0,e.DEPTH_COMPONENT,e.UNSIGNED_SHORT,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,h._webGLTexture,0),h._framebuffer=g,h.baseWidth=k,h.baseHeight=f,h.width=k,h.height=f,h.isReady=!0,h.samples=1,h.generateMipMaps=a,h.samplingMode=
e.NEAREST,h._generateDepthBuffer=c,h._generateStencilBuffer=b,w.push(h),this._internalTexturesCache.push(h));e.drawBuffers(t);this._bindUnboundFramebuffer(null);this.resetTextureCache();return w};g.a.prototype.updateMultipleRenderTargetTextureSampleCount=function(f,e){if(2>this.webGLVersion||!f)return 1;if(f[0].samples===e)return e;var a=f[0]._attachments.length;if(0===a)return 1;var c=this._gl;e=Math.min(e,this.getCaps().maxMSAASamples);f[0]._depthStencilBuffer&&(c.deleteRenderbuffer(f[0]._depthStencilBuffer),
f[0]._depthStencilBuffer=null);f[0]._MSAAFramebuffer&&(c.deleteFramebuffer(f[0]._MSAAFramebuffer),f[0]._MSAAFramebuffer=null);for(var b=0;b<a;b++)f[b]._MSAARenderBuffer&&(c.deleteRenderbuffer(f[b]._MSAARenderBuffer),f[b]._MSAARenderBuffer=null);if(1<e&&c.renderbufferStorageMultisample){var h=c.createFramebuffer();if(!h)throw Error("Unable to create multi sampled framebuffer");this._bindUnboundFramebuffer(h);var d=this._setupFramebufferDepthAttachments(f[0]._generateStencilBuffer,f[0]._generateDepthBuffer,
f[0].width,f[0].height,e),r=[];for(b=0;b<a;b++){var u=f[b],g=c[1<this.webGLVersion?"COLOR_ATTACHMENT"+b:"COLOR_ATTACHMENT"+b+"_WEBGL"],k=c.createRenderbuffer();if(!k)throw Error("Unable to create multi sampled framebuffer");c.bindRenderbuffer(c.RENDERBUFFER,k);c.renderbufferStorageMultisample(c.RENDERBUFFER,e,this._getRGBAMultiSampleBufferFormat(u.type),u.width,u.height);c.framebufferRenderbuffer(c.FRAMEBUFFER,g,c.RENDERBUFFER,k);u._MSAAFramebuffer=h;u._MSAARenderBuffer=k;u.samples=e;u._depthStencilBuffer=
d;c.bindRenderbuffer(c.RENDERBUFFER,null);r.push(g)}c.drawBuffers(r)}else this._bindUnboundFramebuffer(f[0]._framebuffer);this._bindUnboundFramebuffer(null);return e}},"+zdb":function(g,m,k){g=k("h13i");g.a.prototype.setAlphaConstants=function(g,d,f,e){this._alphaState.setAlphaBlendConstants(g,d,f,e)};g.a.prototype.setAlphaMode=function(g,d){void 0===d&&(d=!1);if(this._alphaMode!==g){switch(g){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,
this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA);this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,
this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE);
this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA);this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,
this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA);this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO);this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,
this._gl.ONE_MINUS_SRC_ALPHA);this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA);this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO);this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,
this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}d||(this.depthCullingState.depthMask=0===g);this._alphaMode=g}};g.a.prototype.getAlphaMode=function(){return this._alphaMode};g.a.prototype.setAlphaEquation=function(g){if(this._alphaEquation!==g){switch(g){case 0:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case 1:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case 2:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,
this._gl.FUNC_REVERSE_SUBTRACT);break;case 3:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case 4:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case 5:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=g}};g.a.prototype.getAlphaEquation=function(){return this._alphaEquation}},"/4XI":function(g,m,k){g=k("h13i");g.a.prototype.updateDynamicIndexBuffer=function(g,d,f){this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=
null;this.bindIndexBuffer(g);g=d instanceof Uint16Array||d instanceof Uint32Array?d:g.is32Bits?new Uint32Array(d):new Uint16Array(d);this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,g,this._gl.DYNAMIC_DRAW);this._resetIndexBufferBinding()};g.a.prototype.updateDynamicVertexBuffer=function(g,d,f,e){this.bindArrayBuffer(g);void 0===f&&(f=0);g=d.length||d.byteLength;void 0===e||e>=g&&0===f?d instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,f,new Float32Array(d)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,
f,d):d instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,(new Float32Array(d)).subarray(f,f+e)):(d=d instanceof ArrayBuffer?new Uint8Array(d,f,e):new Uint8Array(d.buffer,d.byteOffset+f,e),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,d));this._resetVertexBufferBinding()}},"3NAF":function(g,m,k){g=k("h13i");var l=k("25bV");g.a.prototype.createUniformBuffer=function(d){var f=this._gl.createBuffer();if(!f)throw Error("Unable to create uniform buffer");f=new l.a(f);this.bindUniformBuffer(f);
d instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,d,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(d),this._gl.STATIC_DRAW);this.bindUniformBuffer(null);f.references=1;return f};g.a.prototype.createDynamicUniformBuffer=function(d){var f=this._gl.createBuffer();if(!f)throw Error("Unable to create dynamic uniform buffer");f=new l.a(f);this.bindUniformBuffer(f);d instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,d,this._gl.DYNAMIC_DRAW):
this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(d),this._gl.DYNAMIC_DRAW);this.bindUniformBuffer(null);f.references=1;return f};g.a.prototype.updateUniformBuffer=function(d,f,e,a){this.bindUniformBuffer(d);void 0===e&&(e=0);void 0===a?f instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,f):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,new Float32Array(f)):f instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,f.subarray(e,e+a)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,
0,(new Float32Array(f)).subarray(e,e+a));this.bindUniformBuffer(null)};g.a.prototype.bindUniformBuffer=function(d){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,d?d.underlyingResource:null)};g.a.prototype.bindUniformBufferBase=function(d,f){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,f,d?d.underlyingResource:null)};g.a.prototype.bindUniformBlock=function(d,f,e){d=d.program;f=this._gl.getUniformBlockIndex(d,f);this._gl.uniformBlockBinding(d,f,e)}},"3XS9":function(g,m,k){var l=k("oYeq"),d=k("k2R8"),
f=k("uyO6");k("h13i").a.prototype.createRenderTargetCubeTexture=function(e,a){a=Object(l.a)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5},a);a.generateStencilBuffer=a.generateDepthBuffer&&a.generateStencilBuffer;1!==a.type||this._caps.textureFloatLinearFiltering?2!==a.type||this._caps.textureHalfFloatLinearFiltering||(a.samplingMode=1):a.samplingMode=1;var c=this._gl,b=new d.a(this,d.b.RenderTarget);this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,
b,!0);var h=this._getSamplingParameters(a.samplingMode,a.generateMipMaps);1!==a.type||this._caps.textureFloat||(a.type=0,f.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type"));c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,h.mag);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,h.min);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);for(h=0;6>
h;h++)c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,this._getRGBABufferInternalSizedFormat(a.type,a.format),e,e,0,this._getInternalFormat(a.format),this._getWebGLTextureType(a.type),null);h=c.createFramebuffer();this._bindUnboundFramebuffer(h);b._depthStencilBuffer=this._setupFramebufferDepthAttachments(a.generateStencilBuffer,a.generateDepthBuffer,e,e);a.generateMipMaps&&c.generateMipmap(c.TEXTURE_CUBE_MAP);this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null);this._bindUnboundFramebuffer(null);b._framebuffer=
h;b.width=e;b.height=e;b.isReady=!0;b.isCube=!0;b.samples=1;b.generateMipMaps=a.generateMipMaps;b.samplingMode=a.samplingMode;b.type=a.type;b.format=a.format;b._generateDepthBuffer=a.generateDepthBuffer;b._generateStencilBuffer=a.generateStencilBuffer;this._internalTexturesCache.push(b);return b}},"83xy":function(g,m,k){function l(b,a,c,e){e=1===e?new Float32Array(a*c*4):new Uint32Array(a*c*4);for(var h=0;h<a;h++)for(var f=0;f<c;f++){var d=3*(f*a+h),n=4*(f*a+h);e[n+0]=b[d+0];e[n+1]=b[d+1];e[n+2]=
b[d+2];e[n+3]=1}return e}function d(b){return function(a,c,f,d,g,k,l,t,x,p){void 0===x&&(x=null);void 0===p&&(p=0);var h=b?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,n=new e.a(this,b?e.b.Raw3D:e.b.Raw2DArray);n.baseWidth=c;n.baseHeight=f;n.baseDepth=d;n.width=c;n.height=f;n.depth=d;n.format=g;n.type=p;n.generateMipMaps=k;n.samplingMode=t;b?n.is3D=!0:n.is2DArray=!0;this._doNotHandleContextLost||(n._bufferView=a);b?this.updateRawTexture3D(n,a,g,l,x,p):this.updateRawTexture2DArray(n,a,g,l,x,p);this._bindTextureDirectly(h,
n,!0);a=this._getSamplingParameters(t,k);this._gl.texParameteri(h,this._gl.TEXTURE_MAG_FILTER,a.mag);this._gl.texParameteri(h,this._gl.TEXTURE_MIN_FILTER,a.min);k&&this._gl.generateMipmap(h);this._bindTextureDirectly(h,null);this._internalTexturesCache.push(n);return n}}function f(b){return function(a,c,e,f,d,g){void 0===d&&(d=null);void 0===g&&(g=0);var h=b?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,n=this._getWebGLTextureType(g),k=this._getInternalFormat(e);g=this._getRGBABufferInternalSizedFormat(g,
e);this._bindTextureDirectly(h,a,!0);this._unpackFlipY(void 0===f?!0:f?!0:!1);this._doNotHandleContextLost||(a._bufferView=c,a.format=e,a.invertY=f,a._compression=d);0!==a.width%4&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1);d&&c?this._gl.compressedTexImage3D(h,0,this.getCaps().s3tc[d],a.width,a.height,a.depth,0,c):this._gl.texImage3D(h,0,g,a.width,a.height,a.depth,0,k,n,c);a.generateMipMaps&&this._gl.generateMipmap(h);this._bindTextureDirectly(h,null);a.isReady=!0}}var e=k("k2R8"),a=k("uyO6"),
c=k("YKqZ");g=k("h13i");g.a.prototype.updateRawTexture=function(b,a,c,e,f,d){void 0===f&&(f=null);void 0===d&&(d=0);if(b){var h=this._getRGBABufferInternalSizedFormat(d,c),n=this._getInternalFormat(c),g=this._getWebGLTextureType(d);this._bindTextureDirectly(this._gl.TEXTURE_2D,b,!0);this._unpackFlipY(void 0===e?!0:e?!0:!1);this._doNotHandleContextLost||(b._bufferView=a,b.format=c,b.type=d,b.invertY=e,b._compression=f);0!==b.width%4&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1);f&&a?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,
0,this.getCaps().s3tc[f],b.width,b.height,0,a):this._gl.texImage2D(this._gl.TEXTURE_2D,0,h,b.width,b.height,0,n,g,a);b.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._bindTextureDirectly(this._gl.TEXTURE_2D,null);b.isReady=!0}};g.a.prototype.createRawTexture=function(b,a,c,f,d,g,k,l,t){void 0===l&&(l=null);void 0===t&&(t=0);var h=new e.a(this,e.b.Raw);h.baseWidth=a;h.baseHeight=c;h.width=a;h.height=c;h.format=f;h.generateMipMaps=d;h.samplingMode=k;h.invertY=g;h._compression=l;
h.type=t;this._doNotHandleContextLost||(h._bufferView=b);this.updateRawTexture(h,b,f,g,l,t);this._bindTextureDirectly(this._gl.TEXTURE_2D,h,!0);b=this._getSamplingParameters(k,d);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,b.mag);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,b.min);d&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._bindTextureDirectly(this._gl.TEXTURE_2D,null);this._internalTexturesCache.push(h);return h};g.a.prototype.createRawCubeTexture=
function(b,h,f,d,g,k,l,m){void 0===m&&(m=null);var n=this._gl,r=new e.a(this,e.b.CubeRaw);r.isCube=!0;r.format=f;r.type=d;this._doNotHandleContextLost||(r._bufferViewArray=b);var p=this._getWebGLTextureType(d);this._getInternalFormat(f);p!==n.FLOAT||this._caps.textureFloatLinearFiltering?p!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?p!==n.FLOAT||this._caps.textureFloatRender?p!==n.HALF_FLOAT||this._caps.colorBufferFloat||(g=!1,a.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):
(g=!1,a.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(g=!1,l=1,a.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(g=!1,l=1,a.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));r.width=h;r.height=h;!this.needPOTTextures||c.b.IsExponentOfTwo(r.width)&&
c.b.IsExponentOfTwo(r.height)||(g=!1);b&&this.updateRawCubeTexture(r,b,f,d,k,m);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,r,!0);b&&g&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);b=this._getSamplingParameters(l,g);n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,b.mag);n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,b.min);n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,
null);r.generateMipMaps=g;return r};g.a.prototype.updateRawCubeTexture=function(b,a,e,f,d,g,k){void 0===g&&(g=null);void 0===k&&(k=0);b._bufferViewArray=a;b.format=e;b.type=f;b.invertY=d;b._compression=g;var h=this._gl,n=this._getWebGLTextureType(f);e=this._getInternalFormat(e);var r=this._getRGBABufferInternalSizedFormat(f),p=!1;e===h.RGB&&(e=h.RGBA,p=!0);this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,b,!0);this._unpackFlipY(void 0===d?!0:d?!0:!1);0!==b.width%4&&h.pixelStorei(h.UNPACK_ALIGNMENT,1);
for(d=0;6>d;d++){var v=a[d];g?h.compressedTexImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+d,k,this.getCaps().s3tc[g],b.width,b.height,0,v):(p&&(v=l(v,b.width,b.height,f)),h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+d,k,r,b.width,b.height,0,e,n,v))}(!this.needPOTTextures||c.b.IsExponentOfTwo(b.width)&&c.b.IsExponentOfTwo(b.height))&&b.generateMipMaps&&0===k&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null);b.isReady=!0};g.a.prototype.createRawCubeTextureFromUrl=
function(b,a,c,e,f,d,g,k,m,x,p,v){var h=this;void 0===m&&(m=null);void 0===x&&(x=null);void 0===p&&(p=3);void 0===v&&(v=!1);var n=this._gl,q=this.createRawCubeTexture(null,c,e,f,!d,v,p,null);null===a||void 0===a?void 0:a._addPendingData(q);q.url=b;this._internalTexturesCache.push(q);this._loadFile(b,function(b){var c=q.width,d=g(b);if(d){if(k){b=h._getWebGLTextureType(f);var p=h._getInternalFormat(e),A=h._getRGBABufferInternalSizedFormat(f),B=!1;p===n.RGB&&(p=n.RGBA,B=!0);h._bindTextureDirectly(n.TEXTURE_CUBE_MAP,
q,!0);h._unpackFlipY(!1);d=k(d);for(var r=0;r<d.length;r++)for(var u=c>>r,x=0;6>x;x++){var z=d[r][x];B&&(z=l(z,u,u,f));n.texImage2D(x,r,A,u,u,0,p,b,z)}h._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null)}else h.updateRawCubeTexture(q,d,e,f,v);q.isReady=!0;null===a||void 0===a?void 0:a._removePendingData(q);m&&m()}},void 0,null===a||void 0===a?void 0:a.offlineProvider,!0,function(b,c){null===a||void 0===a?void 0:a._removePendingData(q);x&&b&&x(b.status+" "+b.statusText,c)});return q};g.a.prototype.createRawTexture2DArray=
d(!1);g.a.prototype.createRawTexture3D=d(!0);g.a.prototype.updateRawTexture2DArray=f(!1);g.a.prototype.updateRawTexture3D=f(!0)},"99gS":function(g,m,k){var l=k("oYeq"),d=k("h13i"),f=k("k2R8"),e=k("uyO6"),a=k("TFEU");d.a.prototype._createDepthStencilCubeTexture=function(a,b){var c=new f.a(this,f.b.Unknown);c.isCube=!0;if(1===this.webGLVersion)return e.a.Error("Depth cube texture is not supported by WebGL 1."),c;b=Object(l.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},b);var d=this._gl;
this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,c,!0);this._setupDepthStencilTexture(c,a,b.generateStencil,b.bilinearFiltering,b.comparisonFunction);for(var g=0;6>g;g++)b.generateStencil?d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,d.DEPTH24_STENCIL8,a,a,0,d.DEPTH_STENCIL,d.UNSIGNED_INT_24_8,null):d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,d.DEPTH_COMPONENT24,a,a,0,d.DEPTH_COMPONENT,d.UNSIGNED_INT,null);this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null);return c};d.a.prototype._partialLoadFile=
function(a,b,e,d,f){void 0===f&&(f=null);this._loadFile(a,function(a){e[b]=a;e._internalCount++;6===e._internalCount&&d(e)},void 0,void 0,!0,function(a,b){f&&a&&f(a.status+" "+a.statusText,b)})};d.a.prototype._cascadeLoadFiles=function(a,b,e,d){void 0===d&&(d=null);a=[];for(var c=a._internalCount=0;6>c;c++)this._partialLoadFile(e[c],c,a,b,d)};d.a.prototype._cascadeLoadImgs=function(a,b,e,d,f){void 0===d&&(d=null);for(var c=[],h=c._internalCount=0;6>h;h++)this._partialLoadImg(e[h],h,c,a,b,d,f)};d.a.prototype._partialLoadImg=
function(c,b,e,d,f,g,k){void 0===g&&(g=null);var h=a.a.LoadImage(c,function(){h&&(e[b]=h,e._internalCount++,d&&d._removePendingData(h));6===e._internalCount&&f(e)},function(a,b){d&&d._removePendingData(h);g&&g(a,b)},d?d.offlineProvider:null,k);d&&h&&d._addPendingData(h)};d.a.prototype._setCubeMapTextureParams=function(a,b){var c=this._gl;c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,b?c.LINEAR_MIPMAP_LINEAR:c.LINEAR);c.texParameteri(c.TEXTURE_CUBE_MAP,
c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);a.samplingMode=b?3:2;this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null)};d.a.prototype.createCubeTexture=function(a,b,h,g,k,l,m,y,w,t,x,p,v){var c=this;void 0===k&&(k=null);void 0===l&&(l=null);void 0===y&&(y=null);void 0===w&&(w=!1);void 0===t&&(t=0);void 0===x&&(x=0);void 0===p&&(p=null);var n=this._gl,q=p?p:new f.a(this,f.b.Cube);q.isCube=!0;q.url=a;q.generateMipMaps=!g;q._lodGenerationScale=
t;q._lodGenerationOffset=x;this._doNotHandleContextLost||(q._extension=y,q._files=h);var r=a;this._transformTextureUrl&&!p&&(a=this._transformTextureUrl(a));p=a.lastIndexOf(".");p=y?y:-1<p?a.substring(p).toLowerCase():"";for(var u=null,z=0,C=d.a._TextureLoaders;z<C.length;z++){var D=C[z];if(D.canLoad(p)){u=D;break}}p=function(d,f){a===r?l&&d&&l(d.status+" "+d.statusText,f):(e.a.Warn("Failed to load "+a+", falling back to the "+r),c.createCubeTexture(r,b,h,g,k,l,m,y,w,t,x,q,v))};if(u){var E=function(a){c._bindTextureDirectly(n.TEXTURE_CUBE_MAP,
q,!0);u.loadCubeData(a,q,w,k,l)};h&&6===h.length?u.supportCascades?this._cascadeLoadFiles(b,function(a){return E(a.map(function(a){return new Uint8Array(a)}))},h,l):l?l("Textures type does not support cascades."):e.a.Warn("Texture loader does not support cascades."):this._loadFile(a,function(a){return E(new Uint8Array(a))},void 0,void 0,!0,p)}else{if(!h)throw Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(b,function(a){var b=c.needPOTTextures?d.a.GetExponentOfTwo(a[0].width,
c._caps.maxCubemapTextureSize):a[0].width,f=[n.TEXTURE_CUBE_MAP_POSITIVE_X,n.TEXTURE_CUBE_MAP_POSITIVE_Y,n.TEXTURE_CUBE_MAP_POSITIVE_Z,n.TEXTURE_CUBE_MAP_NEGATIVE_X,n.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.TEXTURE_CUBE_MAP_NEGATIVE_Z];c._bindTextureDirectly(n.TEXTURE_CUBE_MAP,q,!0);c._unpackFlipY(!1);for(var h=m?c._getInternalFormat(m):c._gl.RGBA,v=0;v<f.length;v++)if(a[v].width!==b||a[v].height!==b){c._prepareWorkingCanvas();if(!c._workingCanvas||!c._workingContext){e.a.Warn("Cannot create canvas to resize texture.");
return}c._workingCanvas.width=b;c._workingCanvas.height=b;c._workingContext.drawImage(a[v],0,0,a[v].width,a[v].height,0,0,b,b);n.texImage2D(f[v],0,h,h,n.UNSIGNED_BYTE,c._workingCanvas)}else n.texImage2D(f[v],0,h,h,n.UNSIGNED_BYTE,a[v]);g||n.generateMipmap(n.TEXTURE_CUBE_MAP);c._setCubeMapTextureParams(q,!g);q.width=b;q.height=b;q.isReady=!0;m&&(q.format=m);q.onLoadedObservable.notifyObservers(q);q.onLoadedObservable.clear();k&&k()},h,l)}this._internalTexturesCache.push(q);return q}},C6Hv:function(g,
m,k){k.d(m,"a",function(){return l});var l=function(){function d(d,e){void 0===e&&(e=20);this.debug=!1;this._sourceCode=d;this._numMaxIterations=e;this._functionDescr=[];this.inlineToken="#define inline"}Object.defineProperty(d.prototype,"code",{get:function(){return this._sourceCode},enumerable:!1,configurable:!0});d.prototype.processCode=function(){this.debug&&console.log("Start inlining process (code size="+this._sourceCode.length+")...");this._collectFunctions();this._processInlining(this._numMaxIterations);
this.debug&&console.log("End of inlining process.")};d.prototype._collectFunctions=function(){for(var f=0;f<this._sourceCode.length;){var e=this._sourceCode.indexOf(this.inlineToken,f);if(0>e)break;var a=this._sourceCode.indexOf("(",e+this.inlineToken.length);if(0>a)this.debug&&console.warn("Could not find the opening parenthesis after the token. startIndex="+f),f=e+this.inlineToken.length;else if(f=d._RegexpFindFunctionNameAndType.exec(this._sourceCode.substring(e+this.inlineToken.length,a))){var c=
[f[3],f[4]];f=c[0];c=c[1];var b=this._extractBetweenMarkers("(",")",this._sourceCode,a);if(0>b)this.debug&&console.warn("Could not extract the parameters the function '"+c+"' (type="+f+"). funcParamsStartIndex="+a),f=e+this.inlineToken.length;else{var h=this._sourceCode.substring(a+1,b),g=this._skipWhitespaces(this._sourceCode,b+1);if(g===this._sourceCode.length)this.debug&&console.warn("Could not extract the body of the function '"+c+"' (type="+f+"). funcParamsEndIndex="+b),f=e+this.inlineToken.length;
else if(a=this._extractBetweenMarkers("{","}",this._sourceCode,g),0>a)this.debug&&console.warn("Could not extract the body of the function '"+c+"' (type="+f+"). funcBodyStartIndex="+g),f=e+this.inlineToken.length;else{b=this._sourceCode.substring(g,a+1);h=this._removeComments(h).split(",");g=[];for(var k=0;k<h.length;++k){var l=h[k].trim(),m=l.lastIndexOf(" ");0<=m&&g.push(l.substring(m+1))}"void"!==f&&g.push("return");this._functionDescr.push({name:c,type:f,parameters:g,body:b,callIndex:0});f=a+
1;c=0<e?this._sourceCode.substring(0,e):"";b=a+1<this._sourceCode.length-1?this._sourceCode.substring(a+1):"";this._sourceCode=c+b;f-=a+1-e}}}else this.debug&&console.warn("Could not extract the name/type of the function from: "+this._sourceCode.substring(e+this.inlineToken.length,a)),f=e+this.inlineToken.length}this.debug&&console.log("Collect functions: "+this._functionDescr.length+" functions found. functionDescr=",this._functionDescr)};d.prototype._processInlining=function(d){for(void 0===d&&
(d=20);0<=d--&&this._replaceFunctionCallsByCode(););this.debug&&console.log("numMaxIterations is "+d+" after inlining process");return 0<=d};d.prototype._extractBetweenMarkers=function(d,e,a,c){for(var b=0,f="";c<a.length;){var g=a.charAt(c);if(f)g===f?'"'===f||"'"===f?"\\"!==a.charAt(c-1)&&(f=""):f="":"*/"===f&&"*"===g&&c+1<a.length&&("/"===a.charAt(c+1)&&(f=""),""===f&&c++);else switch(g){case d:b++;break;case e:b--;break;case '"':case "'":case "`":f=g;break;case "/":c+1<a.length&&(g=a.charAt(c+
1),"/"===g?f="\n":"*"===g&&(f="*/"))}c++;if(0===b)break}return 0===b?c-1:-1};d.prototype._skipWhitespaces=function(d,e){for(;e<d.length;){var a=d[e];if(" "!==a&&"\n"!==a&&"\r"!==a&&"\t"!==a&&"\n"!==a&&"\u00a0"!==a)break;e++}return e};d.prototype._removeComments=function(d){for(var e=0,a="",c=!1,b=[];e<d.length;){var f=d.charAt(e);if(a)f===a?'"'===a||"'"===a?("\\"!==d.charAt(e-1)&&(a=""),b.push(f)):(a="",c=!1):"*/"===a&&"*"===f&&e+1<d.length?("/"===d.charAt(e+1)&&(a=""),""===a&&(c=!1,e++)):c||b.push(f);
else{switch(f){case '"':case "'":case "`":a=f;break;case "/":if(e+1<d.length){var g=d.charAt(e+1);"/"===g?(a="\n",c=!0):"*"===g&&(a="*/",c=!0)}}c||b.push(f)}e++}return b.join("")};d.prototype._replaceFunctionCallsByCode=function(){for(var d=!1,e=0,a=this._functionDescr;e<a.length;e++)for(var c=a[e],b=c.name,h=c.type,g=c.parameters,k=c.body,l=0;l<this._sourceCode.length;){var m=this._sourceCode.indexOf(b,l);if(0>m)break;l=this._skipWhitespaces(this._sourceCode,m+b.length);if(l===this._sourceCode.length||
"("!==this._sourceCode.charAt(l))l=m+b.length;else{var y=this._extractBetweenMarkers("(",")",this._sourceCode,l);if(0>y)this.debug&&console.warn("Could not extract the parameters of the function call. Function '"+b+"' (type="+h+"). callParamsStartIndex="+l),l=m+b.length;else{l=this._sourceCode.substring(l+1,y);l=this._removeComments(l).split(",");for(var w=[],t=0;t<l.length;++t){var x=l[t].trim();w.push(x)}(t="void"!==h?b+"_"+c.callIndex++:null)&&w.push(t+" =");w.length!==g.length?(this.debug&&console.warn("Invalid function call: not the same number of parameters for the call than the number expected by the function. Function '"+
b+"' (type="+h+"). function parameters="+g+", call parameters="+w),l=m+b.length):(l=y+1,d=this._replaceNames(k,g,w),w=0<m?this._sourceCode.substring(0,m):"",x=y+1<this._sourceCode.length-1?this._sourceCode.substring(y+1):"",t?(y=this._findBackward(this._sourceCode,m-1,"\n"),w=this._sourceCode.substring(0,y+1),m=this._sourceCode.substring(y+1,m),this._sourceCode=w+h+" "+t+";\n"+d+"\n"+m+t+x,this.debug&&console.log("Replace function call by code. Function '"+b+"' (type="+h+"). injectDeclarationIndex="+
y)):(this._sourceCode=w+d+x,l+=d.length-(y+1-m),this.debug&&console.log("Replace function call by code. Function '"+b+"' (type="+h+"). functionCallIndex="+m)),d=!0)}}}return d};d.prototype._findBackward=function(d,e,a){for(;0<=e&&d.charAt(e)!==a;)e--;return e};d.prototype._escapeRegExp=function(d){return d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")};d.prototype._replaceNames=function(d,e,a){for(var c=0;c<e.length;++c){var b=new RegExp(this._escapeRegExp(e[c]),"g");d=d.replace(b,a[c])}return d};d._RegexpFindFunctionNameAndType=
/((\s+?)(\w+)\s+(\w+)\s*?)$/;return d}()},DvRB:function(g,m,k){var l=k("oYeq"),d=k("k2R8"),f=k("uyO6"),e=k("9DX3");g=k("h13i");g.a.prototype.createRenderTargetTexture=function(a,c){var b=new e.a;void 0!==c&&"object"===typeof c?(b.generateMipMaps=c.generateMipMaps,b.generateDepthBuffer=!!c.generateDepthBuffer,b.generateStencilBuffer=!!c.generateStencilBuffer,b.type=void 0===c.type?0:c.type,b.samplingMode=void 0===c.samplingMode?3:c.samplingMode,b.format=void 0===c.format?5:c.format):(b.generateMipMaps=
c,b.generateDepthBuffer=!0,b.generateStencilBuffer=!1,b.type=0,b.samplingMode=3,b.format=5);1!==b.type||this._caps.textureFloatLinearFiltering?2!==b.type||this._caps.textureHalfFloatLinearFiltering||(b.samplingMode=1):b.samplingMode=1;1!==b.type||this._caps.textureFloat||(b.type=0,f.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));c=this._gl;var h=new d.a(this,d.b.RenderTarget),g=a.width||a,k=a.height||a;a=a.layers||0;var l=this._getSamplingParameters(b.samplingMode,
b.generateMipMaps?!0:!1),m=0!==a?c.TEXTURE_2D_ARRAY:c.TEXTURE_2D,y=this._getRGBABufferInternalSizedFormat(b.type,b.format),w=this._getInternalFormat(b.format),t=this._getWebGLTextureType(b.type);this._bindTextureDirectly(m,h);0!==a?(h.is2DArray=!0,c.texImage3D(m,0,y,g,k,a,0,w,t,null)):c.texImage2D(m,0,y,g,k,0,w,t,null);c.texParameteri(m,c.TEXTURE_MAG_FILTER,l.mag);c.texParameteri(m,c.TEXTURE_MIN_FILTER,l.min);c.texParameteri(m,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(m,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);
b.generateMipMaps&&this._gl.generateMipmap(m);this._bindTextureDirectly(m,null);l=this._currentFramebuffer;m=c.createFramebuffer();this._bindUnboundFramebuffer(m);h._depthStencilBuffer=this._setupFramebufferDepthAttachments(b.generateStencilBuffer?!0:!1,b.generateDepthBuffer,g,k);h.is2DArray||c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,h._webGLTexture,0);this._bindUnboundFramebuffer(l);h._framebuffer=m;h.baseWidth=g;h.baseHeight=k;h.width=g;h.height=k;h.depth=a;h.isReady=
!0;h.samples=1;h.generateMipMaps=b.generateMipMaps?!0:!1;h.samplingMode=b.samplingMode;h.type=b.type;h.format=b.format;h._generateDepthBuffer=b.generateDepthBuffer;h._generateStencilBuffer=b.generateStencilBuffer?!0:!1;this._internalTexturesCache.push(h);return h};g.a.prototype.createDepthStencilTexture=function(a,c){return c.isCube?this._createDepthStencilCubeTexture(a.width||a,c):this._createDepthStencilTexture(a,c)};g.a.prototype._createDepthStencilTexture=function(a,c){var b=this._gl,e=a.layers||
0,g=0!==e?b.TEXTURE_2D_ARRAY:b.TEXTURE_2D,k=new d.a(this,d.b.Depth);if(!this._caps.depthTextureExtension)return f.a.Error("Depth texture is not supported by your browser or hardware."),k;c=Object(l.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},c);this._bindTextureDirectly(g,k,!0);this._setupDepthStencilTexture(k,a,c.generateStencil,c.bilinearFiltering,c.comparisonFunction);a=c.generateStencil?b.UNSIGNED_INT_24_8:b.UNSIGNED_INT;var m=c.generateStencil?b.DEPTH_STENCIL:b.DEPTH_COMPONENT,
z=m;1<this.webGLVersion&&(z=c.generateStencil?b.DEPTH24_STENCIL8:b.DEPTH_COMPONENT24);k.is2DArray?b.texImage3D(g,0,z,k.width,k.height,e,0,m,a,null):b.texImage2D(g,0,z,k.width,k.height,0,m,a,null);this._bindTextureDirectly(g,null);return k}},E6EV:function(g,m,k){k.d(m,"a",function(){return t});var l=k("X2Ve"),d=function(){function a(){this.children=[]}a.prototype.isValid=function(a){return!0};a.prototype.process=function(a,b){var c="";if(this.line){var d=this.line,e=b.processor;e&&(e.lineProcessor&&
(d=e.lineProcessor(d,b.isFragment)),e.attributeProcessor&&l.a.StartsWith(this.line,"attribute")?d=e.attributeProcessor(this.line):e.varyingProcessor&&l.a.StartsWith(this.line,"varying")?d=e.varyingProcessor(this.line,b.isFragment):(e.uniformProcessor||e.uniformBufferProcessor)&&l.a.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?e.uniformProcessor&&(d=e.uniformProcessor(this.line,b.isFragment)):e.uniformBufferProcessor&&(d=e.uniformBufferProcessor(this.line,b.isFragment),b.lookForClosingBracketForUniformBuffer=
!0)),e.endOfUniformBufferProcessor&&b.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(b.lookForClosingBracketForUniformBuffer=!1,d=e.endOfUniformBufferProcessor(this.line,b.isFragment)));c+=d+"\r\n"}this.children.forEach(function(d){c+=d.process(a,b)});this.additionalDefineKey&&(a[this.additionalDefineKey]=this.additionalDefineValue||"true");return c};return a}(),f=function(){function a(){}Object.defineProperty(a.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"lines",{set:function(a){this._lines=[];for(var b=0;b<a.length;b++){var c=a[b];if("#"===c[0])this._lines.push(c);else{c=c.split(";");for(var d=0;d<c.length;d++){var e=c[d];(e=e.trim())&&this._lines.push(e+(d!==c.length-1?";":""))}}}},enumerable:!1,configurable:!0});return a}(),e=k("oYeq"),a=function(a){function b(){return null!==
a&&a.apply(this,arguments)||this}Object(e.d)(b,a);b.prototype.process=function(a,b){for(var c=0;c<this.children.length;c++){var d=this.children[c];if(d.isValid(a))return d.process(a,b)}return""};return b}(d),c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}Object(e.d)(b,a);b.prototype.isValid=function(a){return this.testExpression.isTrue(a)};return b}(d),b=function(){function a(){}a.prototype.isTrue=function(a){return!0};a.postfixToInfix=function(b){for(var c=[],d=0;d<b.length;d++){var e=
b[d];if(void 0===a._OperatorPriority[e])c.push(e);else{var f=c[c.length-1],h=c[c.length-2];c.length-=2;c.push("("+h+e+f+")")}}return c[c.length-1]};a.infixToPostfix=function(b){for(var c=[],d=-1,e=function(){k=k.trim();""!==k&&(c.push(k),k="")},f=function(b){d<a._Stack.length-1&&(a._Stack[++d]=b)},h=function(){return-1===d?"!!INVALID EXPRESSION!!":a._Stack[d--]},g=0,k="";g<b.length;){var n=b.charAt(g),p=g<b.length-1?b.substr(g,2):"";if("("===n)k="",f(n);else if(")"===n){for(e();-1!==d&&"("!==a._Stack[d];)c.push(h());
h()}else if(1<a._OperatorPriority[p]){for(e();-1!==d&&a._OperatorPriority[a._Stack[d]]>=a._OperatorPriority[p];)c.push(h());f(p);g++}else k+=n;g++}for(e();-1!==d;)"("===a._Stack[d]?h():c.push(h());return c};a._OperatorPriority={")":0,"(":1,"||":2,"&&":3};a._Stack="                   ".split(" ");return a}(),h=function(a){function b(b,c){void 0===c&&(c=!1);var d=a.call(this)||this;d.define=b;d.not=c;return d}Object(e.d)(b,a);b.prototype.isTrue=function(a){a=void 0!==a[this.define];this.not&&(a=!a);
return a};return b}(b),n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}Object(e.d)(b,a);b.prototype.isTrue=function(a){return this.leftOperand.isTrue(a)||this.rightOperand.isTrue(a)};return b}(b),r=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}Object(e.d)(b,a);b.prototype.isTrue=function(a){return this.leftOperand.isTrue(a)&&this.rightOperand.isTrue(a)};return b}(b),u=function(a){function b(b,c,d){var e=a.call(this)||this;e.define=b;e.operand=c;
e.testValue=d;return e}Object(e.d)(b,a);b.prototype.isTrue=function(a){var b=a[this.define];void 0===b&&(b=this.define);a=!1;b=parseInt(b);var c=parseInt(this.testValue);switch(this.operand){case ">":a=b>c;break;case "<":a=b<c;break;case "<=":a=b<=c;break;case ">=":a=b>=c;break;case "==":a=b===c}return a};return b}(b),z=k("n5HA"),y=/defined\s*?\((.+?)\)/g,w=/defined\s*?\[(.+?)\]/g,t=function(){function e(){}e.Process=function(a,b,c,d){var e=this;this._ProcessIncludes(a,b,function(a){a=e._ProcessShaderConversion(a,
b,d);c(a)})};e._ProcessPrecision=function(a,b){b=b.shouldUseHighPrecisionShader;-1===a.indexOf("precision highp float")?a=b?"precision highp float;\n"+a:"precision mediump float;\n"+a:b||(a=a.replace("precision highp float","precision mediump float"));return a};e._ExtractOperation=function(a){var b=/defined\((.+)\)/.exec(a);if(b&&b.length)return new h(b[1].trim(),"!"===a[0]);b="";for(var c=0,d=0,e=["==",">=","<=","<",">"];d<e.length&&!(b=e[d],c=a.indexOf(b),-1<c);d++);if(-1===c)return new h(a);d=
a.substring(0,c).trim();a=a.substring(c+b.length).trim();return new u(d,b,a)};e._BuildSubExpression=function(a){a=a.replace(y,"defined[$1]");var c=[],d=0;for(a=b.infixToPostfix(a);d<a.length;d++){var e=a[d];if("||"!==e&&"&&"!==e)c.push(e);else if(2<=c.length){var f=c[c.length-1],h=c[c.length-2];c.length-=2;e="&&"==e?new r:new n;"string"===typeof f&&(f=f.replace(w,"defined($1)"));"string"===typeof h&&(h=h.replace(w,"defined($1)"));e.leftOperand="string"===typeof h?this._ExtractOperation(h):h;e.rightOperand=
"string"===typeof f?this._ExtractOperation(f):f;c.push(e)}}c=c[c.length-1];"string"===typeof c&&(c=c.replace(w,"defined($1)"));return"string"===typeof c?this._ExtractOperation(c):c};e._BuildExpression=function(a,b){var d=new c,e=a.substring(0,b);a=a.substring(b);a=a.substring(0,(a.indexOf("//")+1||a.length+1)-1).trim();d.testExpression="#ifdef"===e?new h(a):"#ifndef"===e?new h(a,!0):this._BuildSubExpression(a);return d};e._MoveCursorWithinIf=function(a,b,c){for(var e;this._MoveCursor(a,c);){e=a.currentLine;
var f=e.substring(0,5).toLowerCase();if("#else"===f){c=new d;b.children.push(c);this._MoveCursor(a,c);break}else"#elif"===f&&(c=this._BuildExpression(e,5),b.children.push(c))}};e._MoveCursor=function(b,c){for(;b.canRead;){b.lineIndex++;var e=b.currentLine,f=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(e);if(f&&f.length)switch(f[0]){case "#ifdef":f=new a;c.children.push(f);e=this._BuildExpression(e,6);f.children.push(e);this._MoveCursorWithinIf(b,f,e);break;case "#else":case "#elif":return!0;
case "#endif":return!1;case "#ifndef":f=new a;c.children.push(f);e=this._BuildExpression(e,7);f.children.push(e);this._MoveCursorWithinIf(b,f,e);break;case "#if":f=new a,e=this._BuildExpression(e,3),c.children.push(f),f.children.push(e),this._MoveCursorWithinIf(b,f,e)}else f=new d,f.line=e,c.children.push(f),"#"===e[0]&&"d"===e[1]&&(e=e.replace(";","").split(" "),f.additionalDefineKey=e[1],3===e.length&&(f.additionalDefineValue=e[2]))}return!1};e._EvaluatePreProcessors=function(a,b,c){var e=new d,
h=new f;h.lineIndex=-1;h.lines=a.split("\n");this._MoveCursor(h,e);return e.process(b,c)};e._PreparePreProcessors=function(a){for(var b={},c=0,e=a.defines;c<e.length;c++){var d=e[c].replace("#define","").replace(";","").trim().split(" ");b[d[0]]=1<d.length?d[1]:""}b.GL_ES="true";b.__VERSION__=a.version;b[a.platformName]="true";return b};e._ProcessShaderConversion=function(a,b,c){a=this._ProcessPrecision(a,b);if(!b.processor)return a;if(-1!==a.indexOf("#version 3"))return a.replace("#version 300 es",
"");var e=b.defines,d=this._PreparePreProcessors(b);b.processor.preProcessor&&(a=b.processor.preProcessor(a,e,b.isFragment));a=this._EvaluatePreProcessors(a,d,b);b.processor.postProcessor&&(a=b.processor.postProcessor(a,e,b.isFragment,c));return a};e._ProcessIncludes=function(a,b,c){for(var d=this,f=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,h=f.exec(a),g=new String(a),k=!1;null!=h;){var n=h[1];-1!==n.indexOf("__decl__")&&(n=n.replace(/__decl__/,""),b.supportsUniformBuffers&&(n=n.replace(/Vertex/,"Ubo"),
n=n.replace(/Fragment/,"Ubo")),n+="Declaration");if(b.includesShadersStore[n]){var l=b.includesShadersStore[n];if(h[2])for(var m=h[3].split(","),r=0;r<m.length;r+=2)l=l.replace(new RegExp(m[r],"g"),m[r+1]);if(h[4])if(m=h[5],-1!==m.indexOf("..")){var p=m.split(".."),u=parseInt(p[0]);m=parseInt(p[1]);r=l.slice(0);l="";isNaN(m)&&(m=b.indexParameters[p[1]]);for(p=u;p<m;p++)b.supportsUniformBuffers||(r=r.replace(/light\{X\}.(\w*)/g,function(a,b){return b+"{X}"})),l+=r.replace(/\{X\}/g,p.toString())+"\n"}else b.supportsUniformBuffers||
(l=l.replace(/light\{X\}.(\w*)/g,function(a,b){return b+"{X}"})),l=l.replace(/\{X\}/g,m);g=g.replace(h[0],l);k=k||0<=l.indexOf("#include<")}else{e._FileToolsLoadFile(b.shadersRepository+"ShadersInclude/"+n+".fx",function(a){b.includesShadersStore[n]=a;d._ProcessIncludes(g,b,c)});return}h=f.exec(a)}k?this._ProcessIncludes(g.toString(),b,c):c(g)};e._FileToolsLoadFile=function(a,b,c,e,d,f){throw z.a.WarnImport("FileTools");};return e}()},HwNq:function(g,m,k){k.d(m,"a",function(){return l});var l=function(){function d(){}
d.prototype.attributeProcessor=function(d){return d.replace("attribute","in")};d.prototype.varyingProcessor=function(d,e){return d.replace("varying",e?"in":"out")};d.prototype.postProcessor=function(d,e,a){var c=-1!==d.search(/#extension.+GL_EXT_draw_buffers.+require/);d=d.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"");d=d.replace(/texture2D\s*\(/g,"texture(");if(a)d=d.replace(/texture2DLodEXT\s*\(/g,
"textureLod("),d=d.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),d=d.replace(/textureCube\s*\(/g,"texture("),d=d.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),d=d.replace(/gl_FragColor/g,"glFragColor"),d=d.replace(/gl_FragData/g,"glFragData"),d=d.replace(/void\s+?main\s*\(/g,(c?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==e.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+d;return d};return d}()},Yhyi:function(g,m,k){k.d(m,"a",function(){return l});
var l=function(){function d(){}d.prototype.postProcessor=function(d,e,a,c){c.getCaps().drawBuffersExtension||(d=d.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,""));return d};return d}()},avWN:function(g,m,k){},fBKG:function(g,m,k){var l=k("oYeq"),d=k("qUIE"),f=k("/sJ5"),e=k("ps+7"),a=k("YKqZ"),c=k("h87I");Object.defineProperty(d.a.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0});d.a.prototype._prepareVRComponent=
function(){this._vrExclusivePointerMode=this._vrSupported=!1;this.onVRDisplayChangedObservable=new e.a;this.onVRRequestPresentComplete=new e.a;this.onVRRequestPresentStart=new e.a};d.a.prototype.isVRDevicePresent=function(){return!!this._vrDisplay};d.a.prototype.getVRDevice=function(){return this._vrDisplay};d.a.prototype.initWebVR=function(){this.initWebVRAsync();return this.onVRDisplayChangedObservable};d.a.prototype.initWebVRAsync=function(){var a=this,c=function(){var b={vrDisplay:a._vrDisplay,
vrSupported:a._vrSupported};a.onVRDisplayChangedObservable.notifyObservers(b);a._webVRInitPromise=new Promise(function(a){a(b)})};if(!this._onVrDisplayConnect){this._onVrDisplayConnect=function(b){a._vrDisplay=b.display;c()};this._onVrDisplayDisconnect=function(){a._vrDisplay.cancelAnimationFrame(a._frameHandler);a._vrDisplay=void 0;a._frameHandler=d.a.QueueNewFrame(a._boundRenderFunction);c()};this._onVrDisplayPresentChange=function(){a._vrExclusivePointerMode=a._vrDisplay&&a._vrDisplay.isPresenting};
var e=this.getHostWindow();e&&(e.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),e.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),e.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange))}this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync();this._webVRInitPromise.then(c);return this._webVRInitPromise};d.a.prototype._getVRDisplaysAsync=function(){var a=this;return new Promise(function(b){navigator.getVRDisplays?navigator.getVRDisplays().then(function(c){a._vrSupported=
!0;a._vrDisplay=c[0];b({vrDisplay:a._vrDisplay,vrSupported:a._vrSupported})}):(a._vrDisplay=void 0,a._vrSupported=!1,b({vrDisplay:a._vrDisplay,vrSupported:a._vrSupported}))})};d.a.prototype.enableVR=function(a){var b=this;this._vrDisplay&&!this._vrDisplay.isPresenting&&(this.onVRRequestPresentStart.notifyObservers(this),a={highRefreshRate:this.vrPresentationAttributes?this.vrPresentationAttributes.highRefreshRate:!1,foveationLevel:this.vrPresentationAttributes?this.vrPresentationAttributes.foveationLevel:
1,multiview:(this.getCaps().multiview||this.getCaps().oculusMultiview)&&a.useMultiview},this._vrDisplay.requestPresent([Object(l.a)({source:this.getRenderingCanvas(),attributes:a},a)]).then(function(){b.onVRRequestPresentComplete.notifyObservers(!0);b._onVRFullScreenTriggered()}).catch(function(){b.onVRRequestPresentComplete.notifyObservers(!1)}))};d.a.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new f.a(this.getRenderWidth(),this.getRenderHeight());
this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var a=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1);this.setSize(2*a.renderWidth,a.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)};d.a.prototype.disableVR=function(){var a=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(function(){return a._onVRFullScreenTriggered()}).catch(function(){return a._onVRFullScreenTriggered()});
c.a.IsWindowObjectExist()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",
this._onVrDisplayPresentChange),this._onVrDisplayDisconnect=this._onVrDisplayConnect=null))};d.a.prototype._connectVREvents=function(a,d){var b=this;this._onVRDisplayPointerRestricted=function(){a&&a.requestPointerLock()};this._onVRDisplayPointerUnrestricted=function(){if(d)d.exitPointerLock&&d.exitPointerLock();else{var a=b.getHostWindow();a.document&&a.document.exitPointerLock&&a.document.exitPointerLock()}};if(c.a.IsWindowObjectExist()){var e=this.getHostWindow();e.addEventListener("vrdisplaypointerrestricted",
this._onVRDisplayPointerRestricted,!1);e.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)}};d.a.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(b){a.b.Warn("webVR submitFrame has had an unexpected failure: "+b)}};d.a.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting};d.a.prototype._requestVRFrame=function(){this._frameHandler=d.a.QueueNewFrame(this._boundRenderFunction,
this._vrDisplay)}},firj:function(g,m,k){function l(a){var c=function(b){return a&&(a===b||a.match(new RegExp("\\b"+b+"\\b","g")))};if(this._excludedCompressedTextures&&this._excludedCompressedTextures.some(c))return a;c=a.lastIndexOf(".");var b=a.lastIndexOf("?");b=-1<b?a.substring(b,a.length):"";return(-1<c?a.substring(0,c):a)+this._textureFormatInUse+b}k("+zdb");g=k("qUIE");var d=k("ikaq"),f=k("OVZ0"),e=function(){return function(){this.occlusionInternalRetryCounter=0;this.isOccluded=this.isOcclusionQueryInProgress=
!1;this.occlusionRetryCount=-1;this.occlusionType=d.a.OCCLUSION_TYPE_NONE;this.occlusionQueryAlgorithmType=d.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE}}();g.a.prototype.createQuery=function(){return this._gl.createQuery()};g.a.prototype.deleteQuery=function(a){this._gl.deleteQuery(a);return this};g.a.prototype.isQueryResultAvailable=function(a){return this._gl.getQueryParameter(a,this._gl.QUERY_RESULT_AVAILABLE)};g.a.prototype.getQueryResult=function(a){return this._gl.getQueryParameter(a,this._gl.QUERY_RESULT)};
g.a.prototype.beginOcclusionQuery=function(a,c){a=this._getGlAlgorithmType(a);this._gl.beginQuery(a,c);return this};g.a.prototype.endOcclusionQuery=function(a){a=this._getGlAlgorithmType(a);this._gl.endQuery(a);return this};g.a.prototype._createTimeQuery=function(){var a=this.getCaps().timerQuery;return a.createQueryEXT?a.createQueryEXT():this.createQuery()};g.a.prototype._deleteTimeQuery=function(a){var c=this.getCaps().timerQuery;c.deleteQueryEXT?c.deleteQueryEXT(a):this.deleteQuery(a)};g.a.prototype._getTimeQueryResult=
function(a){var c=this.getCaps().timerQuery;return c.getQueryObjectEXT?c.getQueryObjectEXT(a,c.QUERY_RESULT_EXT):this.getQueryResult(a)};g.a.prototype._getTimeQueryAvailability=function(a){var c=this.getCaps().timerQuery;return c.getQueryObjectEXT?c.getQueryObjectEXT(a,c.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(a)};g.a.prototype.startTimeQuery=function(){var a=this.getCaps(),c=a.timerQuery;if(!c)return null;var b=new f.a;this._gl.getParameter(c.GPU_DISJOINT_EXT);if(a.canUseTimestampForTimerQuery)b._startTimeQuery=
this._createTimeQuery(),c.queryCounterEXT(b._startTimeQuery,c.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;b._timeElapsedQuery=this._createTimeQuery();c.beginQueryEXT?c.beginQueryEXT(c.TIME_ELAPSED_EXT,b._timeElapsedQuery):this._gl.beginQuery(c.TIME_ELAPSED_EXT,b._timeElapsedQuery);this._currentNonTimestampToken=b}return b};g.a.prototype.endTimeQuery=function(a){var c=this.getCaps(),b=c.timerQuery;if(!b||!a)return-1;if(c.canUseTimestampForTimerQuery){if(!a._startTimeQuery)return-1;
a._endTimeQuery||(a._endTimeQuery=this._createTimeQuery(),b.queryCounterEXT(a._endTimeQuery,b.TIMESTAMP_EXT))}else if(!a._timeElapsedQueryEnded){if(!a._timeElapsedQuery)return-1;b.endQueryEXT?b.endQueryEXT(b.TIME_ELAPSED_EXT):this._gl.endQuery(b.TIME_ELAPSED_EXT);a._timeElapsedQueryEnded=!0}b=this._gl.getParameter(b.GPU_DISJOINT_EXT);var d=!1;a._endTimeQuery?d=this._getTimeQueryAvailability(a._endTimeQuery):a._timeElapsedQuery&&(d=this._getTimeQueryAvailability(a._timeElapsedQuery));if(d&&!b){if(c.canUseTimestampForTimerQuery){if(!a._startTimeQuery||
!a._endTimeQuery)return-1;c=this._getTimeQueryResult(a._startTimeQuery);c=this._getTimeQueryResult(a._endTimeQuery)-c;this._deleteTimeQuery(a._startTimeQuery);this._deleteTimeQuery(a._endTimeQuery);a._startTimeQuery=null;a._endTimeQuery=null}else{if(!a._timeElapsedQuery)return-1;c=this._getTimeQueryResult(a._timeElapsedQuery);this._deleteTimeQuery(a._timeElapsedQuery);a._timeElapsedQuery=null;a._timeElapsedQueryEnded=!1;this._currentNonTimestampToken=null}return c}return-1};g.a.prototype._getGlAlgorithmType=
function(a){return a===d.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED};Object.defineProperty(d.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(a){this._occlusionDataStorage.isOcclusionQueryInProgress=a},enumerable:!1,configurable:!0});Object.defineProperty(d.a.prototype,"_occlusionDataStorage",{get:function(){this.__occlusionDataStorage||(this.__occlusionDataStorage=
new e);return this.__occlusionDataStorage},enumerable:!1,configurable:!0});Object.defineProperty(d.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(a){this._occlusionDataStorage.isOccluded=a},enumerable:!0,configurable:!0});Object.defineProperty(d.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(a){this._occlusionDataStorage.occlusionQueryAlgorithmType=a},enumerable:!0,
configurable:!0});Object.defineProperty(d.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(a){this._occlusionDataStorage.occlusionType=a},enumerable:!0,configurable:!0});Object.defineProperty(d.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(a){this._occlusionDataStorage.occlusionRetryCount=a},enumerable:!0,configurable:!0});d.a.prototype._checkOcclusionQuery=function(){var a=
this._occlusionDataStorage;if(a.occlusionType===d.a.OCCLUSION_TYPE_NONE)return a.isOccluded=!1;var c=this.getEngine();if(2>c.webGLVersion||!c.isQueryResultAvailable)return a.isOccluded=!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(c.isQueryResultAvailable(this._occlusionQuery)){var b=c.getQueryResult(this._occlusionQuery);a.isOcclusionQueryInProgress=!1;a.occlusionInternalRetryCounter=0;a.isOccluded=1===b?!1:!0}else if(a.occlusionInternalRetryCounter++,-1!==a.occlusionRetryCount&&
a.occlusionInternalRetryCounter>a.occlusionRetryCount)a.isOcclusionQueryInProgress=!1,a.occlusionInternalRetryCounter=0,a.isOccluded=a.occlusionType===d.a.OCCLUSION_TYPE_OPTIMISTIC?!1:a.isOccluded;else return!1;b=this.getScene();b.getBoundingBoxRenderer&&(b=b.getBoundingBoxRenderer(),this._occlusionQuery||(this._occlusionQuery=c.createQuery()),c.beginOcclusionQuery(a.occlusionQueryAlgorithmType,this._occlusionQuery),b.renderOcclusionBoundingBox(this),c.endOcclusionQuery(a.occlusionQueryAlgorithmType),
this._occlusionDataStorage.isOcclusionQueryInProgress=!0);return a.isOccluded};g.a.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()};g.a.prototype.deleteTransformFeedback=function(a){this._gl.deleteTransformFeedback(a)};g.a.prototype.bindTransformFeedback=function(a){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,a)};g.a.prototype.beginTransformFeedback=function(a){void 0===a&&(a=!0);this._gl.beginTransformFeedback(a?this._gl.POINTS:this._gl.TRIANGLES)};
g.a.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()};g.a.prototype.setTranformFeedbackVaryings=function(a,c){this._gl.transformFeedbackVaryings(a,c,this._gl.INTERLEAVED_ATTRIBS)};g.a.prototype.bindTransformFeedbackBuffer=function(a){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,a?a.underlyingResource:null)};k("k5Kv");k("83xy");k("vD8D");k("gXZW");k("+0P/");k("99gS");k("DvRB");k("3XS9");k("fBKG");k("3NAF");k("/4XI");(function(){return function(){}})();g.a.prototype.getInputElement=
function(){return this.inputElement||this.getRenderingCanvas()};g.a.prototype.registerView=function(a,c){var b=this;this.views||(this.views=[]);for(var d=0,e=this.views;d<e.length;d++){var f=e[d];if(f.target===a)return f}if(d=this.getRenderingCanvas())a.width=d.width,a.height=d.height;d={target:a,camera:c};this.views.push(d);c&&c.onDisposeObservable.add(function(){b.unRegisterView(a)});return d};g.a.prototype.unRegisterView=function(a){if(!this.views)return this;for(var c=0,b=this.views;c<b.length;c++){var d=
b[c];if(d.target===a){a=this.views.indexOf(d);-1!==a&&this.views.splice(a,1);break}}return this};g.a.prototype._renderViews=function(){if(!this.views)return!1;var a=this.getRenderingCanvas();if(!a)return!1;for(var c=0,b=this.views;c<b.length;c++){var d=b[c],e=d.target,f=e.getContext("2d");if(f){var g=d.camera,k=null,l=null;if(g){l=g.getScene();if(l.activeCameras&&l.activeCameras.length)continue;this.activeView=d;k=l.activeCamera;l.activeCamera=g}d=e.width!==e.clientWidth||e.height!==e.clientHeight;
e.clientWidth&&e.clientHeight&&d&&(e.width=e.clientWidth,e.height=e.clientHeight,a.width=e.clientWidth,a.height=e.clientHeight,this.resize());if(!a.width||!a.height)return!1;this._renderFrame();f.drawImage(a,0,0);k&&l&&(l.activeCamera=k)}}this.activeView=null;return!0};k("s+Kb");Object.defineProperty(g.a.prototype,"texturesSupported",{get:function(){var a=[];this._caps.astc&&a.push("-astc.ktx");this._caps.s3tc&&a.push("-dxt.ktx");this._caps.pvrtc&&a.push("-pvrtc.ktx");this._caps.etc2&&a.push("-etc2.ktx");
this._caps.etc1&&a.push("-etc1.ktx");return a},enumerable:!0,configurable:!0});Object.defineProperty(g.a.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse||null},enumerable:!0,configurable:!0});g.a.prototype.setCompressedTextureExclusions=function(a){this._excludedCompressedTextures=a};g.a.prototype.setTextureFormatToUse=function(a){for(var c=this.texturesSupported,b=0,d=c.length;b<d;b++)for(var e=0,f=a.length;e<f;e++)if(c[b]===a[e].toLowerCase())return this._transformTextureUrl=
l.bind(this),this._textureFormatInUse=c[b];this._textureFormatInUse="";return this._transformTextureUrl=null}},gXZW:function(g,m,k){g=k("h13i");var l=k("O3Sr");g.a.prototype.updateVideoTexture=function(d,f,e){if(d&&!d._isDisabled){var a=this._bindTextureDirectly(this._gl.TEXTURE_2D,d,!0);this._unpackFlipY(!e);try{void 0===this._videoTextureSupported&&(this._gl.getError(),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,f),0!==this._gl.getError()?this._videoTextureSupported=
!1:this._videoTextureSupported=!0);if(this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,f);else{if(!d._workingCanvas){d._workingCanvas=l.a.CreateCanvas(d.width,d.height);var c=d._workingCanvas.getContext("2d");if(!c)throw Error("Unable to get 2d context");d._workingContext=c;d._workingCanvas.width=d.width;d._workingCanvas.height=d.height}d._workingContext.clearRect(0,0,d.width,d.height);d._workingContext.drawImage(f,0,0,f.videoWidth,
f.videoHeight,0,0,d.width,d.height);this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,d._workingCanvas)}d.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);a||this._bindTextureDirectly(this._gl.TEXTURE_2D,null);d.isReady=!0}catch(b){d._isDisabled=!0}}}},k5Kv:function(g,m,k){g=k("CAkI");m=k("qUIE");var l=k("tVVT"),d=k("k2R8"),f=k("/SR9"),e=k("Qmvu"),a=k("Als7"),c=k("DwXJ");m.a.prototype.createMultiviewRenderTargetTexture=function(a,c){var b=this._gl;
if(!this.getCaps().multiview)throw"Multiview is not supported";var e=new d.a(this,d.b.Unknown,!0);e.width=a;e.height=c;e._framebuffer=b.createFramebuffer();e._colorTextureArray=b.createTexture();b.bindTexture(b.TEXTURE_2D_ARRAY,e._colorTextureArray);b.texStorage3D(b.TEXTURE_2D_ARRAY,1,b.RGBA8,a,c,2);e._depthStencilTextureArray=b.createTexture();b.bindTexture(b.TEXTURE_2D_ARRAY,e._depthStencilTextureArray);b.texStorage3D(b.TEXTURE_2D_ARRAY,1,b.DEPTH32F_STENCIL8,a,c,2);e.isReady=!0;return e};m.a.prototype.bindMultiviewFramebuffer=
function(a){var b=this._gl,c=this.getCaps().oculusMultiview||this.getCaps().multiview;this.bindFramebuffer(a,void 0,void 0,void 0,!0);b.bindFramebuffer(b.DRAW_FRAMEBUFFER,a._framebuffer);if(a._colorTextureArray&&a._depthStencilTextureArray)this.getCaps().oculusMultiview?(c.framebufferTextureMultisampleMultiviewOVR(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0,a._colorTextureArray,0,a.samples,0,2),c.framebufferTextureMultisampleMultiviewOVR(b.DRAW_FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,a._depthStencilTextureArray,
0,a.samples,0,2)):(c.framebufferTextureMultiviewOVR(b.DRAW_FRAMEBUFFER,b.COLOR_ATTACHMENT0,a._colorTextureArray,0,0,2),c.framebufferTextureMultiviewOVR(b.DRAW_FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,a._depthStencilTextureArray,0,0,2));else throw"Invalid multiview frame buffer";};g.a.prototype._useMultiviewToSingleView=!1;g.a.prototype._multiviewTexture=null;g.a.prototype._resizeOrCreateMultiviewTexture=function(b,c){if(!this._multiviewTexture)this._multiviewTexture=new a.a(this.getScene(),{width:b,
height:c});else if(this._multiviewTexture.getRenderWidth()!=b||this._multiviewTexture.getRenderHeight()!=c)this._multiviewTexture.dispose(),this._multiviewTexture=new a.a(this.getScene(),{width:b,height:c})};l.a.prototype._transformMatrixR=f.a.Zero();l.a.prototype._multiviewSceneUbo=null;l.a.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=new e.a(this.getEngine(),void 0,!0);this._multiviewSceneUbo.addUniform("viewProjection",16);this._multiviewSceneUbo.addUniform("viewProjectionR",
16);this._multiviewSceneUbo.addUniform("view",16)};l.a.prototype._updateMultiviewUbo=function(a,d){a&&d&&a.multiplyToRef(d,this._transformMatrixR);a&&d&&(a.multiplyToRef(d,f.c.Matrix[0]),c.a.GetRightPlaneToRef(f.c.Matrix[0],this._frustumPlanes[3]));this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.update())};
l.a.prototype._renderMultiviewToSingleView=function(a){a._resizeOrCreateMultiviewTexture(a._rigPostProcess&&a._rigPostProcess&&0<a._rigPostProcess.width?a._rigPostProcess.width:this.getEngine().getRenderWidth(!0),a._rigPostProcess&&a._rigPostProcess&&0<a._rigPostProcess.height?a._rigPostProcess.height:this.getEngine().getRenderHeight(!0));this._multiviewSceneUbo||this._createMultiviewUbo();a.outputRenderTarget=a._multiviewTexture;this._renderForCamera(a);a.outputRenderTarget=null;for(var b=0;b<a._rigCameras.length;b++){var c=
this.getEngine();this._activeCamera=a._rigCameras[b];c.setViewport(this._activeCamera.viewport);this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}}},"s+Kb":function(g,m,k){k("h13i").a.prototype._readTexturePixels=function(g,d,f,e,a,c){void 0===e&&(e=-1);void 0===a&&(a=0);void 0===c&&(c=null);var b=this._gl;if(!b)throw Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var h=b.createFramebuffer();
if(!h)throw Error("Unable to create dummy framebuffer");this._dummyFramebuffer=h}b.bindFramebuffer(b.FRAMEBUFFER,this._dummyFramebuffer);-1<e?b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+e,g._webGLTexture,a):b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,g._webGLTexture,a);g=void 0!==g.type?this._getWebGLTextureType(g.type):b.UNSIGNED_BYTE;switch(g){case b.UNSIGNED_BYTE:c||(c=new Uint8Array(4*d*f));g=b.UNSIGNED_BYTE;break;default:c||
(c=new Float32Array(4*d*f)),g=b.FLOAT}b.readPixels(0,0,d,f,b.RGBA,g,c);b.bindFramebuffer(b.FRAMEBUFFER,this._currentFramebuffer);return c}},sBHe:function(g,m,k){k.d(m,"a",function(){return l});var l=function(){function d(){this.programValidationError=this.programLinkError=this.fragmentCompilationError=this.vertexCompilationError=null}Object.defineProperty(d.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"isReady",
{get:function(){return this.program?this.isParallelCompiled?this.engine._isRenderingStateCompiled(this):!0:!1},enumerable:!1,configurable:!0});d.prototype._handlesSpectorRebuildCallback=function(d){d&&this.program&&d(this.program)};d.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null};d.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null};return d}()},vD8D:function(g,
m,k){var l=k("h13i"),d=k("k2R8");l.a.prototype.createDynamicTexture=function(f,e,a,c){var b=new d.a(this,d.b.Dynamic);b.baseWidth=f;b.baseHeight=e;a&&(f=this.needPOTTextures?l.a.GetExponentOfTwo(f,this._caps.maxTextureSize):f,e=this.needPOTTextures?l.a.GetExponentOfTwo(e,this._caps.maxTextureSize):e);b.width=f;b.height=e;b.isReady=!1;b.generateMipMaps=a;b.samplingMode=c;this.updateTextureSamplingMode(c,b);this._internalTexturesCache.push(b);return b};l.a.prototype.updateDynamicTexture=function(d,
e,a,c,b,g){void 0===c&&(c=!1);void 0===g&&(g=!1);if(d){var f=this._gl,h=f.TEXTURE_2D;g=this._bindTextureDirectly(h,d,!0,g);this._unpackFlipY(void 0===a?d.invertY:a);c&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);a=this._getWebGLTextureType(d.type);b=this._getInternalFormat(b?b:d.format);var k=this._getRGBABufferInternalSizedFormat(d.type,b);f.texImage2D(h,0,k,b,a,e);d.generateMipMaps&&f.generateMipmap(h);g||this._bindTextureDirectly(h,null);c&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
0);d.isReady=!0}}}}]);
