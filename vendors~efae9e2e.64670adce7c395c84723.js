(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"9aEo":function(y,w,f){f.d(w,"a",function(){return k});var m=f("/SR9"),h=f("uyO6"),q=f("LVN+"),l=f("4gN4"),p=f("y4Ty"),u=f("UtUh"),x=f("SgR9"),n=f("IIC5"),c=f("7uBm"),a=f("sH6m"),b=f("MhaC"),k=function(){function e(d,g,a){var b=this;void 0===d&&(d=!0);void 0===g&&(g=Ammo);void 0===a&&(a=null);this._useDeltaForWorldStep=d;this.bjsAMMO={};this.name="AmmoJSPlugin";this._timeStep=1/60;this._fixedTimeStep=1/60;this._maxSteps=5;this._tmpQuaternion=
new m.b;this._tmpContactCallbackResult=!1;this._tmpContactPoint=new m.e;this._tmpMatrix=new m.a;"function"===typeof g?g(this.bjsAMMO):this.bjsAMMO=g;this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=a||new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,
this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(d,a,g,v){d=b.bjsAMMO.wrapPointer(d,Ammo.btManifoldPoint);d=d.getPositionWorldOnA();b._tmpContactPoint.x=d.x();b._tmpContactPoint.y=d.y();b._tmpContactPoint.z=d.z();b._tmpContactCallbackResult=
!0},this._raycastResult=new c.a,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):h.a.Error("AmmoJS is not available. Please make sure you included the js file.")}e.prototype.setGravity=
function(d){this._tmpAmmoVectorA.setValue(d.x,d.y,d.z);this.world.setGravity(this._tmpAmmoVectorA);this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)};e.prototype.setTimeStep=function(d){this._timeStep=d};e.prototype.setFixedTimeStep=function(d){this._fixedTimeStep=d};e.prototype.setMaxSteps=function(d){this._maxSteps=d};e.prototype.getTimeStep=function(){return this._timeStep};e.prototype._isImpostorInContact=function(d){this._tmpContactCallbackResult=!1;this.world.contactTest(d.physicsBody,
this._tmpAmmoConcreteContactResultCallback);return this._tmpContactCallbackResult};e.prototype._isImpostorPairInContact=function(d,a){this._tmpContactCallbackResult=!1;this.world.contactPairTest(d.physicsBody,a.physicsBody,this._tmpAmmoConcreteContactResultCallback);return this._tmpContactCallbackResult};e.prototype._stepSimulation=function(d,a,b){void 0===d&&(d=1/60);void 0===a&&(a=10);void 0===b&&(b=1/60);if(0==a)this.world.stepSimulation(d,0);else for(;0<a&&0<d;)d-b<b?(this.world.stepSimulation(d,
0),d=0):(d-=b,this.world.stepSimulation(b,0)),a--};e.prototype.executeStep=function(d,a){for(var g=0;g<a.length;g++){var b=a[g];b.soft||b.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?d:this._timeStep,this._maxSteps,this._fixedTimeStep);for(d=0;d<a.length;d++)if(g=a[d],g.soft?this._afterSoftStep(g):g.afterStep(),0<g._onPhysicsCollideCallbacks.length&&this._isImpostorInContact(g)){b=0;for(var c=g._onPhysicsCollideCallbacks;b<c.length;b++)for(var e=0,k=c[b].otherImpostors;e<k.length;e++){var r=
k[e];(g.physicsBody.isActive()||r.physicsBody.isActive())&&this._isImpostorPairInContact(g,r)&&(g.onCollide({body:r.physicsBody,point:this._tmpContactPoint}),r.onCollide({body:g.physicsBody,point:this._tmpContactPoint}))}}};e.prototype._afterSoftStep=function(d){d.type===q.a.RopeImpostor?this._ropeStep(d):this._softbodyOrClothStep(d)};e.prototype._ropeStep=function(d){for(var a=d.physicsBody.get_m_nodes(),b=a.size(),c,e,k,t=[],r=0;r<b;r++)c=a.at(r),e=c.get_m_x(),c=e.x(),k=e.y(),e=e.z(),t.push(new m.e(c,
k,e));a=d.object;b=d.getParam("shape");d.object=d._isFromLine?n.a.CreateLines("lines",{points:t,instance:a}):x.a.ExtrudeShape("ext",{shape:b,path:t,instance:a})};e.prototype._softbodyOrClothStep=function(d){var a=d.type===q.a.ClothImpostor?1:-1,b=d.object,e=b.getVerticesData(p.b.PositionKind);e||(e=[]);var c=b.getVerticesData(p.b.NormalKind);c||(c=[]);var k=e.length/3;d=d.physicsBody.get_m_nodes();for(var t,r,h,n,f,m,l=0;l<k;l++)t=d.at(l),r=t.get_m_x(),n=r.x(),f=r.y(),r=r.z()*a,h=t.get_m_n(),t=h.x(),
m=h.y(),h=h.z()*a,e[3*l]=n,e[3*l+1]=f,e[3*l+2]=r,c[3*l]=t,c[3*l+1]=m,c[3*l+2]=h;a=new u.a;a.positions=e;a.normals=c;a.uvs=b.getVerticesData(p.b.UVKind);a.colors=b.getVerticesData(p.b.ColorKind);b&&b.getIndices&&(a.indices=b.getIndices());a.applyToMesh(b)};e.prototype.applyImpulse=function(d,a,b){if(d.soft)h.a.Warn("Cannot be applied to a soft body");else{d.physicsBody.activate();var g=this._tmpAmmoVectorA,e=this._tmpAmmoVectorB;d.object&&d.object.getWorldMatrix&&b.subtractInPlace(d.object.getWorldMatrix().getTranslation());
g.setValue(b.x,b.y,b.z);e.setValue(a.x,a.y,a.z);d.physicsBody.applyImpulse(e,g)}};e.prototype.applyForce=function(d,a,b){if(d.soft)h.a.Warn("Cannot be applied to a soft body");else{d.physicsBody.activate();var g=this._tmpAmmoVectorA,e=this._tmpAmmoVectorB;d.object&&d.object.getWorldMatrix&&b.subtractInPlace(d.object.getWorldMatrix().getTranslation());g.setValue(b.x,b.y,b.z);e.setValue(a.x,a.y,a.z);d.physicsBody.applyForce(e,g)}};e.prototype.generatePhysicsBody=function(d){d._pluginData.toDispose=
[];if(d.parent)d.physicsBody&&(this.removePhysicsBody(d),d.forceUpdate());else if(d.isBodyInitRequired()){var a=this._createShape(d),b=d.getParam("mass");d._pluginData.mass=b;if(d.soft)a.get_m_cfg().set_collisions(17),a.get_m_cfg().set_kDP(d.getParam("damping")),this.bjsAMMO.castObject(a,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(d.getParam("margin")),a.setActivationState(e.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(a,1,-1),d.physicsBody=a,d._pluginData.toDispose.push(a),
this.setBodyPressure(d,0),d.type===q.a.SoftbodyImpostor&&this.setBodyPressure(d,d.getParam("pressure")),this.setBodyStiffness(d,d.getParam("stiffness")),this.setBodyVelocityIterations(d,d.getParam("velocityIterations")),this.setBodyPositionIterations(d,d.getParam("positionIterations"));else{var c=new this.bjsAMMO.btVector3(0,0,0),k=new this.bjsAMMO.btTransform;k.setIdentity();0!==b&&a.calculateLocalInertia(b,c);this._tmpAmmoVectorA.setValue(d.object.position.x,d.object.position.y,d.object.position.z);
this._tmpAmmoQuaternion.setValue(d.object.rotationQuaternion.x,d.object.rotationQuaternion.y,d.object.rotationQuaternion.z,d.object.rotationQuaternion.w);k.setOrigin(this._tmpAmmoVectorA);k.setRotation(this._tmpAmmoQuaternion);var z=new this.bjsAMMO.btDefaultMotionState(k),t=new this.bjsAMMO.btRigidBodyConstructionInfo(b,z,a,c),r=new this.bjsAMMO.btRigidBody(t);0===b&&(r.setCollisionFlags(r.getCollisionFlags()|e.KINEMATIC_FLAG),r.setActivationState(e.DISABLE_DEACTIVATION_FLAG));d.type!=q.a.NoImpostor||
a.getChildShape||r.setCollisionFlags(r.getCollisionFlags()|e.DISABLE_COLLISION_FLAG);b=d.getParam("group");var h=d.getParam("mask");b&&h?this.world.addRigidBody(r,b,h):this.world.addRigidBody(r);d.physicsBody=r;d._pluginData.toDispose=d._pluginData.toDispose.concat([r,t,z,k,c,a])}this.setBodyRestitution(d,d.getParam("restitution"));this.setBodyFriction(d,d.getParam("friction"))}};e.prototype.removePhysicsBody=function(d){var a=this;this.world&&(d.soft?this.world.removeSoftBody(d.physicsBody):this.world.removeRigidBody(d.physicsBody),
d._pluginData&&(d._pluginData.toDispose.forEach(function(d){a.bjsAMMO.destroy(d)}),d._pluginData.toDispose=[]))};e.prototype.generateJoint=function(d){var a=d.mainImpostor.physicsBody,b=d.connectedImpostor.physicsBody;if(a&&b){var e=d.joint.jointData;e.mainPivot||(e.mainPivot=new m.e(0,0,0));e.connectedPivot||(e.connectedPivot=new m.e(0,0,0));switch(d.joint.type){case l.a.DistanceJoint:var c=e.maxDistance;c&&(e.mainPivot=new m.e(0,-c/2,0),e.connectedPivot=new m.e(0,c/2,0));a=new this.bjsAMMO.btPoint2PointConstraint(a,
b,new this.bjsAMMO.btVector3(e.mainPivot.x,e.mainPivot.y,e.mainPivot.z),new this.bjsAMMO.btVector3(e.connectedPivot.x,e.connectedPivot.y,e.connectedPivot.z));break;case l.a.HingeJoint:e.mainAxis||(e.mainAxis=new m.e(0,0,0));e.connectedAxis||(e.connectedAxis=new m.e(0,0,0));c=new this.bjsAMMO.btVector3(e.mainAxis.x,e.mainAxis.y,e.mainAxis.z);var k=new this.bjsAMMO.btVector3(e.connectedAxis.x,e.connectedAxis.y,e.connectedAxis.z);a=new this.bjsAMMO.btHingeConstraint(a,b,new this.bjsAMMO.btVector3(e.mainPivot.x,
e.mainPivot.y,e.mainPivot.z),new this.bjsAMMO.btVector3(e.connectedPivot.x,e.connectedPivot.y,e.connectedPivot.z),c,k);break;case l.a.BallAndSocketJoint:a=new this.bjsAMMO.btPoint2PointConstraint(a,b,new this.bjsAMMO.btVector3(e.mainPivot.x,e.mainPivot.y,e.mainPivot.z),new this.bjsAMMO.btVector3(e.connectedPivot.x,e.connectedPivot.y,e.connectedPivot.z));break;default:h.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),a=new this.bjsAMMO.btPoint2PointConstraint(a,
b,new this.bjsAMMO.btVector3(e.mainPivot.x,e.mainPivot.y,e.mainPivot.z),new this.bjsAMMO.btVector3(e.connectedPivot.x,e.connectedPivot.y,e.connectedPivot.z))}this.world.addConstraint(a,!d.joint.jointData.collision);d.joint.physicsJoint=a}};e.prototype.removeJoint=function(d){this.world&&this.world.removeConstraint(d.joint.physicsJoint)};e.prototype._addMeshVerts=function(d,a,b){var e=this,g=0;if(b&&b.getIndices&&b.getWorldMatrix&&b.getChildMeshes){var c=b.getIndices();c||(c=[]);var k=b.getVerticesData(p.b.PositionKind);
k||(k=[]);b.computeWorldMatrix(!1);for(var v=c.length/3,h=0;h<v;h++){for(var n=[],f=0;3>f;f++){var l=new m.e(k[3*c[3*h+f]],k[3*c[3*h+f]+1],k[3*c[3*h+f]+2]);m.a.ScalingToRef(b.scaling.x,b.scaling.y,b.scaling.z,this._tmpMatrix);l=m.e.TransformCoordinates(l,this._tmpMatrix);var q=0==f?this._tmpAmmoVectorA:1==f?this._tmpAmmoVectorB:this._tmpAmmoVectorC;q.setValue(l.x,l.y,l.z);n.push(q)}d.addTriangle(n[0],n[1],n[2]);g++}b.getChildMeshes().forEach(function(b){g+=e._addMeshVerts(d,a,b)})}return g};e.prototype._softVertexData=
function(d){if((d=d.object)&&d.getIndices&&d.getWorldMatrix&&d.getChildMeshes){d.getIndices();var a=d.getVerticesData(p.b.PositionKind);a||(a=[]);var b=d.getVerticesData(p.b.NormalKind);b||(b=[]);d.computeWorldMatrix(!1);for(var e=[],c=[],k=0;k<a.length;k+=3){var h=new m.e(a[k],a[k+1],a[k+2]),f=new m.e(b[k],b[k+1],b[k+2]);h=m.e.TransformCoordinates(h,d.getWorldMatrix());f=m.e.TransformNormal(f,d.getWorldMatrix());e.push(h.x,h.y,h.z);c.push(f.x,f.y,f.z)}a=new u.a;a.positions=e;a.normals=c;a.uvs=d.getVerticesData(p.b.UVKind);
a.colors=d.getVerticesData(p.b.ColorKind);d&&d.getIndices&&(a.indices=d.getIndices());a.applyToMesh(d);d.position=m.e.Zero();d.rotationQuaternion=null;d.rotation=m.e.Zero();d.computeWorldMatrix(!0);return a}return u.a.ExtractFromMesh(d)};e.prototype._createSoftbody=function(d){var a=d.object;if(a&&a.getIndices){var b=a.getIndices();b||(b=[]);d=this._softVertexData(d);var e=d.positions,c=d.normals;if(null===e||null===c)return new this.bjsAMMO.btCompoundShape;var k=[];d=[];for(var h=0;h<e.length;h+=
3){var f=new m.e(e[h],e[h+1],e[h+2]),n=new m.e(c[h],c[h+1],c[h+2]);k.push(f.x,f.y,-f.z);d.push(n.x,n.y,-n.z)}a=(new this.bjsAMMO.btSoftBodyHelpers).CreateFromTriMesh(this.world.getWorldInfo(),k,a.getIndices(),b.length/3,!0);b=e.length/3;e=a.get_m_nodes();for(h=0;h<b;h++)c=e.at(h),c=c.get_m_n(),c.setX(d[3*h]),c.setY(d[3*h+1]),c.setZ(d[3*h+2]);return a}};e.prototype._createCloth=function(d){var a=d.object;if(a&&a.getIndices){a.getIndices();var b=this._softVertexData(d);a=b.positions;b=b.normals;if(null===
a||null===b)return new this.bjsAMMO.btCompoundShape;b=a.length;var e=Math.sqrt(b/3);d.segments=e;var c=e-1;this._tmpAmmoVectorA.setValue(a[0],a[1],a[2]);this._tmpAmmoVectorB.setValue(a[3*c],a[3*c+1],a[3*c+2]);this._tmpAmmoVectorD.setValue(a[b-3],a[b-2],a[b-1]);this._tmpAmmoVectorC.setValue(a[b-3-3*c],a[b-2-3*c],a[b-1-3*c]);return(new this.bjsAMMO.btSoftBodyHelpers).CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,e,e,d.getParam("fixedPoints"),
!0)}};e.prototype._createRope=function(d){var a=this._softVertexData(d);var b=a.positions;var e=a.normals;if(null===b||null===e)return new this.bjsAMMO.btCompoundShape;a.applyToMesh(d.object,!0);d._isFromLine=!0;if(0===e.map(function(d){return d*d}).reduce(function(d,a){return d+a}))e=b.length,a=e/3-1,this._tmpAmmoVectorA.setValue(b[0],b[1],b[2]),this._tmpAmmoVectorB.setValue(b[e-3],b[e-2],b[e-1]);else{d._isFromLine=!1;var c=d.getParam("path");if(null===d.getParam("shape"))return h.a.Warn("No shape available for extruded mesh"),
new this.bjsAMMO.btCompoundShape;if(0!==b.length%(3*c.length))return h.a.Warn("Path does not match extrusion"),new this.bjsAMMO.btCompoundShape;e=c.length;a=e-1;this._tmpAmmoVectorA.setValue(c[0].x,c[0].y,c[0].z);this._tmpAmmoVectorB.setValue(c[e-1].x,c[e-1].y,c[e-1].z)}d.segments=a;d=d.getParam("fixedPoints");d=3<d?3:d;d=(new this.bjsAMMO.btSoftBodyHelpers).CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,a-1,d);d.get_m_cfg().set_collisions(17);return d};e.prototype._createCustom=
function(d){var a=null;this.onCreateCustomShape&&(a=this.onCreateCustomShape(d));null==a&&(a=new this.bjsAMMO.btCompoundShape);return a};e.prototype._addHullVerts=function(d,a,b){var e=this,c=0;if(b&&b.getIndices&&b.getWorldMatrix&&b.getChildMeshes){var g=b.getIndices();g||(g=[]);var k=b.getVerticesData(p.b.PositionKind);k||(k=[]);b.computeWorldMatrix(!1);for(var h=g.length/3,v=0;v<h;v++){for(var f=[],n=0;3>n;n++){var l=new m.e(k[3*g[3*v+n]],k[3*g[3*v+n]+1],k[3*g[3*v+n]+2]);m.a.ScalingToRef(b.scaling.x,
b.scaling.y,b.scaling.z,this._tmpMatrix);l=m.e.TransformCoordinates(l,this._tmpMatrix);var q=0==n?this._tmpAmmoVectorA:1==n?this._tmpAmmoVectorB:this._tmpAmmoVectorC;q.setValue(l.x,l.y,l.z);f.push(q)}d.addPoint(f[0],!0);d.addPoint(f[1],!0);d.addPoint(f[2],!0);c++}b.getChildMeshes().forEach(function(b){c+=e._addHullVerts(d,a,b)})}return c};e.prototype._createShape=function(d,b){var e=this;void 0===b&&(b=!1);var c=d.object,g=d.getObjectExtendSize();if(!b){b=d.object.getChildMeshes?d.object.getChildMeshes(!0):
[];var k=new this.bjsAMMO.btCompoundShape;var f=0;b.forEach(function(d){var a=d.getPhysicsImpostor();if(a){if(a.type==q.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var b=e._createShape(a),c=d.parent.getWorldMatrix().clone(),g=new m.e;c.decompose(g);e._tmpAmmoTransform.getOrigin().setValue(d.position.x*g.x,d.position.y*g.y,d.position.z*g.z);e._tmpAmmoQuaternion.setValue(d.rotationQuaternion.x,d.rotationQuaternion.y,
d.rotationQuaternion.z,d.rotationQuaternion.w);e._tmpAmmoTransform.setRotation(e._tmpAmmoQuaternion);k.addChildShape(e._tmpAmmoTransform,b);a.dispose();f++}});if(0<f)return d.type!=q.a.NoImpostor&&(d=this._createShape(d,!0))&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),k.addChildShape(this._tmpAmmoTransform,d)),k;this.bjsAMMO.destroy(k);k=null}switch(d.type){case q.a.SphereImpostor:a.a.WithinEpsilon(g.x,
g.y,1E-4)&&a.a.WithinEpsilon(g.x,g.z,1E-4)?k=new this.bjsAMMO.btSphereShape(g.x/2):(d=[new this.bjsAMMO.btVector3(0,0,0)],k=new this.bjsAMMO.btMultiSphereShape(d,[1],1),k.setLocalScaling(new this.bjsAMMO.btVector3(g.x/2,g.y/2,g.z/2)));break;case q.a.CapsuleImpostor:k=new this.bjsAMMO.btCapsuleShape(g.x/2,g.y/2);break;case q.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(g.x/2,g.y/2,g.z/2);k=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case q.a.PlaneImpostor:case q.a.BoxImpostor:this._tmpAmmoVectorA.setValue(g.x/
2,g.y/2,g.z/2);k=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case q.a.MeshImpostor:if(0==d.getParam("mass")){g=new this.bjsAMMO.btTriangleMesh;d._pluginData.toDispose.push(g);c=this._addMeshVerts(g,c,c);k=0==c?new this.bjsAMMO.btCompoundShape:new this.bjsAMMO.btBvhTriangleMeshShape(g);break}case q.a.ConvexHullImpostor:g=new this.bjsAMMO.btConvexHullShape;c=this._addHullVerts(g,c,c);0==c?(d._pluginData.toDispose.push(g),k=new this.bjsAMMO.btCompoundShape):k=g;break;case q.a.NoImpostor:k=
new this.bjsAMMO.btSphereShape(g.x/2);break;case q.a.CustomImpostor:k=this._createCustom(d);break;case q.a.SoftbodyImpostor:k=this._createSoftbody(d);break;case q.a.ClothImpostor:k=this._createCloth(d);break;case q.a.RopeImpostor:k=this._createRope(d);break;default:h.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return k};e.prototype.setTransformationFromPhysicsBody=function(d){d.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform);d.object.position.set(this._tmpAmmoTransform.getOrigin().x(),
this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z());d.object.rotationQuaternion?d.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):d.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),
this._tmpQuaternion.toEulerAnglesToRef(d.object.rotation))};e.prototype.setPhysicsBodyTransformation=function(d,a,e){var c=d.physicsBody.getWorldTransform();if(Math.abs(c.getOrigin().x()-a.x)>b.a||Math.abs(c.getOrigin().y()-a.y)>b.a||Math.abs(c.getOrigin().z()-a.z)>b.a||Math.abs(c.getRotation().x()-e.x)>b.a||Math.abs(c.getRotation().y()-e.y)>b.a||Math.abs(c.getRotation().z()-e.z)>b.a||Math.abs(c.getRotation().w()-e.w)>b.a)this._tmpAmmoVectorA.setValue(a.x,a.y,a.z),c.setOrigin(this._tmpAmmoVectorA),
this._tmpAmmoQuaternion.setValue(e.x,e.y,e.z,e.w),c.setRotation(this._tmpAmmoQuaternion),d.physicsBody.setWorldTransform(c),0==d.mass?(d=d.physicsBody.getMotionState())&&d.setWorldTransform(c):d.physicsBody.activate()};e.prototype.isSupported=function(){return void 0!==this.bjsAMMO};e.prototype.setLinearVelocity=function(a,b){this._tmpAmmoVectorA.setValue(b.x,b.y,b.z);a.soft?a.physicsBody.linearVelocity(this._tmpAmmoVectorA):a.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)};e.prototype.setAngularVelocity=
function(a,b){this._tmpAmmoVectorA.setValue(b.x,b.y,b.z);a.soft?a.physicsBody.angularVelocity(this._tmpAmmoVectorA):a.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)};e.prototype.getLinearVelocity=function(a){a=a.soft?a.physicsBody.linearVelocity():a.physicsBody.getLinearVelocity();if(!a)return null;var d=new m.e(a.x(),a.y(),a.z());this.bjsAMMO.destroy(a);return d};e.prototype.getAngularVelocity=function(a){a=a.soft?a.physicsBody.angularVelocity():a.physicsBody.getAngularVelocity();if(!a)return null;
var d=new m.e(a.x(),a.y(),a.z());this.bjsAMMO.destroy(a);return d};e.prototype.setBodyMass=function(a,b){a.soft?a.physicsBody.setTotalMass(b,!1):a.physicsBody.setMassProps(b);a._pluginData.mass=b};e.prototype.getBodyMass=function(a){return a._pluginData.mass||0};e.prototype.getBodyFriction=function(a){return a._pluginData.friction||0};e.prototype.setBodyFriction=function(a,b){a.soft?a.physicsBody.get_m_cfg().set_kDF(b):a.physicsBody.setFriction(b);a._pluginData.friction=b};e.prototype.getBodyRestitution=
function(a){return a._pluginData.restitution||0};e.prototype.setBodyRestitution=function(a,b){a.physicsBody.setRestitution(b);a._pluginData.restitution=b};e.prototype.getBodyPressure=function(a){return a.soft?a._pluginData.pressure||0:(h.a.Warn("Pressure is not a property of a rigid body"),0)};e.prototype.setBodyPressure=function(a,b){a.soft?a.type===q.a.SoftbodyImpostor?(a.physicsBody.get_m_cfg().set_kPR(b),a._pluginData.pressure=b):(a.physicsBody.get_m_cfg().set_kPR(0),a._pluginData.pressure=0):
h.a.Warn("Pressure can only be applied to a softbody")};e.prototype.getBodyStiffness=function(a){return a.soft?a._pluginData.stiffness||0:(h.a.Warn("Stiffness is not a property of a rigid body"),0)};e.prototype.setBodyStiffness=function(a,b){a.soft?(b=0>b?0:b,b=1<b?1:b,a.physicsBody.get_m_materials().at(0).set_m_kLST(b),a._pluginData.stiffness=b):h.a.Warn("Stiffness cannot be applied to a rigid body")};e.prototype.getBodyVelocityIterations=function(a){return a.soft?a._pluginData.velocityIterations||
0:(h.a.Warn("Velocity iterations is not a property of a rigid body"),0)};e.prototype.setBodyVelocityIterations=function(a,b){a.soft?(b=0>b?0:b,a.physicsBody.get_m_cfg().set_viterations(b),a._pluginData.velocityIterations=b):h.a.Warn("Velocity iterations cannot be applied to a rigid body")};e.prototype.getBodyPositionIterations=function(a){return a.soft?a._pluginData.positionIterations||0:(h.a.Warn("Position iterations is not a property of a rigid body"),0)};e.prototype.setBodyPositionIterations=function(a,
b){a.soft?(b=0>b?0:b,a.physicsBody.get_m_cfg().set_piterations(b),a._pluginData.positionIterations=b):h.a.Warn("Position iterations cannot be applied to a rigid body")};e.prototype.appendAnchor=function(a,b,e,c,k,h){void 0===k&&(k=1);void 0===h&&(h=!1);var d=a.segments;a.physicsBody.appendAnchor(Math.round((d-1)*e)+d*(d-1-Math.round((d-1)*c)),b.physicsBody,h,k)};e.prototype.appendHook=function(a,b,e,c,k){void 0===c&&(c=1);void 0===k&&(k=!1);a.physicsBody.appendAnchor(Math.round(a.segments*e),b.physicsBody,
k,c)};e.prototype.sleepBody=function(a){h.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")};e.prototype.wakeUpBody=function(a){a.physicsBody.activate()};e.prototype.updateDistanceJoint=function(a,b,e){h.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")};e.prototype.setMotor=function(a,b,e,c){a.physicsJoint.enableAngularMotor(!0,b,e)};e.prototype.setLimit=function(a,b,e){h.a.Warn("setLimit is not currently supported by the Ammo physics plugin")};
e.prototype.syncMeshWithImpostor=function(a,b){b.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform);a.position.x=this._tmpAmmoTransform.getOrigin().x();a.position.y=this._tmpAmmoTransform.getOrigin().y();a.position.z=this._tmpAmmoTransform.getOrigin().z();a.rotationQuaternion&&(a.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),a.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),a.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),a.rotationQuaternion.w=
this._tmpAmmoTransform.getRotation().w())};e.prototype.getRadius=function(a){return a.getObjectExtendSize().x/2};e.prototype.getBoxSizeToRef=function(a,b){a=a.getObjectExtendSize();b.x=a.x;b.y=a.y;b.z=a.z};e.prototype.dispose=function(){this.bjsAMMO.destroy(this.world);this.bjsAMMO.destroy(this._solver);this.bjsAMMO.destroy(this._overlappingPairCache);this.bjsAMMO.destroy(this._dispatcher);this.bjsAMMO.destroy(this._collisionConfiguration);this.bjsAMMO.destroy(this._tmpAmmoVectorA);this.bjsAMMO.destroy(this._tmpAmmoVectorB);
this.bjsAMMO.destroy(this._tmpAmmoVectorC);this.bjsAMMO.destroy(this._tmpAmmoTransform);this.bjsAMMO.destroy(this._tmpAmmoQuaternion);this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback);this.world=null};e.prototype.raycast=function(a,b){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(a.x,a.y,a.z);this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(b.x,b.y,b.z);var d=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);this.world.rayTest(this._tmpAmmoVectorRCA,
this._tmpAmmoVectorRCB,d);this._raycastResult.reset(a,b);d.hasHit()&&(this._raycastResult.setHitData({x:d.get_m_hitNormalWorld().x(),y:d.get_m_hitNormalWorld().y(),z:d.get_m_hitNormalWorld().z()},{x:d.get_m_hitPointWorld().x(),y:d.get_m_hitPointWorld().y(),z:d.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance());this.bjsAMMO.destroy(d);this.bjsAMMO.destroy(this._tmpAmmoVectorRCA);this.bjsAMMO.destroy(this._tmpAmmoVectorRCB);return this._raycastResult};e.DISABLE_COLLISION_FLAG=4;
e.KINEMATIC_FLAG=2;e.DISABLE_DEACTIVATION_FLAG=4;return e}()},cPvs:function(y,w,f){f.d(w,"a",function(){return n});var m=f("uyO6"),h=f("/SR9"),q=f("y4Ty"),l=f("LVN+"),p=f("4gN4"),u=f("3kgD"),x=f("7uBm"),n=function(){function c(a,b,c){void 0===a&&(a=!0);void 0===b&&(b=10);void 0===c&&(c=CANNON);this._useDeltaForWorldStep=a;this.name="CannonJSPlugin";this._physicsMaterials=[];this._fixedTimeStep=1/60;this._physicsBodysToRemoveAfterStep=[];this._firstFrame=!0;this._minus90X=new h.b(-.7071067811865475,
0,0,.7071067811865475);this._plus90X=new h.b(.7071067811865475,0,0,.7071067811865475);this._tmpPosition=h.e.Zero();this._tmpDeltaPosition=h.e.Zero();this._tmpUnityRotation=new h.b;this.BJSCANNON=c;this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=b,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new x.a):m.a.Error("CannonJS is not available. Please make sure you included the js file.")}
c.prototype.setGravity=function(a){this.world.gravity.set(a.x,a.y,a.z)};c.prototype.setTimeStep=function(a){this._fixedTimeStep=a};c.prototype.getTimeStep=function(){return this._fixedTimeStep};c.prototype.executeStep=function(a,b){if(this._firstFrame){this._firstFrame=!1;for(var c=0;c<b.length;c++){var e=b[c];e.type!=l.a.HeightmapImpostor&&e.type!==l.a.PlaneImpostor&&e.beforeStep()}}this.world.step(this._useDeltaForWorldStep?a:this._fixedTimeStep);this._removeMarkedPhysicsBodiesFromWorld()};c.prototype._removeMarkedPhysicsBodiesFromWorld=
function(){var a=this;0<this._physicsBodysToRemoveAfterStep.length&&(this._physicsBodysToRemoveAfterStep.forEach(function(b){a.world.remove(b)}),this._physicsBodysToRemoveAfterStep=[])};c.prototype.applyImpulse=function(a,b,c){c=new this.BJSCANNON.Vec3(c.x,c.y,c.z);b=new this.BJSCANNON.Vec3(b.x,b.y,b.z);a.physicsBody.applyImpulse(b,c)};c.prototype.applyForce=function(a,b,c){c=new this.BJSCANNON.Vec3(c.x,c.y,c.z);b=new this.BJSCANNON.Vec3(b.x,b.y,b.z);a.physicsBody.applyForce(b,c)};c.prototype.generatePhysicsBody=
function(a){this._removeMarkedPhysicsBodiesFromWorld();if(a.parent)a.physicsBody&&(this.removePhysicsBody(a),a.forceUpdate());else{if(a.isBodyInitRequired()){var b=this._createShape(a),c=a.physicsBody;c&&this.removePhysicsBody(a);var e=this._addMaterial("mat-"+a.uniqueId,a.getParam("friction"),a.getParam("restitution"));e={mass:a.getParam("mass"),material:e};var d=a.getParam("nativeOptions"),g;for(g in d)d.hasOwnProperty(g)&&(e[g]=d[g]);a.physicsBody=new this.BJSCANNON.Body(e);a.physicsBody.addEventListener("collide",
a.onCollide);this.world.addEventListener("preStep",a.beforeStep);this.world.addEventListener("postStep",a.afterStep);a.physicsBody.addShape(b);this.world.add(a.physicsBody);c&&["force","torque","velocity","angularVelocity"].forEach(function(b){var d=c[b];a.physicsBody[b].set(d.x,d.y,d.z)});this._processChildMeshes(a)}this._updatePhysicsBodyTransformation(a)}};c.prototype._processChildMeshes=function(a){var b=this,c=a.object.getChildMeshes?a.object.getChildMeshes(!0):[],e=a.object.rotationQuaternion;
if(c.length){var d=function(c){if(e&&c.rotationQuaternion){var k=c.getPhysicsImpostor();if(k&&k.parent!==a){var g=c.getAbsolutePosition().subtract(c.parent.getAbsolutePosition()),h=c.rotationQuaternion;k.physicsBody&&(b.removePhysicsBody(k),k.physicsBody=null);k.parent=a;k.resetUpdateFlags();a.physicsBody.addShape(b._createShape(k),new b.BJSCANNON.Vec3(g.x,g.y,g.z),new b.BJSCANNON.Quaternion(h.x,h.y,h.z,h.w));a.physicsBody.mass+=k.getParam("mass")}e.multiplyInPlace(c.rotationQuaternion);c.getChildMeshes(!0).filter(function(a){return!!a.physicsImpostor}).forEach(d)}};
c.filter(function(a){return!!a.physicsImpostor}).forEach(d)}};c.prototype.removePhysicsBody=function(a){a.physicsBody.removeEventListener("collide",a.onCollide);this.world.removeEventListener("preStep",a.beforeStep);this.world.removeEventListener("postStep",a.afterStep);-1===this._physicsBodysToRemoveAfterStep.indexOf(a.physicsBody)&&this._physicsBodysToRemoveAfterStep.push(a.physicsBody)};c.prototype.generateJoint=function(a){var b=a.mainImpostor.physicsBody,c=a.connectedImpostor.physicsBody;if(b&&
c){var e=a.joint.jointData,d={pivotA:e.mainPivot?(new this.BJSCANNON.Vec3).set(e.mainPivot.x,e.mainPivot.y,e.mainPivot.z):null,pivotB:e.connectedPivot?(new this.BJSCANNON.Vec3).set(e.connectedPivot.x,e.connectedPivot.y,e.connectedPivot.z):null,axisA:e.mainAxis?(new this.BJSCANNON.Vec3).set(e.mainAxis.x,e.mainAxis.y,e.mainAxis.z):null,axisB:e.connectedAxis?(new this.BJSCANNON.Vec3).set(e.connectedAxis.x,e.connectedAxis.y,e.connectedAxis.z):null,maxForce:e.nativeParams.maxForce,collideConnected:!!e.collision};
switch(a.joint.type){case p.a.HingeJoint:case p.a.Hinge2Joint:var g=new this.BJSCANNON.HingeConstraint(b,c,d);break;case p.a.DistanceJoint:g=new this.BJSCANNON.DistanceConstraint(b,c,e.maxDistance||2);break;case p.a.SpringJoint:g=new this.BJSCANNON.Spring(b,c,{restLength:e.length,stiffness:e.stiffness,damping:e.damping,localAnchorA:d.pivotA,localAnchorB:d.pivotB});break;case p.a.LockJoint:g=new this.BJSCANNON.LockConstraint(b,c,d);break;default:g=new this.BJSCANNON.PointToPointConstraint(b,d.pivotA,
c,d.pivotB,d.maxForce)}g.collideConnected=!!e.collision;a.joint.physicsJoint=g;a.joint.type!==p.a.SpringJoint?this.world.addConstraint(g):(a.joint.jointData.forceApplicationCallback=a.joint.jointData.forceApplicationCallback||function(){g.applyForce()},a.mainImpostor.registerAfterPhysicsStep(a.joint.jointData.forceApplicationCallback))}};c.prototype.removeJoint=function(a){a.joint.type!==p.a.SpringJoint?this.world.removeConstraint(a.joint.physicsJoint):a.mainImpostor.unregisterAfterPhysicsStep(a.joint.jointData.forceApplicationCallback)};
c.prototype._addMaterial=function(a,b,c){var e;for(e=0;e<this._physicsMaterials.length;e++){var d=this._physicsMaterials[e];if(d.friction===b&&d.restitution===c)return d}a=new this.BJSCANNON.Material(a);a.friction=b;a.restitution=c;this._physicsMaterials.push(a);return a};c.prototype._checkWithEpsilon=function(a){return a<u.a.Epsilon?u.a.Epsilon:a};c.prototype._createShape=function(a){var b=a.object,c=a.getObjectExtendSize();switch(a.type){case l.a.SphereImpostor:b=c.y;a=c.z;var e=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(c.x),
this._checkWithEpsilon(b),this._checkWithEpsilon(a))/2);break;case l.a.CylinderImpostor:(b=a.getParam("nativeOptions"))||(b={});a=void 0!==b.radiusTop?b.radiusTop:this._checkWithEpsilon(c.x)/2;e=void 0!==b.radiusBottom?b.radiusBottom:this._checkWithEpsilon(c.x)/2;c=void 0!==b.height?b.height:this._checkWithEpsilon(c.y);e=new this.BJSCANNON.Cylinder(a,e,c,void 0!==b.numSegments?b.numSegments:16);b=new this.BJSCANNON.Quaternion;b.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);a=new this.BJSCANNON.Vec3(0,
0,0);e.transformAllPoints(a,b);break;case l.a.BoxImpostor:b=c.scale(.5);e=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(b.x),this._checkWithEpsilon(b.y),this._checkWithEpsilon(b.z)));break;case l.a.PlaneImpostor:m.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead");e=new this.BJSCANNON.Plane;break;case l.a.MeshImpostor:e=b.getVerticesData?b.getVerticesData(q.b.PositionKind):[];var d=b.getIndices?b.getIndices():[];if(!e)return;
c=b.position.clone();var g=b.rotation&&b.rotation.clone(),f=b.rotationQuaternion&&b.rotationQuaternion.clone();b.position.copyFromFloats(0,0,0);b.rotation&&b.rotation.copyFromFloats(0,0,0);b.rotationQuaternion&&b.rotationQuaternion.copyFrom(a.getParentsRotation());b.rotationQuaternion&&b.parent&&b.rotationQuaternion.conjugateInPlace();a=b.computeWorldMatrix(!0);var n=[],p;for(p=0;p<e.length;p+=3)h.e.TransformCoordinates(h.e.FromArray(e,p),a).toArray(n,p);m.a.Warn("MeshImpostor only collides against spheres.");
e=new this.BJSCANNON.Trimesh(n,d);b.position.copyFrom(c);g&&b.rotation&&b.rotation.copyFrom(g);f&&b.rotationQuaternion&&b.rotationQuaternion.copyFrom(f);break;case l.a.HeightmapImpostor:c=b.position.clone();g=b.rotation&&b.rotation.clone();f=b.rotationQuaternion&&b.rotationQuaternion.clone();b.position.copyFromFloats(0,0,0);b.rotation&&b.rotation.copyFromFloats(0,0,0);b.rotationQuaternion&&b.rotationQuaternion.copyFrom(a.getParentsRotation());b.rotationQuaternion&&b.parent&&b.rotationQuaternion.conjugateInPlace();
b.rotationQuaternion&&b.rotationQuaternion.multiplyInPlace(this._minus90X);e=this._createHeightmap(b);b.position.copyFrom(c);g&&b.rotation&&b.rotation.copyFrom(g);f&&b.rotationQuaternion&&b.rotationQuaternion.copyFrom(f);b.computeWorldMatrix(!0);break;case l.a.ParticleImpostor:e=new this.BJSCANNON.Particle;break;case l.a.NoImpostor:e=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return e};c.prototype._createHeightmap=function(a,b){var c=a.getVerticesData(q.b.PositionKind),e=a.computeWorldMatrix(!0),
d=[],g;for(g=0;g<c.length;g+=3)h.e.TransformCoordinates(h.e.FromArray(c,g),e).toArray(d,g);c=d;e=[];b=b||~~(Math.sqrt(c.length/3)-1);d=a.getBoundingInfo();a=d.boundingBox.extendSizeWorld.z;d=2*Math.min(d.boundingBox.extendSizeWorld.x,d.boundingBox.extendSizeWorld.y)/b;for(var f=0;f<c.length;f+=3){g=Math.round(c[f+0]/d+b/2);var n=Math.round(-1*(c[f+1]/d-b/2)),l=-c[f+2]+a;e[g]||(e[g]=[]);e[g][n]||(e[g][n]=l);e[g][n]=Math.max(l,e[g][n])}for(g=0;g<=b;++g){if(!e[g]){for(c=1;!e[(g+c)%b];)c++;e[g]=e[(g+
c)%b].slice()}for(n=0;n<=b;++n)if(!e[g][n]){c=1;for(var m;void 0===m;)m=e[g][(n+c++)%b];e[g][n]=m}}m=new this.BJSCANNON.Heightfield(e,{elementSize:d});m.minY=a;return m};c.prototype._updatePhysicsBodyTransformation=function(a){var b=a.object;b.computeWorldMatrix&&b.computeWorldMatrix(!0);if(b.getBoundingInfo()){var c=a.getObjectCenter();this._tmpDeltaPosition.copyFrom(b.getAbsolutePivotPoint().subtract(c));this._tmpDeltaPosition.divideInPlace(a.object.scaling);this._tmpPosition.copyFrom(c);var e=
b.rotationQuaternion;if(e){if(a.type===l.a.PlaneImpostor||a.type===l.a.HeightmapImpostor)e=e.multiply(this._minus90X),a.setDeltaRotation(this._plus90X);if(a.type===l.a.HeightmapImpostor){var d=b.getBoundingInfo(),g=b.rotationQuaternion;b.rotationQuaternion=this._tmpUnityRotation;b.computeWorldMatrix(!0);var f=c.clone(),n=b.getPivotMatrix();n=n?n.clone():h.a.Identity();var m=h.a.Translation(d.boundingBox.extendSizeWorld.x,0,-d.boundingBox.extendSizeWorld.z);b.setPreTransformMatrix(m);b.computeWorldMatrix(!0);
c=d.boundingBox.centerWorld.subtract(c).subtract(b.position).negate();this._tmpPosition.copyFromFloats(c.x,c.y-d.boundingBox.extendSizeWorld.y,c.z);this._tmpDeltaPosition.copyFrom(d.boundingBox.centerWorld.subtract(f));this._tmpDeltaPosition.y+=d.boundingBox.extendSizeWorld.y;b.rotationQuaternion=g;b.setPreTransformMatrix(n);b.computeWorldMatrix(!0)}else a.type===l.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);a.setDeltaPosition(this._tmpDeltaPosition);a.physicsBody.position.set(this._tmpPosition.x,
this._tmpPosition.y,this._tmpPosition.z);a.physicsBody.quaternion.set(e.x,e.y,e.z,e.w)}}};c.prototype.setTransformationFromPhysicsBody=function(a){a.object.position.set(a.physicsBody.position.x,a.physicsBody.position.y,a.physicsBody.position.z);if(a.object.rotationQuaternion){var b=a.physicsBody.quaternion;a.object.rotationQuaternion.set(b.x,b.y,b.z,b.w)}};c.prototype.setPhysicsBodyTransformation=function(a,b,c){a.physicsBody.position.set(b.x,b.y,b.z);a.physicsBody.quaternion.set(c.x,c.y,c.z,c.w)};
c.prototype.isSupported=function(){return void 0!==this.BJSCANNON};c.prototype.setLinearVelocity=function(a,b){a.physicsBody.velocity.set(b.x,b.y,b.z)};c.prototype.setAngularVelocity=function(a,b){a.physicsBody.angularVelocity.set(b.x,b.y,b.z)};c.prototype.getLinearVelocity=function(a){return(a=a.physicsBody.velocity)?new h.e(a.x,a.y,a.z):null};c.prototype.getAngularVelocity=function(a){return(a=a.physicsBody.angularVelocity)?new h.e(a.x,a.y,a.z):null};c.prototype.setBodyMass=function(a,b){a.physicsBody.mass=
b;a.physicsBody.updateMassProperties()};c.prototype.getBodyMass=function(a){return a.physicsBody.mass};c.prototype.getBodyFriction=function(a){return a.physicsBody.material.friction};c.prototype.setBodyFriction=function(a,b){a.physicsBody.material.friction=b};c.prototype.getBodyRestitution=function(a){return a.physicsBody.material.restitution};c.prototype.setBodyRestitution=function(a,b){a.physicsBody.material.restitution=b};c.prototype.sleepBody=function(a){a.physicsBody.sleep()};c.prototype.wakeUpBody=
function(a){a.physicsBody.wakeUp()};c.prototype.updateDistanceJoint=function(a,b){a.physicsJoint.distance=b};c.prototype.setMotor=function(a,b,c,e){e||(a.physicsJoint.enableMotor(),a.physicsJoint.setMotorSpeed(b),c&&this.setLimit(a,c))};c.prototype.setLimit=function(a,b,c){a.physicsJoint.motorEquation.maxForce=b;a.physicsJoint.motorEquation.minForce=void 0===c?-b:c};c.prototype.syncMeshWithImpostor=function(a,b){b=b.physicsBody;a.position.x=b.position.x;a.position.y=b.position.y;a.position.z=b.position.z;
a.rotationQuaternion&&(a.rotationQuaternion.x=b.quaternion.x,a.rotationQuaternion.y=b.quaternion.y,a.rotationQuaternion.z=b.quaternion.z,a.rotationQuaternion.w=b.quaternion.w)};c.prototype.getRadius=function(a){return a.physicsBody.shapes[0].boundingSphereRadius};c.prototype.getBoxSizeToRef=function(a,b){a=a.physicsBody.shapes[0];b.x=2*a.halfExtents.x;b.y=2*a.halfExtents.y;b.z=2*a.halfExtents.z};c.prototype.dispose=function(){};c.prototype._extendNamespace=function(){var a=new this.BJSCANNON.Vec3,
b=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(c,e,d){d=d||10;e=e||0;if(0===e)this.internalStep(c),this.time+=c;else{var g=Math.floor((this.time+e)/c)-Math.floor(this.time/c);g=Math.min(g,d)||1;d=performance.now();for(var k=0;k!==g&&!(this.internalStep(c),performance.now()-d>1E3*c);k++);this.time+=e;c=this.time%c/c;e=this.bodies;for(g=0;g!==e.length;g++)d=e[g],d.type!==b.Body.STATIC&&d.sleepState!==b.Body.SLEEPING?(d.position.vsub(d.previousPosition,a),a.scale(c,a),d.position.vadd(a,
d.interpolatedPosition)):(d.interpolatedPosition.set(d.position.x,d.position.y,d.position.z),d.interpolatedQuaternion.set(d.quaternion.x,d.quaternion.y,d.quaternion.z,d.quaternion.w))}}};c.prototype.raycast=function(a,b){this._cannonRaycastResult.reset();this.world.raycastClosest(a,b,{},this._cannonRaycastResult);this._raycastResult.reset(a,b);this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,
z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance));return this._raycastResult};return c}();u.a.DefaultPluginFactory=function(){return new n}},"iD+g":function(y,w,f){f.d(w,"a",function(){return x});var m=f("LVN+"),h=f("4gN4"),q=f("3kgD"),l=f("/SR9"),p=f("uyO6"),u=f("7uBm"),x=function(){function f(c,
a,b){void 0===c&&(c=!0);void 0===b&&(b=OIMO);this._useDeltaForWorldStep=c;this.name="OimoJSPlugin";this._fixedTimeStep=1/60;this._tmpImpostorsArray=[];this._tmpPositionVector=l.e.Zero();this.BJSOIMO=b;this.world=new this.BJSOIMO.World({iterations:a});this.world.clear();this._raycastResult=new u.a}f.prototype.setGravity=function(c){this.world.gravity.set(c.x,c.y,c.z)};f.prototype.setTimeStep=function(c){this.world.timeStep=c};f.prototype.getTimeStep=function(){return this.world.timeStep};f.prototype.executeStep=
function(c,a){var b=this;a.forEach(function(a){a.beforeStep()});this.world.timeStep=this._useDeltaForWorldStep?c:this._fixedTimeStep;this.world.step();a.forEach(function(a){a.afterStep();b._tmpImpostorsArray[a.uniqueId]=a});for(c=this.world.contacts;null!==c;){if(!c.touching||c.body1.sleeping||c.body2.sleeping){a=this._tmpImpostorsArray[+c.body1.name];var f=this._tmpImpostorsArray[+c.body2.name];a&&f&&(a.onCollide({body:f.physicsBody,point:null}),f.onCollide({body:a.physicsBody,point:null}))}c=c.next}};
f.prototype.applyImpulse=function(c,a,b){var f=c.physicsBody.mass;c.physicsBody.applyImpulse(b.scale(this.world.invScale),a.scale(this.world.invScale*f))};f.prototype.applyForce=function(c,a,b){p.a.Warn("Oimo doesn't support applying force. Using impule instead.");this.applyImpulse(c,a,b)};f.prototype.generatePhysicsBody=function(c){var a=this;if(c.parent)c.physicsBody&&(this.removePhysicsBody(c),c.forceUpdate());else{if(c.isBodyInitRequired()){var b={name:c.uniqueId,config:[c.getParam("mass")||.001,
c.getParam("friction"),c.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:0!==c.getParam("mass"),density:c.getParam("mass"),friction:c.getParam("friction"),restitution:c.getParam("restitution"),world:this.world},f=[c];(function(a){a.getChildMeshes&&a.getChildMeshes().forEach(function(a){a.physicsImpostor&&f.push(a.physicsImpostor)})})(c.object);var e=function(a){return Math.max(a,q.a.Epsilon)},d=new l.b;f.forEach(function(g){if(g.object.rotationQuaternion){var f=
g.object.rotationQuaternion;d.copyFrom(f);g.object.rotationQuaternion.set(0,0,0,1);g.object.computeWorldMatrix(!0);var k=d.toEulerAngles(),h=g.getObjectExtendSize();if(g===c)k=c.getObjectCenter(),c.object.getAbsolutePivotPoint().subtractToRef(k,a._tmpPositionVector),a._tmpPositionVector.divideInPlace(c.object.scaling),b.pos.push(k.x),b.pos.push(k.y),b.pos.push(k.z),b.posShape.push(0,0,0),b.rotShape.push(0,0,0);else{var l=g.object.position.clone();b.posShape.push(l.x);b.posShape.push(l.y);b.posShape.push(l.z);
b.rotShape.push(57.29577951308232*k.x,57.29577951308232*k.y,57.29577951308232*k.z)}g.object.rotationQuaternion.copyFrom(d);switch(g.type){case m.a.ParticleImpostor:p.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case m.a.SphereImpostor:k=h.y;l=h.z;h=Math.max(e(h.x),e(k),e(l))/2;b.type.push("sphere");b.size.push(h);b.size.push(h);b.size.push(h);break;case m.a.CylinderImpostor:k=e(h.x)/2;l=e(h.y);b.type.push("cylinder");b.size.push(k);b.size.push(l);b.size.push(l);break;default:k=
e(h.x),l=e(h.y),h=e(h.z),b.type.push("box"),b.size.push(k),b.size.push(l),b.size.push(h)}g.object.rotationQuaternion=f}});c.physicsBody=this.world.add(b);c.physicsBody.resetQuaternion(d);c.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);c.setDeltaPosition(this._tmpPositionVector)}};f.prototype.removePhysicsBody=function(c){this.world.removeRigidBody(c.physicsBody)};f.prototype.generateJoint=function(c){var a=c.mainImpostor.physicsBody,b=c.connectedImpostor.physicsBody;
if(a&&b){var f=c.joint.jointData,e=f.nativeParams||{};b={body1:a,body2:b,axe1:e.axe1||(f.mainAxis?f.mainAxis.asArray():null),axe2:e.axe2||(f.connectedAxis?f.connectedAxis.asArray():null),pos1:e.pos1||(f.mainPivot?f.mainPivot.asArray():null),pos2:e.pos2||(f.connectedPivot?f.connectedPivot.asArray():null),min:e.min,max:e.max,collision:e.collision||f.collision,spring:e.spring,world:this.world};switch(c.joint.type){case h.a.BallAndSocketJoint:a="jointBall";break;case h.a.SpringJoint:p.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead"),
b.min=f.length||b.min,b.max=Math.max(b.min,b.max);case h.a.DistanceJoint:a="jointDistance";b.max=f.maxDistance;break;case h.a.PrismaticJoint:a="jointPrisme";break;case h.a.SliderJoint:a="jointSlide";break;case h.a.WheelJoint:a="jointWheel";break;default:a="jointHinge"}b.type=a;c.joint.physicsJoint=this.world.add(b)}};f.prototype.removeJoint=function(c){try{this.world.removeJoint(c.joint.physicsJoint)}catch(a){p.a.Warn(a)}};f.prototype.isSupported=function(){return void 0!==this.BJSOIMO};f.prototype.setTransformationFromPhysicsBody=
function(c){if(!c.physicsBody.sleeping){if(c.physicsBody.shapes.next){for(var a=c.physicsBody.shapes;a.next;)a=a.next;c.object.position.set(a.position.x,a.position.y,a.position.z)}else a=c.physicsBody.getPosition(),c.object.position.set(a.x,a.y,a.z);c.object.rotationQuaternion&&(a=c.physicsBody.getQuaternion(),c.object.rotationQuaternion.set(a.x,a.y,a.z,a.w))}};f.prototype.setPhysicsBodyTransformation=function(c,a,b){var f=c.physicsBody;c.physicsBody.shapes.next||(f.position.set(a.x,a.y,a.z),f.orientation.set(b.x,
b.y,b.z,b.w),f.syncShapes(),f.awake())};f.prototype.setLinearVelocity=function(c,a){c.physicsBody.linearVelocity.set(a.x,a.y,a.z)};f.prototype.setAngularVelocity=function(c,a){c.physicsBody.angularVelocity.set(a.x,a.y,a.z)};f.prototype.getLinearVelocity=function(c){return(c=c.physicsBody.linearVelocity)?new l.e(c.x,c.y,c.z):null};f.prototype.getAngularVelocity=function(c){return(c=c.physicsBody.angularVelocity)?new l.e(c.x,c.y,c.z):null};f.prototype.setBodyMass=function(c,a){var b=0===a;c.physicsBody.shapes.density=
b?1:a;c.physicsBody.setupMass(b?2:1)};f.prototype.getBodyMass=function(c){return c.physicsBody.shapes.density};f.prototype.getBodyFriction=function(c){return c.physicsBody.shapes.friction};f.prototype.setBodyFriction=function(c,a){c.physicsBody.shapes.friction=a};f.prototype.getBodyRestitution=function(c){return c.physicsBody.shapes.restitution};f.prototype.setBodyRestitution=function(c,a){c.physicsBody.shapes.restitution=a};f.prototype.sleepBody=function(c){c.physicsBody.sleep()};f.prototype.wakeUpBody=
function(c){c.physicsBody.awake()};f.prototype.updateDistanceJoint=function(c,a,b){c.physicsJoint.limitMotor.upperLimit=a;void 0!==b&&(c.physicsJoint.limitMotor.lowerLimit=b)};f.prototype.setMotor=function(c,a,b,f){void 0!==b?p.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):b=1E6;(c=f?c.physicsJoint.rotationalLimitMotor2:c.physicsJoint.rotationalLimitMotor1||c.physicsJoint.rotationalLimitMotor||c.physicsJoint.limitMotor)&&c.setMotor(-1*a,b)};f.prototype.setLimit=
function(c,a,b,f){(c=f?c.physicsJoint.rotationalLimitMotor2:c.physicsJoint.rotationalLimitMotor1||c.physicsJoint.rotationalLimitMotor||c.physicsJoint.limitMotor)&&c.setLimit(a,void 0===b?-a:b)};f.prototype.syncMeshWithImpostor=function(c,a){a=a.physicsBody;c.position.x=a.position.x;c.position.y=a.position.y;c.position.z=a.position.z;c.rotationQuaternion&&(c.rotationQuaternion.x=a.orientation.x,c.rotationQuaternion.y=a.orientation.y,c.rotationQuaternion.z=a.orientation.z,c.rotationQuaternion.w=a.orientation.s)};
f.prototype.getRadius=function(c){return c.physicsBody.shapes.radius};f.prototype.getBoxSizeToRef=function(c,a){c=c.physicsBody.shapes;a.x=2*c.halfWidth;a.y=2*c.halfHeight;a.z=2*c.halfDepth};f.prototype.dispose=function(){this.world.clear()};f.prototype.raycast=function(c,a){p.a.Warn("raycast is not currently supported by the Oimo physics plugin");this._raycastResult.reset(c,a);return this._raycastResult};return f}()},s2B1:function(y,w,f){f("3kgD");f("e/hQ");f("xVzz");f("LVN+");f("4gN4");f("cPvs");
f("9aEo");f("iD+g")}}]);
