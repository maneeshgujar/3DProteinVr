(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{"1XPg":function(v,u,g){g.d(u,"a",function(){return h});var q=g("oYeq");v=g("XA4I");var e=g("f9H2"),k=g("lzMP");g=g("WHS4");var h=function(g){function h(r){r=g.call(this,r,k.a.Vertex,!0)||this;r.registerInput("vector",e.a.Vector4);return r}Object(q.d)(h,g);h.prototype.getClassName=function(){return"VertexOutputBlock"};Object.defineProperty(h.prototype,"vector",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});h.prototype._buildBlock=
function(e){g.prototype._buildBlock.call(this,e);e.compilationString+="gl_Position = "+this.vector.associatedVariableName+";\r\n";return this};return h}(v.a);g.a.RegisteredTypes["BABYLON.VertexOutputBlock"]=h},"3KQ5":function(v,u,g){var q=g("oYeq");u=g("XA4I");var e=g("f9H2"),k=g("31XQ"),h=g("/eyM"),m=g("lzMP"),t=g("RLC9"),r=g("sDlf");v=g("WHS4");var f=g("ZxJR"),b=g("O6Ub"),n=g("mdIh"),x=function(a){function c(d){d=a.call(this,d,m.a.Fragment)||this;d.albedoScaling=!1;d.linkSheenWithAlbedo=!1;d._isUnique=
!0;d.registerInput("intensity",e.a.Float,!0,m.a.Fragment);d.registerInput("color",e.a.Color3,!0,m.a.Fragment);d.registerInput("roughness",e.a.Float,!0,m.a.Fragment);d.registerOutput("sheen",e.a.Object,m.a.Fragment,new n.a("sheen",d,k.c.Output,c,"SheenBlock"));return d}Object(q.d)(c,a);c.prototype.initialize=function(d){d._excludeVariableName("sheenOut");d._excludeVariableName("sheenMapData");d._excludeVariableName("vSheenColor");d._excludeVariableName("vSheenRoughness")};c.prototype.getClassName=
function(){return"SheenBlock"};Object.defineProperty(c.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"color",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"roughness",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"sheen",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});c.prototype.prepareDefines=
function(d,c,b){a.prototype.prepareDefines.call(this,d,c,b);b.setValue("SHEEN",!0);b.setValue("SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0);b.setValue("SHEEN_LINKWITHALBEDO",this.linkSheenWithAlbedo,!0);b.setValue("SHEEN_ROUGHNESS",this.roughness.isConnected,!0);b.setValue("SHEEN_ALBEDOSCALING",this.albedoScaling,!0)};c.prototype.getCode=function(d){return"#ifdef SHEEN\n            sheenOutParams sheenOut;\n\n            vec4 vSheenColor = vec4("+(this.color.isConnected?this.color.associatedVariableName:
"vec3(1.)")+", "+(this.intensity.isConnected?this.intensity.associatedVariableName:"1.")+");\n\n            sheenBlock(\n                vSheenColor,\n            #ifdef SHEEN_ROUGHNESS\n                "+(this.roughness.isConnected?this.roughness.associatedVariableName:"0.")+",\n            #endif\n                roughness,\n            #ifdef SHEEN_TEXTURE\n                vec4(0.),\n            #endif\n                reflectance,\n            #ifdef SHEEN_LINKWITHALBEDO\n                baseColor,\n                surfaceAlbedo,\n            #endif\n            #ifdef ENVIRONMENTBRDF\n                NdotV,\n                environmentBrdf,\n            #endif\n            #if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n                AARoughnessFactors,\n                "+
(null===d||void 0===d?void 0:d._vReflectionMicrosurfaceInfosName)+",\n                "+(null===d||void 0===d?void 0:d._vReflectionInfosName)+",\n                "+(null===d||void 0===d?void 0:d.reflectionColor)+",\n                vLightingIntensity,\n                #ifdef "+(null===d||void 0===d?void 0:d._define3DName)+"\n                    "+(null===d||void 0===d?void 0:d._cubeSamplerName)+",\n                #else\n                    "+(null===d||void 0===d?void 0:d._2DSamplerName)+",\n                #endif\n                reflectionOut.reflectionCoords,\n                NdotVUnclamped,\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef "+
(null===d||void 0===d?void 0:d._define3DName)+"\n                        "+(null===d||void 0===d?void 0:d._cubeSamplerName)+",\n                        "+(null===d||void 0===d?void 0:d._cubeSamplerName)+",\n                    #else\n                        "+(null===d||void 0===d?void 0:d._2DSamplerName)+",\n                        "+(null===d||void 0===d?void 0:d._2DSamplerName)+",\n                    #endif\n                #endif\n                #if !defined("+(null===d||void 0===d?void 0:d._defineSkyboxName)+
") && defined(RADIANCEOCCLUSION)\n                    seo,\n                #endif\n                #if !defined("+(null===d||void 0===d?void 0:d._defineSkyboxName)+") && defined(HORIZONOCCLUSION) && defined(BUMP) && defined("+(null===d||void 0===d?void 0:d._define3DName)+")\n                    eho,\n                #endif\n            #endif\n                sheenOut\n            );\n\n            #ifdef SHEEN_LINKWITHALBEDO\n                surfaceAlbedo = sheenOut.surfaceAlbedo;\n            #endif\n        #endif\r\n"};
c.prototype._buildBlock=function(d){d.target===m.a.Fragment&&d.sharedData.blocksWithDefines.push(this);return this};c.prototype._dumpPropertiesCode=function(){var d=a.prototype._dumpPropertiesCode.call(this);d+=this._codeVariableName+".albedoScaling = "+this.albedoScaling+";\r\n";return d+=this._codeVariableName+".linkSheenWithAlbedo = "+this.linkSheenWithAlbedo+";\r\n"};c.prototype.serialize=function(){var d=a.prototype.serialize.call(this);d.albedoScaling=this.albedoScaling;d.linkSheenWithAlbedo=
this.linkSheenWithAlbedo;return d};c.prototype._deserialize=function(d,c,b){a.prototype._deserialize.call(this,d,c,b);this.albedoScaling=d.albedoScaling;this.linkSheenWithAlbedo=d.linkSheenWithAlbedo};Object(q.c)([Object(b.b)("Albedo scaling",b.a.Boolean,"PROPERTIES",{notifiers:{update:!0}})],c.prototype,"albedoScaling",void 0);Object(q.c)([Object(b.b)("Link sheen with albedo",b.a.Boolean,"PROPERTIES",{notifiers:{update:!0}})],c.prototype,"linkSheenWithAlbedo",void 0);return c}(u.a);v.a.RegisteredTypes["BABYLON.SheenBlock"]=
x;var c=g("V0+9"),a=g("O+1A"),w=function(a){function c(d){d=a.call(this,d,m.a.Fragment)||this;d._isUnique=!0;d.registerInput("intensity",e.a.Float,!0,m.a.Fragment);d.registerInput("direction",e.a.Vector2,!0,m.a.Fragment);d.registerInput("uv",e.a.Vector2,!0);d.registerInput("worldTangent",e.a.Vector4,!0);d.registerOutput("anisotropy",e.a.Object,m.a.Fragment,new n.a("anisotropy",d,k.c.Output,c,"AnisotropyBlock"));return d}Object(q.d)(c,a);c.prototype.initialize=function(d){d._excludeVariableName("anisotropicOut");
d._excludeVariableName("TBN")};c.prototype.getClassName=function(){return"AnisotropyBlock"};Object.defineProperty(c.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"direction",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"uv",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"worldTangent",{get:function(){return this._inputs[3]},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"anisotropy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});c.prototype._generateTBNSpace=function(d){var a="",c="//"+this.name,b=this.uv,e=this.worldPositionConnectionPoint,f=this.worldNormalConnectionPoint,n=this.worldTangent;b.isConnected||console.error("You must connect the 'uv' input of the Anisotropy block!");d._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var w={search:/defined\(TANGENT\)/g,
replace:n.isConnected?"defined(TANGENT)":"defined(IGNORE)"};n.isConnected&&(a+="vec3 tbnNormal = normalize("+f.associatedVariableName+".xyz);\r\n",a+="vec3 tbnTangent = normalize("+n.associatedVariableName+".xyz);\r\n",a+="vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\nmat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n");a+="\n            #if defined("+(n.isConnected?"TANGENT":"IGNORE")+") && defined(NORMAL)\n                mat3 TBN = vTBN;\n            #else\n                mat3 TBN = cotangent_frame("+
(f.associatedVariableName+".xyz, v_")+(e.associatedVariableName+".xyz, ")+(b.isConnected?b.associatedVariableName:"vec2(0.)")+", vec2(1., 1.));\n            #endif\r\n";d._emitFunctionFromInclude("bumpFragmentMainFunctions",c,{replaceStrings:[w]});return a};c.prototype.getCode=function(d,a){void 0===a&&(a=!1);var c="";a&&(c+=this._generateTBNSpace(d));return c+("anisotropicOutParams anisotropicOut;\n            anisotropicBlock(\n                vec3("+(this.direction.isConnected?this.direction.associatedVariableName:
"vec2(1., 0.)")+", "+(this.intensity.isConnected?this.intensity.associatedVariableName:"1.0")+"),\n            #ifdef ANISOTROPIC_TEXTURE\n                vec3(0.),\n            #endif\n                TBN,\n                normalW,\n                viewDirectionW,\n                anisotropicOut\n            );\r\n")};c.prototype.prepareDefines=function(d,c,b){a.prototype.prepareDefines.call(this,d,c,b);b.setValue("ANISOTROPIC",!0);b.setValue("ANISOTROPIC_TEXTURE",!1,!0)};c.prototype._buildBlock=
function(d){d.target===m.a.Fragment&&d.sharedData.blocksWithDefines.push(this);return this};return c}(u.a);v.a.RegisteredTypes["BABYLON.AnisotropyBlock"]=w;var l=g("cYoo"),D=g("aCSs"),H=g("sH6m"),y=function(a){function c(d){d=a.call(this,d)||this;d.useSphericalHarmonics=!0;d.forceIrradianceInFragment=!1;d._isUnique=!0;d.registerInput("position",e.a.Vector3,!1,m.a.Vertex);d.registerInput("world",e.a.Matrix,!1,m.a.Vertex);d.registerInput("color",e.a.Color3,!0,m.a.Fragment);d.registerOutput("reflection",
e.a.Object,m.a.Fragment,new n.a("reflection",d,k.c.Output,c,"ReflectionBlock"));return d}Object(q.d)(c,a);c.prototype.getClassName=function(){return"ReflectionBlock"};Object.defineProperty(c.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"worldPosition",{get:function(){return this.worldPositionConnectionPoint},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"worldNormal",{get:function(){return this.worldNormalConnectionPoint},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"world",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"cameraPosition",{get:function(){return this.cameraPositionConnectionPoint},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"color",{get:function(){return this._inputs[2]},enumerable:!1,
configurable:!0});Object.defineProperty(c.prototype,"reflection",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"reflectionColor",{get:function(){return this.color.isConnected?this.color.associatedVariableName:"vec3(1., 1., 1.)"},enumerable:!1,configurable:!0});c.prototype._getTexture=function(){return this.texture?this.texture:
this._scene.environmentTexture};c.prototype.prepareDefines=function(d,c,b){a.prototype.prepareDefines.call(this,d,c,b);c=(d=this._getTexture())&&d.getTextureMatrix;b.setValue("REFLECTION",c,!0);c&&(b.setValue(this._defineLODReflectionAlpha,d.lodLevelInAlpha,!0),b.setValue(this._defineLinearSpecularReflection,d.linearSpecularLOD,!0),b.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?!d.invertZ:d.invertZ,!0),b.setValue("SPHERICAL_HARMONICS",this.useSphericalHarmonics,!0),b.setValue("GAMMAREFLECTION",
d.gammaSpace,!0),b.setValue("RGBDREFLECTION",d.isRGBD,!0),d&&d.coordinatesMode!==D.a.SKYBOX_MODE&&d.isCube&&(b.setValue("USESPHERICALFROMREFLECTIONMAP",!0),b.setValue("USEIRRADIANCEMAP",!1),this.forceIrradianceInFragment||8>=this._scene.getEngine().getCaps().maxVaryingVectors?b.setValue("USESPHERICALINVERTEX",!1):b.setValue("USESPHERICALINVERTEX",!0)))};c.prototype.bind=function(d,c,b,e){a.prototype.bind.call(this,d,c,b);(c=this._getTexture())&&e&&(c.isCube?d.setTexture(this._cubeSamplerName,c):d.setTexture(this._2DSamplerName,
c),b=c.getSize().width,d.setFloat3(this._vReflectionMicrosurfaceInfosName,b,c.lodGenerationScale,c.lodGenerationOffset),d.setFloat2(this._vReflectionFilteringInfoName,b,H.a.Log2(b)),e=e._materialDefines,c=c.sphericalPolynomial,e.USESPHERICALFROMREFLECTIONMAP&&c&&(e.SPHERICAL_HARMONICS?(e=c.preScaledHarmonics,d.setVector3("vSphericalL00",e.l00),d.setVector3("vSphericalL1_1",e.l1_1),d.setVector3("vSphericalL10",e.l10),d.setVector3("vSphericalL11",e.l11),d.setVector3("vSphericalL2_2",e.l2_2),d.setVector3("vSphericalL2_1",
e.l2_1),d.setVector3("vSphericalL20",e.l20),d.setVector3("vSphericalL21",e.l21),d.setVector3("vSphericalL22",e.l22)):(d.setFloat3("vSphericalX",c.x.x,c.x.y,c.x.z),d.setFloat3("vSphericalY",c.y.x,c.y.y,c.y.z),d.setFloat3("vSphericalZ",c.z.x,c.z.y,c.z.z),d.setFloat3("vSphericalXX_ZZ",c.xx.x-c.zz.x,c.xx.y-c.zz.y,c.xx.z-c.zz.z),d.setFloat3("vSphericalYY_ZZ",c.yy.x-c.zz.x,c.yy.y-c.zz.y,c.yy.z-c.zz.z),d.setFloat3("vSphericalZZ",c.zz.x,c.zz.y,c.zz.z),d.setFloat3("vSphericalXY",c.xy.x,c.xy.y,c.xy.z),d.setFloat3("vSphericalYZ",
c.yz.x,c.yz.y,c.yz.z),d.setFloat3("vSphericalZX",c.zx.x,c.zx.y,c.zx.z))))};c.prototype.handleVertexSide=function(d){var c=a.prototype.handleVertexSide.call(this,d);d._emitFunctionFromInclude("harmonicsFunctions","//"+this.name,{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]});var b=d._getFreeVariableName("reflectionVector");this._vEnvironmentIrradianceName=d._getFreeVariableName("vEnvironmentIrradiance");
d._emitVaryingFromString(this._vEnvironmentIrradianceName,"vec3","defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)");d._emitUniformFromString("vSphericalL00","vec3","SPHERICAL_HARMONICS");d._emitUniformFromString("vSphericalL1_1","vec3","SPHERICAL_HARMONICS");d._emitUniformFromString("vSphericalL10","vec3","SPHERICAL_HARMONICS");d._emitUniformFromString("vSphericalL11","vec3","SPHERICAL_HARMONICS");d._emitUniformFromString("vSphericalL2_2","vec3","SPHERICAL_HARMONICS");d._emitUniformFromString("vSphericalL2_1",
"vec3","SPHERICAL_HARMONICS");d._emitUniformFromString("vSphericalL20","vec3","SPHERICAL_HARMONICS");d._emitUniformFromString("vSphericalL21","vec3","SPHERICAL_HARMONICS");d._emitUniformFromString("vSphericalL22","vec3","SPHERICAL_HARMONICS");d._emitUniformFromString("vSphericalX","vec3","SPHERICAL_HARMONICS",!0);d._emitUniformFromString("vSphericalY","vec3","SPHERICAL_HARMONICS",!0);d._emitUniformFromString("vSphericalZ","vec3","SPHERICAL_HARMONICS",!0);d._emitUniformFromString("vSphericalXX_ZZ",
"vec3","SPHERICAL_HARMONICS",!0);d._emitUniformFromString("vSphericalYY_ZZ","vec3","SPHERICAL_HARMONICS",!0);d._emitUniformFromString("vSphericalZZ","vec3","SPHERICAL_HARMONICS",!0);d._emitUniformFromString("vSphericalXY","vec3","SPHERICAL_HARMONICS",!0);d._emitUniformFromString("vSphericalYZ","vec3","SPHERICAL_HARMONICS",!0);d._emitUniformFromString("vSphericalZX","vec3","SPHERICAL_HARMONICS",!0);return c+="#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n                vec3 "+
b+" = vec3("+this._reflectionMatrixName+" * vec4(normalize("+this.worldNormal.associatedVariableName+").xyz, 0)).xyz;\n                #ifdef "+this._defineOppositeZ+"\n                    "+b+".z *= -1.0;\n                #endif\n                "+this._vEnvironmentIrradianceName+" = computeEnvironmentIrradiance("+b+");\n            #endif\r\n"};c.prototype.getCode=function(d,c){var a="";this.handleFragmentSideInits(d);d._emitFunctionFromInclude("harmonicsFunctions","//"+this.name,{replaceStrings:[{search:/uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,
replace:""},{search:/uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,replace:""}]});d._emitFunction("sampleReflection","\n            #ifdef "+this._define3DName+"\n                #define sampleReflection(s, c) textureCube(s, c)\n            #else\n                #define sampleReflection(s, c) texture2D(s, c)\n            #endif\r\n","//"+this.name);d._emitFunction("sampleReflectionLod","\n            #ifdef "+this._define3DName+"\n                #define sampleReflectionLod(s, c, l) textureCubeLodEXT(s, c, l)\n            #else\n                #define sampleReflectionLod(s, c, l) texture2DLodEXT(s, c, l)\n            #endif\r\n",
"//"+this.name);var b="\n            vec3 computeReflectionCoordsPBR(vec4 worldPos, vec3 worldNormal) {\n                "+this.handleFragmentSideCodeReflectionCoords("worldNormal","worldPos",!0)+"\n                return "+this._reflectionVectorName+";\n            }\r\n";d._emitFunction("computeReflectionCoordsPBR",b,"//"+this.name);this._vReflectionMicrosurfaceInfosName=d._getFreeVariableName("vReflectionMicrosurfaceInfos");d._emitUniformFromString(this._vReflectionMicrosurfaceInfosName,"vec3");
this._vReflectionInfosName=d._getFreeVariableName("vReflectionInfos");this._vReflectionFilteringInfoName=d._getFreeVariableName("vReflectionFilteringInfo");d._emitUniformFromString(this._vReflectionFilteringInfoName,"vec2");return a+="#ifdef REFLECTION\n            vec2 "+this._vReflectionInfosName+" = vec2(1., 0.);\n\n            reflectionOutParams reflectionOut;\n\n            reflectionBlock(\n                v_"+(this.worldPosition.associatedVariableName+".xyz,\n                ")+c+",\n                alphaG,\n                "+
this._vReflectionMicrosurfaceInfosName+",\n                "+this._vReflectionInfosName+",\n                "+this.reflectionColor+",\n            #ifdef ANISOTROPIC\n                anisotropicOut,\n            #endif\n            #if defined("+this._defineLODReflectionAlpha+") && !defined("+this._defineSkyboxName+")\n                NdotVUnclamped,\n            #endif\n            #ifdef "+this._defineLinearSpecularReflection+"\n                roughness,\n            #endif\n            #ifdef "+
this._define3DName+"\n                "+this._cubeSamplerName+",\n            #else\n                "+this._2DSamplerName+",\n            #endif\n            #if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n                "+this._vEnvironmentIrradianceName+",\n            #endif\n            #ifdef USESPHERICALFROMREFLECTIONMAP\n                #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n                    "+this._reflectionMatrixName+",\n                #endif\n            #endif\n            #ifdef USEIRRADIANCEMAP\n                irradianceSampler, // ** not handled **\n            #endif\n            #ifndef LODBASEDMICROSFURACE\n                #ifdef "+
this._define3DName+"\n                    "+this._cubeSamplerName+",\n                    "+this._cubeSamplerName+",\n                #else\n                    "+this._2DSamplerName+",\n                    "+this._2DSamplerName+",\n                #endif\n            #endif\n            #ifdef REALTIME_FILTERING\n                "+this._vReflectionFilteringInfoName+",\n            #endif\n                reflectionOut\n            );\n        #endif\r\n"};c.prototype._buildBlock=function(d){this._scene=
d.sharedData.scene;d.target!==m.a.Fragment&&(this._defineLODReflectionAlpha=d._getFreeDefineName("LODINREFLECTIONALPHA"),this._defineLinearSpecularReflection=d._getFreeDefineName("LINEARSPECULARREFLECTION"));return this};c.prototype._dumpPropertiesCode=function(){var d=a.prototype._dumpPropertiesCode.call(this);this.texture&&(d+=this._codeVariableName+".texture.gammaSpace = "+this.texture.gammaSpace+");\r\n");d+=this._codeVariableName+".useSphericalHarmonics = "+this.useSphericalHarmonics+";\r\n";
return d+=this._codeVariableName+".forceIrradianceInFragment = "+this.forceIrradianceInFragment+";\r\n"};c.prototype.serialize=function(){var d,c,b=a.prototype.serialize.call(this);b.useSphericalHarmonics=this.useSphericalHarmonics;b.forceIrradianceInFragment=this.forceIrradianceInFragment;b.gammaSpace=null!==(c=null===(d=this.texture)||void 0===d?void 0:d.gammaSpace)&&void 0!==c?c:!0;return b};c.prototype._deserialize=function(d,c,b){a.prototype._deserialize.call(this,d,c,b);this.useSphericalHarmonics=
d.useSphericalHarmonics;this.forceIrradianceInFragment=d.forceIrradianceInFragment;this.texture&&(this.texture.gammaSpace=d.gammaSpace)};Object(q.c)([Object(b.b)("Spherical Harmonics",b.a.Boolean,"ADVANCED",{notifiers:{update:!0}})],c.prototype,"useSphericalHarmonics",void 0);Object(q.c)([Object(b.b)("Force irradiance in fragment",b.a.Boolean,"ADVANCED",{notifiers:{update:!0}})],c.prototype,"forceIrradianceInFragment",void 0);return c}(l.a);v.a.RegisteredTypes["BABYLON.ReflectionBlock"]=y;var A=g("1VyS"),
N=function(c){function a(d){d=c.call(this,d,m.a.Fragment)||this;d.remapF0OnInterfaceChange=!0;d._isUnique=!0;d.registerInput("intensity",e.a.Float,!1,m.a.Fragment);d.registerInput("roughness",e.a.Float,!0,m.a.Fragment);d.registerInput("indexOfRefraction",e.a.Float,!0,m.a.Fragment);d.registerInput("normalMapColor",e.a.Color3,!0,m.a.Fragment);d.registerInput("uv",e.a.Vector2,!0,m.a.Fragment);d.registerInput("tintColor",e.a.Color3,!0,m.a.Fragment);d.registerInput("tintAtDistance",e.a.Float,!0,m.a.Fragment);
d.registerInput("tintThickness",e.a.Float,!0,m.a.Fragment);d.registerInput("worldTangent",e.a.Vector4,!0);d.registerOutput("clearcoat",e.a.Object,m.a.Fragment,new n.a("clearcoat",d,k.c.Output,a,"ClearCoatBlock"));return d}Object(q.d)(a,c);a.prototype.initialize=function(d){d._excludeVariableName("clearcoatOut");d._excludeVariableName("vClearCoatParams");d._excludeVariableName("vClearCoatTintParams");d._excludeVariableName("vClearCoatRefractionParams");d._excludeVariableName("vClearCoatTangentSpaceParams")};
a.prototype.getClassName=function(){return"ClearCoatBlock"};Object.defineProperty(a.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"roughness",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"indexOfRefraction",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"normalMapColor",{get:function(){return this._inputs[3]},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"uv",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"tintColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"tintAtDistance",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"tintThickness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"worldTangent",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"clearcoat",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});a.prototype.autoConfigure=function(d){this.intensity.isConnected||(d=new r.a("ClearCoat intensity",m.a.Fragment,e.a.Float),d.value=1,d.output.connectTo(this.intensity))};a.prototype.prepareDefines=function(d,a,b){c.prototype.prepareDefines.call(this,d,a,b);b.setValue("CLEARCOAT",
!0);b.setValue("CLEARCOAT_TEXTURE",!1,!0);b.setValue("CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE",!0,!0);b.setValue("CLEARCOAT_TINT",this.tintColor.isConnected||this.tintThickness.isConnected||this.tintAtDistance.isConnected,!0);b.setValue("CLEARCOAT_BUMP",this.normalMapColor.isConnected,!0);b.setValue("CLEARCOAT_DEFAULTIOR",this.indexOfRefraction.isConnected?this.indexOfRefraction.connectInputBlock.value===A.a._DefaultIndexOfRefraction:!0,!0);b.setValue("CLEARCOAT_REMAP_F0",this.remapF0OnInterfaceChange,
!0)};a.prototype.bind=function(d,a,b,e){var f,n;c.prototype.bind.call(this,d,a,b);a=null!==(n=null===(f=this.indexOfRefraction.connectInputBlock)||void 0===f?void 0:f.value)&&void 0!==n?n:A.a._DefaultIndexOfRefraction;f=1-a;n=1+a;d.setFloat4("vClearCoatRefractionParams",Math.pow(-f/n,2),1/a,f,n);f=this.clearcoat.hasEndpoints?this.clearcoat.endpoints[0].ownerBlock:null;f=(null===f||void 0===f?0:f.perturbedNormal.isConnected)?f.perturbedNormal.connectedPoint.ownerBlock:null;this._scene._mirroredCameraPosition?
d.setFloat2("vClearCoatTangentSpaceParams",(null===f||void 0===f?0:f.invertX)?1:-1,(null===f||void 0===f?0:f.invertY)?1:-1):d.setFloat2("vClearCoatTangentSpaceParams",(null===f||void 0===f?0:f.invertX)?-1:1,(null===f||void 0===f?0:f.invertY)?-1:1)};a.prototype._generateTBNSpace=function(d,c,a){c="";var b="//"+this.name,e=this.worldTangent;d._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var f={search:/defined\(TANGENT\)/g,replace:e.isConnected?"defined(TANGENT)":"defined(IGNORE)"};
e.isConnected&&(c=c+("vec3 tbnNormal = normalize("+a+".xyz);\r\nvec3 tbnTangent = normalize(")+(e.associatedVariableName+".xyz);\r\n"),c+="vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\nmat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n");d._emitFunctionFromInclude("bumpFragmentMainFunctions",b,{replaceStrings:[f]});return c};a.GetCode=function(d,c,a,b,e,f,n){var w="",x=(null===c||void 0===c?0:c.intensity.isConnected)?c.intensity.associatedVariableName:"1.",L=(null===c||void 0===c?0:
c.roughness.isConnected)?c.roughness.associatedVariableName:"0.",g=(null===c||void 0===c?0:c.normalMapColor.isConnected)?c.normalMapColor.associatedVariableName:"vec3(0.)",y=(null===c||void 0===c?0:c.uv.isConnected)?c.uv.associatedVariableName:"vec2(0.)",r=(null===c||void 0===c?0:c.tintColor.isConnected)?c.tintColor.associatedVariableName:"vec3(1.)",h=(null===c||void 0===c?0:c.tintThickness.isConnected)?c.tintThickness.associatedVariableName:"1.",M=(null===c||void 0===c?0:c.tintAtDistance.isConnected)?
c.tintAtDistance.associatedVariableName:"1.";c&&(d._emitUniformFromString("vClearCoatRefractionParams","vec4"),d._emitUniformFromString("vClearCoatTangentSpaceParams","vec2"));e&&c&&(w+=c._generateTBNSpace(d,b,n),f=c.worldTangent.isConnected);return w+="clearcoatOutParams clearcoatOut;\n\n        #ifdef CLEARCOAT\n            vec2 vClearCoatParams = vec2("+x+", "+L+");\n            vec4 vClearCoatTintParams = vec4("+r+", "+h+");\n\n            clearcoatBlock(\n                "+b+".xyz,\n                geometricNormalW,\n                viewDirectionW,\n                vClearCoatParams,\n                specularEnvironmentR0,\n            #ifdef CLEARCOAT_TEXTURE\n                vec2(0.),\n            #endif\n            #ifdef CLEARCOAT_TINT\n                vClearCoatTintParams,\n                "+
M+",\n                vClearCoatRefractionParams,\n                #ifdef CLEARCOAT_TINT_TEXTURE\n                    vec4(0.),\n                #endif\n            #endif\n            #ifdef CLEARCOAT_BUMP\n                vec2(0., 1.),\n                vec4("+g+", 0.),\n                "+y+",\n                #if defined("+(f?"TANGENT":"IGNORE")+") && defined(NORMAL)\n                    vTBN,\n                #else\n                    vClearCoatTangentSpaceParams,\n                #endif\n                #ifdef OBJECTSPACE_NORMALMAP\n                    normalMatrix,\n                #endif\n            #endif\n            #if defined(FORCENORMALFORWARD) && defined(NORMAL)\n                faceNormal,\n            #endif\n            #ifdef REFLECTION\n                "+
(null===a||void 0===a?void 0:a._vReflectionMicrosurfaceInfosName)+",\n                "+(null===a||void 0===a?void 0:a._vReflectionInfosName)+",\n                "+(null===a||void 0===a?void 0:a.reflectionColor)+",\n                vLightingIntensity,\n                #ifdef "+(null===a||void 0===a?void 0:a._define3DName)+"\n                    "+(null===a||void 0===a?void 0:a._cubeSamplerName)+",\n                #else\n                    "+(null===a||void 0===a?void 0:a._2DSamplerName)+",\n                #endif\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef "+
(null===a||void 0===a?void 0:a._define3DName)+"\n                        "+(null===a||void 0===a?void 0:a._cubeSamplerName)+",\n                        "+(null===a||void 0===a?void 0:a._cubeSamplerName)+",\n                    #else\n                        "+(null===a||void 0===a?void 0:a._2DSamplerName)+",\n                        "+(null===a||void 0===a?void 0:a._2DSamplerName)+",\n                    #endif\n                #endif\n            #endif\n            #if defined(ENVIRONMENTBRDF) && !defined("+
(null===a||void 0===a?void 0:a._defineSkyboxName)+")\n                #ifdef RADIANCEOCCLUSION\n                    ambientMonochrome,\n                #endif\n            #endif\n                clearcoatOut\n            );\n        #else\n            clearcoatOut.specularEnvironmentR0 = specularEnvironmentR0;\n        #endif\r\n"};a.prototype._buildBlock=function(d){this._scene=d.sharedData.scene;d.target===m.a.Fragment&&(d.sharedData.bindableBlocks.push(this),d.sharedData.blocksWithDefines.push(this));
return this};a.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".remapF0OnInterfaceChange = "+this.remapF0OnInterfaceChange+";\r\n"};a.prototype.serialize=function(){var d=c.prototype.serialize.call(this);d.remapF0OnInterfaceChange=this.remapF0OnInterfaceChange;return d};a.prototype._deserialize=function(d,a,b){var e;c.prototype._deserialize.call(this,d,a,b);this.remapF0OnInterfaceChange=null!==(e=d.remapF0OnInterfaceChange)&&void 0!==e?e:!0};Object(q.c)([Object(b.b)("Remap F0 on interface change",
b.a.Boolean,"ADVANCED")],a.prototype,"remapF0OnInterfaceChange",void 0);return a}(u.a);v.a.RegisteredTypes["BABYLON.ClearCoatBlock"]=N;var J=g("Z+J3"),K=function(c){function a(d){d=c.call(this,d,m.a.Fragment)||this;d.linkRefractionWithTransparency=!1;d.invertRefractionY=!1;d._isUnique=!0;d.registerInput("intensity",e.a.Float,!1,m.a.Fragment);d.registerInput("tintAtDistance",e.a.Float,!0,m.a.Fragment);d.registerOutput("refraction",e.a.Object,m.a.Fragment,new n.a("refraction",d,k.c.Output,a,"RefractionBlock"));
return d}Object(q.d)(a,c);a.prototype.getClassName=function(){return"RefractionBlock"};Object.defineProperty(a.prototype,"intensity",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"tintAtDistance",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"view",{get:function(){return this.viewConnectionPoint},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"refraction",{get:function(){return this._outputs[0]},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hasTexture",{get:function(){return!!this._getTexture()},enumerable:!1,configurable:!0});a.prototype._getTexture=function(){return this.texture?this.texture:this._scene.environmentTexture};a.prototype.autoConfigure=function(d){if(!this.intensity.isConnected){var c=new r.a("Refraction intensity",m.a.Fragment,e.a.Float);c.value=1;c.output.connectTo(this.intensity)}this.view&&!this.view.isConnected&&(d=d.getInputBlockByPredicate(function(d){return d.systemValue===
t.a.View}),d||(d=new r.a("view"),d.setAsSystemValue(t.a.View)),d.output.connectTo(this.view))};a.prototype.prepareDefines=function(d,a,b){c.prototype.prepareDefines.call(this,d,a,b);a=(d=this._getTexture())&&d.getTextureMatrix;b.setValue("SS_REFRACTION",a,!0);a&&(b.setValue(this._define3DName,d.isCube,!0),b.setValue(this._defineLODRefractionAlpha,d.lodLevelInAlpha,!0),b.setValue(this._defineLinearSpecularRefraction,d.linearSpecularLOD,!0),b.setValue(this._defineOppositeZ,this._scene.useRightHandedSystem?
!d.invertZ:d.invertZ,!0),b.setValue("SS_LINKREFRACTIONTOTRANSPARENCY",this.linkRefractionWithTransparency,!0),b.setValue("SS_GAMMAREFRACTION",d.gammaSpace,!0),b.setValue("SS_RGBDREFRACTION",d.isRGBD,!0))};a.prototype.isReady=function(){var d=this._getTexture();return d&&!d.isReadyOrNotBlocking()?!1:!0};a.prototype.bind=function(d,a,b,e){var f,n;c.prototype.bind.call(this,d,a,b);if(a=this._getTexture())a.isCube?d.setTexture(this._cubeSamplerName,a):d.setTexture(this._2DSamplerName,a),d.setMatrix(this._refractionMatrixName,
a.getReflectionTextureMatrix()),b=1,!a.isCube&&a.depth&&(b=a.depth),e=null!==(n=null===(f=this.indexOfRefractionConnectionPoint.connectInputBlock)||void 0===f?void 0:f.value)&&void 0!==n?n:1.5,d.setFloat4(this._vRefractionInfosName,a.level,1/e,b,this.invertRefractionY?-1:1),d.setFloat3(this._vRefractionMicrosurfaceInfosName,a.getSize().width,a.lodGenerationScale,a.lodGenerationOffset),f=a.getSize().width,d.setFloat2(this._vRefractionFilteringInfoName,f,H.a.Log2(f))};a.prototype.getCode=function(d){d.sharedData.blockingBlocks.push(this);
d.sharedData.textureBlocks.push(this);this._cubeSamplerName=d._getFreeVariableName(this.name+"CubeSampler");d.samplers.push(this._cubeSamplerName);this._2DSamplerName=d._getFreeVariableName(this.name+"2DSampler");d.samplers.push(this._2DSamplerName);this._define3DName=d._getFreeDefineName("SS_REFRACTIONMAP_3D");d._samplerDeclaration+="#ifdef "+this._define3DName+"\r\n";d._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+";\r\n";d._samplerDeclaration+="#else\r\n";d._samplerDeclaration+=
"uniform sampler2D "+this._2DSamplerName+";\r\n";d._samplerDeclaration+="#endif\r\n";d.sharedData.blocksWithDefines.push(this);d.sharedData.bindableBlocks.push(this);this._defineLODRefractionAlpha=d._getFreeDefineName("SS_LODINREFRACTIONALPHA");this._defineLinearSpecularRefraction=d._getFreeDefineName("SS_LINEARSPECULARREFRACTION");this._defineOppositeZ=d._getFreeDefineName("SS_REFRACTIONMAP_OPPOSITEZ");this._refractionMatrixName=d._getFreeVariableName("refractionMatrix");d._emitUniformFromString(this._refractionMatrixName,
"mat4");d._emitFunction("sampleRefraction","\n            #ifdef "+this._define3DName+"\n                #define sampleRefraction(s, c) textureCube(s, c)\n            #else\n                #define sampleRefraction(s, c) texture2D(s, c)\n            #endif\r\n","//"+this.name);d._emitFunction("sampleRefractionLod","\n            #ifdef "+this._define3DName+"\n                #define sampleRefractionLod(s, c, l) textureCubeLodEXT(s, c, l)\n            #else\n                #define sampleRefractionLod(s, c, l) texture2DLodEXT(s, c, l)\n            #endif\r\n",
"//"+this.name);this._vRefractionMicrosurfaceInfosName=d._getFreeVariableName("vRefractionMicrosurfaceInfos");d._emitUniformFromString(this._vRefractionMicrosurfaceInfosName,"vec3");this._vRefractionInfosName=d._getFreeVariableName("vRefractionInfos");d._emitUniformFromString(this._vRefractionInfosName,"vec4");this._vRefractionFilteringInfoName=d._getFreeVariableName("vRefractionFilteringInfo");d._emitUniformFromString(this._vRefractionFilteringInfoName,"vec2");return""};a.prototype._buildBlock=function(d){this._scene=
d.sharedData.scene;return this};a.prototype._dumpPropertiesCode=function(){var d=c.prototype._dumpPropertiesCode.call(this);this.texture&&(d=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+'");\r\n':this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+'");\r\n',d+=this._codeVariableName+".texture.coordinatesMode = "+this.texture.coordinatesMode+";\r\n");d+=this._codeVariableName+".linkRefractionWithTransparency = "+this.linkRefractionWithTransparency+
";\r\n";return d+=this._codeVariableName+".invertRefractionY = "+this.invertRefractionY+";\r\n"};a.prototype.serialize=function(){var d=c.prototype.serialize.call(this);this.texture&&(d.texture=this.texture.serialize());d.linkRefractionWithTransparency=this.linkRefractionWithTransparency;d.invertRefractionY=this.invertRefractionY;return d};a.prototype._deserialize=function(d,a,b){c.prototype._deserialize.call(this,d,a,b);d.texture&&(b=0===d.texture.url.indexOf("data:")?"":b,this.texture=d.texture.isCube?
J.a.Parse(d.texture,a,b):D.a.Parse(d.texture,a,b));this.linkRefractionWithTransparency=d.linkRefractionWithTransparency;this.invertRefractionY=d.invertRefractionY};Object(q.c)([Object(b.b)("Link refraction to transparency",b.a.Boolean,"ADVANCED",{notifiers:{update:!0}})],a.prototype,"linkRefractionWithTransparency",void 0);Object(q.c)([Object(b.b)("Invert refraction Y",b.a.Boolean,"ADVANCED",{notifiers:{update:!0}})],a.prototype,"invertRefractionY",void 0);return a}(u.a);v.a.RegisteredTypes["BABYLON.RefractionBlock"]=
K;var R=function(a){function c(d){d=a.call(this,d,m.a.Fragment)||this;d._isUnique=!0;d.registerInput("thickness",e.a.Float,!1,m.a.Fragment);d.registerInput("tintColor",e.a.Color3,!0,m.a.Fragment);d.registerInput("translucencyIntensity",e.a.Float,!0,m.a.Fragment);d.registerInput("translucencyDiffusionDist",e.a.Color3,!0,m.a.Fragment);d.registerInput("refraction",e.a.Object,!0,m.a.Fragment,new n.a("refraction",d,k.c.Input,K,"RefractionBlock"));d.registerOutput("subsurface",e.a.Object,m.a.Fragment,new n.a("subsurface",
d,k.c.Output,c,"SubSurfaceBlock"));return d}Object(q.d)(c,a);c.prototype.initialize=function(d){d._excludeVariableName("subSurfaceOut");d._excludeVariableName("vThicknessParam");d._excludeVariableName("vTintColor");d._excludeVariableName("vSubSurfaceIntensity")};c.prototype.getClassName=function(){return"SubSurfaceBlock"};Object.defineProperty(c.prototype,"thickness",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"tintColor",{get:function(){return this._inputs[1]},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"translucencyIntensity",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"translucencyDiffusionDist",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"refraction",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"subsurface",{get:function(){return this._outputs[0]},
enumerable:!1,configurable:!0});c.prototype.autoConfigure=function(d){this.thickness.isConnected||(d=new r.a("SubSurface thickness",m.a.Fragment,e.a.Float),d.value=0,d.output.connectTo(this.thickness))};c.prototype.prepareDefines=function(d,c,b){a.prototype.prepareDefines.call(this,d,c,b);d=this.translucencyDiffusionDist.isConnected||this.translucencyIntensity.isConnected;b.setValue("SUBSURFACE",d||this.refraction.isConnected,!0);b.setValue("SS_TRANSLUCENCY",d,!0);b.setValue("SS_THICKNESSANDMASK_TEXTURE",
!1,!0);b.setValue("SS_MASK_FROM_THICKNESS_TEXTURE",!1,!0);b.setValue("SS_MASK_FROM_THICKNESS_TEXTURE_GLTF",!1,!0)};c.GetCode=function(d,a,c,b){var e,f,n,w,x,g,y,r,h,l,m,k,M,q,L,t,da=(null===a||void 0===a?0:a.thickness.isConnected)?a.thickness.associatedVariableName:"0.",D=(null===a||void 0===a?0:a.tintColor.isConnected)?a.tintColor.associatedVariableName:"vec3(1.)",u=(null===a||void 0===a?0:a.translucencyIntensity.isConnected)?null===a||void 0===a?void 0:a.translucencyIntensity.associatedVariableName:
"1.",H=(null===a||void 0===a?0:a.translucencyDiffusionDist.isConnected)?null===a||void 0===a?void 0:a.translucencyDiffusionDist.associatedVariableName:"vec3(1.)";a=(null===a||void 0===a?0:a.refraction.isConnected)?null===(e=null===a||void 0===a?void 0:a.refraction.connectedPoint)||void 0===e?void 0:e.ownerBlock:null;e=(null===a||void 0===a?0:a.tintAtDistance.isConnected)?a.tintAtDistance.associatedVariableName:"1.";var v=(null===a||void 0===a?0:a.intensity.isConnected)?a.intensity.associatedVariableName:
"1.",A=(null===a||void 0===a?0:a.view.isConnected)?a.view.associatedVariableName:"";d=""+(null!==(f=null===a||void 0===a?void 0:a.getCode(d))&&void 0!==f?f:"");return d+="subSurfaceOutParams subSurfaceOut;\n\n        #ifdef SUBSURFACE\n            vec2 vThicknessParam = vec2(0., "+da+");\n            vec4 vTintColor = vec4("+D+", "+e+");\n            vec3 vSubSurfaceIntensity = vec3("+v+", "+u+", 0.);\n\n            subSurfaceBlock(\n                vSubSurfaceIntensity,\n                vThicknessParam,\n                vTintColor,\n                normalW,\n                specularEnvironmentReflectance,\n            #ifdef SS_THICKNESSANDMASK_TEXTURE\n                vec4(0.),\n            #endif\n            #ifdef REFLECTION\n                #ifdef SS_TRANSLUCENCY\n                    "+
(null===c||void 0===c?void 0:c._reflectionMatrixName)+",\n                    #ifdef USESPHERICALFROMREFLECTIONMAP\n                        #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n                            reflectionOut.irradianceVector,\n                        #endif\n                        #if defined(REALTIME_FILTERING)\n                            "+(null===c||void 0===c?void 0:c._cubeSamplerName)+",\n                            "+(null===c||void 0===c?void 0:c._vReflectionFilteringInfoName)+
",\n                        #endif\n                        #endif\n                    #ifdef USEIRRADIANCEMAP\n                        irradianceSampler,\n                    #endif\n                #endif\n            #endif\n            #ifdef SS_REFRACTION\n                "+b+".xyz,\n                viewDirectionW,\n                "+A+",\n                surfaceAlbedo,\n                "+(null!==(n=null===a||void 0===a?void 0:a._vRefractionInfosName)&&void 0!==n?n:"")+",\n                "+
(null!==(w=null===a||void 0===a?void 0:a._refractionMatrixName)&&void 0!==w?w:"")+",\n                "+(null!==(x=null===a||void 0===a?void 0:a._vRefractionMicrosurfaceInfosName)&&void 0!==x?x:"")+",\n                vLightingIntensity,\n                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n                    alpha,\n                #endif\n                #ifdef "+(null!==(g=null===a||void 0===a?void 0:a._defineLODRefractionAlpha)&&void 0!==g?g:"IGNORE")+"\n                    NdotVUnclamped,\n                #endif\n                #ifdef "+
(null!==(y=null===a||void 0===a?void 0:a._defineLinearSpecularRefraction)&&void 0!==y?y:"IGNORE")+"\n                    roughness,\n                #else\n                    alphaG,\n                #endif\n                #ifdef "+(null!==(r=null===a||void 0===a?void 0:a._define3DName)&&void 0!==r?r:"IGNORE")+"\n                    "+(null!==(h=null===a||void 0===a?void 0:a._cubeSamplerName)&&void 0!==h?h:"")+",\n                #else\n                    "+(null!==(l=null===a||void 0===a?void 0:
a._2DSamplerName)&&void 0!==l?l:"")+",\n                #endif\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef "+(null!==(m=null===a||void 0===a?void 0:a._define3DName)&&void 0!==m?m:"IGNORE")+"\n                        "+(null!==(k=null===a||void 0===a?void 0:a._cubeSamplerName)&&void 0!==k?k:"")+",\n                        "+(null!==(M=null===a||void 0===a?void 0:a._cubeSamplerName)&&void 0!==M?M:"")+",\n                    #else\n                        "+(null!==(q=null===
a||void 0===a?void 0:a._2DSamplerName)&&void 0!==q?q:"")+",\n                        "+(null!==(L=null===a||void 0===a?void 0:a._2DSamplerName)&&void 0!==L?L:"")+",\n                    #endif\n                #endif\n                #ifdef ANISOTROPIC\n                    anisotropicOut,\n                #endif\n                #ifdef REALTIME_FILTERING\n                    "+(null!==(t=null===a||void 0===a?void 0:a._vRefractionFilteringInfoName)&&void 0!==t?t:"")+",\n                #endif\n            #endif\n            #ifdef SS_TRANSLUCENCY\n                "+
H+",\n            #endif\n                subSurfaceOut\n            );\n\n            #ifdef SS_REFRACTION\n                surfaceAlbedo = subSurfaceOut.surfaceAlbedo;\n                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n                    alpha = subSurfaceOut.alpha;\n                #endif\n            #endif\n        #else\n            subSurfaceOut.specularEnvironmentReflectance = specularEnvironmentReflectance;\n        #endif\r\n"};c.prototype._buildBlock=function(d){d.target===m.a.Fragment&&
d.sharedData.blocksWithDefines.push(this);return this};return c}(u.a);v.a.RegisteredTypes["BABYLON.SubSurfaceBlock"]=R;var E=g("Xeau"),ea={ambientClr:["finalAmbient",""],diffuseDir:["finalDiffuse",""],specularDir:["finalSpecularScaled","!defined(UNLIT) && defined(SPECULARTERM)"],clearcoatDir:["finalClearCoatScaled","!defined(UNLIT) && defined(CLEARCOAT)"],sheenDir:["finalSheenScaled","!defined(UNLIT) && defined(SHEEN)"],diffuseInd:["finalIrradiance","!defined(UNLIT) && defined(REFLECTION)"],specularInd:["finalRadianceScaled",
"!defined(UNLIT) && defined(REFLECTION)"],clearcoatInd:["clearcoatOut.finalClearCoatRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(CLEARCOAT)"],sheenInd:["sheenOut.finalSheenRadianceScaled","!defined(UNLIT) && defined(REFLECTION) && defined(SHEEN) && defined(ENVIRONMENTBRDF)"],refraction:["subSurfaceOut.finalRefraction","!defined(UNLIT) && defined(SS_REFRACTION)"],lighting:["finalColor.rgb",""],shadow:["shadow",""],alpha:["alpha",""]};g=function(g){function l(d){d=g.call(this,
d,m.a.VertexAndFragment)||this;d._environmentBRDFTexture=null;d._metallicReflectanceColor=E.a.White();d._metallicF0Factor=1;d.directIntensity=1;d.environmentIntensity=1;d.specularIntensity=1;d.lightFalloff=0;d.useAlphaTest=!1;d.alphaTestCutoff=.5;d.useAlphaBlending=!1;d.useRadianceOverAlpha=!0;d.useSpecularOverAlpha=!0;d.enableSpecularAntiAliasing=!1;d.realTimeFiltering=!1;d.realTimeFilteringQuality=8;d.useEnergyConservation=!0;d.useRadianceOcclusion=!0;d.useHorizonOcclusion=!0;d.unlit=!1;d.forceNormalForward=
!1;d.debugMode=0;d.debugLimit=0;d.debugFactor=1;d._isUnique=!0;d.registerInput("worldPosition",e.a.Vector4,!1,m.a.Vertex);d.registerInput("worldNormal",e.a.Vector4,!1,m.a.Fragment);d.registerInput("view",e.a.Matrix,!1);d.registerInput("cameraPosition",e.a.Vector3,!1,m.a.Fragment);d.registerInput("perturbedNormal",e.a.Vector4,!0,m.a.Fragment);d.registerInput("baseColor",e.a.Color3,!0,m.a.Fragment);d.registerInput("metallic",e.a.Float,!1,m.a.Fragment);d.registerInput("roughness",e.a.Float,!1,m.a.Fragment);
d.registerInput("ambientOcc",e.a.Float,!0,m.a.Fragment);d.registerInput("opacity",e.a.Float,!0,m.a.Fragment);d.registerInput("indexOfRefraction",e.a.Float,!0,m.a.Fragment);d.registerInput("ambientColor",e.a.Color3,!0,m.a.Fragment);d.registerInput("reflection",e.a.Object,!0,m.a.Fragment,new n.a("reflection",d,k.c.Input,y,"ReflectionBlock"));d.registerInput("clearcoat",e.a.Object,!0,m.a.Fragment,new n.a("clearcoat",d,k.c.Input,N,"ClearCoatBlock"));d.registerInput("sheen",e.a.Object,!0,m.a.Fragment,
new n.a("sheen",d,k.c.Input,x,"SheenBlock"));d.registerInput("subsurface",e.a.Object,!0,m.a.Fragment,new n.a("subsurface",d,k.c.Input,R,"SubSurfaceBlock"));d.registerInput("anisotropy",e.a.Object,!0,m.a.Fragment,new n.a("anisotropy",d,k.c.Input,w,"AnisotropyBlock"));d.registerOutput("ambientClr",e.a.Color3,m.a.Fragment);d.registerOutput("diffuseDir",e.a.Color3,m.a.Fragment);d.registerOutput("specularDir",e.a.Color3,m.a.Fragment);d.registerOutput("clearcoatDir",e.a.Color3,m.a.Fragment);d.registerOutput("sheenDir",
e.a.Color3,m.a.Fragment);d.registerOutput("diffuseInd",e.a.Color3,m.a.Fragment);d.registerOutput("specularInd",e.a.Color3,m.a.Fragment);d.registerOutput("clearcoatInd",e.a.Color3,m.a.Fragment);d.registerOutput("sheenInd",e.a.Color3,m.a.Fragment);d.registerOutput("refraction",e.a.Color3,m.a.Fragment);d.registerOutput("lighting",e.a.Color3,m.a.Fragment);d.registerOutput("shadow",e.a.Float,m.a.Fragment);d.registerOutput("alpha",e.a.Float,m.a.Fragment);return d}Object(q.d)(l,g);l.prototype.initialize=
function(d){d._excludeVariableName("vLightingIntensity");d._excludeVariableName("geometricNormalW");d._excludeVariableName("normalW");d._excludeVariableName("faceNormal");d._excludeVariableName("albedoOpacityOut");d._excludeVariableName("surfaceAlbedo");d._excludeVariableName("alpha");d._excludeVariableName("aoOut");d._excludeVariableName("baseColor");d._excludeVariableName("reflectivityOut");d._excludeVariableName("microSurface");d._excludeVariableName("roughness");d._excludeVariableName("NdotVUnclamped");
d._excludeVariableName("NdotV");d._excludeVariableName("alphaG");d._excludeVariableName("AARoughnessFactors");d._excludeVariableName("environmentBrdf");d._excludeVariableName("ambientMonochrome");d._excludeVariableName("seo");d._excludeVariableName("eho");d._excludeVariableName("environmentRadiance");d._excludeVariableName("irradianceVector");d._excludeVariableName("environmentIrradiance");d._excludeVariableName("diffuseBase");d._excludeVariableName("specularBase");d._excludeVariableName("preInfo");
d._excludeVariableName("info");d._excludeVariableName("shadow");d._excludeVariableName("finalDiffuse");d._excludeVariableName("finalAmbient");d._excludeVariableName("ambientOcclusionForDirectDiffuse");d._excludeVariableName("finalColor");d._excludeVariableName("vClipSpacePosition");d._excludeVariableName("vDebugMode")};l.prototype.getClassName=function(){return"PBRMetallicRoughnessBlock"};Object.defineProperty(l.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});
Object.defineProperty(l.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"view",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"cameraPosition",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"perturbedNormal",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,
"baseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"metallic",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"roughness",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"ambientOcc",{get:function(){return this._inputs[8]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"opacity",{get:function(){return this._inputs[9]},
enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"indexOfRefraction",{get:function(){return this._inputs[10]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"ambientColor",{get:function(){return this._inputs[11]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"reflection",{get:function(){return this._inputs[12]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"clearcoat",{get:function(){return this._inputs[13]},enumerable:!1,
configurable:!0});Object.defineProperty(l.prototype,"sheen",{get:function(){return this._inputs[14]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"subsurface",{get:function(){return this._inputs[15]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"anisotropy",{get:function(){return this._inputs[16]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"ambientClr",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,
"diffuseDir",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"specularDir",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"clearcoatDir",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"sheenDir",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"diffuseIndirect",{get:function(){return this._outputs[5]},
enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"specularIndirect",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"clearcoatIndirect",{get:function(){return this._outputs[7]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"sheenIndirect",{get:function(){return this._outputs[8]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"refraction",{get:function(){return this._outputs[9]},enumerable:!1,
configurable:!0});Object.defineProperty(l.prototype,"lighting",{get:function(){return this._outputs[10]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"shadow",{get:function(){return this._outputs[11]},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"alpha",{get:function(){return this._outputs[12]},enumerable:!1,configurable:!0});l.prototype.autoConfigure=function(d){if(!this.cameraPosition.isConnected){var a=d.getInputBlockByPredicate(function(d){return d.systemValue===
t.a.CameraPosition});a||(a=new r.a("cameraPosition"),a.setAsSystemValue(t.a.CameraPosition));a.output.connectTo(this.cameraPosition)}this.view.isConnected||(d=d.getInputBlockByPredicate(function(d){return d.systemValue===t.a.View}),d||(d=new r.a("view"),d.setAsSystemValue(t.a.View)),d.output.connectTo(this.view))};l.prototype.prepareDefines=function(d,c,b){b.setValue("PBR",!0);b.setValue("METALLICWORKFLOW",!0);b.setValue("DEBUGMODE",this.debugMode,!0);b.setValue("NORMALXYSCALE",!0);b.setValue("BUMP",
this.perturbedNormal.isConnected,!0);b.setValue("LODBASEDMICROSFURACE",this._scene.getEngine().getCaps().textureLOD);b.setValue("ALBEDO",!1,!0);b.setValue("OPACITY",this.opacity.isConnected,!0);b.setValue("AMBIENT",!0,!0);b.setValue("AMBIENTINGRAYSCALE",!1,!0);b.setValue("REFLECTIVITY",!1,!0);b.setValue("AOSTOREINMETALMAPRED",!1,!0);b.setValue("METALLNESSSTOREINMETALMAPBLUE",!1,!0);b.setValue("ROUGHNESSSTOREINMETALMAPALPHA",!1,!0);b.setValue("ROUGHNESSSTOREINMETALMAPGREEN",!1,!0);this.lightFalloff===
f.a.LIGHTFALLOFF_STANDARD?(b.setValue("USEPHYSICALLIGHTFALLOFF",!1),b.setValue("USEGLTFLIGHTFALLOFF",!1)):this.lightFalloff===f.a.LIGHTFALLOFF_GLTF?(b.setValue("USEPHYSICALLIGHTFALLOFF",!1),b.setValue("USEGLTFLIGHTFALLOFF",!0)):(b.setValue("USEPHYSICALLIGHTFALLOFF",!0),b.setValue("USEGLTFLIGHTFALLOFF",!1));var e=this.alphaTestCutoff.toString();b.setValue("ALPHABLEND",this.useAlphaBlending,!0);b.setValue("ALPHAFROMALBEDO",!1,!0);b.setValue("ALPHATEST",this.useAlphaTest,!0);b.setValue("ALPHATESTVALUE",
0>e.indexOf(".")?e+".":e,!0);b.setValue("OPACITYRGB",!1,!0);b.setValue("RADIANCEOVERALPHA",this.useRadianceOverAlpha,!0);b.setValue("SPECULAROVERALPHA",this.useSpecularOverAlpha,!0);b.setValue("SPECULARAA",this._scene.getEngine().getCaps().standardDerivatives&&this.enableSpecularAntiAliasing,!0);b.setValue("REALTIME_FILTERING",this.realTimeFiltering,!0);1<this._scene.getEngine().webGLVersion?b.setValue("NUM_SAMPLES",this.realTimeFilteringQuality+"u",!0):b.setValue("NUM_SAMPLES",""+this.realTimeFilteringQuality,
!0);b.setValue("BRDF_V_HEIGHT_CORRELATED",!0);b.setValue("MS_BRDF_ENERGY_CONSERVATION",this.useEnergyConservation,!0);b.setValue("RADIANCEOCCLUSION",this.useRadianceOcclusion,!0);b.setValue("HORIZONOCCLUSION",this.useHorizonOcclusion,!0);b.setValue("UNLIT",this.unlit,!0);b.setValue("FORCENORMALFORWARD",this.forceNormalForward,!0);this._environmentBRDFTexture&&a.a.ReflectionTextureEnabled?(b.setValue("ENVIRONMENTBRDF",!0),b.setValue("ENVIRONMENTBRDF_RGBD",this._environmentBRDFTexture.isRGBD,!0)):(b.setValue("ENVIRONMENTBRDF",
!1),b.setValue("ENVIRONMENTBRDF_RGBD",!1));b._areLightsDirty&&(e=d.getScene(),this.light?(c={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1},h.a.PrepareDefinesForLight(e,d,this.light,this._lightId,b,!0,c),c.needRebuild&&b.rebuild()):(h.a.PrepareDefinesForLights(e,d,b,!0,c.maxSimultaneousLights),b._needNormals=!0,h.a.PrepareDefinesForMultiview(e,b)))};l.prototype.updateUniformsAndSamples=function(d,a,c,b){for(var e=0;e<a.maxSimultaneousLights&&c["LIGHT"+e];e++){var f=
0<=d.uniforms.indexOf("vLightData"+e);h.a.PrepareUniformsAndSamplersForLight(e,d.uniforms,d.samplers,c["PROJECTEDLIGHTTEXTURE"+e],b,f)}};l.prototype.bind=function(d,a,c){var b,e;if(c){var f=c.getScene();this.light?h.a.BindLight(this.light,this._lightId,f,d,!0):h.a.BindLights(f,c,d,!0,a.maxSimultaneousLights);d.setTexture(this._environmentBrdfSamplerName,this._environmentBRDFTexture);d.setFloat2("vDebugMode",this.debugLimit,this.debugFactor);(a=this._scene.ambientColor)&&d.setColor3("ambientFromScene",
a);d.setFloat(this._invertNormalName,f.useRightHandedSystem===(null!=f._mirroredCameraPosition)?-1:1);d.setFloat4("vLightingIntensity",this.directIntensity,1,this.environmentIntensity*this._scene.environmentIntensity,this.specularIntensity);f=null!==(e=null===(b=this.indexOfRefraction.connectInputBlock)||void 0===b?void 0:b.value)&&void 0!==e?e:1.5;this._metallicReflectanceColor.scaleToRef(Math.pow((f-1)/(f+1),2)*this._metallicF0Factor,E.c.Color3[0]);d.setColor4(this._vMetallicReflectanceFactorsName,
E.c.Color3[0],this._metallicF0Factor)}};l.prototype._injectVertexCode=function(d){var a,c,b=this.worldPosition,e="//"+this.name;this.light?(this._lightId=(void 0!==d.counters.lightCounter?d.counters.lightCounter:-1)+1,d.counters.lightCounter=this._lightId,d._emitFunctionFromInclude(d.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",e,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(d._emitFunctionFromInclude(d.supportUniformBuffers?
"lightUboDeclaration":"lightFragmentDeclaration",e,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,d.sharedData.dynamicUniformBlocks.push(this));var f="v_"+b.associatedVariableName;d._emitVaryingFromString(f,"vec4")&&(d.compilationString+=f+" = "+b.associatedVariableName+";\r\n");if(f=this.reflection.isConnected?null===(a=this.reflection.connectedPoint)||void 0===a?void 0:a.ownerBlock:null)f.viewConnectionPoint=this.view;d.compilationString+=null!==(c=null===f||void 0===f?void 0:f.handleVertexSide(d))&&
void 0!==c?c:"";d._emitUniformFromString("vDebugMode","vec2","defined(IGNORE) || DEBUGMODE > 0");d._emitUniformFromString("ambientFromScene","vec3");d._emitVaryingFromString("vClipSpacePosition","vec4","defined(IGNORE) || DEBUGMODE > 0")&&(d._injectAtEnd+="#if DEBUGMODE > 0\r\n",d._injectAtEnd+="vClipSpacePosition = gl_Position;\r\n",d._injectAtEnd+="#endif\r\n");this.light?d.compilationString+=d._emitCodeFromInclude("shadowsVertex",e,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},
{search:/worldPos/g,replace:b.associatedVariableName}]}):(d.compilationString+="vec4 worldPos = "+b.associatedVariableName+";\r\n",this.view.isConnected&&(d.compilationString+="mat4 view = "+this.view.associatedVariableName+";\r\n"),d.compilationString+=d._emitCodeFromInclude("shadowsVertex",e,{repeatKey:"maxSimultaneousLights"}))};l.prototype._getAlbedoOpacityCode=function(){return"albedoOpacityOutParams albedoOpacityOut;\r\nalbedoOpacityBlock(\n                vec4("+((this.baseColor.isConnected?
this.baseColor.associatedVariableName:"vec3(1.)")+", 1.),\n            #ifdef ALBEDO\n                vec4(1.),\n                vec2(1., 1.),\n            #endif\n            #ifdef OPACITY\n                vec4("+(this.opacity.isConnected?this.opacity.associatedVariableName:"1.")+"),\n                vec2(1., 1.),\n            #endif\n                albedoOpacityOut\n            );\n\n            vec3 surfaceAlbedo = albedoOpacityOut.surfaceAlbedo;\n            float alpha = albedoOpacityOut.alpha;\r\n")};
l.prototype._getAmbientOcclusionCode=function(){return"ambientOcclusionOutParams aoOut;\r\nambientOcclusionBlock(\n            #ifdef AMBIENT\n                vec3("+((this.ambientOcc.isConnected?this.ambientOcc.associatedVariableName:"1.")+"),\n                vec4(0., 1.0, 1.0, 0.),\n            #endif\n                aoOut\n            );\r\n")};l.prototype._getReflectivityCode=function(d){var a="reflectivityOutParams reflectivityOut;\r\n";this._vMetallicReflectanceFactorsName=d._getFreeVariableName("vMetallicReflectanceFactors");
d._emitUniformFromString(this._vMetallicReflectanceFactorsName,"vec4");return a+="vec3 baseColor = surfaceAlbedo;\n\n            reflectivityBlock(\n                vec4("+this.metallic.associatedVariableName+", "+this.roughness.associatedVariableName+", 0., 0.),\n            #ifdef METALLICWORKFLOW\n                surfaceAlbedo,\n                "+this._vMetallicReflectanceFactorsName+",\n            #endif\n            #ifdef REFLECTIVITY\n                vec3(0., 0., 1.),\n                vec4(1.),\n            #endif\n            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY)  && defined(AOSTOREINMETALMAPRED)\n                aoOut.ambientOcclusionColor,\n            #endif\n            #ifdef MICROSURFACEMAP\n                microSurfaceTexel, <== not handled!\n            #endif\n                reflectivityOut\n            );\n\n            float microSurface = reflectivityOut.microSurface;\n            float roughness = reflectivityOut.roughness;\n\n            #ifdef METALLICWORKFLOW\n                surfaceAlbedo = reflectivityOut.surfaceAlbedo;\n            #endif\n            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n                aoOut.ambientOcclusionColor = reflectivityOut.ambientOcclusionColor;\n            #endif\r\n"};
l.prototype._buildBlock=function(d){var a,b,e,n,w,x,l,y,r,h,k,q,t,D,u,H,v,A,E,I,J,K,O,P,Q,S,T,U,V,z,B,F,G,W,X,Y,Z,aa,ba;g.prototype._buildBlock.call(this,d);this._scene=d.sharedData.scene;this._environmentBRDFTexture||(this._environmentBRDFTexture=c.a.GetEnvironmentBRDFTexture(this._scene));var p=this.reflection.isConnected?null===(a=this.reflection.connectedPoint)||void 0===a?void 0:a.ownerBlock:null;p&&(p.worldPositionConnectionPoint=this.worldPosition,p.cameraPositionConnectionPoint=this.cameraPosition,
p.worldNormalConnectionPoint=this.worldNormal);if(d.target!==m.a.Fragment)return this._injectVertexCode(d),this;d.sharedData.bindableBlocks.push(this);d.sharedData.blocksWithDefines.push(this);a="//"+this.name;var C="v_"+this.worldPosition.associatedVariableName,ca=this.perturbedNormal;this._environmentBrdfSamplerName=d._getFreeVariableName("environmentBrdfSampler");d._emit2DSampler(this._environmentBrdfSamplerName);d.sharedData.hints.needAlphaBlending=d.sharedData.hints.needAlphaBlending||this.useAlphaBlending;
d.sharedData.hints.needAlphaTesting=d.sharedData.hints.needAlphaTesting||this.useAlphaTest;d._emitExtension("lod","#extension GL_EXT_shader_texture_lod : enable","defined(LODBASEDMICROSFURACE)");d._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");this.light?d._emitFunctionFromInclude(d.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",a,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):d._emitFunctionFromInclude(d.supportUniformBuffers?
"lightUboDeclaration":"lightFragmentDeclaration",a,{repeatKey:"maxSimultaneousLights"});d._emitFunctionFromInclude("helperFunctions",a);d._emitFunctionFromInclude("importanceSampling",a);d._emitFunctionFromInclude("pbrHelperFunctions",a);d._emitFunctionFromInclude("imageProcessingFunctions",a);d._emitFunctionFromInclude("shadowsFragmentFunctions",a,{replaceStrings:[{search:/vPositionW/g,replace:C+".xyz"}]});d._emitFunctionFromInclude("pbrDirectLightingSetupFunctions",a,{replaceStrings:[{search:/vPositionW/g,
replace:C+".xyz"}]});d._emitFunctionFromInclude("pbrDirectLightingFalloffFunctions",a);d._emitFunctionFromInclude("pbrBRDFFunctions",a,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(b=null===p||void 0===p?void 0:p._defineSkyboxName)&&void 0!==b?b:"REFLECTIONMAP_SKYBOX"}]});d._emitFunctionFromInclude("hdrFilteringFunctions",a);d._emitFunctionFromInclude("pbrDirectLightingFunctions",a,{replaceStrings:[{search:/vPositionW/g,replace:C+".xyz"}]});d._emitFunctionFromInclude("pbrIBLFunctions",
a);d._emitFunctionFromInclude("pbrBlockAlbedoOpacity",a);d._emitFunctionFromInclude("pbrBlockReflectivity",a);d._emitFunctionFromInclude("pbrBlockAmbientOcclusion",a);d._emitFunctionFromInclude("pbrBlockAlphaFresnel",a);d._emitFunctionFromInclude("pbrBlockAnisotropic",a);d._emitUniformFromString("vLightingIntensity","vec4");this._vNormalWName=d._getFreeVariableName("vNormalW");d.compilationString+="vec4 "+this._vNormalWName+" = normalize("+this.worldNormal.associatedVariableName+");\r\n";d._registerTempVariable("viewDirectionW")&&
(d.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - "+C+".xyz);\r\n");d.compilationString+="vec3 geometricNormalW = "+this._vNormalWName+".xyz;\r\n";d.compilationString+="vec3 normalW = "+(ca.isConnected?"normalize("+ca.associatedVariableName+".xyz)":"geometricNormalW")+";\r\n";this._invertNormalName=d._getFreeVariableName("invertNormal");d._emitUniformFromString(this._invertNormalName,"float");d.compilationString+=d._emitCodeFromInclude("pbrBlockNormalFinal",
a,{replaceStrings:[{search:/vPositionW/g,replace:C+".xyz"},{search:/vEyePosition.w/g,replace:this._invertNormalName}]});d.compilationString+=this._getAlbedoOpacityCode();d.compilationString+=d._emitCodeFromInclude("depthPrePass",a);d.compilationString+=this._getAmbientOcclusionCode();d.compilationString+=d._emitCodeFromInclude("pbrBlockLightmapInit",a);d.compilationString+="#ifdef UNLIT\n                vec3 diffuseBase = vec3(1., 1., 1.);\n            #else\r\n";d.compilationString+=this._getReflectivityCode(d);
d.compilationString+=d._emitCodeFromInclude("pbrBlockGeometryInfo",a,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(e=null===p||void 0===p?void 0:p._defineSkyboxName)&&void 0!==e?e:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:null!==(n=null===p||void 0===p?void 0:p._define3DName)&&void 0!==n?n:"REFLECTIONMAP_3D"}]});if(b=this.anisotropy.isConnected?null===(w=this.anisotropy.connectedPoint)||void 0===w?void 0:w.ownerBlock:null)b.worldPositionConnectionPoint=this.worldPosition,
b.worldNormalConnectionPoint=this.worldNormal,d.compilationString+=b.getCode(d,!this.perturbedNormal.isConnected);p&&p.hasTexture&&(d.compilationString+=p.getCode(d,b?"anisotropicOut.anisotropicNormal":"normalW"));d._emitFunctionFromInclude("pbrBlockReflection",a,{replaceStrings:[{search:/computeReflectionCoords/g,replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:null!==(x=null===p||void 0===p?void 0:p._define3DName)&&void 0!==x?x:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,
replace:null!==(l=null===p||void 0===p?void 0:p._defineOppositeZ)&&void 0!==l?l:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:null!==(y=null===p||void 0===p?void 0:p._defineProjectionName)&&void 0!==y?y:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(r=null===p||void 0===p?void 0:p._defineSkyboxName)&&void 0!==r?r:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:null!==(h=null===p||void 0===p?void 0:p._defineLODReflectionAlpha)&&
void 0!==h?h:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:null!==(k=null===p||void 0===p?void 0:p._defineLinearSpecularReflection)&&void 0!==k?k:"LINEARSPECULARREFLECTION"},{search:/vReflectionFilteringInfo/g,replace:null!==(q=null===p||void 0===p?void 0:p._vReflectionFilteringInfoName)&&void 0!==q?q:"vReflectionFilteringInfo"}]});d.compilationString+=d._emitCodeFromInclude("pbrBlockReflectance0",a,{replaceStrings:[{search:/metallicReflectanceFactors/g,replace:this._vMetallicReflectanceFactorsName}]});
if(w=this.sheen.isConnected?null===(t=this.sheen.connectedPoint)||void 0===t?void 0:t.ownerBlock:null)d.compilationString+=w.getCode(p);d._emitFunctionFromInclude("pbrBlockSheen",a,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:null!==(D=null===p||void 0===p?void 0:p._define3DName)&&void 0!==D?D:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(u=null===p||void 0===p?void 0:p._defineSkyboxName)&&void 0!==u?u:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:null!==
(H=null===p||void 0===p?void 0:p._defineLODReflectionAlpha)&&void 0!==H?H:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:null!==(v=null===p||void 0===p?void 0:p._defineLinearSpecularReflection)&&void 0!==v?v:"LINEARSPECULARREFLECTION"}]});t=this.clearcoat.isConnected?null===(A=this.clearcoat.connectedPoint)||void 0===A?void 0:A.ownerBlock:null;A=!this.perturbedNormal.isConnected&&!this.anisotropy.isConnected;D=this.perturbedNormal.isConnected&&(null===(E=this.perturbedNormal.connectedPoint)||
void 0===E?void 0:E.ownerBlock).worldTangent.isConnected;E=this.anisotropy.isConnected&&(null===(I=this.anisotropy.connectedPoint)||void 0===I?void 0:I.ownerBlock).worldTangent.isConnected;I=D||!this.perturbedNormal.isConnected&&E;d.compilationString+=N.GetCode(d,t,p,C,A,I,this.worldNormal.associatedVariableName);A&&(I=null!==(J=null===t||void 0===t?void 0:t.worldTangent.isConnected)&&void 0!==J?J:!1);d._emitFunctionFromInclude("pbrBlockClearcoat",a,{replaceStrings:[{search:/computeReflectionCoords/g,
replace:"computeReflectionCoordsPBR"},{search:/REFLECTIONMAP_3D/g,replace:null!==(K=null===p||void 0===p?void 0:p._define3DName)&&void 0!==K?K:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:null!==(O=null===p||void 0===p?void 0:p._defineOppositeZ)&&void 0!==O?O:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,replace:null!==(P=null===p||void 0===p?void 0:p._defineProjectionName)&&void 0!==P?P:"REFLECTIONMAP_PROJECTION"},{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==
(Q=null===p||void 0===p?void 0:p._defineSkyboxName)&&void 0!==Q?Q:"REFLECTIONMAP_SKYBOX"},{search:/LODINREFLECTIONALPHA/g,replace:null!==(S=null===p||void 0===p?void 0:p._defineLODReflectionAlpha)&&void 0!==S?S:"LODINREFLECTIONALPHA"},{search:/LINEARSPECULARREFLECTION/g,replace:null!==(T=null===p||void 0===p?void 0:p._defineLinearSpecularReflection)&&void 0!==T?T:"LINEARSPECULARREFLECTION"},{search:/defined\(TANGENT\)/g,replace:I?"defined(TANGENT)":"defined(IGNORE)"}]});d.compilationString+=d._emitCodeFromInclude("pbrBlockReflectance",
a,{replaceStrings:[{search:/REFLECTIONMAP_SKYBOX/g,replace:null!==(U=null===p||void 0===p?void 0:p._defineSkyboxName)&&void 0!==U?U:"REFLECTIONMAP_SKYBOX"},{search:/REFLECTIONMAP_3D/g,replace:null!==(V=null===p||void 0===p?void 0:p._define3DName)&&void 0!==V?V:"REFLECTIONMAP_3D"}]});J=this.subsurface.isConnected?null===(z=this.subsurface.connectedPoint)||void 0===z?void 0:z.ownerBlock:null;if(z=this.subsurface.isConnected?null===(F=(null===(B=this.subsurface.connectedPoint)||void 0===B?void 0:B.ownerBlock).refraction.connectedPoint)||
void 0===F?void 0:F.ownerBlock:null)z.viewConnectionPoint=this.view,z.indexOfRefractionConnectionPoint=this.indexOfRefraction;d.compilationString+=R.GetCode(d,J,p,C);d._emitFunctionFromInclude("pbrBlockSubSurface",a,{replaceStrings:[{search:/REFLECTIONMAP_3D/g,replace:null!==(G=null===p||void 0===p?void 0:p._define3DName)&&void 0!==G?G:"REFLECTIONMAP_3D"},{search:/REFLECTIONMAP_OPPOSITEZ/g,replace:null!==(W=null===p||void 0===p?void 0:p._defineOppositeZ)&&void 0!==W?W:"REFLECTIONMAP_OPPOSITEZ"},{search:/REFLECTIONMAP_PROJECTION/g,
replace:null!==(X=null===p||void 0===p?void 0:p._defineProjectionName)&&void 0!==X?X:"REFLECTIONMAP_PROJECTION"},{search:/SS_REFRACTIONMAP_3D/g,replace:null!==(Y=null===z||void 0===z?void 0:z._define3DName)&&void 0!==Y?Y:"SS_REFRACTIONMAP_3D"},{search:/SS_LODINREFRACTIONALPHA/g,replace:null!==(Z=null===z||void 0===z?void 0:z._defineLODRefractionAlpha)&&void 0!==Z?Z:"SS_LODINREFRACTIONALPHA"},{search:/SS_LINEARSPECULARREFRACTION/g,replace:null!==(aa=null===z||void 0===z?void 0:z._defineLinearSpecularRefraction)&&
void 0!==aa?aa:"SS_LINEARSPECULARREFRACTION"},{search:/SS_REFRACTIONMAP_OPPOSITEZ/g,replace:null!==(ba=null===z||void 0===z?void 0:z._defineOppositeZ)&&void 0!==ba?ba:"SS_REFRACTIONMAP_OPPOSITEZ"}]});d.compilationString+=d._emitCodeFromInclude("pbrBlockDirectLighting",a);d.compilationString=this.light?d.compilationString+d._emitCodeFromInclude("lightFragment",a,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):d.compilationString+d._emitCodeFromInclude("lightFragment",a,{repeatKey:"maxSimultaneousLights"});
d.compilationString+=d._emitCodeFromInclude("pbrBlockFinalLitComponents",a);d.compilationString+="#endif\r\n";B=this.ambientColor.isConnected?this.ambientColor.associatedVariableName:"vec3(0., 0., 0.)";F=f.a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS.toString();-1===F.indexOf(".")&&(F+=".");d.compilationString+=d._emitCodeFromInclude("pbrBlockFinalUnlitComponents",a,{replaceStrings:[{search:/vec3 finalEmissive[\s\S]*?finalEmissive\*=vLightingIntensity\.y;/g,replace:""},{search:/vAmbientColor/g,replace:B+" * ambientFromScene"},
{search:/vAmbientInfos\.w/g,replace:F}]});d.compilationString+=d._emitCodeFromInclude("pbrBlockFinalColorComposition",a,{replaceStrings:[{search:/finalEmissive/g,replace:"vec3(0.)"}]});d.compilationString+=d._emitCodeFromInclude("pbrBlockImageProcessing",a,{replaceStrings:[{search:/visibility/g,replace:"1."}]});d.compilationString+=d._emitCodeFromInclude("pbrDebug",a,{replaceStrings:[{search:/vNormalW/g,replace:this._vNormalWName},{search:/vPositionW/g,replace:C},{search:/albedoTexture\.rgb;/g,replace:"vec3(1.);\r\ngl_FragColor.rgb = toGammaSpace(gl_FragColor.rgb);\r\n"}]});
a=0;for(C=this._outputs;a<C.length;a++)if(B=C[a],B.hasEndpoints)if(G=ea[B.name]){F=G[0];if(G=G[1])d.compilationString+="#if "+G+"\r\n";d.compilationString+=this._declareOutput(B,d)+" = "+F+";\r\n";G&&(d.compilationString+="#else\r\n",d.compilationString+=this._declareOutput(B,d)+" = vec3(0.);\r\n",d.compilationString+="#endif\r\n")}else console.error("There's no remapping for the "+B.name+" end point! No code generated");return this};l.prototype._dumpPropertiesCode=function(){var a=this._codeVariableName+
".lightFalloff = "+this.lightFalloff+";\r\n";a+=this._codeVariableName+".useAlphaTest = "+this.useAlphaTest+";\r\n";a+=this._codeVariableName+".alphaTestCutoff = "+this.alphaTestCutoff+";\r\n";a+=this._codeVariableName+".useAlphaBlending = "+this.useAlphaBlending+";\r\n";a+=this._codeVariableName+".useRadianceOverAlpha = "+this.useRadianceOverAlpha+";\r\n";a+=this._codeVariableName+".useSpecularOverAlpha = "+this.useSpecularOverAlpha+";\r\n";a+=this._codeVariableName+".enableSpecularAntiAliasing = "+
this.enableSpecularAntiAliasing+";\r\n";a+=this._codeVariableName+".realTimeFiltering = "+this.realTimeFiltering+";\r\n";a+=this._codeVariableName+".realTimeFilteringQuality = "+this.realTimeFilteringQuality+";\r\n";a+=this._codeVariableName+".useEnergyConservation = "+this.useEnergyConservation+";\r\n";a+=this._codeVariableName+".useRadianceOcclusion = "+this.useRadianceOcclusion+";\r\n";a+=this._codeVariableName+".useHorizonOcclusion = "+this.useHorizonOcclusion+";\r\n";a+=this._codeVariableName+
".unlit = "+this.unlit+";\r\n";a+=this._codeVariableName+".forceNormalForward = "+this.forceNormalForward+";\r\n";a+=this._codeVariableName+".debugMode = "+this.debugMode+";\r\n";a+=this._codeVariableName+".debugLimit = "+this.debugLimit+";\r\n";return a+=this._codeVariableName+".debugFactor = "+this.debugFactor+";\r\n"};l.prototype.serialize=function(){var a=g.prototype.serialize.call(this);this.light&&(a.lightId=this.light.id);a.lightFalloff=this.lightFalloff;a.useAlphaTest=this.useAlphaTest;a.alphaTestCutoff=
this.alphaTestCutoff;a.useAlphaBlending=this.useAlphaBlending;a.useRadianceOverAlpha=this.useRadianceOverAlpha;a.useSpecularOverAlpha=this.useSpecularOverAlpha;a.enableSpecularAntiAliasing=this.enableSpecularAntiAliasing;a.realTimeFiltering=this.realTimeFiltering;a.realTimeFilteringQuality=this.realTimeFilteringQuality;a.useEnergyConservation=this.useEnergyConservation;a.useRadianceOcclusion=this.useRadianceOcclusion;a.useHorizonOcclusion=this.useHorizonOcclusion;a.unlit=this.unlit;a.forceNormalForward=
this.forceNormalForward;a.debugMode=this.debugMode;a.debugLimit=this.debugLimit;a.debugFactor=this.debugFactor;return a};l.prototype._deserialize=function(a,c,b){var d,e;g.prototype._deserialize.call(this,a,c,b);a.lightId&&(this.light=c.getLightByID(a.lightId));this.lightFalloff=null!==(d=a.lightFalloff)&&void 0!==d?d:0;this.useAlphaTest=a.useAlphaTest;this.alphaTestCutoff=a.alphaTestCutoff;this.useAlphaBlending=a.useAlphaBlending;this.useRadianceOverAlpha=a.useRadianceOverAlpha;this.useSpecularOverAlpha=
a.useSpecularOverAlpha;this.enableSpecularAntiAliasing=a.enableSpecularAntiAliasing;this.realTimeFiltering=!!a.realTimeFiltering;this.realTimeFilteringQuality=null!==(e=a.realTimeFilteringQuality)&&void 0!==e?e:8;this.useEnergyConservation=a.useEnergyConservation;this.useRadianceOcclusion=a.useRadianceOcclusion;this.useHorizonOcclusion=a.useHorizonOcclusion;this.unlit=a.unlit;this.forceNormalForward=!!a.forceNormalForward;this.debugMode=a.debugMode;this.debugLimit=a.debugLimit;this.debugFactor=a.debugFactor};
Object(q.c)([Object(b.b)("Direct lights",b.a.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],l.prototype,"directIntensity",void 0);Object(q.c)([Object(b.b)("Environment lights",b.a.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],l.prototype,"environmentIntensity",void 0);Object(q.c)([Object(b.b)("Specular highlights",b.a.Float,"INTENSITY",{min:0,max:1,notifiers:{update:!0}})],l.prototype,"specularIntensity",void 0);Object(q.c)([Object(b.b)("Light falloff",b.a.List,"LIGHTING & COLORS",
{notifiers:{update:!0},options:[{label:"Physical",value:f.a.LIGHTFALLOFF_PHYSICAL},{label:"GLTF",value:f.a.LIGHTFALLOFF_GLTF},{label:"Standard",value:f.a.LIGHTFALLOFF_STANDARD}]})],l.prototype,"lightFalloff",void 0);Object(q.c)([Object(b.b)("Alpha Testing",b.a.Boolean,"OPACITY")],l.prototype,"useAlphaTest",void 0);Object(q.c)([Object(b.b)("Alpha CutOff",b.a.Float,"OPACITY",{min:0,max:1,notifiers:{update:!0}})],l.prototype,"alphaTestCutoff",void 0);Object(q.c)([Object(b.b)("Alpha blending",b.a.Boolean,
"OPACITY")],l.prototype,"useAlphaBlending",void 0);Object(q.c)([Object(b.b)("Radiance over alpha",b.a.Boolean,"RENDERING",{notifiers:{update:!0}})],l.prototype,"useRadianceOverAlpha",void 0);Object(q.c)([Object(b.b)("Specular over alpha",b.a.Boolean,"RENDERING",{notifiers:{update:!0}})],l.prototype,"useSpecularOverAlpha",void 0);Object(q.c)([Object(b.b)("Specular anti-aliasing",b.a.Boolean,"RENDERING",{notifiers:{update:!0}})],l.prototype,"enableSpecularAntiAliasing",void 0);Object(q.c)([Object(b.b)("Realtime filtering",
b.a.Boolean,"RENDERING",{notifiers:{update:!0}})],l.prototype,"realTimeFiltering",void 0);Object(q.c)([Object(b.b)("Realtime filtering quality",b.a.List,"RENDERING",{notifiers:{update:!0},options:[{label:"Low",value:8},{label:"Medium",value:16},{label:"High",value:64}]})],l.prototype,"realTimeFilteringQuality",void 0);Object(q.c)([Object(b.b)("Energy Conservation",b.a.Boolean,"ADVANCED",{notifiers:{update:!0}})],l.prototype,"useEnergyConservation",void 0);Object(q.c)([Object(b.b)("Radiance occlusion",
b.a.Boolean,"ADVANCED",{notifiers:{update:!0}})],l.prototype,"useRadianceOcclusion",void 0);Object(q.c)([Object(b.b)("Horizon occlusion",b.a.Boolean,"ADVANCED",{notifiers:{update:!0}})],l.prototype,"useHorizonOcclusion",void 0);Object(q.c)([Object(b.b)("Unlit",b.a.Boolean,"ADVANCED",{notifiers:{update:!0}})],l.prototype,"unlit",void 0);Object(q.c)([Object(b.b)("Force normal forward",b.a.Boolean,"ADVANCED",{notifiers:{update:!0}})],l.prototype,"forceNormalForward",void 0);Object(q.c)([Object(b.b)("Debug mode",
b.a.List,"DEBUG",{notifiers:{update:!0},options:[{label:"None",value:0},{label:"Normalized position",value:1},{label:"Normals",value:2},{label:"Tangents",value:3},{label:"Bitangents",value:4},{label:"Bump Normals",value:5},{label:"ClearCoat Normals",value:8},{label:"ClearCoat Tangents",value:9},{label:"ClearCoat Bitangents",value:10},{label:"Anisotropic Normals",value:11},{label:"Anisotropic Tangents",value:12},{label:"Anisotropic Bitangents",value:13},{label:"Env Refraction",value:40},{label:"Env Reflection",
value:41},{label:"Env Clear Coat",value:42},{label:"Direct Diffuse",value:50},{label:"Direct Specular",value:51},{label:"Direct Clear Coat",value:52},{label:"Direct Sheen",value:53},{label:"Env Irradiance",value:54},{label:"Surface Albedo",value:60},{label:"Reflectance 0",value:61},{label:"Metallic",value:62},{label:"Metallic F0",value:71},{label:"Roughness",value:63},{label:"AlphaG",value:64},{label:"NdotV",value:65},{label:"ClearCoat Color",value:66},{label:"ClearCoat Roughness",value:67},{label:"ClearCoat NdotV",
value:68},{label:"Transmittance",value:69},{label:"Refraction Transmittance",value:70},{label:"SEO",value:80},{label:"EHO",value:81},{label:"Energy Factor",value:82},{label:"Specular Reflectance",value:83},{label:"Clear Coat Reflectance",value:84},{label:"Sheen Reflectance",value:85},{label:"Luminance Over Alpha",value:86},{label:"Alpha",value:87}]})],l.prototype,"debugMode",void 0);Object(q.c)([Object(b.b)("Split position",b.a.Float,"DEBUG",{min:-1,max:1,notifiers:{update:!0}})],l.prototype,"debugLimit",
void 0);Object(q.c)([Object(b.b)("Output factor",b.a.Float,"DEBUG",{min:0,max:5,notifiers:{update:!0}})],l.prototype,"debugFactor",void 0);return l}(u.a);v.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessBlock"]=g},"5syJ":function(v,u,g){g("scQo");g("dNku");g("XoJq")},"840t":function(v,u,g){g.d(u,"a",function(){return q});var q;(function(e){e[e.None=0]="None";e[e.Time=1]="Time"})(q||(q={}))},"8g8O":function(v,u,g){g("1XPg");var q=g("oYeq");u=g("XA4I");var e=g("f9H2"),k=g("RLC9"),h=g("lzMP"),m=g("/eyM"),
t=g("sDlf");v=g("WHS4");g("1+8w");g("suwV");var r=function(b){function f(c){c=b.call(this,c,h.a.Vertex)||this;c.registerInput("matricesIndices",e.a.Vector4);c.registerInput("matricesWeights",e.a.Vector4);c.registerInput("matricesIndicesExtra",e.a.Vector4,!0);c.registerInput("matricesWeightsExtra",e.a.Vector4,!0);c.registerInput("world",e.a.Matrix);c.registerOutput("output",e.a.Matrix);return c}Object(q.d)(f,b);f.prototype.initialize=function(c){c._excludeVariableName("boneSampler");c._excludeVariableName("boneTextureWidth");
c._excludeVariableName("mBones");c._excludeVariableName("BonesPerMesh")};f.prototype.getClassName=function(){return"BonesBlock"};Object.defineProperty(f.prototype,"matricesIndices",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"matricesWeights",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"matricesIndicesExtra",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});
Object.defineProperty(f.prototype,"matricesWeightsExtra",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});f.prototype.autoConfigure=function(c){if(!this.matricesIndices.isConnected){var a=c.getInputBlockByPredicate(function(a){return a.isAttribute&&
"matricesIndices"===a.name});a||(a=new t.a("matricesIndices"),a.setAsAttribute("matricesIndices"));a.output.connectTo(this.matricesIndices)}this.matricesWeights.isConnected||(a=c.getInputBlockByPredicate(function(a){return a.isAttribute&&"matricesWeights"===a.name}),a||(a=new t.a("matricesWeights"),a.setAsAttribute("matricesWeights")),a.output.connectTo(this.matricesWeights));this.world.isConnected||(c=c.getInputBlockByPredicate(function(a){return a.systemValue===k.a.World}),c||(c=new t.a("world"),
c.setAsSystemValue(k.a.World)),c.output.connectTo(this.world))};f.prototype.provideFallbacks=function(c,a){c&&c.useBones&&c.computeBonesUsingShaders&&c.skeleton&&a.addCPUSkinningFallback(0,c)};f.prototype.bind=function(c,a,b){m.a.BindBonesParameters(b,c)};f.prototype.prepareDefines=function(c,a,b){b._areAttributesDirty&&m.a.PrepareDefinesForBones(c,b)};f.prototype._buildBlock=function(c){b.prototype._buildBlock.call(this,c);c.sharedData.blocksWithFallbacks.push(this);c.sharedData.bindableBlocks.push(this);
c.sharedData.blocksWithDefines.push(this);c.uniforms.push("boneTextureWidth");c.uniforms.push("mBones");c.samplers.push("boneSampler");var a="//"+this.name;c._emitFunctionFromInclude("bonesDeclaration",a,{removeAttributes:!0,removeUniforms:!1,removeVaryings:!0,removeIfDef:!1});var e=c._getFreeVariableName("influence");c.compilationString+=c._emitCodeFromInclude("bonesVertex",a,{replaceStrings:[{search:/finalWorld=finalWorld\*influence;/,replace:""},{search:/influence/gm,replace:e}]});a=this._outputs[0];
var f=this.world;c.compilationString+="#if NUM_BONE_INFLUENCERS>0\r\n";c.compilationString+=this._declareOutput(a,c)+(" = "+f.associatedVariableName+" * "+e+";\r\n");c.compilationString+="#else\r\n";c.compilationString+=this._declareOutput(a,c)+(" = "+f.associatedVariableName+";\r\n");c.compilationString+="#endif\r\n";return this};return f}(u.a);v.a.RegisteredTypes["BABYLON.BonesBlock"]=r;r=function(b){function f(c){c=b.call(this,c,h.a.Vertex)||this;c.registerInput("world0",e.a.Vector4);c.registerInput("world1",
e.a.Vector4);c.registerInput("world2",e.a.Vector4);c.registerInput("world3",e.a.Vector4);c.registerInput("world",e.a.Matrix,!0);c.registerOutput("output",e.a.Matrix);c.registerOutput("instanceID",e.a.Float);return c}Object(q.d)(f,b);f.prototype.getClassName=function(){return"InstancesBlock"};Object.defineProperty(f.prototype,"world0",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"world1",{get:function(){return this._inputs[1]},enumerable:!1,
configurable:!0});Object.defineProperty(f.prototype,"world2",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"world3",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"world",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,
"instanceID",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});f.prototype.autoConfigure=function(c){if(!this.world0.connectedPoint){var a=c.getInputBlockByPredicate(function(a){return a.isAttribute&&"world0"===a.name});a||(a=new t.a("world0"),a.setAsAttribute("world0"));a.output.connectTo(this.world0)}this.world1.connectedPoint||(a=c.getInputBlockByPredicate(function(a){return a.isAttribute&&"world1"===a.name}),a||(a=new t.a("world1"),a.setAsAttribute("world1")),a.output.connectTo(this.world1));
this.world2.connectedPoint||(a=c.getInputBlockByPredicate(function(a){return a.isAttribute&&"world2"===a.name}),a||(a=new t.a("world2"),a.setAsAttribute("world2")),a.output.connectTo(this.world2));this.world3.connectedPoint||(a=c.getInputBlockByPredicate(function(a){return a.isAttribute&&"world3"===a.name}),a||(a=new t.a("world3"),a.setAsAttribute("world3")),a.output.connectTo(this.world3));this.world.connectedPoint||(c=c.getInputBlockByPredicate(function(a){return a.isAttribute&&"world"===a.name}),
c||(c=new t.a("world"),c.setAsSystemValue(k.a.World)),c.output.connectTo(this.world));this.world.define="!INSTANCES || THIN_INSTANCES"};f.prototype.prepareDefines=function(c,a,b,f,e){void 0===f&&(f=!1);c=!1;b.INSTANCES!==f&&(b.setValue("INSTANCES",f),c=!0);e&&b.THIN_INSTANCES!==!(null===e||void 0===e||!e.getRenderingMesh().hasThinInstances)&&(b.setValue("THIN_INSTANCES",!(null===e||void 0===e||!e.getRenderingMesh().hasThinInstances)),c=!0);c&&b.markAsUnprocessed()};f.prototype._buildBlock=function(c){b.prototype._buildBlock.call(this,
c);c.sharedData.blocksWithDefines.push(this);var a=this._outputs[0],f=this._outputs[1],e=this.world0,n=this.world1,g=this.world2,y=this.world3;c.compilationString+="#ifdef INSTANCES\r\n";c.compilationString+=this._declareOutput(a,c)+(" = mat4("+e.associatedVariableName+", "+n.associatedVariableName+", "+g.associatedVariableName+", "+y.associatedVariableName+");\r\n");c.compilationString+="#ifdef THIN_INSTANCES\r\n";c.compilationString+=a.associatedVariableName+" = "+this.world.associatedVariableName+
" * "+a.associatedVariableName+";\r\n";c.compilationString+="#endif\r\n";c.compilationString+=this._declareOutput(f,c)+" = float(gl_InstanceID);\r\n";c.compilationString+="#else\r\n";c.compilationString+=this._declareOutput(a,c)+(" = "+this.world.associatedVariableName+";\r\n");c.compilationString+=this._declareOutput(f,c)+" = 0.0;\r\n";c.compilationString+="#endif\r\n";return this};return f}(u.a);v.a.RegisteredTypes["BABYLON.InstancesBlock"]=r;var f=g("y4Ty");g("U/Gr");g("wszx");r=function(b){function n(c){c=
b.call(this,c,h.a.Vertex)||this;c.registerInput("position",e.a.Vector3);c.registerInput("normal",e.a.Vector3);c.registerInput("tangent",e.a.Vector3);c.registerInput("uv",e.a.Vector2);c.registerOutput("positionOutput",e.a.Vector3);c.registerOutput("normalOutput",e.a.Vector3);c.registerOutput("tangentOutput",e.a.Vector3);c.registerOutput("uvOutput",e.a.Vector2);return c}Object(q.d)(n,b);n.prototype.getClassName=function(){return"MorphTargetsBlock"};Object.defineProperty(n.prototype,"position",{get:function(){return this._inputs[0]},
enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"normal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"tangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"positionOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,
"normalOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"tangentOutput",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"uvOutput",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0});n.prototype.initialize=function(c){c._excludeVariableName("morphTargetInfluences")};n.prototype.autoConfigure=function(c){if(!this.position.isConnected){var a=c.getInputBlockByPredicate(function(a){return a.isAttribute&&
"position"===a.name});a||(a=new t.a("position"),a.setAsAttribute());a.output.connectTo(this.position)}this.normal.isConnected||(a=c.getInputBlockByPredicate(function(a){return a.isAttribute&&"normal"===a.name}),a||(a=new t.a("normal"),a.setAsAttribute("normal")),a.output.connectTo(this.normal));this.tangent.isConnected||(a=c.getInputBlockByPredicate(function(a){return a.isAttribute&&"tangent"===a.name}),a||(a=new t.a("tangent"),a.setAsAttribute("tangent")),a.output.connectTo(this.tangent));this.uv.isConnected||
(c=c.getInputBlockByPredicate(function(a){return a.isAttribute&&"uv"===a.name}),c||(c=new t.a("uv"),c.setAsAttribute("uv")),c.output.connectTo(this.uv))};n.prototype.prepareDefines=function(c,a,b){b._areAttributesDirty&&m.a.PrepareDefinesForMorphTargets(c,b)};n.prototype.bind=function(c,a,b){b&&b.morphTargetManager&&0<b.morphTargetManager.numInfluencers&&m.a.BindMorphTargetParameters(b,c)};n.prototype.replaceRepeatableContent=function(c,a,b,e){a=this.position;var n=this.normal,g=this.tangent,y=this.uv,
l=this.positionOutput,x=this.normalOutput,w=this.tangentOutput,r=this.uvOutput,h=e.NUM_MORPH_INFLUENCERS,k=b.morphTargetManager;b=k&&k.supportsNormals&&e.NORMAL;var m=k&&k.supportsTangents&&e.TANGENT;e=k&&k.supportsUVs&&e.UV1;k="";for(var t=0;t<h;t++)k+="#ifdef MORPHTARGETS\r\n",k+=l.associatedVariableName+" += (position"+t+" - "+a.associatedVariableName+") * morphTargetInfluences["+t+"];\r\n",b&&(k+="#ifdef MORPHTARGETS_NORMAL\r\n",k+=x.associatedVariableName+" += (normal"+t+" - "+n.associatedVariableName+
") * morphTargetInfluences["+t+"];\r\n",k+="#endif\r\n"),m&&(k+="#ifdef MORPHTARGETS_TANGENT\r\n",k+=w.associatedVariableName+".xyz += (tangent"+t+" - "+g.associatedVariableName+".xyz) * morphTargetInfluences["+t+"];\r\n",k+="#endif\r\n"),e&&(k+="#ifdef MORPHTARGETS_UV\r\n",k+=r.associatedVariableName+".xy += (uv_"+t+" - "+y.associatedVariableName+".xy) * morphTargetInfluences["+t+"];\r\n",k+="#endif\r\n"),k+="#endif\r\n";c.compilationString=c.compilationString.replace(this._repeatableContentAnchor,
k);if(0<h)for(t=0;t<h;t++)c.attributes.push(f.b.PositionKind+t),b&&c.attributes.push(f.b.NormalKind+t),m&&c.attributes.push(f.b.TangentKind+t),e&&c.attributes.push(f.b.UVKind+"_"+t)};n.prototype._buildBlock=function(c){b.prototype._buildBlock.call(this,c);c.sharedData.blocksWithDefines.push(this);c.sharedData.bindableBlocks.push(this);c.sharedData.repeatableContentBlocks.push(this);var a=this.position,e=this.normal,f=this.tangent,n=this.uv,g=this.positionOutput,y=this.normalOutput,x=this.tangentOutput,
r=this.uvOutput,k="//"+this.name;c.uniforms.push("morphTargetInfluences");c._emitFunctionFromInclude("morphTargetsVertexGlobalDeclaration",k);c._emitFunctionFromInclude("morphTargetsVertexDeclaration",k,{repeatKey:"maxSimultaneousMorphTargets"});c.compilationString+=this._declareOutput(g,c)+" = "+a.associatedVariableName+";\r\n";c.compilationString+="#ifdef NORMAL\r\n";c.compilationString+=this._declareOutput(y,c)+" = "+e.associatedVariableName+";\r\n";c.compilationString+="#else\r\n";c.compilationString+=
this._declareOutput(y,c)+" = vec3(0., 0., 0.);\r\n";c.compilationString+="#endif\r\n";c.compilationString+="#ifdef TANGENT\r\n";c.compilationString+=this._declareOutput(x,c)+" = "+f.associatedVariableName+";\r\n";c.compilationString+="#else\r\n";c.compilationString+=this._declareOutput(x,c)+" = vec3(0., 0., 0.);\r\n";c.compilationString+="#endif\r\n";c.compilationString+="#ifdef UV1\r\n";c.compilationString+=this._declareOutput(r,c)+" = "+n.associatedVariableName+";\r\n";c.compilationString+="#else\r\n";
c.compilationString+=this._declareOutput(r,c)+" = vec2(0., 0.);\r\n";c.compilationString+="#endif\r\n";this._repeatableContentAnchor=c._repeatableContentAnchor;c.compilationString+=this._repeatableContentAnchor;return this};return n}(u.a);v.a.RegisteredTypes["BABYLON.MorphTargetsBlock"]=r;var b=g("zZL8");g=function(f){function n(c){c=f.call(this,c,h.a.Vertex)||this;c.registerInput("worldPosition",e.a.Vector4,!1,h.a.Vertex);c.registerOutput("direction",e.a.Vector3);c.registerOutput("color",e.a.Color3);
c.registerOutput("intensity",e.a.Float);return c}Object(q.d)(n,f);n.prototype.getClassName=function(){return"LightInformationBlock"};Object.defineProperty(n.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"direction",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,"color",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(n.prototype,
"intensity",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0});n.prototype.bind=function(c,a,b){b&&(this.light&&this.light.isDisposed&&(this.light=null),b=this.light,a=a.getScene(),!b&&a.lights.length&&(b=a.lights[0]),b&&b.isEnabled?(b.transferToNodeMaterialEffect(c,this._lightDataUniformName),c.setColor4(this._lightColorUniformName,b.diffuse,b.intensity)):(c.setFloat3(this._lightDataUniformName,0,0,0),c.setFloat4(this._lightColorUniformName,0,0,0,0)))};n.prototype.prepareDefines=
function(c,a,f){f._areLightsDirty&&(c=this.light,f.setValue(this._lightTypeDefineName,c&&c instanceof b.a?!0:!1))};n.prototype._buildBlock=function(c){f.prototype._buildBlock.call(this,c);c.sharedData.bindableBlocks.push(this);c.sharedData.blocksWithDefines.push(this);var a=this.direction,b=this.color,e=this.intensity;this._lightDataUniformName=c._getFreeVariableName("lightData");this._lightColorUniformName=c._getFreeVariableName("lightColor");this._lightTypeDefineName=c._getFreeDefineName("LIGHTPOINTTYPE");
c._emitUniformFromString(this._lightDataUniformName,"vec3");c._emitUniformFromString(this._lightColorUniformName,"vec4");c.compilationString+="#ifdef "+this._lightTypeDefineName+"\r\n";c.compilationString+=this._declareOutput(a,c)+(" = normalize("+this.worldPosition.associatedVariableName+".xyz - "+this._lightDataUniformName+");\r\n");c.compilationString+="#else\r\n";c.compilationString+=this._declareOutput(a,c)+(" = "+this._lightDataUniformName+";\r\n");c.compilationString+="#endif\r\n";c.compilationString+=
this._declareOutput(b,c)+(" = "+this._lightColorUniformName+".rgb;\r\n");c.compilationString+=this._declareOutput(e,c)+(" = "+this._lightColorUniformName+".a;\r\n");return this};n.prototype.serialize=function(){var c=f.prototype.serialize.call(this);this.light&&(c.lightId=this.light.id);return c};n.prototype._deserialize=function(c,a,b){f.prototype._deserialize.call(this,c,a,b);c.lightId&&(this.light=a.getLightByID(c.lightId))};return n}(u.a);v.a.RegisteredTypes["BABYLON.LightInformationBlock"]=g},
Nobe:function(v,u,g){g("sDlf");g("840t")},X5mG:function(v,u,g){g("vKbb");var q=g("oYeq");u=g("XA4I");var e=g("f9H2"),k=g("lzMP");v=g("WHS4");g("BKDp");g("z1+4");g("hDr5");var h=function(g){function f(b){b=g.call(this,b,k.a.Fragment)||this;b.registerInput("color",e.a.Color4);b.registerOutput("output",e.a.Color4);b._inputs[0].acceptedConnectionPointTypes.push(e.a.Color3);return b}Object(q.d)(f,g);f.prototype.getClassName=function(){return"ImageProcessingBlock"};Object.defineProperty(f.prototype,"color",
{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});f.prototype.initialize=function(b){b._excludeVariableName("exposureLinear");b._excludeVariableName("contrast");b._excludeVariableName("vInverseScreenSize");b._excludeVariableName("vignetteSettings1");b._excludeVariableName("vignetteSettings2");b._excludeVariableName("vCameraColorCurveNegative");b._excludeVariableName("vCameraColorCurveNeutral");
b._excludeVariableName("vCameraColorCurvePositive");b._excludeVariableName("txColorTransform");b._excludeVariableName("colorTransformSettings")};f.prototype.isReady=function(b,f,e){return e._areImageProcessingDirty&&f.imageProcessingConfiguration&&!f.imageProcessingConfiguration.isReady()?!1:!0};f.prototype.prepareDefines=function(b,f,e){e._areImageProcessingDirty&&f.imageProcessingConfiguration&&f.imageProcessingConfiguration.prepareDefines(e)};f.prototype.bind=function(b,f,e){e&&f.imageProcessingConfiguration&&
f.imageProcessingConfiguration.bind(b)};f.prototype._buildBlock=function(b){g.prototype._buildBlock.call(this,b);b.sharedData.blocksWithDefines.push(this);b.sharedData.blockingBlocks.push(this);b.sharedData.bindableBlocks.push(this);b.uniforms.push("exposureLinear");b.uniforms.push("contrast");b.uniforms.push("vInverseScreenSize");b.uniforms.push("vignetteSettings1");b.uniforms.push("vignetteSettings2");b.uniforms.push("vCameraColorCurveNegative");b.uniforms.push("vCameraColorCurveNeutral");b.uniforms.push("vCameraColorCurvePositive");
b.uniforms.push("txColorTransform");b.uniforms.push("colorTransformSettings");var f=this.color,r=this._outputs[0],c="//"+this.name;b._emitFunctionFromInclude("helperFunctions",c);b._emitFunctionFromInclude("imageProcessingDeclaration",c);b._emitFunctionFromInclude("imageProcessingFunctions",c);b.compilationString=f.connectedPoint.type===e.a.Color4||f.connectedPoint.type===e.a.Vector4?b.compilationString+(this._declareOutput(r,b)+" = "+f.associatedVariableName+";\r\n"):b.compilationString+(this._declareOutput(r,
b)+" = vec4("+f.associatedVariableName+", 1.0);\r\n");b.compilationString+="#ifdef IMAGEPROCESSINGPOSTPROCESS\r\n";b.compilationString+=r.associatedVariableName+".rgb = toLinearSpace("+f.associatedVariableName+".rgb);\r\n";b.compilationString+="#else\r\n";b.compilationString+="#ifdef IMAGEPROCESSING\r\n";b.compilationString+=r.associatedVariableName+".rgb = toLinearSpace("+f.associatedVariableName+".rgb);\r\n";b.compilationString+=r.associatedVariableName+" = applyImageProcessing("+r.associatedVariableName+
");\r\n";b.compilationString+="#endif\r\n";b.compilationString+="#endif\r\n";return this};return f}(u.a);v.a.RegisteredTypes["BABYLON.ImageProcessingBlock"]=h;var m=g("sDlf"),t=g("O6Ub");g("X/2o");g("1g2l");g("F7aL");g=function(g){function f(b){b=g.call(this,b,k.a.Fragment)||this;b._tangentSpaceParameterName="";b.invertX=!1;b.invertY=!1;b.registerInput("worldPosition",e.a.Vector4,!1);b.registerInput("worldNormal",e.a.Vector4,!1);b.registerInput("worldTangent",e.a.Vector4,!0);b.registerInput("uv",
e.a.Vector2,!1);b.registerInput("normalMapColor",e.a.Color3,!1);b.registerInput("strength",e.a.Float,!1);b.registerOutput("output",e.a.Vector4);return b}Object(q.d)(f,g);f.prototype.getClassName=function(){return"PerturbNormalBlock"};Object.defineProperty(f.prototype,"worldPosition",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,
"worldTangent",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"uv",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"normalMapColor",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"strength",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"output",{get:function(){return this._outputs[0]},
enumerable:!1,configurable:!0});f.prototype.prepareDefines=function(b,f,e){e.setValue("BUMP",!0)};f.prototype.bind=function(b,f,e){f.getScene()._mirroredCameraPosition?b.setFloat2(this._tangentSpaceParameterName,this.invertX?1:-1,this.invertY?1:-1):b.setFloat2(this._tangentSpaceParameterName,this.invertX?-1:1,this.invertY?-1:1)};f.prototype.autoConfigure=function(b){this.uv.isConnected||(b=b.getInputBlockByPredicate(function(b){return b.isAttribute&&"uv"===b.name}),b||(b=new m.a("uv"),b.setAsAttribute()),
b.output.connectTo(this.uv));this.strength.isConnected||(b=new m.a("strength"),b.value=1,b.output.connectTo(this.strength))};f.prototype._buildBlock=function(b){g.prototype._buildBlock.call(this,b);var f="//"+this.name,e=this.uv,c=this.worldPosition,a=this.worldNormal,r=this.worldTangent;b.sharedData.blocksWithDefines.push(this);b.sharedData.bindableBlocks.push(this);this._tangentSpaceParameterName=b._getFreeDefineName("tangentSpaceParameter");b._emitUniformFromString(this._tangentSpaceParameterName,
"vec2");var l=this.strength.isConnectedToInputBlock&&this.strength.connectInputBlock.isConstant?""+b._emitFloat(1/this.strength.connectInputBlock.value):"1.0 / "+this.strength.associatedVariableName;b._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");var k={search:/defined\(TANGENT\)/g,replace:r.isConnected?"defined(TANGENT)":"defined(IGNORE)"};r.isConnected&&(b.compilationString+="vec3 tbnNormal = normalize("+a.associatedVariableName+".xyz);\r\n",b.compilationString+=
"vec3 tbnTangent = normalize("+r.associatedVariableName+".xyz);\r\n",b.compilationString+="vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\n",b.compilationString+="mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n");b._emitFunctionFromInclude("bumpFragmentMainFunctions",f,{replaceStrings:[k]});b._emitFunctionFromInclude("bumpFragmentFunctions",f,{replaceStrings:[{search:/vBumpInfos.y/g,replace:l},{search:/vTangentSpaceParams/g,replace:this._tangentSpaceParameterName},{search:/vPositionW/g,
replace:c.associatedVariableName+".xyz"}]});b.compilationString+=this._declareOutput(this.output,b)+" = vec4(0.);\r\n";b.compilationString+=b._emitCodeFromInclude("bumpFragment",f,{replaceStrings:[{search:/perturbNormal\(TBN,vBumpUV\+uvOffset\)/g,replace:"perturbNormal(TBN, "+this.normalMapColor.associatedVariableName+")"},{search:/vBumpInfos.y/g,replace:l},{search:/vBumpUV/g,replace:e.associatedVariableName},{search:/vPositionW/g,replace:c.associatedVariableName+".xyz"},{search:/normalW=/g,replace:this.output.associatedVariableName+
".xyz = "},{search:/mat3\(normalMatrix\)\*normalW/g,replace:"mat3(normalMatrix) * "+this.output.associatedVariableName+".xyz"},{search:/normalW/g,replace:a.associatedVariableName+".xyz"},k]});return this};f.prototype._dumpPropertiesCode=function(){var b=this._codeVariableName+".invertX = "+this.invertX+";\r\n";return b+=this._codeVariableName+".invertY = "+this.invertY+";\r\n"};f.prototype.serialize=function(){var b=g.prototype.serialize.call(this);b.invertX=this.invertX;b.invertY=this.invertY;return b};
f.prototype._deserialize=function(b,f,e){g.prototype._deserialize.call(this,b,f,e);this.invertX=b.invertX;this.invertY=b.invertY};Object(q.c)([Object(t.b)("Invert X axis",t.a.Boolean,"PROPERTIES",{notifiers:{update:!1}})],f.prototype,"invertX",void 0);Object(q.c)([Object(t.b)("Invert Y axis",t.a.Boolean,"PROPERTIES",{notifiers:{update:!1}})],f.prototype,"invertY",void 0);return f}(u.a);v.a.RegisteredTypes["BABYLON.PerturbNormalBlock"]=g;g=function(g){function f(b){b=g.call(this,b,k.a.Fragment,!0)||
this;b.registerInput("value",e.a.Float,!0);b.registerInput("cutoff",e.a.Float,!0);return b}Object(q.d)(f,g);f.prototype.getClassName=function(){return"DiscardBlock"};Object.defineProperty(f.prototype,"value",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"cutoff",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});f.prototype._buildBlock=function(b){g.prototype._buildBlock.call(this,b);b.sharedData.hints.needAlphaTesting=
!0;if(this.cutoff.isConnected&&this.value.isConnected)return b.compilationString+="if ("+this.value.associatedVariableName+" < "+this.cutoff.associatedVariableName+") discard;\r\n",this};return f}(u.a);v.a.RegisteredTypes["BABYLON.DiscardBlock"]=g;g=function(g){function f(b){b=g.call(this,b,k.a.Fragment)||this;b.registerOutput("output",e.a.Float,k.a.Fragment);return b}Object(q.d)(f,g);f.prototype.getClassName=function(){return"FrontFacingBlock"};Object.defineProperty(f.prototype,"output",{get:function(){return this._outputs[0]},
enumerable:!1,configurable:!0});f.prototype._buildBlock=function(b){g.prototype._buildBlock.call(this,b);if(b.target===k.a.Vertex)throw"FrontFacingBlock must only be used in a fragment shader";b.compilationString+=this._declareOutput(this._outputs[0],b)+" = gl_FrontFacing ? 1.0 : 0.0;\r\n";return this};return f}(u.a);v.a.RegisteredTypes["BABYLON.FrontFacingBlock"]=g;g=function(g){function f(b){b=g.call(this,b,k.a.Fragment)||this;b.registerInput("input",e.a.AutoDetect,!1);b.registerOutput("dx",e.a.BasedOnInput);
b.registerOutput("dy",e.a.BasedOnInput);b._outputs[0]._typeConnectionSource=b._inputs[0];b._outputs[1]._typeConnectionSource=b._inputs[0];return b}Object(q.d)(f,g);f.prototype.getClassName=function(){return"DerivativeBlock"};Object.defineProperty(f.prototype,"input",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"dx",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"dy",{get:function(){return this._outputs[1]},
enumerable:!1,configurable:!0});f.prototype._buildBlock=function(b){g.prototype._buildBlock.call(this,b);var f=this._outputs[0],e=this._outputs[1];b._emitExtension("derivatives","#extension GL_OES_standard_derivatives : enable");f.hasEndpoints&&(b.compilationString+=this._declareOutput(f,b)+(" = dFdx("+this.input.associatedVariableName+");\r\n"));e.hasEndpoints&&(b.compilationString+=this._declareOutput(e,b)+(" = dFdy("+this.input.associatedVariableName+");\r\n"));return this};return f}(u.a);v.a.RegisteredTypes["BABYLON.DerivativeBlock"]=
g;g=function(g){function f(b){b=g.call(this,b,k.a.Fragment)||this;b.registerOutput("xy",e.a.Vector2,k.a.Fragment);b.registerOutput("xyz",e.a.Vector3,k.a.Fragment);b.registerOutput("xyzw",e.a.Vector4,k.a.Fragment);b.registerOutput("x",e.a.Float,k.a.Fragment);b.registerOutput("y",e.a.Float,k.a.Fragment);b.registerOutput("z",e.a.Float,k.a.Fragment);b.registerOutput("w",e.a.Float,k.a.Fragment);return b}Object(q.d)(f,g);f.prototype.getClassName=function(){return"FragCoordBlock"};Object.defineProperty(f.prototype,
"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"xyz",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"xyzw",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"x",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"y",{get:function(){return this._outputs[4]},enumerable:!1,
configurable:!0});Object.defineProperty(f.prototype,"z",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"output",{get:function(){return this._outputs[6]},enumerable:!1,configurable:!0});f.prototype.writeOutputs=function(b){for(var f="",e=0,c=this._outputs;e<c.length;e++){var a=c[e];a.hasEndpoints&&(f+=this._declareOutput(a,b)+" = gl_FragCoord."+a.name+";\r\n")}return f};f.prototype._buildBlock=function(b){g.prototype._buildBlock.call(this,
b);if(b.target===k.a.Vertex)throw"FragCoordBlock must only be used in a fragment shader";b.compilationString+=this.writeOutputs(b);return this};return f}(u.a);v.a.RegisteredTypes["BABYLON.FragCoordBlock"]=g;u=function(g){function f(b){b=g.call(this,b,k.a.Fragment)||this;b.registerOutput("xy",e.a.Vector2,k.a.Fragment);b.registerOutput("x",e.a.Float,k.a.Fragment);b.registerOutput("y",e.a.Float,k.a.Fragment);return b}Object(q.d)(f,g);f.prototype.getClassName=function(){return"ScreenSizeBlock"};Object.defineProperty(f.prototype,
"xy",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"x",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"y",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0});f.prototype.bind=function(b,f,e){f=this._scene.getEngine();b.setFloat2(this._varName,f.getRenderWidth(),f.getRenderWidth())};f.prototype.writeOutputs=function(b,f){for(var e="",c=0,a=this._outputs;c<a.length;c++){var n=
a[c];n.hasEndpoints&&(e+=this._declareOutput(n,b)+" = "+f+"."+n.name+";\r\n")}return e};f.prototype._buildBlock=function(b){g.prototype._buildBlock.call(this,b);this._scene=b.sharedData.scene;if(b.target===k.a.Vertex)throw"ScreenSizeBlock must only be used in a fragment shader";b.sharedData.bindableBlocks.push(this);this._varName=b._getFreeVariableName("screenSize");b._emitUniformFromString(this._varName,"vec2");b.compilationString+=this.writeOutputs(b,this._varName);return this};return f}(u.a);v.a.RegisteredTypes["BABYLON.ScreenSizeBlock"]=
u},XoJq:function(v,u,g){g.d(u,"a",function(){return h});var q=g("oYeq");v=g("XA4I");var e=g("f9H2"),k=g("lzMP");g=g("WHS4");var h=function(g){function h(h){h=g.call(this,h,k.a.Fragment)||this;h._isUnique=!0;h.registerInput("color",e.a.Color4,!1,k.a.Fragment);h.registerInput("alphaTexture",e.a.Float,!1,k.a.Fragment);h.registerInput("alphaColor",e.a.Float,!1,k.a.Fragment);h.registerOutput("blendColor",e.a.Color4,k.a.Fragment);return h}Object(q.d)(h,g);h.prototype.getClassName=function(){return"ParticleBlendMultiplyBlock"};
Object.defineProperty(h.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"alphaTexture",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"alphaColor",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"blendColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});h.prototype.initialize=function(e){e._excludeVariableName("sourceAlpha")};
h.prototype._buildBlock=function(e){g.prototype._buildBlock.call(this,e);if(e.target!==k.a.Vertex)return e.compilationString+="\n            #ifdef BLENDMULTIPLYMODE\n                "+this._declareOutput(this.blendColor,e)+";\n                float sourceAlpha = "+this.alphaColor.associatedVariableName+" * "+this.alphaTexture.associatedVariableName+";\n                "+this.blendColor.associatedVariableName+".rgb = "+this.color.associatedVariableName+".rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha);\n                "+
this.blendColor.associatedVariableName+".a = "+this.color.associatedVariableName+".a;\n            #else\n                "+this._declareOutput(this.blendColor,e)+" = "+this.color.associatedVariableName+";\n            #endif\n        ",this};return h}(v.a);g.a.RegisteredTypes["BABYLON.ParticleBlendMultiplyBlock"]=h},aZIP:function(v,u,g){g.d(u,"a",function(){return m});var q=g("oYeq");v=g("XA4I");var e=g("f9H2"),k=g("lzMP");u=g("WHS4");var h=g("aCSs"),m=function(g){function r(f){f=g.call(this,f,k.a.VertexAndFragment)||
this;f._samplerName="textureSampler";f.convertToGammaSpace=!1;f.convertToLinearSpace=!1;f._isUnique=!1;f.registerInput("uv",e.a.Vector2,!1,k.a.VertexAndFragment);f.registerOutput("rgba",e.a.Color4,k.a.Neutral);f.registerOutput("rgb",e.a.Color3,k.a.Neutral);f.registerOutput("r",e.a.Float,k.a.Neutral);f.registerOutput("g",e.a.Float,k.a.Neutral);f.registerOutput("b",e.a.Float,k.a.Neutral);f.registerOutput("a",e.a.Float,k.a.Neutral);f._inputs[0].acceptedConnectionPointTypes.push(e.a.Vector3);f._inputs[0].acceptedConnectionPointTypes.push(e.a.Vector4);
f._inputs[0]._prioritizeVertex=!1;return f}Object(q.d)(r,g);r.prototype.getClassName=function(){return"CurrentScreenBlock"};Object.defineProperty(r.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(r.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(r.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(r.prototype,"r",{get:function(){return this._outputs[2]},
enumerable:!1,configurable:!0});Object.defineProperty(r.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(r.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(r.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0});r.prototype.initialize=function(f){f._excludeVariableName("textureSampler")};Object.defineProperty(r.prototype,"target",{get:function(){return!this.uv.isConnected||
this.uv.sourceBlock.isInput?k.a.VertexAndFragment:k.a.Fragment},enumerable:!1,configurable:!0});r.prototype.prepareDefines=function(f,b,e){e.setValue(this._linearDefineName,this.convertToGammaSpace,!0);e.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)};r.prototype.isReady=function(){return this.texture&&!this.texture.isReadyOrNotBlocking()?!1:!0};r.prototype._injectVertexCode=function(f){var b=this.uv;b.connectedPoint.ownerBlock.isInput&&(b.connectedPoint.ownerBlock.isAttribute||f._emitUniformFromString(b.associatedVariableName,
"vec2"));this._mainUVName="vMain"+b.associatedVariableName;f._emitVaryingFromString(this._mainUVName,"vec2");f.compilationString+=this._mainUVName+" = "+b.associatedVariableName+".xy;\r\n";if(this._outputs.some(function(c){return c.isConnectedInVertexShader})){this._writeTextureRead(f,!0);b=0;for(var e=this._outputs;b<e.length;b++){var g=e[b];g.hasEndpoints&&this._writeOutput(f,g,g.name,!0)}}};r.prototype._writeTextureRead=function(e,b){void 0===b&&(b=!1);var f=this.uv;b?e.target!==k.a.Fragment&&
(e.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+f.associatedVariableName+");\r\n"):e.compilationString=this.uv.ownerBlock.target===k.a.Fragment?e.compilationString+("vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+f.associatedVariableName+");\r\n"):e.compilationString+("vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._mainUVName+");\r\n")};r.prototype._writeOutput=function(e,b,g,h){void 0===h&&(h=!1);h?e.target!==
k.a.Fragment&&(e.compilationString+=this._declareOutput(b,e)+" = "+this._tempTextureRead+"."+g+";\r\n"):this.uv.ownerBlock.target===k.a.Fragment?e.compilationString+=this._declareOutput(b,e)+" = "+this._tempTextureRead+"."+g+";\r\n":(e.compilationString+=this._declareOutput(b,e)+" = "+this._tempTextureRead+"."+g+";\r\n",e.compilationString+="#ifdef "+this._linearDefineName+"\r\n",e.compilationString+=b.associatedVariableName+" = toGammaSpace("+b.associatedVariableName+");\r\n",e.compilationString+=
"#endif\r\n",e.compilationString+="#ifdef "+this._gammaDefineName+"\r\n",e.compilationString+=b.associatedVariableName+" = toLinearSpace("+b.associatedVariableName+");\r\n",e.compilationString+="#endif\r\n")};r.prototype._buildBlock=function(e){g.prototype._buildBlock.call(this,e);this._tempTextureRead=e._getFreeVariableName("tempTextureRead");0>e.sharedData.blockingBlocks.indexOf(this)&&e.sharedData.blockingBlocks.push(this);0>e.sharedData.textureBlocks.indexOf(this)&&e.sharedData.textureBlocks.push(this);
0>e.sharedData.blocksWithDefines.indexOf(this)&&e.sharedData.blocksWithDefines.push(this);if(e.target!==k.a.Fragment)e._emit2DSampler(this._samplerName),this._injectVertexCode(e);else if(this._outputs.some(function(c){return c.isConnectedInFragmentShader})){e._emit2DSampler(this._samplerName);this._linearDefineName=e._getFreeDefineName("ISLINEAR");this._gammaDefineName=e._getFreeDefineName("ISGAMMA");e._emitFunctionFromInclude("helperFunctions","//"+this.name);this._writeTextureRead(e);for(var b=
0,f=this._outputs;b<f.length;b++){var h=f[b];h.hasEndpoints&&this._writeOutput(e,h,h.name)}return this}};r.prototype.serialize=function(){var e=g.prototype.serialize.call(this);e.convertToGammaSpace=this.convertToGammaSpace;e.convertToLinearSpace=this.convertToLinearSpace;this.texture&&(e.texture=this.texture.serialize());return e};r.prototype._deserialize=function(e,b,n){g.prototype._deserialize.call(this,e,b,n);this.convertToGammaSpace=e.convertToGammaSpace;this.convertToLinearSpace=!!e.convertToLinearSpace;
e.texture&&(n=0===e.texture.url.indexOf("data:")?"":n,this.texture=h.a.Parse(e.texture,b,n))};return r}(v.a);u.a.RegisteredTypes["BABYLON.CurrentScreenBlock"]=m},cYoo:function(v,u,g){g.d(u,"a",function(){return r});var q=g("oYeq");v=g("XA4I");var e=g("lzMP");u=g("WHS4");var k=g("sDlf"),h=g("RLC9");g("mNxE");var m=g("Z+J3"),t=g("aCSs"),r=function(f){function b(b){return f.call(this,b,e.a.VertexAndFragment)||this}Object(q.d)(b,f);b.prototype.getClassName=function(){return"ReflectionTextureBaseBlock"};
b.prototype._getTexture=function(){return this.texture};b.prototype.autoConfigure=function(b){if(!this.position.isConnected){var e=b.getInputBlockByPredicate(function(c){return c.isAttribute&&"position"===c.name});e||(e=new k.a("position"),e.setAsAttribute());e.output.connectTo(this.position)}this.world.isConnected||(e=b.getInputBlockByPredicate(function(c){return c.systemValue===h.a.World}),e||(e=new k.a("world"),e.setAsSystemValue(h.a.World)),e.output.connectTo(this.world));this.view&&!this.view.isConnected&&
(b=b.getInputBlockByPredicate(function(c){return c.systemValue===h.a.View}),b||(b=new k.a("view"),b.setAsSystemValue(h.a.View)),b.output.connectTo(this.view))};b.prototype.prepareDefines=function(b,e,c){c._areTexturesDirty&&(b=this._getTexture())&&b.getTextureMatrix&&(c.setValue(this._define3DName,b.isCube,!0),c.setValue(this._defineLocalCubicName,b.boundingBoxSize?!0:!1,!0),c.setValue(this._defineExplicitName,0===b.coordinatesMode,!0),c.setValue(this._defineSkyboxName,5===b.coordinatesMode,!0),c.setValue(this._defineCubicName,
3===b.coordinatesMode||6===b.coordinatesMode,!0),c.setValue("INVERTCUBICMAP",6===b.coordinatesMode,!0),c.setValue(this._defineSphericalName,1===b.coordinatesMode,!0),c.setValue(this._definePlanarName,2===b.coordinatesMode,!0),c.setValue(this._defineProjectionName,4===b.coordinatesMode,!0),c.setValue(this._defineEquirectangularName,7===b.coordinatesMode,!0),c.setValue(this._defineEquirectangularFixedName,8===b.coordinatesMode,!0),c.setValue(this._defineMirroredEquirectangularFixedName,9===b.coordinatesMode,
!0))};b.prototype.isReady=function(){var b=this._getTexture();return b&&!b.isReadyOrNotBlocking()?!1:!0};b.prototype.bind=function(b,e,c){e=this._getTexture();c&&e&&(b.setMatrix(this._reflectionMatrixName,e.getReflectionTextureMatrix()),e.isCube?b.setTexture(this._cubeSamplerName,e):b.setTexture(this._2DSamplerName,e))};b.prototype.handleVertexSide=function(b){this._define3DName=b._getFreeDefineName("REFLECTIONMAP_3D");this._defineCubicName=b._getFreeDefineName("REFLECTIONMAP_CUBIC");this._defineSphericalName=
b._getFreeDefineName("REFLECTIONMAP_SPHERICAL");this._definePlanarName=b._getFreeDefineName("REFLECTIONMAP_PLANAR");this._defineProjectionName=b._getFreeDefineName("REFLECTIONMAP_PROJECTION");this._defineExplicitName=b._getFreeDefineName("REFLECTIONMAP_EXPLICIT");this._defineEquirectangularName=b._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR");this._defineLocalCubicName=b._getFreeDefineName("USE_LOCAL_REFLECTIONMAP_CUBIC");this._defineMirroredEquirectangularFixedName=b._getFreeDefineName("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");
this._defineEquirectangularFixedName=b._getFreeDefineName("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");this._defineSkyboxName=b._getFreeDefineName("REFLECTIONMAP_SKYBOX");this._defineOppositeZ=b._getFreeDefineName("REFLECTIONMAP_OPPOSITEZ");this._reflectionMatrixName=b._getFreeVariableName("reflectionMatrix");b._emitUniformFromString(this._reflectionMatrixName,"mat4");var e="",c="v_"+this.worldPosition.associatedVariableName;b._emitVaryingFromString(c,"vec4")&&(e+=c+" = "+this.worldPosition.associatedVariableName+
";\r\n");this._positionUVWName=b._getFreeVariableName("positionUVW");this._directionWName=b._getFreeVariableName("directionW");b._emitVaryingFromString(this._positionUVWName,"vec3",this._defineSkyboxName)&&(e+="#ifdef "+this._defineSkyboxName+"\r\n",e+=this._positionUVWName+" = "+this.position.associatedVariableName+".xyz;\r\n",e+="#endif\r\n");b._emitVaryingFromString(this._directionWName,"vec3","defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+
")")&&(e+="#if defined("+this._defineEquirectangularFixedName+") || defined("+this._defineMirroredEquirectangularFixedName+")\r\n",e+=this._directionWName+" = normalize(vec3("+this.world.associatedVariableName+" * vec4("+this.position.associatedVariableName+".xyz, 0.0)));\r\n",e+="#endif\r\n");return e};b.prototype.handleFragmentSideInits=function(b){b.sharedData.blockingBlocks.push(this);b.sharedData.textureBlocks.push(this);this._cubeSamplerName=b._getFreeVariableName(this.name+"CubeSampler");b.samplers.push(this._cubeSamplerName);
this._2DSamplerName=b._getFreeVariableName(this.name+"2DSampler");b.samplers.push(this._2DSamplerName);b._samplerDeclaration+="#ifdef "+this._define3DName+"\r\n";b._samplerDeclaration+="uniform samplerCube "+this._cubeSamplerName+";\r\n";b._samplerDeclaration+="#else\r\n";b._samplerDeclaration+="uniform sampler2D "+this._2DSamplerName+";\r\n";b._samplerDeclaration+="#endif\r\n";b.sharedData.blocksWithDefines.push(this);b.sharedData.bindableBlocks.push(this);var e="//"+this.name;b._emitFunction("ReciprocalPI",
"#define RECIPROCAL_PI2 0.15915494","");b._emitFunctionFromInclude("reflectionFunction",e,{replaceStrings:[{search:/vec3 computeReflectionCoords/g,replace:"void DUMMYFUNC"}]});this._reflectionColorName=b._getFreeVariableName("reflectionColor");this._reflectionVectorName=b._getFreeVariableName("reflectionUVW");this._reflectionCoordsName=b._getFreeVariableName("reflectionCoords")};b.prototype.handleFragmentSideCodeReflectionCoords=function(b,e,c){void 0===c&&(c=!1);e||(e="v_"+this.worldPosition.associatedVariableName);
var a=this._reflectionMatrixName,f="normalize("+this._directionWName+")",g=""+this._positionUVWName,h=""+this.cameraPosition.associatedVariableName,k=""+this.view.associatedVariableName;b+=".xyz";b="\n            #ifdef "+this._defineMirroredEquirectangularFixedName+"\n                vec3 "+this._reflectionVectorName+" = computeMirroredFixedEquirectangularCoords("+e+", "+b+", "+f+");\n            #endif\n\n            #ifdef "+this._defineEquirectangularFixedName+"\n                vec3 "+this._reflectionVectorName+
" = computeFixedEquirectangularCoords("+e+", "+b+", "+f+");\n            #endif\n\n            #ifdef "+this._defineEquirectangularName+"\n                vec3 "+this._reflectionVectorName+" = computeEquirectangularCoords("+e+", "+b+", "+h+".xyz, "+a+");\n            #endif\n\n            #ifdef "+this._defineSphericalName+"\n                vec3 "+this._reflectionVectorName+" = computeSphericalCoords("+e+", "+b+", "+k+", "+a+");\n            #endif\n\n            #ifdef "+this._definePlanarName+
"\n                vec3 "+this._reflectionVectorName+" = computePlanarCoords("+e+", "+b+", "+h+".xyz, "+a+");\n            #endif\n\n            #ifdef "+this._defineCubicName+"\n                #ifdef "+this._defineLocalCubicName+"\n                    vec3 "+this._reflectionVectorName+" = computeCubicLocalCoords("+e+", "+b+", "+h+".xyz, "+a+", vReflectionSize, vReflectionPosition);\n                #else\n                vec3 "+this._reflectionVectorName+" = computeCubicCoords("+e+", "+b+", "+h+
".xyz, "+a+");\n                #endif\n            #endif\n\n            #ifdef "+this._defineProjectionName+"\n                vec3 "+this._reflectionVectorName+" = computeProjectionCoords("+e+", "+k+", "+a+");\n            #endif\n\n            #ifdef "+this._defineSkyboxName+"\n                vec3 "+this._reflectionVectorName+" = computeSkyBoxCoords("+g+", "+a+");\n            #endif\n\n            #ifdef "+this._defineExplicitName+"\n                vec3 "+this._reflectionVectorName+" = vec3(0, 0, 0);\n            #endif\n\n            #ifdef "+
this._defineOppositeZ+"\n                "+this._reflectionVectorName+".z *= -1.0;\n            #endif\r\n";c||(b+="\n                #ifdef "+this._define3DName+"\n                    vec3 "+this._reflectionCoordsName+" = "+this._reflectionVectorName+";\n                #else\n                    vec2 "+this._reflectionCoordsName+" = "+this._reflectionVectorName+".xy;\n                    #ifdef "+this._defineProjectionName+"\n                        "+this._reflectionCoordsName+" /= "+this._reflectionVectorName+
".z;\n                    #endif\n                    "+this._reflectionCoordsName+".y = 1.0 - "+this._reflectionCoordsName+".y;\n                #endif\r\n");return b};b.prototype.handleFragmentSideCodeReflectionColor=function(b,e){void 0===e&&(e=".rgb");var c="vec"+(0===e.length?"4":e.length-1)+" "+this._reflectionColorName+";\n            #ifdef "+this._define3DName+"\r\n";c=b?c+(this._reflectionColorName+" = textureCubeLodEXT("+this._cubeSamplerName+", "+this._reflectionVectorName+", "+b+")"+
e+";\r\n"):c+(this._reflectionColorName+" = textureCube("+this._cubeSamplerName+", "+this._reflectionVectorName+")"+e+";\r\n");c+="\n            #else\r\n";c=b?c+(this._reflectionColorName+" = texture2DLodEXT("+this._2DSamplerName+", "+this._reflectionCoordsName+", "+b+")"+e+";\r\n"):c+(this._reflectionColorName+" = texture2D("+this._2DSamplerName+", "+this._reflectionCoordsName+")"+e+";\r\n");return c+"#endif\r\n"};b.prototype.writeOutputs=function(b,f){var c="";if(b.target===e.a.Fragment)for(var a=
0,g=this._outputs;a<g.length;a++){var h=g[a];h.hasEndpoints&&(c+=this._declareOutput(h,b)+" = "+f+"."+h.name+";\r\n")}return c};b.prototype._buildBlock=function(b){f.prototype._buildBlock.call(this,b);return this};b.prototype._dumpPropertiesCode=function(){if(!this.texture)return"";var b=this.texture.isCube?this._codeVariableName+'.texture = new BABYLON.CubeTexture("'+this.texture.name+'");\r\n':this._codeVariableName+'.texture = new BABYLON.Texture("'+this.texture.name+'");\r\n';return b+=this._codeVariableName+
".texture.coordinatesMode = "+this.texture.coordinatesMode+";\r\n"};b.prototype.serialize=function(){var b=f.prototype.serialize.call(this);this.texture&&(b.texture=this.texture.serialize());return b};b.prototype._deserialize=function(b,e,c){f.prototype._deserialize.call(this,b,e,c);b.texture&&(c=0===b.texture.url.indexOf("data:")?"":c,this.texture=b.texture.isCube?m.a.Parse(b.texture,e,c):t.a.Parse(b.texture,e,c))};return b}(v.a);u.a.RegisteredTypes["BABYLON.ReflectionTextureBaseBlock"]=r},dNku:function(v,
u,g){g.d(u,"a",function(){return h});var q=g("oYeq");v=g("XA4I");var e=g("f9H2"),k=g("lzMP");g=g("WHS4");var h=function(g){function h(h){h=g.call(this,h,k.a.Fragment)||this;h._isUnique=!0;h.registerInput("color",e.a.Color4,!1,k.a.Fragment);h.registerOutput("rampColor",e.a.Color4,k.a.Fragment);return h}Object(q.d)(h,g);h.prototype.getClassName=function(){return"ParticleRampGradientBlock"};Object.defineProperty(h.prototype,"color",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});
Object.defineProperty(h.prototype,"rampColor",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});h.prototype.initialize=function(e){e._excludeVariableName("remapRanges");e._excludeVariableName("rampSampler");e._excludeVariableName("baseColor");e._excludeVariableName("alpha");e._excludeVariableName("remappedColorIndex");e._excludeVariableName("rampColor");e._excludeVariableName("finalAlpha")};h.prototype._buildBlock=function(e){g.prototype._buildBlock.call(this,e);if(e.target!==
k.a.Vertex)return e._emit2DSampler("rampSampler"),e._emitVaryingFromString("remapRanges","vec4","RAMPGRADIENT"),e.compilationString+="\n            #ifdef RAMPGRADIENT\n                vec4 baseColor = "+this.color.associatedVariableName+";\n                float alpha = "+this.color.associatedVariableName+".a;\n\n                float remappedColorIndex = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);\n\n                vec4 rampColor = texture2D(rampSampler, vec2(1.0 - remappedColorIndex, 0.));\n                baseColor.rgb *= rampColor.rgb;\n\n                // Remapped alpha\n                float finalAlpha = baseColor.a;\n                baseColor.a = clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0);\n\n                "+
this._declareOutput(this.rampColor,e)+" = baseColor;\n            #else\n                "+this._declareOutput(this.rampColor,e)+" = "+this.color.associatedVariableName+";\n            #endif\n        ",this};return h}(v.a);g.a.RegisteredTypes["BABYLON.ParticleRampGradientBlock"]=h},"n/qM":function(v,u,g){var q=g("oYeq");u=g("XA4I");var e=g("f9H2"),k=g("RLC9"),h=g("lzMP"),m=g("/eyM"),t=g("sDlf");v=g("WHS4");g("J/yG");var r=function(b){function c(a){a=b.call(this,a,h.a.VertexAndFragment,!0)||this;
a.registerInput("worldPosition",e.a.Vector4,!1,h.a.Vertex);a.registerInput("view",e.a.Matrix,!1,h.a.Vertex);a.registerInput("input",e.a.Color3,!1,h.a.Fragment);a.registerInput("fogColor",e.a.Color3,!1,h.a.Fragment);a.registerOutput("output",e.a.Color3,h.a.Fragment);a.input.acceptedConnectionPointTypes.push(e.a.Color4);a.fogColor.acceptedConnectionPointTypes.push(e.a.Color4);return a}Object(q.d)(c,b);c.prototype.getClassName=function(){return"FogBlock"};Object.defineProperty(c.prototype,"worldPosition",
{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"view",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"input",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"fogColor",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,
configurable:!0});c.prototype.autoConfigure=function(a){if(!this.view.isConnected){var b=a.getInputBlockByPredicate(function(a){return a.systemValue===k.a.View});b||(b=new t.a("view"),b.setAsSystemValue(k.a.View));b.output.connectTo(this.view)}this.fogColor.isConnected||(a=a.getInputBlockByPredicate(function(a){return a.systemValue===k.a.FogColor}),a||(a=new t.a("fogColor",void 0,e.a.Color3),a.setAsSystemValue(k.a.FogColor)),a.output.connectTo(this.fogColor))};c.prototype.prepareDefines=function(a,
b,c){var e=a.getScene();c.setValue("FOG",b.fogEnabled&&m.a.GetFogState(a,e))};c.prototype.bind=function(a,b,c){c&&(b=c.getScene(),a.setFloat4(this._fogParameters,b.fogMode,b.fogStart,b.fogEnd,b.fogDensity))};c.prototype._buildBlock=function(a){b.prototype._buildBlock.call(this,a);if(a.target===h.a.Fragment){a.sharedData.blocksWithDefines.push(this);a.sharedData.bindableBlocks.push(this);a._emitFunctionFromInclude("fogFragmentDeclaration","//"+this.name,{removeUniforms:!0,removeVaryings:!0,removeIfDef:!1,
replaceStrings:[{search:/float CalcFogFactor\(\)/,replace:"float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)"}]});var c=a._getFreeVariableName("fog"),e=this.input,f=this.fogColor;this._fogParameters=a._getFreeVariableName("fogParameters");var g=this._outputs[0];a._emitUniformFromString(this._fogParameters,"vec4");a.compilationString+="#ifdef FOG\r\n";a.compilationString+="float "+c+" = CalcFogFactor("+this._fogDistanceName+", "+this._fogParameters+");\r\n";a.compilationString+=this._declareOutput(g,
a)+(" = "+c+" * "+e.associatedVariableName+".rgb + (1.0 - "+c+") * "+f.associatedVariableName+".rgb;\r\n");a.compilationString+="#else\r\n"+this._declareOutput(g,a)+" =  "+e.associatedVariableName+".rgb;\r\n";a.compilationString+="#endif\r\n"}else c=this.worldPosition,e=this.view,this._fogDistanceName=a._getFreeVariableName("vFogDistance"),a._emitVaryingFromString(this._fogDistanceName,"vec3"),a.compilationString+=this._fogDistanceName+" = ("+e.associatedVariableName+" * "+c.associatedVariableName+
").xyz;\r\n";return this};return c}(u.a);v.a.RegisteredTypes["BABYLON.FogBlock"]=r;g("DgfZ");g("96d9");g("mKn1");g("BKDp");g("+eXD");g("bP33");g("jQhv");r=function(b){function c(a){a=b.call(this,a,h.a.VertexAndFragment)||this;a._isUnique=!0;a.registerInput("worldPosition",e.a.Vector4,!1,h.a.Vertex);a.registerInput("worldNormal",e.a.Vector4,!1,h.a.Fragment);a.registerInput("cameraPosition",e.a.Vector3,!1,h.a.Fragment);a.registerInput("glossiness",e.a.Float,!0,h.a.Fragment);a.registerInput("glossPower",
e.a.Float,!0,h.a.Fragment);a.registerInput("diffuseColor",e.a.Color3,!0,h.a.Fragment);a.registerInput("specularColor",e.a.Color3,!0,h.a.Fragment);a.registerInput("view",e.a.Matrix,!0);a.registerOutput("diffuseOutput",e.a.Color3,h.a.Fragment);a.registerOutput("specularOutput",e.a.Color3,h.a.Fragment);a.registerOutput("shadow",e.a.Float,h.a.Fragment);return a}Object(q.d)(c,b);c.prototype.getClassName=function(){return"LightBlock"};Object.defineProperty(c.prototype,"worldPosition",{get:function(){return this._inputs[0]},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"worldNormal",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"cameraPosition",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"glossiness",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"glossPower",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"diffuseColor",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"specularColor",{get:function(){return this._inputs[6]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"view",{get:function(){return this._inputs[7]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"diffuseOutput",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"specularOutput",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"shadow",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0});c.prototype.autoConfigure=function(a){this.cameraPosition.isConnected||(a=a.getInputBlockByPredicate(function(a){return a.systemValue===k.a.CameraPosition}),a||(a=new t.a("cameraPosition"),a.setAsSystemValue(k.a.CameraPosition)),a.output.connectTo(this.cameraPosition))};c.prototype.prepareDefines=
function(a,b,c){if(c._areLightsDirty){var e=a.getScene();this.light?(b={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1},m.a.PrepareDefinesForLight(e,a,this.light,this._lightId,c,!0,b),b.needRebuild&&c.rebuild()):m.a.PrepareDefinesForLights(e,a,c,!0,b.maxSimultaneousLights)}};c.prototype.updateUniformsAndSamples=function(a,b,c,e){for(var f=0;f<b.maxSimultaneousLights&&c["LIGHT"+f];f++){var g=0<=a.uniforms.indexOf("vLightData"+f);m.a.PrepareUniformsAndSamplersForLight(f,
a.uniforms,a.samplers,c["PROJECTEDLIGHTTEXTURE"+f],e,g)}};c.prototype.bind=function(a,b,c){if(c){var e=c.getScene();this.light?m.a.BindLight(this.light,this._lightId,e,a,!0):m.a.BindLights(e,c,a,!0,b.maxSimultaneousLights)}};c.prototype._injectVertexCode=function(a){var b=this.worldPosition,c="//"+this.name;this.light?(this._lightId=(void 0!==a.counters.lightCounter?a.counters.lightCounter:-1)+1,a.counters.lightCounter=this._lightId,a._emitFunctionFromInclude(a.supportUniformBuffers?"lightUboDeclaration":
"lightFragmentDeclaration",c,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString())):(a._emitFunctionFromInclude(a.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",c,{repeatKey:"maxSimultaneousLights"}),this._lightId=0,a.sharedData.dynamicUniformBlocks.push(this));var e="v_"+b.associatedVariableName;a._emitVaryingFromString(e,"vec4")&&(a.compilationString+=e+" = "+b.associatedVariableName+";\r\n");this.light?a.compilationString+=a._emitCodeFromInclude("shadowsVertex",
c,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()},{search:/worldPos/g,replace:b.associatedVariableName}]}):(a.compilationString+="vec4 worldPos = "+b.associatedVariableName+";\r\n",this.view.isConnected&&(a.compilationString+="mat4 view = "+this.view.associatedVariableName+";\r\n"),a.compilationString+=a._emitCodeFromInclude("shadowsVertex",c,{repeatKey:"maxSimultaneousLights"}))};c.prototype._buildBlock=function(a){b.prototype._buildBlock.call(this,a);if(a.target!==h.a.Fragment)this._injectVertexCode(a);
else{a.sharedData.bindableBlocks.push(this);a.sharedData.blocksWithDefines.push(this);var c="//"+this.name,e=this.worldPosition;a._emitFunctionFromInclude("helperFunctions",c);a._emitFunctionFromInclude("lightsFragmentFunctions",c,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+e.associatedVariableName+".xyz"}]});a._emitFunctionFromInclude("shadowsFragmentFunctions",c,{replaceStrings:[{search:/vPositionW/g,replace:"v_"+e.associatedVariableName+".xyz"}]});this.light?a._emitFunctionFromInclude(a.supportUniformBuffers?
"lightUboDeclaration":"lightFragmentDeclaration",c,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]},this._lightId.toString()):a._emitFunctionFromInclude(a.supportUniformBuffers?"lightUboDeclaration":"lightFragmentDeclaration",c,{repeatKey:"maxSimultaneousLights"});0===this._lightId&&(a._registerTempVariable("viewDirectionW")&&(a.compilationString+="vec3 viewDirectionW = normalize("+this.cameraPosition.associatedVariableName+" - v_"+e.associatedVariableName+".xyz);\r\n"),a.compilationString+=
"lightingInfo info;\r\n",a.compilationString+="float shadow = 1.;\r\n",a.compilationString+="float glossiness = "+(this.glossiness.isConnected?this.glossiness.associatedVariableName:"1.0")+" * "+(this.glossPower.isConnected?this.glossPower.associatedVariableName:"1024.0")+";\r\n",a.compilationString+="vec3 diffuseBase = vec3(0., 0., 0.);\r\n",a.compilationString+="vec3 specularBase = vec3(0., 0., 0.);\r\n",a.compilationString+="vec3 normalW = "+this.worldNormal.associatedVariableName+".xyz;\r\n");
a.compilationString=this.light?a.compilationString+a._emitCodeFromInclude("lightFragment",c,{replaceStrings:[{search:/{X}/g,replace:this._lightId.toString()}]}):a.compilationString+a._emitCodeFromInclude("lightFragment",c,{repeatKey:"maxSimultaneousLights"});c=this.specularOutput;a.compilationString+=this._declareOutput(this.diffuseOutput,a)+(" = diffuseBase"+(this.diffuseColor.isConnected?" * "+this.diffuseColor.associatedVariableName:"")+";\r\n");c.hasEndpoints&&(a.compilationString+=this._declareOutput(c,
a)+(" = specularBase"+(this.specularColor.isConnected?" * "+this.specularColor.associatedVariableName:"")+";\r\n"));this.shadow.hasEndpoints&&(a.compilationString+=this._declareOutput(this.shadow,a)+" = shadow;\r\n");return this}};c.prototype.serialize=function(){var a=b.prototype.serialize.call(this);this.light&&(a.lightId=this.light.id);return a};c.prototype._deserialize=function(a,c,e){b.prototype._deserialize.call(this,a,c,e);a.lightId&&(this.light=c.getLightByID(a.lightId))};return c}(u.a);v.a.RegisteredTypes["BABYLON.LightBlock"]=
r;var f=g("MNkK"),b=g("aCSs"),n=g("Jf/A");u=function(g){function c(a,b){void 0===b&&(b=!1);a=g.call(this,a,b?h.a.Fragment:h.a.VertexAndFragment)||this;a.convertToGammaSpace=!1;a.convertToLinearSpace=!1;a._fragmentOnly=b;a.registerInput("uv",e.a.Vector2,!1,h.a.VertexAndFragment);a.registerOutput("rgba",e.a.Color4,h.a.Neutral);a.registerOutput("rgb",e.a.Color3,h.a.Neutral);a.registerOutput("r",e.a.Float,h.a.Neutral);a.registerOutput("g",e.a.Float,h.a.Neutral);a.registerOutput("b",e.a.Float,h.a.Neutral);
a.registerOutput("a",e.a.Float,h.a.Neutral);a._inputs[0].acceptedConnectionPointTypes.push(e.a.Vector3);a._inputs[0].acceptedConnectionPointTypes.push(e.a.Vector4);a._inputs[0]._prioritizeVertex=!b;return a}Object(q.d)(c,g);c.prototype.getClassName=function(){return"TextureBlock"};Object.defineProperty(c.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"a",{get:function(){return this._outputs[5]},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"target",{get:function(){if(this._fragmentOnly)return h.a.Fragment;if(!this.uv.isConnected||this.uv.sourceBlock.isInput)return h.a.VertexAndFragment;for(var a=this.uv.connectedPoint;a;){if(a.target===h.a.Fragment)return h.a.Fragment;if(a.target===h.a.Vertex)break;if(a.target===h.a.Neutral||a.target===h.a.VertexAndFragment){var b=a.ownerBlock;a=null;var c=0;for(b=b.inputs;c<b.length;c++){var e=b[c];if(e.connectedPoint){a=e.connectedPoint;
break}}}}return h.a.VertexAndFragment},enumerable:!1,configurable:!0});c.prototype.autoConfigure=function(a){if(!this.uv.isConnected)if(a.mode===n.a.PostProcess)(a=a.getBlockByPredicate(function(a){return"uv"===a.name}))&&a.connectTo(this);else{var b=a.mode===n.a.Particle?"particle_uv":"uv";a=a.getInputBlockByPredicate(function(a){return a.isAttribute&&a.name===b});a||(a=new t.a("uv"),a.setAsAttribute(b));a.output.connectTo(this.uv)}};c.prototype.initializeDefines=function(a,b,c,e){c._areTexturesDirty&&
c.setValue(this._mainUVDefineName,!1)};c.prototype.prepareDefines=function(a,b,c){c._areTexturesDirty&&(this.texture&&this.texture.getTextureMatrix?(c.setValue(this._linearDefineName,this.convertToGammaSpace),c.setValue(this._gammaDefineName,this.convertToLinearSpace),this._isMixed&&(this.texture.getTextureMatrix().isIdentityAs3x2()?(c.setValue(this._defineName,!1),c.setValue(this._mainUVDefineName,!0)):c.setValue(this._defineName,!0))):(c.setValue(this._defineName,!1),c.setValue(this._mainUVDefineName,
!0)))};c.prototype.isReady=function(){return this.texture&&!this.texture.isReadyOrNotBlocking()?!1:!0};c.prototype.bind=function(a,b,c){this.texture&&(this._isMixed&&(a.setFloat(this._textureInfoName,this.texture.level),a.setMatrix(this._textureTransformName,this.texture.getTextureMatrix())),a.setTexture(this._samplerName,this.texture))};Object.defineProperty(c.prototype,"_isMixed",{get:function(){return this.target!==h.a.Fragment},enumerable:!1,configurable:!0});c.prototype._injectVertexCode=function(a){var b=
this.uv;this._defineName=a._getFreeDefineName("UVTRANSFORM");this._mainUVDefineName="VMAIN"+b.associatedVariableName.toUpperCase();b.connectedPoint.ownerBlock.isInput&&(b.connectedPoint.ownerBlock.isAttribute||a._emitUniformFromString(b.associatedVariableName,"vec2"));this._mainUVName="vMain"+b.associatedVariableName;this._transformedUVName=a._getFreeVariableName("transformedUV");this._textureTransformName=a._getFreeVariableName("textureTransform");this._textureInfoName=a._getFreeVariableName("textureInfoName");
a._emitVaryingFromString(this._transformedUVName,"vec2",this._defineName);a._emitVaryingFromString(this._mainUVName,"vec2",this._mainUVDefineName);a._emitUniformFromString(this._textureTransformName,"mat4",this._defineName);a.compilationString+="#ifdef "+this._defineName+"\r\n";a.compilationString+=this._transformedUVName+" = vec2("+this._textureTransformName+" * vec4("+b.associatedVariableName+".xy, 1.0, 0.0));\r\n";a.compilationString+="#elif defined("+this._mainUVDefineName+")\r\n";a.compilationString+=
this._mainUVName+" = "+b.associatedVariableName+".xy;\r\n";a.compilationString+="#endif\r\n";if(this._outputs.some(function(a){return a.isConnectedInVertexShader})){this._writeTextureRead(a,!0);b=0;for(var c=this._outputs;b<c.length;b++){var e=c[b];e.hasEndpoints&&this._writeOutput(a,e,e.name,!0)}}};c.prototype._writeTextureRead=function(a,b){void 0===b&&(b=!1);var c=this.uv;b?a.target!==h.a.Fragment&&(a.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+c.associatedVariableName+
");\r\n"):this.uv.ownerBlock.target===h.a.Fragment?a.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+c.associatedVariableName+");\r\n":(a.compilationString+="#ifdef "+this._defineName+"\r\n",a.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+", "+this._transformedUVName+");\r\n",a.compilationString+="#elif defined("+this._mainUVDefineName+")\r\n",a.compilationString+="vec4 "+this._tempTextureRead+" = texture2D("+this._samplerName+
", "+this._mainUVName+");\r\n",a.compilationString+="#endif\r\n")};c.prototype._writeOutput=function(a,b,c,e){void 0===e&&(e=!1);e?a.target!==h.a.Fragment&&(a.compilationString+=this._declareOutput(b,a)+" = "+this._tempTextureRead+"."+c+";\r\n"):this.uv.ownerBlock.target===h.a.Fragment?a.compilationString+=this._declareOutput(b,a)+" = "+this._tempTextureRead+"."+c+";\r\n":(e=" * "+this._textureInfoName,a.compilationString+=this._declareOutput(b,a)+" = "+this._tempTextureRead+"."+c+e+";\r\n","a"!==
c&&(a.compilationString+="#ifdef "+this._linearDefineName+"\r\n",a.compilationString+=b.associatedVariableName+" = toGammaSpace("+b.associatedVariableName+");\r\n",a.compilationString+="#endif\r\n",a.compilationString+="#ifdef "+this._gammaDefineName+"\r\n",a.compilationString+=b.associatedVariableName+" = toLinearSpace("+b.associatedVariableName+");\r\n",a.compilationString+="#endif\r\n"))};c.prototype._buildBlock=function(a){g.prototype._buildBlock.call(this,a);if(a.target===h.a.Vertex||this._fragmentOnly)this._tempTextureRead=
a._getFreeVariableName("tempTextureRead");if(!this._isMixed&&a.target===h.a.Fragment||this._isMixed&&a.target===h.a.Vertex)this._samplerName=a._getFreeVariableName(this.name+"Sampler"),a._emit2DSampler(this._samplerName),a.sharedData.blockingBlocks.push(this),a.sharedData.textureBlocks.push(this),a.sharedData.blocksWithDefines.push(this),a.sharedData.bindableBlocks.push(this);if(a.target!==h.a.Fragment)this._injectVertexCode(a);else if(this._outputs.some(function(a){return a.isConnectedInFragmentShader})){this._isMixed&&
a._emit2DSampler(this._samplerName);this._linearDefineName=a._getFreeDefineName("ISLINEAR");this._gammaDefineName=a._getFreeDefineName("ISGAMMA");a._emitFunctionFromInclude("helperFunctions","//"+this.name);this._isMixed&&a._emitUniformFromString(this._textureInfoName,"float");this._writeTextureRead(a);for(var b=0,c=this._outputs;b<c.length;b++){var e=c[b];e.hasEndpoints&&this._writeOutput(a,e,e.name)}return this}};c.prototype._dumpPropertiesCode=function(){if(!this.texture)return"";var a=this._codeVariableName+
'.texture = new BABYLON.Texture("'+this.texture.name+'", null);\r\n';a+=this._codeVariableName+".texture.wrapU = "+this.texture.wrapU+";\r\n";a+=this._codeVariableName+".texture.wrapV = "+this.texture.wrapV+";\r\n";a+=this._codeVariableName+".texture.uAng = "+this.texture.uAng+";\r\n";a+=this._codeVariableName+".texture.vAng = "+this.texture.vAng+";\r\n";a+=this._codeVariableName+".texture.wAng = "+this.texture.wAng+";\r\n";a+=this._codeVariableName+".texture.uOffset = "+this.texture.uOffset+";\r\n";
a+=this._codeVariableName+".texture.vOffset = "+this.texture.vOffset+";\r\n";a+=this._codeVariableName+".texture.uScale = "+this.texture.uScale+";\r\n";a+=this._codeVariableName+".texture.vScale = "+this.texture.vScale+";\r\n";a+=this._codeVariableName+".convertToGammaSpace = "+this.convertToGammaSpace+";\r\n";return a+=this._codeVariableName+".convertToLinearSpace = "+this.convertToLinearSpace+";\r\n"};c.prototype.serialize=function(){var a=g.prototype.serialize.call(this);a.convertToGammaSpace=
this.convertToGammaSpace;a.convertToLinearSpace=this.convertToLinearSpace;a.fragmentOnly=this._fragmentOnly;this.texture&&!this.texture.isRenderTarget&&(a.texture=this.texture.serialize());return a};c.prototype._deserialize=function(a,c,e){g.prototype._deserialize.call(this,a,c,e);this.convertToGammaSpace=a.convertToGammaSpace;this.convertToLinearSpace=!!a.convertToLinearSpace;this._fragmentOnly=!!a.fragmentOnly;a.texture&&!f.a.IgnoreTexturesAtLoadTime&&(e=0===a.texture.url.indexOf("data:")?"":e,
this.texture=b.a.Parse(a.texture,c,e))};return c}(u.a);v.a.RegisteredTypes["BABYLON.TextureBlock"]=u;u=function(b){function c(a){a=b.call(this,a)||this;a.registerInput("position",e.a.Vector3,!1,h.a.Vertex);a.registerInput("worldPosition",e.a.Vector4,!1,h.a.Vertex);a.registerInput("worldNormal",e.a.Vector4,!1,h.a.Fragment);a.registerInput("world",e.a.Matrix,!1,h.a.Vertex);a.registerInput("cameraPosition",e.a.Vector3,!1,h.a.Fragment);a.registerInput("view",e.a.Matrix,!1,h.a.Fragment);a.registerOutput("rgb",
e.a.Color3,h.a.Fragment);a.registerOutput("rgba",e.a.Color4,h.a.Fragment);a.registerOutput("r",e.a.Float,h.a.Fragment);a.registerOutput("g",e.a.Float,h.a.Fragment);a.registerOutput("b",e.a.Float,h.a.Fragment);a.registerOutput("a",e.a.Float,h.a.Fragment);a._inputs[0].acceptedConnectionPointTypes.push(e.a.Vector4);return a}Object(q.d)(c,b);c.prototype.getClassName=function(){return"ReflectionTextureBlock"};Object.defineProperty(c.prototype,"position",{get:function(){return this._inputs[0]},enumerable:!1,
configurable:!0});Object.defineProperty(c.prototype,"worldPosition",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"worldNormal",{get:function(){return this._inputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"world",{get:function(){return this._inputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"cameraPosition",{get:function(){return this._inputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"view",{get:function(){return this._inputs[5]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"rgb",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"rgba",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,
configurable:!0});Object.defineProperty(c.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0});c.prototype.autoConfigure=function(a){b.prototype.autoConfigure.call(this,a);this.cameraPosition.isConnected||(a=a.getInputBlockByPredicate(function(a){return a.systemValue===k.a.CameraPosition}),a||(a=new t.a("cameraPosition"),a.setAsSystemValue(k.a.CameraPosition)),
a.output.connectTo(this.cameraPosition))};c.prototype._buildBlock=function(a){b.prototype._buildBlock.call(this,a);if(!this.texture)return a.compilationString+=this.writeOutputs(a,"vec3(0.)"),this;if(a.target!==h.a.Fragment)return a.compilationString+=this.handleVertexSide(a),this;this.handleFragmentSideInits(a);var c=a._getFreeVariableName("normalWUnit");a.compilationString+="vec4 "+c+" = normalize("+this.worldNormal.associatedVariableName+");\r\n";a.compilationString+=this.handleFragmentSideCodeReflectionCoords(c);
a.compilationString+=this.handleFragmentSideCodeReflectionColor(void 0,"");a.compilationString+=this.writeOutputs(a,this._reflectionColorName);return this};return c}(g("cYoo").a);v.a.RegisteredTypes["BABYLON.ReflectionTextureBlock"]=u;g("aZIP")},sDlf:function(v,u,g){g.d(u,"a",function(){return l});var q=g("oYeq");v=g("XA4I");var e=g("f9H2"),k=g("lSHt"),h=g("RLC9"),m=g("/SR9"),t=g("lzMP"),r=g("WHS4"),f=g("GR64"),b=g("840t"),n=g("ps+7"),x=g("/eyM"),c={position2d:"position",particle_uv:"vUV",particle_color:"vColor",
particle_texturemask:"textureMask",particle_positionw:"vPositionW"},a={particle_uv:!0,particle_color:!0,particle_texturemask:!0,particle_positionw:!0},w={particle_texturemask:!0},l=function(g){function l(a,c,f){void 0===c&&(c=t.a.Vertex);void 0===f&&(f=e.a.AutoDetect);a=g.call(this,a,c,!1,!0)||this;a._mode=k.a.Undefined;a._animationType=b.a.None;a.min=0;a.max=0;a.isBoolean=!1;a.matrixMode=0;a._systemValue=null;a.isConstant=!1;a.groupInInspector="";a.onValueChangedObservable=new n.a;a.convertToGammaSpace=
!1;a.convertToLinearSpace=!1;a._type=f;a.setDefaultValue();a.registerOutput("output",f);return a}Object(q.d)(l,g);Object.defineProperty(l.prototype,"type",{get:function(){if(this._type===e.a.AutoDetect){if(this.isUniform&&null!=this.value){if(!isNaN(this.value))return this._type=e.a.Float;switch(this.value.getClassName()){case "Vector2":return this._type=e.a.Vector2;case "Vector3":return this._type=e.a.Vector3;case "Vector4":return this._type=e.a.Vector4;case "Color3":return this._type=e.a.Color3;
case "Color4":return this._type=e.a.Color4;case "Matrix":return this._type=e.a.Matrix}}if(this.isAttribute)switch(this.name){case "position":case "normal":case "tangent":case "particle_positionw":return this._type=e.a.Vector3;case "uv":case "uv2":case "position2d":case "particle_uv":return this._type=e.a.Vector2;case "matricesIndices":case "matricesWeights":case "world0":case "world1":case "world2":case "world3":return this._type=e.a.Vector4;case "color":case "particle_color":case "particle_texturemask":return this._type=
e.a.Color4}if(this.isSystemValue)switch(this._systemValue){case h.a.World:case h.a.WorldView:case h.a.WorldViewProjection:case h.a.View:case h.a.ViewProjection:case h.a.Projection:this._type=e.a.Matrix;break;case h.a.CameraPosition:this._type=e.a.Vector3;break;case h.a.FogColor:this._type=e.a.Color3;break;case h.a.DeltaTime:this._type=e.a.Float}}return this._type},enumerable:!1,configurable:!0});l.prototype.validateBlockName=function(a){return this.isAttribute?!0:g.prototype.validateBlockName.call(this,
a)};Object.defineProperty(l.prototype,"output",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});l.prototype.setAsAttribute=function(a){this._mode=k.a.Attribute;a&&(this.name=a);return this};l.prototype.setAsSystemValue=function(a){this.systemValue=a;return this};Object.defineProperty(l.prototype,"value",{get:function(){return this._storedValue},set:function(a){this.type===e.a.Float&&(this.isBoolean?a=a?1:0:this.min!==this.max&&(a=Math.max(this.min,a),a=Math.min(this.max,a)));
this._storedValue=a;this._mode=k.a.Uniform;this.onValueChangedObservable.notifyObservers(this)},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"valueCallback",{get:function(){return this._valueCallback},set:function(a){this._valueCallback=a;this._mode=k.a.Uniform},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"associatedVariableName",{get:function(){return this._associatedVariableName},set:function(a){this._associatedVariableName=a},enumerable:!1,configurable:!0});
Object.defineProperty(l.prototype,"animationType",{get:function(){return this._animationType},set:function(a){this._animationType=a},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"isUndefined",{get:function(){return this._mode===k.a.Undefined},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"isUniform",{get:function(){return this._mode===k.a.Uniform},set:function(a){this._mode=a?k.a.Uniform:k.a.Undefined;this.associatedVariableName=""},enumerable:!1,configurable:!0});
Object.defineProperty(l.prototype,"isAttribute",{get:function(){return this._mode===k.a.Attribute},set:function(a){this._mode=a?k.a.Attribute:k.a.Undefined;this.associatedVariableName=""},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"isVarying",{get:function(){return this._mode===k.a.Varying},set:function(a){this._mode=a?k.a.Varying:k.a.Undefined;this.associatedVariableName=""},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"isSystemValue",{get:function(){return null!=
this._systemValue},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"systemValue",{get:function(){return this._systemValue},set:function(a){this._mode=k.a.Uniform;this.associatedVariableName="";this._systemValue=a},enumerable:!1,configurable:!0});l.prototype.getClassName=function(){return"InputBlock"};l.prototype.animate=function(a){switch(this._animationType){case b.a.Time:this.type===e.a.Float&&(this.value+=.01*a.getAnimationRatio())}};l.prototype._emitDefine=function(a){return"!"===
a[0]?"#ifndef "+a.substring(1)+"\r\n":"#ifdef "+a+"\r\n"};l.prototype.initialize=function(a){this.associatedVariableName=""};l.prototype.setDefaultValue=function(){switch(this.type){case e.a.Float:this.value=0;break;case e.a.Vector2:this.value=m.d.Zero();break;case e.a.Vector3:this.value=m.e.Zero();break;case e.a.Vector4:this.value=m.f.Zero();break;case e.a.Color3:this.value=f.b.White();break;case e.a.Color4:this.value=new f.c(1,1,1,1);break;case e.a.Matrix:this.value=m.a.Identity()}};l.prototype._emitConstant=
function(a){switch(this.type){case e.a.Float:return""+a._emitFloat(this.value);case e.a.Vector2:return"vec2("+this.value.x+", "+this.value.y+")";case e.a.Vector3:return"vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")";case e.a.Vector4:return"vec4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";case e.a.Color3:return f.g.Color3[0].set(this.value.r,this.value.g,this.value.b),this.convertToGammaSpace&&f.g.Color3[0].toGammaSpaceToRef(f.g.Color3[0]),this.convertToLinearSpace&&
f.g.Color3[0].toLinearSpaceToRef(f.g.Color3[0]),"vec3("+f.g.Color3[0].r+", "+f.g.Color3[0].g+", "+f.g.Color3[0].b+")";case e.a.Color4:return f.g.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a),this.convertToGammaSpace&&f.g.Color4[0].toGammaSpaceToRef(f.g.Color4[0]),this.convertToLinearSpace&&f.g.Color4[0].toLinearSpaceToRef(f.g.Color4[0]),"vec4("+f.g.Color4[0].r+", "+f.g.Color4[0].g+", "+f.g.Color4[0].b+", "+f.g.Color4[0].a+")"}return""};Object.defineProperty(l.prototype,"_noContextSwitch",
{get:function(){return a[this.name]},enumerable:!1,configurable:!0});l.prototype._emit=function(e,f){var g;if(this.isUniform)if(this.associatedVariableName||(this.associatedVariableName=e._getFreeVariableName("u_"+this.name)),this.isConstant)-1===e.constants.indexOf(this.associatedVariableName)&&(e.constants.push(this.associatedVariableName),e._constantDeclaration+=this._declareOutput(this.output,e)+(" = "+this._emitConstant(e)+";\r\n"));else{if(-1===e.uniforms.indexOf(this.associatedVariableName))if(e.uniforms.push(this.associatedVariableName),
f&&(e._uniformDeclaration+=this._emitDefine(f)),e._uniformDeclaration+="uniform "+e._getGLType(this.type)+" "+this.associatedVariableName+";\r\n",f&&(e._uniformDeclaration+="#endif\r\n"),f=e.sharedData.hints,null!==this._systemValue&&void 0!==this._systemValue)switch(this._systemValue){case h.a.WorldView:f.needWorldViewMatrix=!0;break;case h.a.WorldViewProjection:f.needWorldViewProjectionMatrix=!0}else this._animationType!==b.a.None&&e.sharedData.animatedInputs.push(this)}else this.isAttribute&&(this.associatedVariableName=
null!==(g=c[this.name])&&void 0!==g?g:this.name,this.target===t.a.Vertex&&e._vertexState?a[this.name]?w[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),f):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),f):this._emit(e._vertexState,f):-1===e.attributes.indexOf(this.associatedVariableName)&&(e.attributes.push(this.associatedVariableName),a[this.name]?w[this.name]?e._emitUniformFromString(this.associatedVariableName,e._getGLType(this.type),
f):e._emitVaryingFromString(this.associatedVariableName,e._getGLType(this.type),f):(f&&(e._attributeDeclaration+=this._emitDefine(f)),e._attributeDeclaration+="attribute "+e._getGLType(this.type)+" "+this.associatedVariableName+";\r\n",f&&(e._attributeDeclaration+="#endif\r\n"))))};l.prototype._transmitWorld=function(a,b,c,e){if(this._systemValue){var f=this.associatedVariableName;switch(this._systemValue){case h.a.World:a.setMatrix(f,b);break;case h.a.WorldView:a.setMatrix(f,c);break;case h.a.WorldViewProjection:a.setMatrix(f,
e)}}};l.prototype._transmit=function(a,b){if(!this.isAttribute){var c=this.associatedVariableName;if(this._systemValue)switch(this._systemValue){case h.a.View:a.setMatrix(c,b.getViewMatrix());break;case h.a.Projection:a.setMatrix(c,b.getProjectionMatrix());break;case h.a.ViewProjection:a.setMatrix(c,b.getTransformMatrix());break;case h.a.CameraPosition:x.a.BindEyePosition(a,b,c);break;case h.a.FogColor:a.setColor3(c,b.fogColor);break;case h.a.DeltaTime:a.setFloat(c,b.deltaTime/1E3)}else if(b=this._valueCallback?
this._valueCallback():this._storedValue,null!==b)switch(this.type){case e.a.Float:a.setFloat(c,b);break;case e.a.Int:a.setInt(c,b);break;case e.a.Color3:f.g.Color3[0].set(this.value.r,this.value.g,this.value.b);this.convertToGammaSpace&&f.g.Color3[0].toGammaSpaceToRef(f.g.Color3[0]);this.convertToLinearSpace&&f.g.Color3[0].toLinearSpaceToRef(f.g.Color3[0]);a.setColor3(c,f.g.Color3[0]);break;case e.a.Color4:f.g.Color4[0].set(this.value.r,this.value.g,this.value.b,this.value.a);this.convertToGammaSpace&&
f.g.Color4[0].toGammaSpaceToRef(f.g.Color4[0]);this.convertToLinearSpace&&f.g.Color4[0].toLinearSpaceToRef(f.g.Color4[0]);a.setDirectColor4(c,f.g.Color4[0]);break;case e.a.Vector2:a.setVector2(c,b);break;case e.a.Vector3:a.setVector3(c,b);break;case e.a.Vector4:a.setVector4(c,b);break;case e.a.Matrix:a.setMatrix(c,b)}}};l.prototype._buildBlock=function(a){g.prototype._buildBlock.call(this,a);(this.isUniform||this.isSystemValue)&&a.sharedData.inputBlocks.push(this);this._emit(a)};l.prototype._dumpPropertiesCode=
function(){var a=this._codeVariableName;if(this.isAttribute)return a+'.setAsAttribute("'+this.name+'");\r\n';if(this.isSystemValue)return a+".setAsSystemValue(BABYLON.NodeMaterialSystemValues."+h.a[this._systemValue]+");\r\n";if(this.isUniform){var c=[],f="";switch(this.type){case e.a.Float:f=""+this.value;break;case e.a.Vector2:f="new BABYLON.Vector2("+this.value.x+", "+this.value.y+")";break;case e.a.Vector3:f="new BABYLON.Vector3("+this.value.x+", "+this.value.y+", "+this.value.z+")";break;case e.a.Vector4:f=
"new BABYLON.Vector4("+this.value.x+", "+this.value.y+", "+this.value.z+", "+this.value.w+")";break;case e.a.Color3:f="new BABYLON.Color3("+this.value.r+", "+this.value.g+", "+this.value.b+")";this.convertToGammaSpace&&(f+=".toGammaSpace()");this.convertToLinearSpace&&(f+=".toLinearSpace()");break;case e.a.Color4:f="new BABYLON.Color4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")";this.convertToGammaSpace&&(f+=".toGammaSpace()");this.convertToLinearSpace&&(f+=".toLinearSpace()");
break;case e.a.Matrix:f="BABYLON.Matrix.FromArray(["+this.value.m+"])"}c.push(a+".value = "+f);this.type===e.a.Float&&c.push(a+".min = "+this.min,a+".max = "+this.max,a+".isBoolean = "+this.isBoolean,a+".matrixMode = "+this.matrixMode,a+".animationType = BABYLON.AnimatedInputBlockTypes."+b.a[this.animationType]);c.push(a+".isConstant = "+this.isConstant);c.push("");return c.join(";\r\n")}return""};l.prototype.dispose=function(){this.onValueChangedObservable.clear();g.prototype.dispose.call(this)};
l.prototype.serialize=function(){var a=g.prototype.serialize.call(this);a.type=this.type;a.mode=this._mode;a.systemValue=this._systemValue;a.animationType=this._animationType;a.min=this.min;a.max=this.max;a.isBoolean=this.isBoolean;a.matrixMode=this.matrixMode;a.isConstant=this.isConstant;a.groupInInspector=this.groupInInspector;a.convertToGammaSpace=this.convertToGammaSpace;a.convertToLinearSpace=this.convertToLinearSpace;null!=this._storedValue&&this._mode===k.a.Uniform&&(this._storedValue.asArray?
(a.valueType="BABYLON."+this._storedValue.getClassName(),a.value=this._storedValue.asArray()):(a.valueType="number",a.value=this._storedValue));return a};l.prototype._deserialize=function(a,b,c){this._mode=a.mode;g.prototype._deserialize.call(this,a,b,c);this._type=a.type;this._systemValue=a.systemValue||a.wellKnownValue;this._animationType=a.animationType;this.min=a.min||0;this.max=a.max||0;this.isBoolean=!!a.isBoolean;this.matrixMode=a.matrixMode||0;this.isConstant=!!a.isConstant;this.groupInInspector=
a.groupInInspector||"";this.convertToGammaSpace=!!a.convertToGammaSpace;this.convertToLinearSpace=!!a.convertToLinearSpace;if(a.valueType)if("number"===a.valueType)this._storedValue=a.value;else if(b=r.a.GetClass(a.valueType))this._storedValue=b.FromArray(a.value)};return l}(v.a);r.a.RegisteredTypes["BABYLON.InputBlock"]=l},scQo:function(v,u,g){g.d(u,"a",function(){return t});var q=g("oYeq");v=g("XA4I");var e=g("f9H2"),k=g("lzMP"),h=g("sDlf");u=g("WHS4");var m=g("aCSs"),t=function(g){function f(b){b=
g.call(this,b,k.a.Fragment)||this;b._samplerName="diffuseSampler";b.convertToGammaSpace=!1;b.convertToLinearSpace=!1;b._isUnique=!1;b.registerInput("uv",e.a.Vector2,!1,k.a.VertexAndFragment);b.registerOutput("rgba",e.a.Color4,k.a.Neutral);b.registerOutput("rgb",e.a.Color3,k.a.Neutral);b.registerOutput("r",e.a.Float,k.a.Neutral);b.registerOutput("g",e.a.Float,k.a.Neutral);b.registerOutput("b",e.a.Float,k.a.Neutral);b.registerOutput("a",e.a.Float,k.a.Neutral);b._inputs[0].acceptedConnectionPointTypes.push(e.a.Vector3);
b._inputs[0].acceptedConnectionPointTypes.push(e.a.Vector4);return b}Object(q.d)(f,g);f.prototype.getClassName=function(){return"ParticleTextureBlock"};Object.defineProperty(f.prototype,"uv",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"rgba",{get:function(){return this._outputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"rgb",{get:function(){return this._outputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,
"r",{get:function(){return this._outputs[2]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"g",{get:function(){return this._outputs[3]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"b",{get:function(){return this._outputs[4]},enumerable:!1,configurable:!0});Object.defineProperty(f.prototype,"a",{get:function(){return this._outputs[5]},enumerable:!1,configurable:!0});f.prototype.initialize=function(b){b._excludeVariableName("diffuseSampler")};f.prototype.autoConfigure=
function(b){this.uv.isConnected||(b=b.getInputBlockByPredicate(function(b){return b.isAttribute&&"particle_uv"===b.name}),b||(b=new h.a("uv"),b.setAsAttribute("particle_uv")),b.output.connectTo(this.uv))};f.prototype.prepareDefines=function(b,e,f){f.setValue(this._linearDefineName,this.convertToGammaSpace,!0);f.setValue(this._gammaDefineName,this.convertToLinearSpace,!0)};f.prototype.isReady=function(){return this.texture&&!this.texture.isReadyOrNotBlocking()?!1:!0};f.prototype._writeOutput=function(b,
e,f){b.compilationString+=this._declareOutput(e,b)+" = "+this._tempTextureRead+"."+f+";\r\n";b.compilationString+="#ifdef "+this._linearDefineName+"\r\n";b.compilationString+=e.associatedVariableName+" = toGammaSpace("+e.associatedVariableName+");\r\n";b.compilationString+="#endif\r\n";b.compilationString+="#ifdef "+this._gammaDefineName+"\r\n";b.compilationString+=e.associatedVariableName+" = toLinearSpace("+e.associatedVariableName+");\r\n";b.compilationString+="#endif\r\n"};f.prototype._buildBlock=
function(b){g.prototype._buildBlock.call(this,b);if(b.target!==k.a.Vertex){this._tempTextureRead=b._getFreeVariableName("tempTextureRead");b._emit2DSampler(this._samplerName);b.sharedData.blockingBlocks.push(this);b.sharedData.textureBlocks.push(this);b.sharedData.blocksWithDefines.push(this);this._linearDefineName=b._getFreeDefineName("ISLINEAR");this._gammaDefineName=b._getFreeDefineName("ISGAMMA");b._emitFunctionFromInclude("helperFunctions","//"+this.name);b.compilationString+="vec4 "+this._tempTextureRead+
" = texture2D("+this._samplerName+", "+this.uv.associatedVariableName+");\r\n";for(var e=0,f=this._outputs;e<f.length;e++){var c=f[e];c.hasEndpoints&&this._writeOutput(b,c,c.name)}return this}};f.prototype.serialize=function(){var b=g.prototype.serialize.call(this);b.convertToGammaSpace=this.convertToGammaSpace;b.convertToLinearSpace=this.convertToLinearSpace;this.texture&&(b.texture=this.texture.serialize());return b};f.prototype._deserialize=function(b,e,f){g.prototype._deserialize.call(this,b,
e,f);this.convertToGammaSpace=b.convertToGammaSpace;this.convertToLinearSpace=!!b.convertToLinearSpace;b.texture&&(f=0===b.texture.url.indexOf("data:")?"":f,this.texture=m.a.Parse(b.texture,e,f))};return f}(v.a);u.a.RegisteredTypes["BABYLON.ParticleTextureBlock"]=t},vKbb:function(v,u,g){g.d(u,"a",function(){return h});var q=g("oYeq");v=g("XA4I");var e=g("f9H2"),k=g("lzMP");g=g("WHS4");var h=function(g){function h(h){h=g.call(this,h,k.a.Fragment,!0)||this;h.registerInput("rgba",e.a.Color4,!0);h.registerInput("rgb",
e.a.Color3,!0);h.registerInput("a",e.a.Float,!0);h.rgb.acceptedConnectionPointTypes.push(e.a.Float);return h}Object(q.d)(h,g);h.prototype.getClassName=function(){return"FragmentOutputBlock"};Object.defineProperty(h.prototype,"rgba",{get:function(){return this._inputs[0]},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"rgb",{get:function(){return this._inputs[1]},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"a",{get:function(){return this._inputs[2]},enumerable:!1,
configurable:!0});h.prototype._buildBlock=function(h){g.prototype._buildBlock.call(this,h);var f=this.rgba,b=this.rgb,k=this.a;h.sharedData.hints.needAlphaBlending=f.isConnected||k.isConnected;f.connectedPoint?h.compilationString=k.isConnected?h.compilationString+("gl_FragColor = vec4("+f.associatedVariableName+".rgb, "+k.associatedVariableName+");\r\n"):h.compilationString+("gl_FragColor = "+f.associatedVariableName+";\r\n"):b.connectedPoint?(f="1.0",k.connectedPoint&&(f=k.associatedVariableName),
h.compilationString=b.connectedPoint.type===e.a.Float?h.compilationString+("gl_FragColor = vec4("+b.associatedVariableName+", "+b.associatedVariableName+", "+b.associatedVariableName+", "+f+");\r\n"):h.compilationString+("gl_FragColor = vec4("+b.associatedVariableName+", "+f+");\r\n")):h.sharedData.checks.notConnectedNonOptionalInputs.push(f);return this};return h}(v.a);g.a.RegisteredTypes["BABYLON.FragmentOutputBlock"]=h}}]);
