var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);$jscomp.checkEs6ConformanceViaProxy=function(){try{var g={},w=Object.create(new $jscomp.global.Proxy(g,{get:function(m,c,f){return m==g&&"q"==c&&f==w}}));return!0===w.q}catch(m){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;
$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.arrayIteratorImpl=function(g){var w=0;return function(){return w<g.length?{done:!1,value:g[w++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,w,m){g!=Array.prototype&&g!=Object.prototype&&(g[w]=m.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(g,w){this.$jscomp$symbol$id_=g;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:w})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function g(m){if(this instanceof g)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(m||"")+"_"+w++,m)}var w=0;return g}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.iterator;g||(g=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[g]&&$jscomp.defineProperty(Array.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.asyncIterator;g||(g=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(g){$jscomp.initSymbolIterator();g={next:g};g[$jscomp.global.Symbol.iterator]=function(){return this};return g};
$jscomp.makeIterator=function(g){var w="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];return w?w.call(g):$jscomp.arrayIterator(g)};$jscomp.owns=function(g,w){return Object.prototype.hasOwnProperty.call(g,w)};$jscomp.polyfill=function(g,w,m,c){if(w){m=$jscomp.global;g=g.split(".");for(c=0;c<g.length-1;c++){var f=g[c];f in m||(m[f]={});m=m[f]}g=g[g.length-1];c=m[g];w=w(c);w!=c&&null!=w&&$jscomp.defineProperty(m,g,{configurable:!0,writable:!0,value:w})}};
$jscomp.polyfill("WeakMap",function(g){function w(){if(!g||!Object.seal)return!1;try{var c=Object.seal({}),f=Object.seal({}),q=new g([[c,2],[f,3]]);if(2!=q.get(c)||3!=q.get(f))return!1;q.delete(c);q.set(f,4);return!q.has(c)&&4==q.get(f)}catch(T){return!1}}function m(){}function c(c){if(!$jscomp.owns(c,A)){var f=new m;$jscomp.defineProperty(c,A,{value:f})}}function f(f){var F=Object[f];F&&(Object[f]=function(f){if(f instanceof m)return f;c(f);return F(f)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(g&&
$jscomp.ES6_CONFORMANCE)return g}else if(w())return g;var A="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var y=0,C=function(c){this.id_=(y+=Math.random()+1).toString();if(c){c=$jscomp.makeIterator(c);for(var f;!(f=c.next()).done;)f=f.value,this.set(f[0],f[1])}};C.prototype.set=function(f,g){c(f);if(!$jscomp.owns(f,A))throw Error("WeakMap key fail: "+f);f[A][this.id_]=g;return this};C.prototype.get=function(c){return $jscomp.owns(c,A)?c[A][this.id_]:void 0};C.prototype.has=
function(c){return $jscomp.owns(c,A)&&$jscomp.owns(c[A],this.id_)};C.prototype.delete=function(c){return $jscomp.owns(c,A)&&$jscomp.owns(c[A],this.id_)?delete c[A][this.id_]:!1};return C},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(g){function w(){if($jscomp.ASSUME_NO_NATIVE_MAP||!g||"function"!=typeof g||!g.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),f=new g($jscomp.makeIterator([[c,"s"]]));if("s"!=f.get(c)||1!=f.size||f.get({x:4})||f.set({x:4},"t")!=f||2!=f.size)return!1;var q=f.entries(),m=q.next();if(m.done||m.value[0]!=c||"s"!=m.value[1])return!1;m=q.next();return m.done||4!=m.value[0].x||"t"!=m.value[1]||!q.next().done?!1:!0}catch(L){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(g&&$jscomp.ES6_CONFORMANCE)return g}else if(w())return g;$jscomp.initSymbolIterator();var m=new WeakMap,c=function(c){this.data_={};this.head_=y();this.size=0;if(c){c=$jscomp.makeIterator(c);for(var f;!(f=c.next()).done;)f=f.value,this.set(f[0],f[1])}};c.prototype.set=function(c,g){c=0===c?0:c;var q=f(this,c);q.list||(q.list=this.data_[q.id]=[]);q.entry?q.entry.value=g:(q.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:c,
value:g},q.list.push(q.entry),this.head_.previous.next=q.entry,this.head_.previous=q.entry,this.size++);return this};c.prototype.delete=function(c){c=f(this,c);return c.entry&&c.list?(c.list.splice(c.index,1),c.list.length||delete this.data_[c.id],c.entry.previous.next=c.entry.next,c.entry.next.previous=c.entry.previous,c.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=y();this.size=0};c.prototype.has=function(c){return!!f(this,c).entry};
c.prototype.get=function(c){return(c=f(this,c).entry)&&c.value};c.prototype.entries=function(){return A(this,function(c){return[c.key,c.value]})};c.prototype.keys=function(){return A(this,function(c){return c.key})};c.prototype.values=function(){return A(this,function(c){return c.value})};c.prototype.forEach=function(c,f){for(var q=this.entries(),g;!(g=q.next()).done;)g=g.value,c.call(f,g[1],g[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var f=function(c,f){var q=f&&typeof f;"object"==
q||"function"==q?m.has(f)?q=m.get(f):(q=""+ ++C,m.set(f,q)):q="p_"+f;var g=c.data_[q];if(g&&$jscomp.owns(c.data_,q))for(c=0;c<g.length;c++){var y=g[c];if(f!==f&&y.key!==y.key||f===y.key)return{id:q,list:g,index:c,entry:y}}return{id:q,list:g,index:-1,entry:void 0}},A=function(c,f){var g=c.head_;return $jscomp.iteratorPrototype(function(){if(g){for(;g.head!=c.head_;)g=g.previous;for(;g.next!=g.head;)return g=g.next,{done:!1,value:f(g)};g=null}return{done:!0,value:void 0}})},y=function(){var c={};return c.previous=
c.next=c.head=c},C=0;return c},"es6","es3");
$jscomp.polyfill("Set",function(g){function w(){if($jscomp.ASSUME_NO_NATIVE_SET||!g||"function"!=typeof g||!g.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),f=new g($jscomp.makeIterator([c]));if(!f.has(c)||1!=f.size||f.add(c)!=f||1!=f.size||f.add({x:4})!=f||2!=f.size)return!1;var m=f.entries(),y=m.next();if(y.done||y.value[0]!=c||y.value[1]!=c)return!1;y=m.next();return y.done||y.value[0]==c||4!=y.value[0].x||y.value[1]!=y.value[0]?!1:m.next().done}catch(C){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(g&&$jscomp.ES6_CONFORMANCE)return g}else if(w())return g;$jscomp.initSymbolIterator();var m=function(c){this.map_=new Map;if(c){c=$jscomp.makeIterator(c);for(var f;!(f=c.next()).done;)this.add(f.value)}this.size=this.map_.size};m.prototype.add=function(c){c=0===c?0:c;this.map_.set(c,c);this.size=this.map_.size;return this};m.prototype.delete=function(c){c=this.map_.delete(c);this.size=this.map_.size;return c};m.prototype.clear=function(){this.map_.clear();
this.size=0};m.prototype.has=function(c){return this.map_.has(c)};m.prototype.entries=function(){return this.map_.entries()};m.prototype.values=function(){return this.map_.values()};m.prototype.keys=m.prototype.values;m.prototype[Symbol.iterator]=m.prototype.values;m.prototype.forEach=function(c,f){var g=this;this.map_.forEach(function(m){return c.call(f,m,m,g)})};return m},"es6","es3");
$jscomp.findInternal=function(g,w,m){g instanceof String&&(g=String(g));for(var c=g.length,f=0;f<c;f++){var A=g[f];if(w.call(m,A,f,g))return{i:f,v:A}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(g){return g?g:function(g,m){return $jscomp.findInternal(this,g,m).v}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(g){function w(){this.batch_=null}function m(c){return c instanceof f?c:new f(function(f,g){f(c)})}if(g&&!$jscomp.FORCE_POLYFILL_PROMISE)return g;w.prototype.asyncExecute=function(c){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(c)};var c=$jscomp.global.setTimeout;w.prototype.asyncExecuteFunction=function(f){c(f,0)};w.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=
this.batch_;this.batch_=[];for(var f=0;f<c.length;++f){var g=c[f];c[f]=null;try{g()}catch(J){this.asyncThrow_(J)}}}this.batch_=null};w.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var f=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var f=this.createResolveAndReject_();try{c(f.resolve,f.reject)}catch(F){f.reject(F)}};f.prototype.createResolveAndReject_=function(){function c(c){return function(m){g||(g=!0,c.call(f,m))}}var f=this,g=!1;
return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};f.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof f)this.settleSameAsPromise_(c);else{a:switch(typeof c){case "object":var g=null!=c;break a;case "function":g=!0;break a;default:g=!1}g?this.resolveToNonPromiseObj_(c):this.fulfill_(c)}};f.prototype.resolveToNonPromiseObj_=function(c){var f=void 0;try{f=c.then}catch(F){this.reject_(F);return}"function"==typeof f?
this.settleSameAsThenable_(f,c):this.fulfill_(c)};f.prototype.reject_=function(c){this.settle_(2,c)};f.prototype.fulfill_=function(c){this.settle_(1,c)};f.prototype.settle_=function(c,f){if(0!=this.state_)throw Error("Cannot settle("+c+", "+f+"): Promise already settled in state"+this.state_);this.state_=c;this.result_=f;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var c=0;c<this.onSettledCallbacks_.length;++c)A.asyncExecute(this.onSettledCallbacks_[c]);
this.onSettledCallbacks_=null}};var A=new w;f.prototype.settleSameAsPromise_=function(c){var f=this.createResolveAndReject_();c.callWhenSettled_(f.resolve,f.reject)};f.prototype.settleSameAsThenable_=function(c,f){var g=this.createResolveAndReject_();try{c.call(f,g.resolve,g.reject)}catch(J){g.reject(J)}};f.prototype.then=function(c,g){function m(c,f){return"function"==typeof c?function(f){try{w(c(f))}catch(V){q(V)}}:f}var w,q,y=new f(function(c,f){w=c;q=f});this.callWhenSettled_(m(c,w),m(g,q));return y};
f.prototype.catch=function(c){return this.then(void 0,c)};f.prototype.callWhenSettled_=function(c,f){function g(){switch(m.state_){case 1:c(m.result_);break;case 2:f(m.result_);break;default:throw Error("Unexpected state: "+m.state_);}}var m=this;null==this.onSettledCallbacks_?A.asyncExecute(g):this.onSettledCallbacks_.push(g)};f.resolve=m;f.reject=function(c){return new f(function(f,g){g(c)})};f.race=function(c){return new f(function(f,g){for(var w=$jscomp.makeIterator(c),q=w.next();!q.done;q=w.next())m(q.value).callWhenSettled_(f,
g)})};f.all=function(c){var g=$jscomp.makeIterator(c),w=g.next();return w.done?m([]):new f(function(c,f){function q(f){return function(g){y[f]=g;A--;0==A&&c(y)}}var y=[],A=0;do y.push(void 0),A++,m(w.value).callWhenSettled_(q(y.length-1),f),w=g.next();while(!w.done)})};return f},"es6","es3");
$jscomp.iteratorFromArray=function(g,w){$jscomp.initSymbolIterator();g instanceof String&&(g+="");var m=0,c={next:function(){if(m<g.length){var f=m++;return{value:w(f,g[f]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};$jscomp.polyfill("Array.prototype.keys",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(g){return g})}},"es6","es3");
(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{dVDo:function(g,w,m){m.d(w,"b",function(){return A});m.d(w,"a",function(){return ca});m.d(w,"c",function(){return da});var c=m("/SR9"),f=m("YKqZ"),A=function(){function e(){}e.OBJ=function(a,b,d,h){var k=[],p=1;b&&(d||(d="mat"),k.push("mtllib "+d+".mtl"));for(d=0;d<a.length;d++){k.push("g object"+d);k.push("o object_"+d);var r=null;if(h){var t=c.a.Translation(a[d].position.x,a[d].position.y,a[d].position.z);r=c.a.Translation(-a[d].position.x,
-a[d].position.y,-a[d].position.z);a[d].bakeTransformIntoVertices(t)}b&&(t=a[d].material)&&k.push("usemtl "+t.id);var l=a[d].geometry;if(l){var n=l.getVerticesData("position");t=l.getVerticesData("normal");var e=l.getVerticesData("uv");l=l.getIndices();var g=0;if(n&&l){for(var x=0;x<n.length;x+=3)a[0].getScene().useRightHandedSystem?k.push("v "+n[x]+" "+n[x+1]+" "+n[x+2]):k.push("v "+n[x]+" "+n[x+1]+" "+-n[x+2]),g++;if(null!=t)for(x=0;x<t.length;x+=3)k.push("vn "+t[x]+" "+t[x+1]+" "+t[x+2]);if(null!=
e)for(x=0;x<e.length;x+=2)k.push("vt "+e[x]+" "+e[x+1]);for(x=0;x<l.length;x+=3){var u=[String(l[x+2]+p),String(l[x+1]+p),String(l[x]+p)],m=["","",""];n=u;var q=null!=e?u:m;u=null!=t?u:m;k.push("f "+n[0]+"/"+q[0]+"/"+u[0]+" "+n[1]+"/"+q[1]+"/"+u[1]+" "+n[2]+"/"+q[2]+"/"+u[2])}h&&r&&a[d].bakeTransformIntoVertices(r);p+=g}else f.b.Warn("There are no position vertices or indices on the mesh!")}else f.b.Warn("No geometry is present on the mesh")}return k.join("\n")};e.MTL=function(a){var b=[];a=a.material;
b.push("newmtl mat1");b.push("  Ns "+a.specularPower.toFixed(4));b.push("  Ni 1.5000");b.push("  d "+a.alpha.toFixed(4));b.push("  Tr 0.0000");b.push("  Tf 1.0000 1.0000 1.0000");b.push("  illum 2");b.push("  Ka "+a.ambientColor.r.toFixed(4)+" "+a.ambientColor.g.toFixed(4)+" "+a.ambientColor.b.toFixed(4));b.push("  Kd "+a.diffuseColor.r.toFixed(4)+" "+a.diffuseColor.g.toFixed(4)+" "+a.diffuseColor.b.toFixed(4));b.push("  Ks "+a.specularColor.r.toFixed(4)+" "+a.specularColor.g.toFixed(4)+" "+a.specularColor.b.toFixed(4));
b.push("  Ke "+a.emissiveColor.r.toFixed(4)+" "+a.emissiveColor.g.toFixed(4)+" "+a.emissiveColor.b.toFixed(4));a.ambientTexture&&b.push("  map_Ka "+a.ambientTexture.name);a.diffuseTexture&&b.push("  map_Kd "+a.diffuseTexture.name);a.specularTexture&&b.push("  map_Ks "+a.specularTexture.name);a.bumpTexture&&b.push("  map_bump -imfchan z "+a.bumpTexture.name);a.opacityTexture&&b.push("  map_d "+a.opacityTexture.name);return b.join("\n")};return e}(),y=m("mBE3"),C=m("qVgn"),F=m("YSg2"),J=m("wAMR"),q=
function(){function e(){}e._CreateBufferView=function(a,b,d,h,k){a={buffer:a,byteLength:d};b&&(a.byteOffset=b);k&&(a.name=k);h&&(a.byteStride=h);return a};e._CreateAccessor=function(a,b,d,h,k,c,r,e){a={name:b,bufferView:a,componentType:h,count:k,type:d};null!=r&&(a.min=r);null!=e&&(a.max=e);null!=c&&(a.byteOffset=c);return a};e._CalculateMinMaxPositions=function(a,b,d,h){var k=[Infinity,Infinity,Infinity],p=[-Infinity,-Infinity,-Infinity];if(d){var r=b;for(d=b+d;r<d;++r){b=3*r;var t=c.e.FromArray(a,
b);h&&e._GetRightHandedPositionVector3FromRef(t);t=t.asArray();for(var l=0;3>l;++l){var n=t[l];n<k[l]&&(k[l]=n);n>p[l]&&(p[l]=n);++b}}}return{min:k,max:p}};e._GetRightHandedPositionVector3=function(a){return new c.e(a.x,a.y,-a.z)};e._GetRightHandedPositionVector3FromRef=function(a){a.z*=-1};e._GetRightHandedPositionArray3FromRef=function(a){a[2]*=-1};e._GetRightHandedNormalVector3=function(a){return new c.e(a.x,a.y,-a.z)};e._GetRightHandedNormalVector3FromRef=function(a){a.z*=-1};e._GetRightHandedNormalArray3FromRef=
function(a){a[2]*=-1};e._GetRightHandedVector4FromRef=function(a){a.z*=-1;a.w*=-1};e._GetRightHandedArray4FromRef=function(a){a[2]*=-1;a[3]*=-1};e._GetRightHandedQuaternionFromRef=function(a){a.x*=-1;a.y*=-1};e._GetRightHandedQuaternionArrayFromRef=function(a){a[0]*=-1;a[1]*=-1};e._NormalizeTangentFromRef=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);0<b&&(a.x/=b,a.y/=b,a.z/=b)};e._GetRightHandedMatrixFromRef=function(a){var b=a.m;c.a.FromValuesToRef(b[0],b[1],-b[2],b[3],b[4],b[5],-b[6],b[7],
-b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15],a)};e._GetDataAccessorElementCount=function(a){switch(a){case "MAT2":return 4;case "MAT3":return 9;case "MAT4":return 16;case "SCALAR":return 1;case "VEC2":return 2;case "VEC3":return 3;case "VEC4":return 4}};return e}(),T=m("Ql7q"),L;(function(c){c[c.INTANGENT=0]="INTANGENT";c[c.OUTTANGENT=1]="OUTTANGENT"})(L||(L={}));var U=function(){function e(){}e._CreateNodeAnimation=function(a,b,d,h,k,c){var r=[],p=[],l=b.getKeys(),n=e.calculateMinMaxKeyFrames(l),
G=e._DeduceInterpolation(l,d,k);l=n.max-n.min;var g=G.interpolationType;(G=G.shouldBakeAnimation)?e._CreateBakedAnimation(a,b,d,n.min,n.max,b.framePerSecond,c,r,p,n,h,k):"LINEAR"===g||"STEP"===g?e._CreateLinearOrStepAnimation(a,b,d,l,r,p,h,k):"CUBICSPLINE"===g?e._CreateCubicSplineAnimation(a,b,d,l,r,p,h,k):e._CreateBakedAnimation(a,b,d,n.min,n.max,b.framePerSecond,c,r,p,n,h,k);return r.length&&p.length?{inputs:r,outputs:p,samplerInterpolation:g,inputsMin:G?n.min:f.b.FloatRound(n.min/b.framePerSecond),
inputsMax:G?n.max:f.b.FloatRound(n.max/b.framePerSecond)}:null};e._DeduceAnimationInfo=function(a){var b=null,d="VEC3",h=!1;a=a.targetProperty.split(".");switch(a[0]){case "scaling":b="scale";break;case "position":b="translation";break;case "rotation":d="VEC4";b="rotation";break;case "rotationQuaternion":d="VEC4";h=!0;b="rotation";break;case "influence":d="SCALAR";b="weights";break;default:f.b.Error("Unsupported animatable property "+a[0])}if(b)return{animationChannelTargetPath:b,dataAccessorType:d,
useQuaternion:h};f.b.Error("animation channel target path and data accessor type could be deduced");return null};e._CreateNodeAnimationFromNodeAnimations=function(a,b,d,h,k,c,r,t,l,n){if(a instanceof C.a&&a.animations)for(var p=0,f=a.animations;p<f.length;p++){var g=f[p],u=e._DeduceAnimationInfo(g);u&&(k={name:g.name,samplers:[],channels:[]},e.AddAnimation(""+g.name,g.hasRunningRuntimeAnimations?b:k,a,g,u.dataAccessorType,u.animationChannelTargetPath,h,c,r,t,l,u.useQuaternion,n),k.samplers.length&&
k.channels.length&&d.push(k))}};e._CreateMorphTargetAnimationFromMorphTargetAnimations=function(a,b,d,h,k,c,r,t,l,n){if(a instanceof J.a&&(k=a.morphTargetManager))for(var p=0;p<k.numTargets;++p)for(var f=0,g=k.getTarget(p).animations;f<g.length;f++){var u=g[f],m=new y.a(""+u.name,"influence",u.framePerSecond,u.dataType,u.loopMode,u.enableBlending);var q=[];for(var v=u.getKeys(),H=0;H<v.length;++H)for(var z=v[H],w=0;w<k.numTargets;++w)w==p?q.push(z):q.push({frame:z.frame,value:0});m.setKeys(q);if(v=
e._DeduceAnimationInfo(m))q={name:m.name,samplers:[],channels:[]},e.AddAnimation(u.name,u.hasRunningRuntimeAnimations?b:q,a,m,v.dataAccessorType,v.animationChannelTargetPath,h,c,r,t,l,v.useQuaternion,n,k.numTargets),q.samplers.length&&q.channels.length&&d.push(q)}};e._CreateNodeAndMorphAnimationFromAnimationGroups=function(a,b,d,h,k,c,r,t,l){var p,f;if(a.animationGroups){h=function(h){var n=new Map,g=new Map,G=new Set,x=h.to-h.from;f={name:h.name,channels:[],samplers:[]};for(var u=function(b){var x=
h.targetedAnimations[b],u=x.target;b=x.animation;if(u instanceof C.a||1===u.length&&u[0]instanceof C.a){if(x=e._DeduceAnimationInfo(x.animation))u=u instanceof C.a?u:u[0],e.AddAnimation(""+b.name,f,u,b,x.dataAccessorType,x.animationChannelTargetPath,d,k,c,r,t[u.uniqueId],x.useQuaternion,l)}else if(u instanceof F.a||1===u.length&&u[0]instanceof F.a)if(x=e._DeduceAnimationInfo(x.animation)){var m=u instanceof F.a?u:u[0];if(m){var q=a.morphTargetManagers.find(function(a){for(var b=0;b<a.numTargets;++b)if(a.getTarget(b)===
m)return!0;return!1});q&&(u=a.meshes.find(function(a){return a.morphTargetManager===q}))&&(n.has(u)||n.set(u,new Map),null===(p=n.get(u))||void 0===p?void 0:p.set(m,b),G.add(u),g.set(u,b))}}},m=0;m<h.targetedAnimations.length;++m)u(m);G.forEach(function(a){for(var b=a.morphTargetManager,p=null,t=[],G=g.get(a).getKeys(),u=G.length,m=0;m<u;++m)for(var q=0;q<b.numTargets;++q){var I=b.getTarget(q),v=n.get(a);v&&((v=v.get(I))?(p||(p=new y.a(h.name+"_"+a.name+"_MorphWeightAnimation","influence",v.framePerSecond,
y.a.ANIMATIONTYPE_FLOAT,v.loopMode,v.enableBlending)),t.push(v.getKeys()[m])):t.push({frame:h.from+x/u*m,value:I.influence,inTangent:G[0].inTangent?0:void 0,outTangent:G[0].outTangent?0:void 0}))}p.setKeys(t);(t=e._DeduceAnimationInfo(p))&&e.AddAnimation(h.name+"_"+a.name+"_MorphWeightAnimation",f,a,p,t.dataAccessorType,t.animationChannelTargetPath,d,k,c,r,!1,t.useQuaternion,l,null===b||void 0===b?void 0:b.numTargets)});f.channels.length&&f.samplers.length&&b.push(f)};for(var g=0,x=a.animationGroups;g<
x.length;g++)h(x[g])}};e.AddAnimation=function(a,b,d,h,k,c,r,t,l,n,f,g,x,u){if(h=e._CreateNodeAnimation(d,h,c,f,g,x)){if(u){g=f=0;for(x=[];0<h.inputs.length;)g=h.inputs.shift(),0==f%u&&x.push(g),f++;h.inputs=x}d=r[d.uniqueId];f=4*h.inputs.length;f=q._CreateBufferView(0,t.getByteOffset(),f,void 0,a+"  keyframe data view");l.push(f);h.inputs.forEach(function(a){t.setFloat32(a)});u=q._CreateAccessor(l.length-1,a+"  keyframes","SCALAR",5126,h.inputs.length,null,[h.inputsMin],[h.inputsMax]);n.push(u);
r=n.length-1;u=h.outputs.length;f=4*q._GetDataAccessorElementCount(k)*h.outputs.length;f=q._CreateBufferView(0,t.getByteOffset(),f,void 0,a+"  data view");l.push(f);h.outputs.forEach(function(a){a.forEach(function(a){t.setFloat32(a)})});u=q._CreateAccessor(l.length-1,a+"  data",k,5126,u,null,null,null);n.push(u);a=n.length-1;a={interpolation:h.samplerInterpolation,input:r,output:a};b.samplers.push(a);c={sampler:b.samplers.length-1,target:{node:d,path:c}};b.channels.push(c)}};e._CreateBakedAnimation=
function(a,b,d,h,k,p,r,t,l,n,g,m){var x=c.b.Identity(),u=null,G=null;n.min=f.b.FloatRound(h/p);h=b.getKeys();for(var q=0,v=h.length;q<v;++q){var I=h[q];if(q+1<v){var z=h[q+1];if(I.value.equals&&I.value.equals(z.value)||I.value===z.value)if(0===q)z=I.frame;else continue;else z=z.frame}else if(z=h[q-1],I.value.equals&&I.value.equals(z.value)||I.value===z.value)continue;else z=k;if(z)for(var w=I.frame;w<=z;w+=r){var y=f.b.FloatRound(w/p);y!==u&&(G=u=y,I=b._interpolate(w,{key:0,repeatCount:0,loopMode:b.loopMode}),
e._SetInterpolatedValue(a,I,y,b,d,x,t,l,g,m))}}G&&(n.max=G)};e._ConvertFactorToVector3OrQuaternion=function(a,b,d,h,k,p,r){var t=null;b=e._GetBasePositionRotationOrScale(b,k,p,r);if(h===y.a.ANIMATIONTYPE_FLOAT)switch(d=(t=d.targetProperty.split("."))?t[1]:"",t=r?c.b.FromArray(b).normalize():c.e.FromArray(b),d){case "x":t[d]=p&&r&&"scale"!==k?-a:a;break;case "y":t[d]=p&&r&&"scale"!==k?-a:a;break;case "z":t[d]=p&&!r&&"scale"!==k?-a:a;break;case "w":t.w=a;break;default:f.b.Error('glTFAnimation: Unsupported component type "'+
d+'" for scale animation!')}return t};e._SetInterpolatedValue=function(a,b,d,h,k,p,r,e,l,n){var t=h.dataType;r.push(d);"number"===typeof b&&a instanceof C.a&&(b=this._ConvertFactorToVector3OrQuaternion(b,a,h,t,k,l,n));b&&("rotation"===k?(n?p=b:c.b.RotationYawPitchRollToRef(b.y,b.x,b.z,p),l&&(q._GetRightHandedQuaternionFromRef(p),a.parent||(p=c.b.FromArray([0,1,0,0]).multiply(p))),e.push(p.asArray())):"weights"===k?e.push([b]):(l&&"scale"!==k&&(q._GetRightHandedPositionVector3FromRef(b),a.parent||
(b.x*=-1,b.z*=-1)),e.push(b.asArray())))};e._CreateLinearOrStepAnimation=function(a,b,d,h,c,p,r,t){h=0;for(var k=b.getKeys();h<k.length;h++){var n=k[h];c.push(n.frame/b.framePerSecond);e._AddKeyframeValue(n,b,p,d,a,r,t)}};e._CreateCubicSplineAnimation=function(a,b,d,h,c,p,r,t){b.getKeys().forEach(function(k){c.push(k.frame/b.framePerSecond);e.AddSplineTangent(a,L.INTANGENT,p,d,"CUBICSPLINE",k,h,t,r);e._AddKeyframeValue(k,b,p,d,a,r,t);e.AddSplineTangent(a,L.OUTTANGENT,p,d,"CUBICSPLINE",k,h,t,r)})};
e._GetBasePositionRotationOrScale=function(a,b,d,h){"rotation"===b?h?a.rotationQuaternion?(b=a.rotationQuaternion.asArray(),d&&(q._GetRightHandedQuaternionArrayFromRef(b),a.parent||(b=c.b.FromArray([0,1,0,0]).multiply(c.b.FromArray(b)).asArray()))):b=c.b.Identity().asArray():(b=a.rotation.asArray(),q._GetRightHandedNormalArray3FromRef(b)):"translation"===b?(b=a.position.asArray(),d&&q._GetRightHandedPositionArray3FromRef(b)):b=a.scaling.asArray();return b};e._AddKeyframeValue=function(a,b,d,h,k,p,
r){var e=b.dataType;if(e===y.a.ANIMATIONTYPE_VECTOR3)r=a.value.asArray(),"rotation"===h?(h=c.e.FromArray(r),h=c.b.RotationYawPitchRoll(h.y,h.x,h.z),p&&(q._GetRightHandedQuaternionFromRef(h),k.parent||(h=c.b.FromArray([0,1,0,0]).multiply(h))),r=h.asArray()):"translation"===h&&p&&(q._GetRightHandedNormalArray3FromRef(r),k.parent||(r[0]*=-1,r[2]*=-1)),d.push(r);else if(e===y.a.ANIMATIONTYPE_FLOAT)if("weights"===h)d.push([a.value]);else{if(a=this._ConvertFactorToVector3OrQuaternion(a.value,k,b,e,h,p,
r))"rotation"===h?(h=r?a:c.b.RotationYawPitchRoll(a.y,a.x,a.z).normalize(),p&&(q._GetRightHandedQuaternionFromRef(h),k.parent||(h=c.b.FromArray([0,1,0,0]).multiply(h))),d.push(h.asArray())):"translation"===h&&p&&(q._GetRightHandedNormalVector3FromRef(a),k.parent||(a.x*=-1,a.z*=-1)),d.push(a.asArray())}else e===y.a.ANIMATIONTYPE_QUATERNION?(r=a.value.normalize().asArray(),p&&(q._GetRightHandedQuaternionArrayFromRef(r),k.parent||(r=c.b.FromArray([0,1,0,0]).multiply(c.b.FromArray(r)).asArray())),d.push(r)):
f.b.Error("glTFAnimation: Unsupported key frame values for animation!")};e._DeduceInterpolation=function(a,b,d){var h=!1;if("rotation"===b&&!d)return{interpolationType:"LINEAR",shouldBakeAnimation:!0};d=0;for(var c=a.length;d<c;++d)if(b=a[d],b.inTangent||b.outTangent)if(p){if("CUBICSPLINE"!==p){var p="LINEAR";h=!0;break}}else p="CUBICSPLINE";else if(p){if("CUBICSPLINE"===p||b.interpolation&&b.interpolation===T.a.STEP&&"STEP"!==p){p="LINEAR";h=!0;break}}else p=b.interpolation&&b.interpolation===T.a.STEP?
"STEP":"LINEAR";p||(p="LINEAR");return{interpolationType:p,shouldBakeAnimation:h}};e.AddSplineTangent=function(a,b,d,h,k,p,r,e,l){b=b===L.INTANGENT?p.inTangent:p.outTangent;"CUBICSPLINE"===k&&("rotation"===h?b?(k=e?b.asArray():c.b.RotationYawPitchRoll(b.y,b.x,b.z).asArray(),l&&(q._GetRightHandedQuaternionArrayFromRef(k),a.parent||(k=c.b.FromArray([0,1,0,0]).multiply(c.b.FromArray(k)).asArray()))):k=[0,0,0,0]:"weights"===h?k=b?[b]:[0]:b?(k=b.asArray(),l&&"translation"===h&&(q._GetRightHandedPositionArray3FromRef(k),
a.parent||(k[0]*=-1,k[2]*=-1))):k=[0,0,0],d.push(k))};e.calculateMinMaxKeyFrames=function(a){var b=Infinity,d=-Infinity;a.forEach(function(a){b=Math.min(b,a.frame);d=Math.max(d,a.frame)});return{min:b,max:d}};return e}(),Y=function(){function c(){this.glTFFiles={}}c.prototype.downloadFiles=function(){function a(a,b){return-1!==a.indexOf(b,a.length-b.length)}for(var b in this.glTFFiles){var d=document.createElement("a");document.body.appendChild(d);d.setAttribute("type","hidden");d.download=b;var h=
this.glTFFiles[b],c=void 0;a(b,".glb")?c={type:"model/gltf-binary"}:a(b,".bin")?c={type:"application/octet-stream"}:a(b,".gltf")?c={type:"model/gltf+json"}:a(b,".jpeg")?c={type:"image/jpeg"}:a(b,".png")&&(c={type:"image/png"});d.href=window.URL.createObjectURL(new Blob([h],c));d.click()}};return c}(),V=m("mrSG"),D=m("Xeau"),v=m("y4Ty"),Z=m("CFrw"),W=m("acOv"),E=m("cdI9"),ea=m("jI0L"),X=m("kdvT"),fa=m("qUIE"),P=m("sH6m"),aa=m("AOHV"),B=m("aCSs"),ha=m("T5W1"),Q=m("oXT7"),ia=m("kJpR"),ja=m("OJ6t"),ka=
m("tVVT"),R=m("BOQG"),la=function(){function e(a){this._textureMap={};this._exporter=a}e.FuzzyEquals=function(a,b,d){return P.a.WithinEpsilon(a.r,b.r,d)&&P.a.WithinEpsilon(a.g,b.g,d)&&P.a.WithinEpsilon(a.b,b.b,d)};e.prototype._convertMaterialsToGLTFAsync=function(a,b,d){for(var h=[],c=0;c<a.length;c++){var p=a[c];p instanceof X.a?h.push(this._convertStandardMaterialAsync(p,b,d)):p instanceof ia.a?h.push(this._convertPBRMetallicRoughnessMaterialAsync(p,b,d)):p instanceof Q.a?h.push(this._convertPBRMaterialAsync(p,
b,d)):f.b.Warn("Unsupported material type: "+p.name)}return Promise.all(h).then(function(){})};e.prototype._stripTexturesFromMaterial=function(a){var b={};a&&(b.name=a.name,b.doubleSided=a.doubleSided,b.alphaMode=a.alphaMode,b.alphaCutoff=a.alphaCutoff,b.emissiveFactor=a.emissiveFactor,a=a.pbrMetallicRoughness)&&(b.pbrMetallicRoughness={},b.pbrMetallicRoughness.baseColorFactor=a.baseColorFactor,b.pbrMetallicRoughness.metallicFactor=a.metallicFactor,b.pbrMetallicRoughness.roughnessFactor=a.roughnessFactor);
return b};e.prototype._hasTexturesPresent=function(a){return a.emissiveTexture||a.normalTexture||a.occlusionTexture?!0:(a=a.pbrMetallicRoughness)&&(a.baseColorTexture||a.metallicRoughnessTexture)?!0:!1};e.prototype._convertToGLTFPBRMetallicRoughness=function(a){var b=new c.d(0,1),d=new c.d(0,.1),h=new c.d(0,.1),k=new c.d(1300,.1),p=a.diffuseColor.toLinearSpace().scale(.5),r=a.alpha;a=P.a.Clamp(a.specularPower,0,e._MaxSpecularPower);a=Math.pow(a/k.x,.333333);return{baseColorFactor:[p.r,p.g,p.b,r],
metallicFactor:0,roughnessFactor:(1-a)*(1-a)*(1-a)*b.y+3*(1-a)*(1-a)*a*d.y+3*(1-a)*a*a*h.y+a*a*a*k.y}};e._SolveMetallic=function(a,b,d){if(b<this._DielectricSpecular.r)return this._DielectricSpecular,0;var h=this._DielectricSpecular.r;a=a*d/(1-this._DielectricSpecular.r)+b-2*this._DielectricSpecular.r;return P.a.Clamp((-a+Math.sqrt(a*a-4*h*(this._DielectricSpecular.r-b)))/(2*h),0,1)};e._SetAlphaMode=function(a,b){b.needAlphaBlending()?a.alphaMode="BLEND":b.needAlphaTesting()&&(a.alphaMode="MASK",
a.alphaCutoff=b.alphaCutOff)};e.prototype._convertStandardMaterialAsync=function(a,b,d){var h=this._exporter._materialMap,c=this._exporter._materials,p=[],r=this._convertToGLTFPBRMetallicRoughness(a),t={name:a.name};null==a.backFaceCulling||a.backFaceCulling||(a.twoSidedLighting||f.b.Warn(a.name+": Back-face culling enabled and two-sided lighting disabled is not supported in glTF."),t.doubleSided=!0);d&&(a.diffuseTexture&&p.push(this._exportTextureAsync(a.diffuseTexture,b).then(function(a){a&&(r.baseColorTexture=
a)})),a.bumpTexture&&p.push(this._exportTextureAsync(a.bumpTexture,b).then(function(b){b&&(t.normalTexture=b,null!=a.bumpTexture&&1!==a.bumpTexture.level&&(t.normalTexture.scale=a.bumpTexture.level))})),a.emissiveTexture&&(t.emissiveFactor=[1,1,1],p.push(this._exportTextureAsync(a.emissiveTexture,b).then(function(a){a&&(t.emissiveTexture=a)}))),a.ambientTexture&&p.push(this._exportTextureAsync(a.ambientTexture,b).then(function(a){a&&(a={index:a.index},t.occlusionTexture=a,a.strength=1)})));if(1>a.alpha||
a.opacityTexture)a.alphaMode===R.a.ALPHA_COMBINE?t.alphaMode="BLEND":f.b.Warn(a.name+": glTF 2.0 does not support alpha mode: "+a.alphaMode.toString());a.emissiveColor&&!e.FuzzyEquals(a.emissiveColor,D.a.Black(),e._Epsilon)&&(t.emissiveFactor=a.emissiveColor.asArray());t.pbrMetallicRoughness=r;e._SetAlphaMode(t,a);c.push(t);h[a.uniqueId]=c.length-1;return this._finishMaterial(p,t,a,b)};e.prototype._finishMaterial=function(a,b,d,h){var c=this;return Promise.all(a).then(function(){for(var a=null,k=
0,e=c._exporter._extensionsPostExportMaterialAdditionalTextures("exportMaterial",b,d);k<e.length;k++){var l=e[k];a||(a=[]);a.push(c._exportTextureAsync(l,h))}a||(a=[Promise.resolve(null)]);return Promise.all(a).then(function(){var a=c._exporter._extensionsPostExportMaterialAsync("exportMaterial",b,d);return a?a.then(function(){return b}):b})})};e.prototype._convertPBRMetallicRoughnessMaterialAsync=function(a,b,d){var h=this._exporter._materialMap,c=this._exporter._materials,p=[],r={};a.baseColor&&
(r.baseColorFactor=[a.baseColor.r,a.baseColor.g,a.baseColor.b,a.alpha]);null!=a.metallic&&1!==a.metallic&&(r.metallicFactor=a.metallic);null!=a.roughness&&1!==a.roughness&&(r.roughnessFactor=a.roughness);var t={name:a.name};a.doubleSided&&(t.doubleSided=a.doubleSided);e._SetAlphaMode(t,a);d&&(null!=a.baseTexture&&p.push(this._exportTextureAsync(a.baseTexture,b).then(function(a){a&&(r.baseColorTexture=a)})),a.normalTexture&&p.push(this._exportTextureAsync(a.normalTexture,b).then(function(b){b&&(t.normalTexture=
b,1!==a.normalTexture.level&&(t.normalTexture.scale=a.normalTexture.level))})),a.occlusionTexture&&p.push(this._exportTextureAsync(a.occlusionTexture,b).then(function(b){b&&(t.occlusionTexture=b,null!=a.occlusionStrength&&(t.occlusionTexture.strength=a.occlusionStrength))})),a.emissiveTexture&&p.push(this._exportTextureAsync(a.emissiveTexture,b).then(function(a){a&&(t.emissiveTexture=a)})));e.FuzzyEquals(a.emissiveColor,D.a.Black(),e._Epsilon)&&(t.emissiveFactor=a.emissiveColor.asArray());t.pbrMetallicRoughness=
r;c.push(t);h[a.uniqueId]=c.length-1;return this._finishMaterial(p,t,a,b)};e.prototype._createBase64FromCanvasAsync=function(a,b,d,h){var c=this;return new Promise(function(k,r){var e=R.a.TEXTURETYPE_UNSIGNED_INT,l=c._exporter._getLocalEngine();var p=new ka.a(l);var g=l.createRawTexture(a,b,d,R.a.TEXTUREFORMAT_RGBA,!1,!0,B.a.NEAREST_SAMPLINGMODE,null,e),m=new ja.a("pass","pass",null,null,1,null,B.a.NEAREST_SAMPLINGMODE,l,!1,void 0,R.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);m.getEffect().executeWhenCompiled(function(){var a,
c;m.onApply=function(a){a._bindTexture("textureSampler",g)};l.setSize(b,d);p.postProcessManager.directRender([m],null);m.dispose();g.dispose();var e=l.getRenderingCanvas(),n=document.createElement("canvas");n.width=null!==(a=null===e||void 0===e?void 0:e.width)&&void 0!==a?a:0;n.height=null!==(c=null===e||void 0===e?void 0:e.height)&&void 0!==c?c:0;n.getContext("2d").drawImage(e,0,0);n?n.toBlob?f.b.ToBlob(n,function(a){n=null;if(a){var b=new FileReader;b.onload=function(a){a=a.target.result;p.dispose();
k(a)};b.readAsDataURL(a)}else r("gltfMaterialExporter: Failed to get blob from image canvas!")},h):(a=n.toDataURL(),k(a)):r("Engine is missing a canvas!")})})};e.prototype._createWhiteTexture=function(a,b,d){for(var h=new Uint8Array(a*b*4),c=0;c<h.length;c+=4)h[c]=h[c+1]=h[c+2]=h[c+3]=255;return ha.a.CreateRGBATexture(h,a,b,d)};e.prototype._resizeTexturesToSameDimensions=function(a,b,d){var h=a?a.getSize():{width:0,height:0},c=b?b.getSize():{width:0,height:0};h.width<c.width?a=a&&a instanceof B.a?
aa.a.CreateResizedCopy(a,c.width,c.height,!0):this._createWhiteTexture(c.width,c.height,d):h.width>c.width&&(b=b&&b instanceof B.a?aa.a.CreateResizedCopy(b,h.width,h.height,!0):this._createWhiteTexture(h.width,h.height,d));return{texture1:a,texture2:b}};e.prototype._convertPixelArrayToFloat32=function(a){if(a instanceof Uint8Array){for(var b=a.length,d=new Float32Array(a.length),c=0;c<b;++c)d[c]=a[c]/255;return d}if(a instanceof Float32Array)return a;throw Error("Unsupported pixel format!");};e.prototype._convertSpecularGlossinessTexturesToMetallicRoughnessAsync=
function(a,b,d,c){var h=[];if(!a&&!b)return Promise.reject("_ConvertSpecularGlosinessTexturesToMetallicRoughness: diffuse and specular glossiness textures are not defined!");var p=a?a.getScene():b?b.getScene():null;if(p){var r=this._resizeTexturesToSameDimensions(a,b,p);b=r.texture1.getSize();var f=void 0,l=void 0;a=b.width;b=b.height;var n=r.texture1.readPixels();p=r.texture2.readPixels();if(n)f=this._convertPixelArrayToFloat32(n);else return Promise.reject("Failed to retrieve pixels from diffuse texture!");
if(p)l=this._convertPixelArrayToFloat32(p);else return Promise.reject("Failed to retrieve pixels from specular glossiness texture!");n=l.byteLength;p=new Uint8Array(n);n=new Uint8Array(n);for(var g=D.a.Black(),m=0,x=0,u=0;u<b;++u)for(var q=0;q<a;++q){var v=4*(a*u+q),w=(new D.a(f[v],f[v+1],f[v+2])).toLinearSpace().multiply(d.diffuseColor),H=(new D.a(l[v],l[v+1],l[v+2])).toLinearSpace().multiply(d.specularColor);w=this._convertSpecularGlossinessToMetallicRoughness({diffuseColor:w,specularColor:H,glossiness:l[v+
3]*d.glossiness});g.r=Math.max(g.r,w.baseColor.r);g.g=Math.max(g.g,w.baseColor.g);g.b=Math.max(g.b,w.baseColor.b);m=Math.max(m,w.metallic);x=Math.max(x,w.roughness);n[v]=255*w.baseColor.r;n[v+1]=255*w.baseColor.g;n[v+2]=255*w.baseColor.b;n[v+3]=r.texture1.hasAlpha?255*f[v+3]:255;p[v]=0;p[v+1]=255*w.roughness;p[v+2]=255*w.metallic;p[v+3]=255}var z={baseColor:g,metallic:m,roughness:x};d=r=!1;for(u=0;u<b;++u)for(q=0;q<a;++q)f=4*(a*u+q),n[f]/=z.baseColor.r>e._Epsilon?z.baseColor.r:1,n[f+1]/=z.baseColor.g>
e._Epsilon?z.baseColor.g:1,n[f+2]/=z.baseColor.b>e._Epsilon?z.baseColor.b:1,l=D.a.FromInts(n[f],n[f+1],n[f+2]).toGammaSpace(),n[f]=255*l.r,n[f+1]=255*l.g,n[f+2]=255*l.b,e.FuzzyEquals(l,D.a.White(),e._Epsilon)||(d=!0),p[f+1]/=z.roughness>e._Epsilon?z.roughness:1,p[f+2]/=z.metallic>e._Epsilon?z.metallic:1,f=D.a.FromInts(255,p[f+1],p[f+2]),e.FuzzyEquals(f,D.a.White(),e._Epsilon)||(r=!0);r&&(p=this._createBase64FromCanvasAsync(p,a,b,c).then(function(a){z.metallicRoughnessTextureBase64=a}),h.push(p));
d&&(p=this._createBase64FromCanvasAsync(n,a,b,c).then(function(a){z.baseColorTextureBase64=a}),h.push(p));return Promise.all(h).then(function(){return z})}return Promise.reject("_ConvertSpecularGlossinessTexturesToMetallicRoughness: Scene from textures is missing!")};e.prototype._convertSpecularGlossinessToMetallicRoughness=function(a){var b=this._getPerceivedBrightness(a.diffuseColor),d=this._getPerceivedBrightness(a.specularColor),c=1-this._getMaxComponent(a.specularColor);b=e._SolveMetallic(b,
d,c);c=a.diffuseColor.scale(c/(1-e._DielectricSpecular.r)/Math.max(1-b,e._Epsilon));d=a.specularColor.subtract(e._DielectricSpecular.scale(1-b)).scale(1/Math.max(b,e._Epsilon));c=D.a.Lerp(c,d,b*b);c=c.clampToRef(0,1,c);return{baseColor:c,metallic:b,roughness:1-a.glossiness}};e.prototype._getPerceivedBrightness=function(a){return a?Math.sqrt(.299*a.r*a.r+.587*a.g*a.g+.114*a.b*a.b):0};e.prototype._getMaxComponent=function(a){return a?Math.max(a.r,Math.max(a.g,a.b)):0};e.prototype._convertMetalRoughFactorsToMetallicRoughnessAsync=
function(a,b,d,c){var h=[],e={baseColor:a.albedoColor,metallic:a.metallic,roughness:a.roughness};c&&(a.albedoTexture&&h.push(this._exportTextureAsync(a.albedoTexture,b).then(function(a){a&&(d.baseColorTexture=a)})),a.metallicTexture&&h.push(this._exportTextureAsync(a.metallicTexture,b).then(function(a){a&&(d.metallicRoughnessTexture=a)})));return Promise.all(h).then(function(){return e})};e.prototype._getGLTFTextureSampler=function(a){var b=this._getGLTFTextureWrapModesSampler(a);a=a instanceof B.a?
a.samplingMode:null;if(null!=a)switch(a){case B.a.LINEAR_LINEAR:b.magFilter=9729;b.minFilter=9729;break;case B.a.LINEAR_NEAREST:b.magFilter=9729;b.minFilter=9728;break;case B.a.NEAREST_LINEAR:b.magFilter=9728;b.minFilter=9729;break;case B.a.NEAREST_LINEAR_MIPLINEAR:b.magFilter=9728;b.minFilter=9987;break;case B.a.NEAREST_NEAREST:b.magFilter=9728;b.minFilter=9728;break;case B.a.NEAREST_LINEAR_MIPNEAREST:b.magFilter=9728;b.minFilter=9985;break;case B.a.LINEAR_NEAREST_MIPNEAREST:b.magFilter=9729;b.minFilter=
9984;break;case B.a.LINEAR_NEAREST_MIPLINEAR:b.magFilter=9729;b.minFilter=9986;break;case B.a.NEAREST_NEAREST_MIPLINEAR:b.magFilter=9728;b.minFilter=9986;break;case B.a.LINEAR_LINEAR_MIPLINEAR:b.magFilter=9729;b.minFilter=9987;break;case B.a.LINEAR_LINEAR_MIPNEAREST:b.magFilter=9729;b.minFilter=9985;break;case B.a.NEAREST_NEAREST_MIPNEAREST:b.magFilter=9728,b.minFilter=9984}return b};e.prototype._getGLTFTextureWrapMode=function(a){switch(a){case B.a.WRAP_ADDRESSMODE:return 10497;case B.a.CLAMP_ADDRESSMODE:return 33071;
case B.a.MIRROR_ADDRESSMODE:return 33648;default:return f.b.Error("Unsupported Texture Wrap Mode "+a+"!"),10497}};e.prototype._getGLTFTextureWrapModesSampler=function(a){var b=this._getGLTFTextureWrapMode(a instanceof B.a?a.wrapU:B.a.WRAP_ADDRESSMODE);a=this._getGLTFTextureWrapMode(a instanceof B.a?a.wrapV:B.a.WRAP_ADDRESSMODE);return 10497===b&&10497===a?{}:{wrapS:b,wrapT:a}};e.prototype._convertSpecGlossFactorsToMetallicRoughnessAsync=function(a,b,d,c){var h=this;return Promise.resolve().then(function(){var k=
h._exporter._samplers,e=h._exporter._textures,f={diffuseColor:a.albedoColor||D.a.White(),specularColor:a.reflectivityColor||D.a.White(),glossiness:a.microSurface||1},l=null,n=h._getGLTFTextureSampler(a.albedoTexture);null!=n.magFilter&&null!=n.minFilter&&null!=n.wrapS&&null!=n.wrapT&&(k.push(n),l=k.length-1);return a.reflectivityTexture&&!a.useMicroSurfaceFromReflectivityMapAlpha?Promise.reject("_ConvertPBRMaterial: Glossiness values not included in the reflectivity texture are currently not supported"):
(a.albedoTexture||a.reflectivityTexture)&&c?h._convertSpecularGlossinessTexturesToMetallicRoughnessAsync(a.albedoTexture,a.reflectivityTexture,f,b).then(function(c){if(c.baseColorTextureBase64){var k=h._getTextureInfoFromBase64(c.baseColorTextureBase64,"bjsBaseColorTexture_"+e.length+".png",b,a.albedoTexture?a.albedoTexture.coordinatesIndex:null,l);k&&(d.baseColorTexture=k)}c.metallicRoughnessTextureBase64&&(k=h._getTextureInfoFromBase64(c.metallicRoughnessTextureBase64,"bjsMetallicRoughnessTexture_"+
e.length+".png",b,a.reflectivityTexture?a.reflectivityTexture.coordinatesIndex:null,l))&&(d.metallicRoughnessTexture=k);return c}):h._convertSpecularGlossinessToMetallicRoughness(f)})};e.prototype._convertPBRMaterialAsync=function(a,b,d){var c=this,k={},e={name:a.name};return a.isMetallicWorkflow()?(a.albedoColor&&(k.baseColorFactor=[a.albedoColor.r,a.albedoColor.g,a.albedoColor.b,a.alpha]),this._convertMetalRoughFactorsToMetallicRoughnessAsync(a,b,k,d).then(function(h){return c.setMetallicRoughnessPbrMaterial(h,
a,e,k,b,d)})):this._convertSpecGlossFactorsToMetallicRoughnessAsync(a,b,k,d).then(function(h){return c.setMetallicRoughnessPbrMaterial(h,a,e,k,b,d)})};e.prototype.setMetallicRoughnessPbrMaterial=function(a,b,d,c,k,p){var h=this._exporter._materialMap,t=this._exporter._materials,l=[];a&&(e._SetAlphaMode(d,b),e.FuzzyEquals(a.baseColor,D.a.White(),e._Epsilon)&&b.alpha>=e._Epsilon||(c.baseColorFactor=[a.baseColor.r,a.baseColor.g,a.baseColor.b,b.alpha]),null!=a.metallic&&1!==a.metallic&&(c.metallicFactor=
a.metallic),null!=a.roughness&&1!==a.roughness&&(c.roughnessFactor=a.roughness),null==b.backFaceCulling||b.backFaceCulling||(b.twoSidedLighting||f.b.Warn(b.name+": Back-face culling enabled and two-sided lighting disabled is not supported in glTF."),d.doubleSided=!0),p&&(b.bumpTexture&&(a=this._exportTextureAsync(b.bumpTexture,k).then(function(a){a&&(d.normalTexture=a,1!==b.bumpTexture.level&&(d.normalTexture.scale=b.bumpTexture.level))}),l.push(a)),b.ambientTexture&&(a=this._exportTextureAsync(b.ambientTexture,
k).then(function(a){a&&(a={index:a.index,texCoord:a.texCoord},d.occlusionTexture=a,b.ambientTextureStrength&&(a.strength=b.ambientTextureStrength))}),l.push(a)),b.emissiveTexture&&(a=this._exportTextureAsync(b.emissiveTexture,k).then(function(a){a&&(d.emissiveTexture=a)}),l.push(a))),e.FuzzyEquals(b.emissiveColor,D.a.Black(),e._Epsilon)||(d.emissiveFactor=b.emissiveColor.asArray()),d.pbrMetallicRoughness=c,t.push(d),h[b.uniqueId]=t.length-1);return this._finishMaterial(l,d,b,k)};e.prototype.getPixelsFromTexture=
function(a){return a.readPixels()};e.prototype._exportTextureAsync=function(a,b){var d=this,c=this._exporter._extensionsPreExportTextureAsync("exporter",a,b);return c?c.then(function(c){return c?d._exportTextureInfoAsync(c,b):d._exportTextureInfoAsync(a,b)}):this._exportTextureInfoAsync(a,b)};e.prototype._exportTextureInfoAsync=function(a,b){var d=this;return Promise.resolve().then(function(){var c=a.uid;if(c in d._textureMap)return d._textureMap[c];var k=d.getPixelsFromTexture(a);if(!k)return null;
for(var e=d._exporter._samplers,f=d._getGLTFTextureSampler(a),t=null,l=null,n=0;n<e.length;++n){var g=e[n];if(g.minFilter===f.minFilter&&g.magFilter===f.magFilter&&g.wrapS===f.wrapS&&g.wrapT===f.wrapT){l=n;break}}null==l?(e.push(f),t=e.length-1):t=l;e=a.getSize();if(a.mimeType)switch(a.mimeType){case "image/jpeg":b="image/jpeg";break;case "image/png":b="image/png"}return d._createBase64FromCanvasAsync(k,e.width,e.height,b).then(function(h){if(h=d._getTextureInfoFromBase64(h,a.name.replace(/\.\/|\/|\.\\|\\/g,
"_"),b,a.coordinatesIndex,t))d._textureMap[c]=h,d._exporter._extensionsPostExportTextures("linkTextureInfo",h,a);return h})})};e.prototype._getTextureInfoFromBase64=function(a,b,d,c,k){var h=this._exporter._textures,e=this._exporter._images,t=this._exporter._imageData,l=null,n={source:e.length,name:b};null!=k&&(n.sampler=k);k=atob(a.split(",")[1]);a=new ArrayBuffer(k.length);var g=new Uint8Array(a);a=0;for(var m=k.length;a<m;++a)g[a]=k.charCodeAt(a);a={data:g,mimeType:d};g="image/jpeg"===d?".jpeg":
".png";k=m=b+g;m in t&&(m=b+"_"+f.b.RandomId()+g);t[m]=a;if("image/jpeg"===d||"image/png"===d){b={name:b,uri:m};d=null;for(a=0;a<e.length;++a)if(e[a].uri===k){d=a;break}null==d?(e.push(b),n.source=e.length-1):n.source=d;h.push(n);l={index:h.length-1};null!=c&&(l.texCoord=c)}else f.b.Error("Unsupported texture mime type "+d);return l};e._DielectricSpecular=new D.a(.04,.04,.04);e._MaxSpecularPower=1024;e._Epsilon=1E-6;return e}(),ma=m("JIAX"),na=m("MhaC"),M=function(){function e(a,b){this._includeCoordinateSystemConversionNodes=
!1;this._extensions={};this._glTF={asset:{generator:"BabylonJS",version:"2.0"}};this._babylonScene=a;this._bufferViews=[];this._accessors=[];this._meshes=[];this._scenes=[];this._nodes=[];this._images=[];this._materials=[];this._materialMap=[];this._textures=[];this._samplers=[];this._skins=[];this._animations=[];this._imageData={};this._orderedImageData=[];this._options=b||{};this._animationSampleRate=b&&b.animationSampleRate?b.animationSampleRate:1/60;this._includeCoordinateSystemConversionNodes=
b&&b.includeCoordinateSystemConversionNodes?!0:!1;this._glTFMaterialExporter=new la(this);this._loadExtensions()}e.prototype._applyExtension=function(a,b,d,c){var h=this;if(d>=b.length)return Promise.resolve(a);var e=c(b[d],a);return e?e.then(function(a){return h._applyExtension(a,b,d+1,c)}):this._applyExtension(a,b,d+1,c)};e.prototype._applyExtensions=function(a,b){for(var d=[],c=0,k=e._ExtensionNames;c<k.length;c++)d.push(this._extensions[k[c]]);return this._applyExtension(a,d,0,b)};e.prototype._extensionsPreExportTextureAsync=
function(a,b,d){return this._applyExtensions(b,function(b,c){return b.preExportTextureAsync&&b.preExportTextureAsync(a,c,d)})};e.prototype._extensionsPostExportMeshPrimitiveAsync=function(a,b,d,c){return this._applyExtensions(b,function(b,h){return b.postExportMeshPrimitiveAsync&&b.postExportMeshPrimitiveAsync(a,h,d,c)})};e.prototype._extensionsPostExportNodeAsync=function(a,b,d,c){return this._applyExtensions(b,function(b,h){return b.postExportNodeAsync&&b.postExportNodeAsync(a,h,d,c)})};e.prototype._extensionsPostExportMaterialAsync=
function(a,b,d){return this._applyExtensions(b,function(b,c){return b.postExportMaterialAsync&&b.postExportMaterialAsync(a,c,d)})};e.prototype._extensionsPostExportMaterialAdditionalTextures=function(a,b,d){for(var c=[],k=0,f=e._ExtensionNames;k<f.length;k++){var r=this._extensions[f[k]];r.postExportMaterialAdditionalTextures&&c.push.apply(c,r.postExportMaterialAdditionalTextures(a,b,d))}return c};e.prototype._extensionsPostExportTextures=function(a,b,d){for(var c=0,k=e._ExtensionNames;c<k.length;c++){var f=
this._extensions[k[c]];f.postExportTexture&&f.postExportTexture(a,b,d)}};e.prototype._forEachExtensions=function(a){for(var b=0,d=e._ExtensionNames;b<d.length;b++){var c=this._extensions[d[b]];c.enabled&&a(c)}};e.prototype._extensionsOnExporting=function(){var a=this;this._forEachExtensions(function(b){if(b.wasUsed&&(null==a._glTF.extensionsUsed&&(a._glTF.extensionsUsed=[]),-1===a._glTF.extensionsUsed.indexOf(b.name)&&a._glTF.extensionsUsed.push(b.name),b.required&&(null==a._glTF.extensionsRequired&&
(a._glTF.extensionsRequired=[]),-1===a._glTF.extensionsRequired.indexOf(b.name)&&a._glTF.extensionsRequired.push(b.name)),null==a._glTF.extensions&&(a._glTF.extensions={}),b.onExporting))b.onExporting()})};e.prototype._loadExtensions=function(){for(var a=0,b=e._ExtensionNames;a<b.length;a++){var d=b[a],c=e._ExtensionFactories[d](this);this._extensions[d]=c}};e.prototype.dispose=function(){for(var a in this._extensions)this._extensions[a].dispose()};e.RegisterExtension=function(a,b){e.UnregisterExtension(a)&&
f.b.Warn("Extension with the name "+a+" already exists");e._ExtensionFactories[a]=b;e._ExtensionNames.push(a)};e.UnregisterExtension=function(a){if(!e._ExtensionFactories[a])return!1;delete e._ExtensionFactories[a];a=e._ExtensionNames.indexOf(a);-1!==a&&e._ExtensionNames.splice(a,1);return!0};e.prototype._getLocalEngine=function(){if(!this._localEngine){var a=document.createElement("canvas");a.id="WriteCanvas";a.width=2048;a.height=2048;this._localEngine=new fa.a(a,!0,{premultipliedAlpha:f.b.IsSafari(),
preserveDrawingBuffer:!0});this._localEngine.setViewport(new ma.a(0,0,1,1))}return this._localEngine};e.prototype.reorderIndicesBasedOnPrimitiveMode=function(a,b,c,h,e){switch(b){case E.a.TriangleFillMode:h||(h=0);b=a.indexStart;for(c=a.indexStart+a.indexCount;b<c;b+=3){a=h+4*b;var d=e.getUInt32(a+4),k=e.getUInt32(a+8);e.setUInt32(k,a+4);e.setUInt32(d,a+8)}break;case E.a.TriangleFanDrawMode:b=a.indexStart+a.indexCount-1;for(a=a.indexStart;b>=a;--b)e.setUInt32(c[b],h),h+=4;break;case E.a.TriangleStripDrawMode:3<=
a.indexCount&&(e.setUInt32(c[a.indexStart+2],h+4),e.setUInt32(c[a.indexStart+1],h+8))}};e.prototype.reorderVertexAttributeDataBasedOnPrimitiveMode=function(a,b,c,h,e,f,r,g){if(g&&c===E.a.ClockWiseSideOrientation)switch(b){case E.a.TriangleFillMode:this.reorderTriangleFillMode(a,b,c,h,e,f,r,g);break;case E.a.TriangleStripDrawMode:this.reorderTriangleStripDrawMode(a,b,c,h,e,f,r,g);break;case E.a.TriangleFanDrawMode:this.reorderTriangleFanMode(a,b,c,h,e,f,r,g)}};e.prototype.reorderTriangleFillMode=function(a,
b,d,h,e,p,r,g){var l=this.getVertexBufferFromMesh(h,a.getMesh());if(l)if(b=l.byteStride/v.b.GetTypeByteLength(l.type),0!==a.verticesCount%3)f.b.Error("The submesh vertices for the triangle fill mode is not divisible by 3!");else{d=[];switch(h){case v.b.PositionKind:case v.b.NormalKind:for(var k=a.verticesStart;k<a.verticesStart+a.verticesCount;k+=3)l=k*b,d.push(c.e.FromArray(e,l)),d.push(c.e.FromArray(e,l+2*b)),d.push(c.e.FromArray(e,l+b));break;case v.b.TangentKind:for(k=a.verticesStart;k<a.verticesStart+
a.verticesCount;k+=3)l=k*b,d.push(c.f.FromArray(e,l)),d.push(c.f.FromArray(e,l+2*b)),d.push(c.f.FromArray(e,l+b));break;case v.b.ColorKind:var t=l.getSize();for(k=a.verticesStart;k<a.verticesStart+a.verticesCount;k+=t)l=k*b,4===t?(d.push(c.f.FromArray(e,l)),d.push(c.f.FromArray(e,l+2*b)),d.push(c.f.FromArray(e,l+b))):(d.push(c.e.FromArray(e,l)),d.push(c.e.FromArray(e,l+2*b)),d.push(c.e.FromArray(e,l+b)));break;case v.b.UVKind:case v.b.UV2Kind:for(k=a.verticesStart;k<a.verticesStart+a.verticesCount;k+=
3)l=k*b,d.push(c.d.FromArray(e,l)),d.push(c.d.FromArray(e,l+2*b)),d.push(c.d.FromArray(e,l+b));break;default:f.b.Error("Unsupported Vertex Buffer type: "+h)}this.writeVertexAttributeData(d,p,h,e,r,g)}else f.b.Warn("reorderTriangleFillMode: Vertex Buffer Kind "+h+" not present!")};e.prototype.reorderTriangleStripDrawMode=function(a,b,d,h,e,p,r,g){if(b=this.getVertexBufferFromMesh(h,a.getMesh())){d=b.byteStride/v.b.GetTypeByteLength(b.type);var k=[];switch(h){case v.b.PositionKind:case v.b.NormalKind:var n=
a.verticesStart;k.push(c.e.FromArray(e,n+2*d));k.push(c.e.FromArray(e,n+d));break;case v.b.TangentKind:for(var t=a.verticesStart+a.verticesCount-1;t>=a.verticesStart;--t)n=t*d,k.push(c.f.FromArray(e,n));break;case v.b.ColorKind:for(t=a.verticesStart+a.verticesCount-1;t>=a.verticesStart;--t)n=t*d,4===b.getSize()?k.push(c.f.FromArray(e,n)):k.push(c.e.FromArray(e,n));break;case v.b.UVKind:case v.b.UV2Kind:for(t=a.verticesStart+a.verticesCount-1;t>=a.verticesStart;--t)n=t*d,k.push(c.d.FromArray(e,n));
break;default:f.b.Error("Unsupported Vertex Buffer type: "+h)}this.writeVertexAttributeData(k,p+12,h,e,r,g)}else f.b.Warn("reorderTriangleStripDrawMode: Vertex buffer kind "+h+" not present!")};e.prototype.reorderTriangleFanMode=function(a,b,d,h,e,p,r,g){if(b=this.getVertexBufferFromMesh(h,a.getMesh())){d=b.byteStride/v.b.GetTypeByteLength(b.type);var k=[];switch(h){case v.b.PositionKind:case v.b.NormalKind:for(var n=a.verticesStart+a.verticesCount-1;n>=a.verticesStart;--n){var t=n*d;k.push(c.e.FromArray(e,
t))}break;case v.b.TangentKind:for(n=a.verticesStart+a.verticesCount-1;n>=a.verticesStart;--n)t=n*d,k.push(c.f.FromArray(e,t));break;case v.b.ColorKind:for(n=a.verticesStart+a.verticesCount-1;n>=a.verticesStart;--n)t=n*d,k.push(c.f.FromArray(e,t)),4===b.getSize()?k.push(c.f.FromArray(e,t)):k.push(c.e.FromArray(e,t));break;case v.b.UVKind:case v.b.UV2Kind:for(n=a.verticesStart+a.verticesCount-1;n>=a.verticesStart;--n)t=n*d,k.push(c.d.FromArray(e,t));break;default:f.b.Error("Unsupported Vertex Buffer type: "+
h)}this.writeVertexAttributeData(k,p,h,e,r,g)}else f.b.Warn("reorderTriangleFanMode: Vertex buffer kind "+h+" not present!")};e.prototype.writeVertexAttributeData=function(a,b,d,h,e,p){for(h=0;h<a.length;h++){var k=a[h];!p||d===v.b.ColorKind||k instanceof c.d||(k instanceof c.e?d===v.b.NormalKind?q._GetRightHandedNormalVector3FromRef(k):d===v.b.PositionKind?q._GetRightHandedPositionVector3FromRef(k):f.b.Error("Unsupported vertex attribute kind!"):q._GetRightHandedVector4FromRef(k));d===v.b.NormalKind?
k.normalize():d===v.b.TangentKind&&k instanceof c.f&&q._NormalizeTangentFromRef(k);var t=0;for(k=k.asArray();t<k.length;t++)e.setFloat32(k[t],b),b+=4}};e.prototype.writeAttributeData=function(a,b,d,h,e,p,r){var k=[];switch(a){case v.b.PositionKind:r=0;for(var l=d.length/h;r<l;++r){a=r*h;var n=c.e.FromArray(d,a);p&&q._GetRightHandedPositionVector3FromRef(n);k.push(n.asArray())}break;case v.b.NormalKind:r=0;for(l=d.length/h;r<l;++r)a=r*h,n=c.e.FromArray(d,a),p&&q._GetRightHandedNormalVector3FromRef(n),
n.normalize(),k.push(n.asArray());break;case v.b.TangentKind:r=0;for(l=d.length/h;r<l;++r)a=r*h,n=c.f.FromArray(d,a),p&&q._GetRightHandedVector4FromRef(n),q._NormalizeTangentFromRef(n),k.push(n.asArray());break;case v.b.ColorKind:p=(a=r.material)?a instanceof X.a:!0;n=3===h?new D.a:new D.b;r=0;for(l=d.length/h;r<l;++r)a=r*h,3===h?D.a.FromArrayToRef(d,a,n):D.b.FromArrayToRef(d,a,n),p&&n.toLinearSpaceToRef(n),k.push(n.asArray());break;case v.b.UVKind:case v.b.UV2Kind:r=0;for(n=d.length/h;r<n;++r)a=
r*h,k.push([d[a],d[a+1]]);break;case v.b.MatricesIndicesKind:case v.b.MatricesIndicesExtraKind:r=0;for(p=d.length/h;r<p;++r)a=r*h,n=c.f.FromArray(d,a),k.push(n.asArray());break;case v.b.MatricesWeightsKind:case v.b.MatricesWeightsExtraKind:r=0;for(p=d.length/h;r<p;++r)a=r*h,n=c.f.FromArray(d,a),k.push(n.asArray());break;default:f.b.Warn("Unsupported Vertex Buffer Type: "+a),k=[]}switch(b){case 5121:b=e.setUInt8.bind(e);break;case 5123:b=e.setUInt16.bind(e);break;case 5125:e.setUInt32.bind(e);case 5126:b=
e.setFloat32.bind(e);break;default:f.b.Warn("Unsupported Attribute Component kind: "+b);return}for(d=0;d<k.length;d++)for(h=0,e=k[d];h<e.length;h++)b(e[h])};e.prototype.writeMorphTargetAttributeData=function(a,b,d,e,k,p,r,g,l,n){e=[];var h=new c.e,t=new c.f(0,0,0,0);switch(a){case v.b.PositionKind:for(a=d.verticesStart;a<d.verticesCount;++a){var x=d.indexStart+a*r;var m=c.e.FromArray(k,x);x=c.e.FromArray(p,x);h=x.subtractToRef(m,h);l&&q._GetRightHandedPositionVector3FromRef(h);n&&(n.min.copyFromFloats(Math.min(h.x,
n.min.x),Math.min(h.y,n.min.y),Math.min(h.z,n.min.z)),n.max.copyFromFloats(Math.max(h.x,n.max.x),Math.max(h.y,n.max.y),Math.max(h.z,n.max.z)));e.push(h.asArray())}break;case v.b.NormalKind:for(a=d.verticesStart;a<d.verticesCount;++a)x=d.indexStart+a*r,m=c.e.FromArray(k,x),m.normalize(),x=c.e.FromArray(p,x),x.normalize(),h=x.subtractToRef(m,h),l&&q._GetRightHandedNormalVector3FromRef(h),e.push(h.asArray());break;case v.b.TangentKind:for(a=d.verticesStart;a<d.verticesCount;++a)x=d.indexStart+a*(r+1),
m=c.f.FromArray(k,x),q._NormalizeTangentFromRef(m),x=c.f.FromArray(p,x),q._NormalizeTangentFromRef(x),t=x.subtractToRef(m,t),l&&q._GetRightHandedVector4FromRef(t),e.push([t.x,t.y,t.z]);break;default:f.b.Warn("Unsupported Vertex Buffer Type: "+a),e=[]}switch(b){case 5121:b=g.setUInt8.bind(g);break;case 5123:b=g.setUInt16.bind(g);break;case 5125:g.setUInt32.bind(g);case 5126:b=g.setFloat32.bind(g);break;default:f.b.Warn("Unsupported Attribute Component kind: "+b);return}for(d=0;d<e.length;d++)for(k=
0,p=e[d];k<p.length;k++)b(p[k])};e.prototype.generateJSON=function(a,b,c){var d=this,e={byteLength:this._totalByteLength},f,r,g,l=this._totalByteLength;e.byteLength&&(this._glTF.buffers=[e]);this._nodes&&this._nodes.length&&(this._glTF.nodes=this._nodes);this._meshes&&this._meshes.length&&(this._glTF.meshes=this._meshes);this._scenes&&this._scenes.length&&(this._glTF.scenes=this._scenes,this._glTF.scene=0);this._bufferViews&&this._bufferViews.length&&(this._glTF.bufferViews=this._bufferViews);this._accessors&&
this._accessors.length&&(this._glTF.accessors=this._accessors);this._animations&&this._animations.length&&(this._glTF.animations=this._animations);this._materials&&this._materials.length&&(this._glTF.materials=this._materials);this._textures&&this._textures.length&&(this._glTF.textures=this._textures);this._samplers&&this._samplers.length&&(this._glTF.samplers=this._samplers);this._skins&&this._skins.length&&(this._glTF.skins=this._skins);this._images&&this._images.length&&(a?(this._glTF.images=[],
this._images.forEach(function(a){a.uri&&(r=d._imageData[a.uri],d._orderedImageData.push(r),f=a.uri.split(".")[0]+" image",g=q._CreateBufferView(0,l,r.data.length,void 0,f),l+=r.data.buffer.byteLength,d._bufferViews.push(g),a.bufferView=d._bufferViews.length-1,a.name=f,a.mimeType=r.mimeType,a.uri=void 0,d._glTF.images||(d._glTF.images=[]),d._glTF.images.push(a))}),e.byteLength=l):this._glTF.images=this._images);a||(e.uri=b+".bin");return c?JSON.stringify(this._glTF,null,2):JSON.stringify(this._glTF)};
e.prototype._generateGLTFAsync=function(a,b){var c=this;void 0===b&&(b=!0);return this._generateBinaryAsync().then(function(d){c._extensionsOnExporting();var e=c.generateJSON(!1,a,!0);d=new Blob([d],{type:"application/octet-stream"});var h=a+".gltf",f=a+".bin",g=new Y;g.glTFFiles[h]=e;g.glTFFiles[f]=d;if(c._imageData)for(var l in c._imageData)g.glTFFiles[l]=new Blob([c._imageData[l].data],{type:c._imageData[l].mimeType});b&&c.dispose();return g})};e.prototype._generateBinaryAsync=function(){var a=
this,b=new oa(4);return this.createSceneAsync(this._babylonScene,b).then(function(){a._localEngine&&a._localEngine.dispose();return b.getArrayBuffer()})};e.prototype._getPadding=function(a){a%=4;return 0===a?a:4-a};e.prototype._generateGLBAsync=function(a,b){var c=this;void 0===b&&(b=!0);return this._generateBinaryAsync().then(function(d){c._extensionsOnExporting();for(var e=c.generateJSON(!0),h=a+".glb",f=e.length,g=0,l=0;l<c._orderedImageData.length;++l)g+=c._orderedImageData[l].data.byteLength;
var n=c._getPadding(f),m=c._getPadding(d.byteLength),q=c._getPadding(g),x=28+f+n+d.byteLength+m+g+q,u=new ArrayBuffer(12);l=new DataView(u);l.setUint32(0,1179937895,!0);l.setUint32(4,2,!0);l.setUint32(8,x,!0);x=new ArrayBuffer(8+f+n);l=new DataView(x);l.setUint32(0,f+n,!0);l.setUint32(4,1313821514,!0);var v=new Uint8Array(x,8);for(l=0;l<f;++l)v[l]=e.charCodeAt(l);e=new Uint8Array(x,8+f);for(l=0;l<n;++l)e[l]=32;n=new ArrayBuffer(8);l=new DataView(n);l.setUint32(0,d.byteLength+g+q,!0);l.setUint32(4,
5130562,!0);g=new ArrayBuffer(m);e=new Uint8Array(g);for(l=0;l<m;++l)e[l]=0;m=new ArrayBuffer(q);e=new Uint8Array(m);for(l=0;l<q;++l)e[l]=0;d=[u,x,n,d];for(l=0;l<c._orderedImageData.length;++l)d.push(c._orderedImageData[l].data.buffer);d.push(g);d.push(m);d=new Blob(d,{type:"application/octet-stream"});q=new Y;q.glTFFiles[h]=d;null!=c._localEngine&&c._localEngine.dispose();b&&c.dispose();return q})};e.prototype.setNodeTransformation=function(a,b,d){b.getPivotPoint().equalsToFloats(0,0,0)||f.b.Warn("Pivot points are not supported in the glTF serializer");
b.position.equalsToFloats(0,0,0)||(a.translation=d?q._GetRightHandedPositionVector3(b.position).asArray():b.position.asArray());b.scaling.equalsToFloats(1,1,1)||(a.scale=b.scaling.asArray());var e=c.b.RotationYawPitchRoll(b.rotation.y,b.rotation.x,b.rotation.z);b.rotationQuaternion&&e.multiplyInPlace(b.rotationQuaternion);if(0!==e.x||0!==e.y||0!==e.z||1!==e.w)d&&q._GetRightHandedQuaternionFromRef(e),a.rotation=e.normalize().asArray()};e.prototype.getVertexBufferFromMesh=function(a,b){return b.isVerticesDataPresent(a)&&
(a=b.getVertexBuffer(a))?a:null};e.prototype.createBufferViewKind=function(a,b,c,e,f,g){var d=c instanceof J.a?c:c instanceof W.a?c.sourceMesh:null;if(d){var h=d.getVertexBuffer(a),k=d.getVerticesData(a);if(h&&k){h=v.b.GetTypeByteLength(b);var n=k.length*h;d=q._CreateBufferView(0,e.getByteOffset(),n,f,a+" - "+d.name);this._bufferViews.push(d);this.writeAttributeData(a,b,k,f/h,e,g,c)}}};e.prototype.setMorphTargetAttributes=function(a,b,d,e,f){if(d){b.targets||(b.targets=[]);var h={};if(d.hasNormals){var k=
a.getMesh().getVerticesData(v.b.NormalKind),g=d.getNormals(),l=a.verticesCount,n=12,m=l*n;m=q._CreateBufferView(0,e.getByteOffset(),m,n,d.name+"_NORMAL");this._bufferViews.push(m);m=this._bufferViews.length-1;l=q._CreateAccessor(m,d.name+" - NORMAL","VEC3",5126,l,0,null,null);this._accessors.push(l);h.NORMAL=this._accessors.length-1;this.writeMorphTargetAttributeData(v.b.NormalKind,5126,a,d,k,g,n/4,e,f)}if(d.hasPositions){k=a.getMesh().getVerticesData(v.b.PositionKind);g=d.getPositions();l=a.verticesCount;
n=12;m=l*n;m=q._CreateBufferView(0,e.getByteOffset(),m,n,d.name+"_POSITION");this._bufferViews.push(m);m=this._bufferViews.length-1;var w={min:new c.e(Infinity,Infinity,Infinity),max:new c.e(-Infinity,-Infinity,-Infinity)};l=q._CreateAccessor(m,d.name+" - POSITION","VEC3",5126,l,0,null,null);this._accessors.push(l);h.POSITION=this._accessors.length-1;this.writeMorphTargetAttributeData(v.b.PositionKind,5126,a,d,k,g,n/4,e,f,w);l.min=w.min.asArray();l.max=w.max.asArray()}d.hasTangents&&(k=a.getMesh().getVerticesData(v.b.TangentKind),
g=d.getTangents(),l=a.verticesCount,n=12,m=l*n,m=q._CreateBufferView(0,e.getByteOffset(),m,n,d.name+"_NORMAL"),this._bufferViews.push(m),m=this._bufferViews.length-1,l=q._CreateAccessor(m,d.name+" - TANGENT","VEC3",5126,l,0,null,null),this._accessors.push(l),h.TANGENT=this._accessors.length-1,this.writeMorphTargetAttributeData(v.b.TangentKind,5126,a,d,k,g,n/4,e,f));b.targets.push(h)}};e.prototype.getMeshPrimitiveMode=function(a){return a instanceof Z.b?E.a.LineListDrawMode:a.material?a.material.fillMode:
E.a.TriangleFillMode};e.prototype.setPrimitiveMode=function(a,b){switch(b){case E.a.TriangleStripDrawMode:a.mode=5;break;case E.a.TriangleFanDrawMode:a.mode=6;break;case E.a.PointListDrawMode:a.mode=0;case E.a.PointFillMode:a.mode=0;break;case E.a.LineLoopDrawMode:a.mode=2;break;case E.a.LineListDrawMode:a.mode=1;break;case E.a.LineStripDrawMode:a.mode=3}};e.prototype.setAttributeKind=function(a,b){switch(b){case v.b.PositionKind:a.attributes.POSITION=this._accessors.length-1;break;case v.b.NormalKind:a.attributes.NORMAL=
this._accessors.length-1;break;case v.b.ColorKind:a.attributes.COLOR_0=this._accessors.length-1;break;case v.b.TangentKind:a.attributes.TANGENT=this._accessors.length-1;break;case v.b.UVKind:a.attributes.TEXCOORD_0=this._accessors.length-1;break;case v.b.UV2Kind:a.attributes.TEXCOORD_1=this._accessors.length-1;break;case v.b.MatricesIndicesKind:a.attributes.JOINTS_0=this._accessors.length-1;break;case v.b.MatricesIndicesExtraKind:a.attributes.JOINTS_1=this._accessors.length-1;break;case v.b.MatricesWeightsKind:a.attributes.WEIGHTS_0=
this._accessors.length-1;break;case v.b.MatricesWeightsExtraKind:a.attributes.WEIGHTS_1=this._accessors.length-1;break;default:f.b.Warn("Unsupported Vertex Buffer Type: "+b)}};e.prototype.setPrimitiveAttributesAsync=function(a,b,c,e){var d,h=[],f=null;b instanceof J.a?f=b:b instanceof W.a&&(f=b.sourceMesh);var g=[{kind:v.b.PositionKind,accessorType:"VEC3",accessorComponentType:5126,byteStride:12},{kind:v.b.NormalKind,accessorType:"VEC3",accessorComponentType:5126,byteStride:12},{kind:v.b.ColorKind,
accessorType:"VEC4",accessorComponentType:5126,byteStride:16},{kind:v.b.TangentKind,accessorType:"VEC4",accessorComponentType:5126,byteStride:16},{kind:v.b.UVKind,accessorType:"VEC2",accessorComponentType:5126,byteStride:8},{kind:v.b.UV2Kind,accessorType:"VEC2",accessorComponentType:5126,byteStride:8},{kind:v.b.MatricesIndicesKind,accessorType:"VEC4",accessorComponentType:5123,byteStride:8},{kind:v.b.MatricesIndicesExtraKind,accessorType:"VEC4",accessorComponentType:5123,byteStride:8},{kind:v.b.MatricesWeightsKind,
accessorType:"VEC4",accessorComponentType:5126,byteStride:16},{kind:v.b.MatricesWeightsExtraKind,accessorType:"VEC4",accessorComponentType:5126,byteStride:16}];if(f){var l=null;for(var n=this.getMeshPrimitiveMode(f),m={},w=f.morphTargetManager,x=0;x<g.length;x++){var u=g[x],y=u.kind,N=u.accessorComponentType;if(f.isVerticesDataPresent(y)){var O=this.getVertexBufferFromMesh(y,f);u.byteStride=O?O.getSize()*v.b.GetTypeByteLength(u.accessorComponentType):4*v.b.DeduceStride(y);12===u.byteStride&&(u.accessorType=
"VEC3");this.createBufferViewKind(y,N,b,c,u.byteStride,e);u.bufferViewIndex=this._bufferViews.length-1;m[y]=u.bufferViewIndex}}if(f.getTotalIndices()&&(x=f.getIndices())){l=4*x.length;l=q._CreateBufferView(0,c.getByteOffset(),l,void 0,"Indices - "+f.name);this._bufferViews.push(l);l=this._bufferViews.length-1;N=0;for(var H=x.length;N<H;++N)c.setUInt32(x[N])}if(f.subMeshes)for(x=0,N=f.subMeshes;x<N.length;x++){H=N[x];var z=H.getMaterial()||f.getScene().defaultMaterial,A=null;if(z)if(f instanceof Z.b){var B=
{name:f.name+" material"};if(!f.color.equals(D.a.White())||1>f.alpha)B.pbrMetallicRoughness={baseColorFactor:f.color.asArray().concat([f.alpha])};this._materials.push(B);A=this._materials.length-1}else if(z instanceof ea.a){if(B=z.subMaterials[H.materialIndex])z=B,A=this._materialMap[z.uniqueId]}else A=this._materialMap[z.uniqueId];var C=null!=A?this._materials[A]:null;B={attributes:{}};this.setPrimitiveMode(B,n);for(var F=0,L=g;F<L.length;F++)if(u=L[F],y=u.kind,y!==v.b.UVKind&&y!==v.b.UV2Kind||!C||
this._glTFMaterialExporter._hasTexturesPresent(C)){var K=f.getVerticesData(y);if(K&&(O=this.getVertexBufferFromMesh(y,f))){var M=O.getSize(),P=u.bufferViewIndex;void 0!=P&&(O={min:null,max:null},y==v.b.PositionKind&&(O=q._CalculateMinMaxPositions(K,0,K.length/M,e)),u=q._CreateAccessor(P,y+" - "+b.name,u.accessorType,u.accessorComponentType,K.length/M,0,O.min,O.max),this._accessors.push(u),this.setAttributeKind(B,y))}}l&&(u=q._CreateAccessor(l,"indices - "+b.name,"SCALAR",5125,H.indexCount,4*H.indexStart,
null,null),this._accessors.push(u),B.indices=this._accessors.length-1);if(null!=A&&0<Object.keys(B.attributes).length){y=null!==f.overrideMaterialSideOrientation?f.overrideMaterialSideOrientation:z.sideOrientation;if(y==E.a.ClockWiseSideOrientation&&this._babylonScene.useRightHandedSystem||y==E.a.ClockWiseSideOrientation&&e&&f.overrideMaterialSideOrientation!==(null===(d=f.material)||void 0===d?void 0:d.sideOrientation))if(u=null!=l?this._bufferViews[l].byteOffset:null,null==u&&(u=0),K=null,null!=
l&&(K=f.getIndices()),K)this.reorderIndicesBasedOnPrimitiveMode(H,n,K,u,c);else for(z=0,C=g;z<C.length;z++)if(u=C[z],K=f.getVerticesData(u.kind))(F=this._bufferViews[m[u.kind]].byteOffset)||(F=0),this.reorderVertexAttributeDataBasedOnPrimitiveMode(H,n,y,u.kind,K,F,c,e);B.material=A}if(w)for(A=void 0,u=0;u<w.numTargets;++u)A=w.getTarget(u),this.setMorphTargetAttributes(H,B,A,c,e);a.primitives.push(B);this._extensionsPostExportMeshPrimitiveAsync("postExport",B,H,c)&&h.push()}}return Promise.all(h).then(function(){})};
e.prototype.isBabylonCoordinateSystemConvertingNode=function(a){if(a instanceof C.a){if("__root__"!==a.name)return!1;var b=a.getWorldMatrix(),d=c.a.Compose(this._convertToRightHandedSystem?new c.e(-1,1,1):c.e.One(),c.b.Identity(),c.e.Zero());b=b.multiply(d);d=c.a.IdentityReadOnly;for(var e=0;16>e;e++)if(Math.abs(b.m[e]-d.m[e])>na.a)return!1;return a instanceof J.a&&null!==a.geometry||a instanceof W.a&&null!==a.sourceMesh.geometry||this._includeCoordinateSystemConversionNodes?!1:!0}return!1};e.prototype.createSceneAsync=
function(a,b){var d=this,e={nodes:[]},k,g,r,m=Object(V.d)(a.transformNodes,a.meshes,a.lights),l=[];this._convertToRightHandedSystem=!a.useRightHandedSystem;this._convertToRightHandedSystemMap={};a.rootNodes.forEach(function(a){d._convertToRightHandedSystemMap[a.uniqueId]=d._convertToRightHandedSystem;a.getDescendants(!1).forEach(function(a){d._convertToRightHandedSystemMap[a.uniqueId]=d._convertToRightHandedSystem})});a.rootNodes.forEach(function(a){if(d.isBabylonCoordinateSystemConvertingNode(a)){l.push(a);
var b=m.indexOf(a);-1!==b&&m.splice(b,1);a.getDescendants(!1).forEach(function(a){d._convertToRightHandedSystemMap[a.uniqueId]=!1})}});return this._glTFMaterialExporter._convertMaterialsToGLTFAsync(a.materials,"image/png",!0).then(function(){return d.createNodeMapAndAnimationsAsync(a,m,b).then(function(h){return d.createSkinsAsync(a,h,b).then(function(a){d._nodeMap=h;d._totalByteLength=b.getByteOffset();if(void 0==d._totalByteLength)throw Error("undefined byte length!");for(var n=0;n<m.length;n++){var p=
m[n];k=d._nodeMap[p.uniqueId];if(void 0!==k){g=d._nodes[k];p.metadata&&(d._options.metadataSelector?g.extras=d._options.metadataSelector(p.metadata):p.metadata.gltf&&(g.extras=p.metadata.gltf.extras));p.parent&&-1===l.indexOf(p.parent)||(d._options.shouldExportNode&&!d._options.shouldExportNode(p)?f.b.Log("Omitting "+p.name+" from scene."):(d._convertToRightHandedSystemMap[p.uniqueId]&&(g.translation&&(g.translation[2]*=-1,g.translation[0]*=-1),g.rotation=g.rotation?c.b.FromArray([0,1,0,0]).multiply(c.b.FromArray(g.rotation)).asArray():
c.b.FromArray([0,1,0,0]).asArray()),e.nodes.push(k)));if(p instanceof J.a){var t=p;t.skeleton&&(g.skin=a[t.skeleton.uniqueId])}r=p.getDescendants(!0);if(!g.children&&r&&r.length){p=[];t=0;for(var q=r;t<q.length;t++){var v=q[t];null!=d._nodeMap[v.uniqueId]&&p.push(d._nodeMap[v.uniqueId])}p.length&&(g.children=p)}}}e.nodes.length&&d._scenes.push(e)})})})};e.prototype.createNodeMapAndAnimationsAsync=function(a,b,c){for(var d=this,e=Promise.resolve(),g={},m,t={name:"runtime animations",channels:[],samplers:[]},
l=[],n=function(b){!q._options.shouldExportNode||q._options.shouldExportNode(b)?e=e.then(function(){var e=d._convertToRightHandedSystemMap[b.uniqueId];return d.createNodeAsync(b,c,e,g).then(function(h){h=d._extensionsPostExportNodeAsync("createNodeAsync",h,b,g);return null==h?(f.b.Warn("Not exporting node "+b.name),Promise.resolve()):h.then(function(f){f&&(d._nodes.push(f),m=d._nodes.length-1,g[b.uniqueId]=m,a.animationGroups.length||(U._CreateMorphTargetAnimationFromMorphTargetAnimations(b,t,l,g,
d._nodes,c,d._bufferViews,d._accessors,e,d._animationSampleRate),b.animations.length&&U._CreateNodeAnimationFromNodeAnimations(b,t,l,g,d._nodes,c,d._bufferViews,d._accessors,e,d._animationSampleRate)))})})}):"Excluding node "+b.name},q=this,v=0;v<b.length;v++)n(b[v]);return e.then(function(){t.channels.length&&t.samplers.length&&d._animations.push(t);l.forEach(function(a){a.channels.length&&a.samplers.length&&d._animations.push(a)});a.animationGroups.length&&U._CreateNodeAndMorphAnimationFromAnimationGroups(a,
d._animations,g,d._nodes,c,d._bufferViews,d._accessors,d._convertToRightHandedSystemMap,d._animationSampleRate);return g})};e.prototype.createNodeAsync=function(a,b,c,e){var d=this;return Promise.resolve().then(function(){var e={},f={primitives:[]};a.name&&(e.name=a.name);if(a instanceof C.a){d.setNodeTransformation(e,a,c);if(a instanceof J.a){var h=a.morphTargetManager;if(h&&0<h.numTargets){f.weights=[];for(var g=0;g<h.numTargets;++g)f.weights.push(h.getTarget(g).influence)}}return d.setPrimitiveAttributesAsync(f,
a,b,c).then(function(){f.primitives.length&&(d._meshes.push(f),e.mesh=d._meshes.length-1);return e})}return e})};e.prototype.createSkinsAsync=function(a,b,c){for(var d=Promise.resolve(),e={},f=function(d){var f={joints:[]},h=[],k=a.meshes.find(function(a){a.skeleton===d});f.skeleton=null===d.overrideMesh?k?b[k.uniqueId]:void 0:b[d.overrideMesh.uniqueId];k={};for(var l=-1,n=-1,m=0,p=d.bones;m<p.length;m++){var r=p[m];n=r.getIndex();-1<n&&(k[n]=r);l=Math.max(l,n)}for(n=0;n<=l;++n)if(r=k[n],m=r.getTransformNode())r=
r.getInvertedAbsoluteTransform(),g._convertToRightHandedSystem&&q._GetRightHandedMatrixFromRef(r),h.push(r),f.joints.push(b[m.uniqueId]);k=64*h.length;l=c.getByteOffset();k=q._CreateBufferView(0,l,k,64,"InverseBindMatrices - "+d.name);g._bufferViews.push(k);k=q._CreateAccessor(g._bufferViews.length-1,"InverseBindMatrices - "+d.name,"MAT4",5126,h.length,null,null,null);k=g._accessors.push(k)-1;f.inverseBindMatrices=k;g._skins.push(f);e[d.uniqueId]=g._skins.length-1;h.forEach(function(a){a.m.forEach(function(a){c.setFloat32(a)})})},
g=this,m=0,l=a.skeletons;m<l.length;m++)f(l[m]);return d.then(function(){return e})};e._ExtensionNames=[];e._ExtensionFactories={};return e}(),oa=function(){function c(a){this._arrayBuffer=new ArrayBuffer(a);this._dataView=new DataView(this._arrayBuffer);this._byteOffset=0}c.prototype.resizeBuffer=function(a){a=new ArrayBuffer(a);for(var b=new Uint8Array(this._arrayBuffer),c=new Uint8Array(a),e=0,f=c.byteLength;e<f;++e)c[e]=b[e];this._arrayBuffer=a;this._dataView=new DataView(this._arrayBuffer);return a};
c.prototype.getArrayBuffer=function(){return this.resizeBuffer(this.getByteOffset())};c.prototype.getByteOffset=function(){if(void 0==this._byteOffset)throw Error("Byte offset is undefined!");return this._byteOffset};c.prototype.setUInt8=function(a,b){null!=b?b<this._byteOffset?this._dataView.setUint8(b,a):f.b.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+1>this._arrayBuffer.byteLength&&this.resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint8(this._byteOffset,
a),this._byteOffset+=1)};c.prototype.setUInt16=function(a,b){null!=b?b<this._byteOffset?this._dataView.setUint16(b,a,!0):f.b.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+2>this._arrayBuffer.byteLength&&this.resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint16(this._byteOffset,a,!0),this._byteOffset+=2)};c.prototype.getUInt32=function(a){if(a<this._byteOffset)return this._dataView.getUint32(a,!0);f.b.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!");
throw Error("BinaryWriter: byteoffset is greater than the current binary buffer length!");};c.prototype.getVector3Float32FromRef=function(a,b){b+8>this._byteOffset?f.b.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(a.x=this._dataView.getFloat32(b,!0),a.y=this._dataView.getFloat32(b+4,!0),a.z=this._dataView.getFloat32(b+8,!0))};c.prototype.setVector3Float32FromRef=function(a,b){b+8>this._byteOffset?f.b.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):
(this._dataView.setFloat32(b,a.x,!0),this._dataView.setFloat32(b+4,a.y,!0),this._dataView.setFloat32(b+8,a.z,!0))};c.prototype.getVector4Float32FromRef=function(a,b){b+12>this._byteOffset?f.b.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(a.x=this._dataView.getFloat32(b,!0),a.y=this._dataView.getFloat32(b+4,!0),a.z=this._dataView.getFloat32(b+8,!0),a.w=this._dataView.getFloat32(b+12,!0))};c.prototype.setVector4Float32FromRef=function(a,b){b+12>this._byteOffset?
f.b.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._dataView.setFloat32(b,a.x,!0),this._dataView.setFloat32(b+4,a.y,!0),this._dataView.setFloat32(b+8,a.z,!0),this._dataView.setFloat32(b+12,a.w,!0))};c.prototype.setFloat32=function(a,b){isNaN(a)&&f.b.Error("Invalid data being written!");null!=b&&(b<this._byteOffset?this._dataView.setFloat32(b,a,!0):f.b.Error("BinaryWriter: byteoffset is greater than the current binary length!"));this._byteOffset+4>this._arrayBuffer.byteLength&&
this.resizeBuffer(2*this._arrayBuffer.byteLength);this._dataView.setFloat32(this._byteOffset,a,!0);this._byteOffset+=4};c.prototype.setUInt32=function(a,b){null!=b?b<this._byteOffset?this._dataView.setUint32(b,a,!0):f.b.Error("BinaryWriter: byteoffset is greater than the current binary buffer length!"):(this._byteOffset+4>this._arrayBuffer.byteLength&&this.resizeBuffer(2*this._arrayBuffer.byteLength),this._dataView.setUint32(this._byteOffset,a,!0),this._byteOffset+=4)};return c}(),ca=function(){function c(){}
c.GLTFAsync=function(a,b,c){return a.whenReadyAsync().then(function(){var d=b.replace(/\.[^/.]+$/,"");return(new M(a,c))._generateGLTFAsync(d)})};c._PreExportAsync=function(a,b){return Promise.resolve().then(function(){return b&&b.exportWithoutWaitingForScene?Promise.resolve():a.whenReadyAsync()})};c._PostExportAsync=function(a,b,c){return Promise.resolve().then(function(){return b})};c.GLBAsync=function(a,b,c){var d=this;return this._PreExportAsync(a,c).then(function(){var e=b.replace(/\.[^/.]+$/,
"");return(new M(a,c))._generateGLBAsync(e).then(function(b){return d._PostExportAsync(a,b,c)})})};return c}(),pa=m("jpcn");m("Z6Y1").a.ShadersStore.textureTransformPixelShader="precision highp float;\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 textureTransformMat;\nvoid main(void) {\nvec2 uvTransformed=(textureTransformMat*vec4(vUV.xy,1,1)).xy;\ngl_FragColor=texture2D(textureSampler,uvTransformed);\n}";var qa=function(){function c(a){this._recordedTextures=[];this.name="KHR_texture_transform";
this.enabled=!0;this._wasUsed=this.required=!1}c.prototype.dispose=function(){for(var a=0,b=this._recordedTextures;a<b.length;a++)b[a].dispose()};Object.defineProperty(c.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0});c.prototype.postExportTexture=function(a,b,c){if(c&&(0===c.uAng&&0===c.wAng&&0===c.vAng||0===c.uRotationCenter&&0===c.vRotationCenter)){a={};var d=!1;if(0!==c.uOffset||0!==c.vOffset)a.offset=[c.uOffset,c.vOffset],d=!0;if(1!==c.uScale||1!==c.vScale)a.scale=
[c.uScale,c.vScale],d=!0;0!==c.wAng&&(a.rotation=c.wAng,d=!0);0!==c.coordinatesIndex&&(a.texCoord=c.coordinatesIndex,d=!0);d&&(this._wasUsed=!0,b.extensions||(b.extensions={}),b.extensions.KHR_texture_transform=a)}};c.prototype.preExportTextureAsync=function(a,b,c){var d=this;return new Promise(function(c,e){var f=b.getScene();if(f){var h=!1;0===b.uAng&&0===b.wAng&&0===b.vAng||0===b.uRotationCenter&&0===b.vRotationCenter||(h=!0);if(h)return d._textureTransformTextureAsync(b,f).then(function(a){c(a)}).catch(function(a){e(a)});
c(b)}else e(a+': "scene" is not defined for Babylon texture '+b.name+"!")})};c.prototype._textureTransformTextureAsync=function(a,b){var c=this;return new Promise(function(d){var e=new pa.a(""+a.name,a.getSize(),"textureTransform",b);e.reservedDataStore={hidden:!0,source:a};c._recordedTextures.push(e);e.coordinatesIndex=a.coordinatesIndex;e.setTexture("textureSampler",a);e.setMatrix("textureTransformMat",a.getTextureMatrix());e.isReady()?(e.render(),d(e)):e.getEffect().executeWhenCompiled(function(){e.render();
d(e)})})};return c}();M.RegisterExtension("KHR_texture_transform",function(c){return new qa(c)});var S=m("llUH"),ra=m("lFBE"),sa=m("fqU1"),ba=m("uyO6"),ta=function(){function e(a){this.name="KHR_lights_punctual";this.enabled=!0;this.required=!1;this._exporter=a}e.prototype.dispose=function(){this._lights=null};Object.defineProperty(e.prototype,"wasUsed",{get:function(){return!!this._lights},enumerable:!1,configurable:!0});e.prototype.onExporting=function(){this._exporter._glTF.extensions.KHR_lights_punctual=
this._lights};e.prototype.postExportNodeAsync=function(a,b,d,e){var f=this;return new Promise(function(h,g){if(b&&d instanceof sa.a)if(g=d.getTypeID()==S.a.LIGHTTYPEID_POINTLIGHT?"point":d.getTypeID()==S.a.LIGHTTYPEID_DIRECTIONALLIGHT?"directional":d.getTypeID()==S.a.LIGHTTYPEID_SPOTLIGHT?"spot":null,null==g)ba.a.Warn(a+": Light "+d.name+" is not supported in KHR_lights_punctual");else{var k=d.position.clone();var l=f._exporter._convertToRightHandedSystemMap[d.uniqueId];k.equals(c.e.Zero())||(l&&
q._GetRightHandedPositionVector3FromRef(k),b.translation=k.asArray());"point"!==g&&(k=d.direction,k=c.b.RotationYawPitchRoll(-Math.atan2(k.z*(f._exporter._babylonScene.useRightHandedSystem?-1:1),k.x)+Math.PI/2,-Math.atan2(k.y,Math.sqrt(k.x*k.x+k.z*k.z)),0),l&&q._GetRightHandedQuaternionFromRef(k),k.equals(c.b.Identity())||(b.rotation=k.asArray()));d.falloffType!==S.a.FALLOFF_GLTF&&ba.a.Warn(a+": Light falloff for "+d.name+" does not match the KHR_lights_punctual specification!");l={type:g};d.diffuse.equals(D.a.White())||
(l.color=d.diffuse.asArray());1!==d.intensity&&(l.intensity=d.intensity);d.range!==Number.MAX_VALUE&&(l.range=d.range);"spot"===g&&(d.angle!==Math.PI/2&&(null==l.spot&&(l.spot={}),l.spot.outerConeAngle=d.angle/2),0!==d.innerAngle&&(null==l.spot&&(l.spot={}),l.spot.innerConeAngle=d.innerAngle/2));null==f._lights&&(f._lights={lights:[]});f._lights.lights.push(l);g={light:f._lights.lights.length-1};if((l=d.parent)&&1==l.getChildren().length&&(l=f._exporter._nodes[e[l.uniqueId]])){var n=c.c.Matrix[0];
k=c.c.Matrix[1];var m=l.translation?new c.e(l.translation[0],l.translation[1],l.translation[2]):c.e.Zero(),p=l.rotation?new c.b(l.rotation[0],l.rotation[1],l.rotation[2],l.rotation[3]):c.b.Identity(),r=l.scale?new c.e(l.scale[0],l.scale[1],l.scale[2]):c.e.One();c.a.ComposeToRef(r,p,m,n);n.invertToRef(k);n=c.c.Matrix[2];m=b.translation?new c.e(b.translation[0],b.translation[1],b.translation[2]):c.e.Zero();d instanceof ra.a&&m.subtractInPlace(f._exporter._babylonScene.useRightHandedSystem?d.direction:
q._GetRightHandedPositionVector3(d.direction));p=f._exporter._babylonScene.useRightHandedSystem?c.b.Identity():new c.b(0,1,0,0);b.rotation&&p.multiplyInPlace(new c.b(b.rotation[0],b.rotation[1],b.rotation[2],b.rotation[3]));r=b.scale?new c.e(b.scale[0],b.scale[1],b.scale[2]):c.e.One();c.a.ComposeToRef(r,p,m,n);n.multiplyToRef(k,n);k=c.c.Vector3[0];m=c.c.Quaternion[0];p=c.c.Vector3[1];n.decompose(k,m,p);l.scale=k.asArray();l.rotation=m.asArray();l.translation=p.asArray();null==l.extensions&&(l.extensions=
{});l.extensions.KHR_lights_punctual=g;h(void 0);return}null==b.extensions&&(b.extensions={});b.extensions.KHR_lights_punctual=g}h(b)})};return e}();M.RegisterExtension("KHR_lights_punctual",function(c){return new ta(c)});var ua=function(){function c(a){this.name="KHR_materials_sheen";this.enabled=!0;this.required=!1;this._textureInfos=[];this._exportedTextures=[];this._wasUsed=!1}c.prototype.dispose=function(){this._textureInfos=[];this._exportedTextures=[]};Object.defineProperty(c.prototype,"wasUsed",
{get:function(){return this._wasUsed},enumerable:!1,configurable:!0});c.prototype._getTextureIndex=function(a){var b=this._exportedTextures.indexOf(a);-1===b&&a.reservedDataStore&&(b=this._exportedTextures.indexOf(a.reservedDataStore.source));return b};c.prototype.postExportTexture=function(a,b,c){a=this._getTextureIndex(c);-1<a&&(this._textureInfos[a]=b)};c.prototype.postExportMaterialAdditionalTextures=function(a,b,c){return c instanceof Q.a&&c.sheen.isEnabled&&c.sheen.texture?(this._exportedTextures.push(c.sheen.texture),
[c.sheen.texture]):[]};c.prototype.postExportMaterialAsync=function(a,b,c){var d=this;return new Promise(function(a,e){var f;if(c instanceof Q.a){if(!c.sheen.isEnabled){a(b);return}d._wasUsed=!0;null==b.extensions&&(b.extensions={});e={sheenColorFactor:c.sheen.color.asArray(),sheenRoughnessFactor:null!==(f=c.sheen.roughness)&&void 0!==f?f:0};c.sheen.texture&&(f=d._getTextureIndex(c.sheen.texture),-1<f&&(e.sheenColorTexture=d._textureInfos[f]));c.sheen.textureRoughness&&!c.sheen.useRoughnessFromMainTexture?
(f=d._getTextureIndex(c.sheen.textureRoughness),-1<f&&(e.sheenRoughnessTexture=d._textureInfos[f])):c.sheen.texture&&c.sheen.useRoughnessFromMainTexture&&(f=d._getTextureIndex(c.sheen.texture),-1<f&&(e.sheenRoughnessTexture=d._textureInfos[f]));b.extensions.KHR_materials_sheen=e}a(b)})};return c}();M.RegisterExtension("KHR_materials_sheen",function(c){return new ua(c)});var va=function(){function c(a){this.name="KHR_materials_unlit";this.enabled=!0;this._wasUsed=this.required=!1}Object.defineProperty(c.prototype,
"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0});c.prototype.dispose=function(){};c.prototype.postExportMaterialAsync=function(a,b,c){var d=this;return new Promise(function(a,e){e=!1;c instanceof Q.a?e=c.unlit:c instanceof X.a&&(e=c.disableLighting);e&&(d._wasUsed=!0,null==b.extensions&&(b.extensions={}),b.extensions.KHR_materials_unlit={});a(b)})};return c}();M.RegisterExtension("KHR_materials_unlit",function(c){return new va(c)});var da=function(){function e(){}e.CreateSTL=
function(a,b,d,e,f,g){void 0===b&&(b=!0);void 0===d&&(d="stlmesh");void 0===e&&(e=!1);void 0===f&&(f=!0);void 0===g&&(g=!1);var h=function(a,b,d){a=[3*a[d],3*a[d+1],3*a[d+2]];b=[new c.e(b[a[0]],b[a[0]+2],b[a[0]+1]),new c.e(b[a[1]],b[a[1]+2],b[a[1]+1]),new c.e(b[a[2]],b[a[2]+2],b[a[2]+1])];a=b[0].subtract(b[1]);d=b[2].subtract(b[1]);a=c.e.Cross(d,a).normalize();return{v:b,n:a}},k=function(a,b,c,d){b=l(a,b,c.x,d);b=l(a,b,c.y,d);return l(a,b,c.z,d)},l=function(a,b,c,d){a.setFloat32(b,c,d);return b+4},
n=0,m=0;if(e){for(var p=0;p<a.length;p++){var q=a[p];q=q.getIndices();n+=q?q.length/3:0}var u=new ArrayBuffer(84+50*n);u=new DataView(u);m+=80;u.setUint32(m,n,f);m+=4}else u="solid stlmesh\r\n";for(p=0;p<a.length;p++){q=a[p];g||q.bakeCurrentTransformIntoVertices();n=q.getVerticesData(v.b.PositionKind)||[];q=q.getIndices()||[];for(var w=0;w<q.length;w+=3){var y=h(q,n,w);e?(m=k(u,m,y.n,f),m=k(u,m,y.v[0],f),m=k(u,m,y.v[1],f),m=k(u,m,y.v[2],f),m+=2):(u+="facet normal "+y.n.x+" "+y.n.y+" "+y.n.z+"\r\n",
u+="\touter loop\r\n",u+="\t\tvertex "+y.v[0].x+" "+y.v[0].y+" "+y.v[0].z+"\r\n",u+="\t\tvertex "+y.v[1].x+" "+y.v[1].y+" "+y.v[1].z+"\r\n",u+="\t\tvertex "+y.v[2].x+" "+y.v[2].y+" "+y.v[2].z+"\r\n",u+="\tendloop\r\n",u+="endfacet\r\n")}}e||(u+="endsolid stlmesh");b&&(a=document.createElement("a"),b=new Blob([u],{type:"application/octet-stream"}),a.href=window.URL.createObjectURL(b),a.download=d+".stl",a.click());return u};return e}()}}]);
