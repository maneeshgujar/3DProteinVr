var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);$jscomp.checkEs6ConformanceViaProxy=function(){try{var k={},t=Object.create(new $jscomp.global.Proxy(k,{get:function(e,m,q){return e==k&&"q"==m&&q==t}}));return!0===t.q}catch(e){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;
$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.arrayIteratorImpl=function(k){var t=0;return function(){return t<k.length?{done:!1,value:k[t++]}:{done:!0}}};$jscomp.arrayIterator=function(k){return{next:$jscomp.arrayIteratorImpl(k)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,t,e){k!=Array.prototype&&k!=Object.prototype&&(k[t]=e.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(k,t){this.$jscomp$symbol$id_=k;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:t})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function k(e){if(this instanceof k)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(e||"")+"_"+t++,e)}var t=0;return k}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.iterator;k||(k=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[k]&&$jscomp.defineProperty(Array.prototype,k,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.asyncIterator;k||(k=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(k){$jscomp.initSymbolIterator();k={next:k};k[$jscomp.global.Symbol.iterator]=function(){return this};return k};
$jscomp.makeIterator=function(k){var t="undefined"!=typeof Symbol&&Symbol.iterator&&k[Symbol.iterator];return t?t.call(k):$jscomp.arrayIterator(k)};$jscomp.owns=function(k,t){return Object.prototype.hasOwnProperty.call(k,t)};$jscomp.polyfill=function(k,t,e,m){if(t){e=$jscomp.global;k=k.split(".");for(m=0;m<k.length-1;m++){var q=k[m];q in e||(e[q]={});e=e[q]}k=k[k.length-1];m=e[k];t=t(m);t!=m&&null!=t&&$jscomp.defineProperty(e,k,{configurable:!0,writable:!0,value:t})}};
$jscomp.polyfill("WeakMap",function(k){function t(){if(!k||!Object.seal)return!1;try{var d=Object.seal({}),b=Object.seal({}),c=new k([[d,2],[b,3]]);if(2!=c.get(d)||3!=c.get(b))return!1;c.delete(d);c.set(b,4);return!c.has(d)&&4==c.get(b)}catch(a){return!1}}function e(){}function m(d){if(!$jscomp.owns(d,n)){var b=new e;$jscomp.defineProperty(d,n,{value:b})}}function q(d){var b=Object[d];b&&(Object[d]=function(c){if(c instanceof e)return c;m(c);return b(c)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(k&&
$jscomp.ES6_CONFORMANCE)return k}else if(t())return k;var n="$jscomp_hidden_"+Math.random();q("freeze");q("preventExtensions");q("seal");var g=0,w=function(d){this.id_=(g+=Math.random()+1).toString();if(d){d=$jscomp.makeIterator(d);for(var b;!(b=d.next()).done;)b=b.value,this.set(b[0],b[1])}};w.prototype.set=function(d,b){m(d);if(!$jscomp.owns(d,n))throw Error("WeakMap key fail: "+d);d[n][this.id_]=b;return this};w.prototype.get=function(d){return $jscomp.owns(d,n)?d[n][this.id_]:void 0};w.prototype.has=
function(d){return $jscomp.owns(d,n)&&$jscomp.owns(d[n],this.id_)};w.prototype.delete=function(d){return $jscomp.owns(d,n)&&$jscomp.owns(d[n],this.id_)?delete d[n][this.id_]:!1};return w},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(k){function t(){if($jscomp.ASSUME_NO_NATIVE_MAP||!k||"function"!=typeof k||!k.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),b=new k($jscomp.makeIterator([[d,"s"]]));if("s"!=b.get(d)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var c=b.entries(),a=c.next();if(a.done||a.value[0]!=d||"s"!=a.value[1])return!1;a=c.next();return a.done||4!=a.value[0].x||"t"!=a.value[1]||!c.next().done?!1:!0}catch(z){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(k&&$jscomp.ES6_CONFORMANCE)return k}else if(t())return k;$jscomp.initSymbolIterator();var e=new WeakMap,m=function(d){this.data_={};this.head_=g();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var b;!(b=d.next()).done;)b=b.value,this.set(b[0],b[1])}};m.prototype.set=function(d,b){d=0===d?0:d;var c=q(this,d);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:d,
value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};m.prototype.delete=function(d){d=q(this,d);return d.entry&&d.list?(d.list.splice(d.index,1),d.list.length||delete this.data_[d.id],d.entry.previous.next=d.entry.next,d.entry.next.previous=d.entry.previous,d.entry.head=null,this.size--,!0):!1};m.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};m.prototype.has=function(d){return!!q(this,d).entry};
m.prototype.get=function(d){return(d=q(this,d).entry)&&d.value};m.prototype.entries=function(){return n(this,function(d){return[d.key,d.value]})};m.prototype.keys=function(){return n(this,function(d){return d.key})};m.prototype.values=function(){return n(this,function(d){return d.value})};m.prototype.forEach=function(d,b){for(var c=this.entries(),a;!(a=c.next()).done;)a=a.value,d.call(b,a[1],a[0],this)};m.prototype[Symbol.iterator]=m.prototype.entries;var q=function(d,b){var c;var a=(c=b)&&typeof c;
"object"==a||"function"==a?e.has(c)?c=e.get(c):(a=""+ ++w,e.set(c,a),c=a):c="p_"+c;if((a=d.data_[c])&&$jscomp.owns(d.data_,c))for(d=0;d<a.length;d++){var g=a[d];if(b!==b&&g.key!==g.key||b===g.key)return{id:c,list:a,index:d,entry:g}}return{id:c,list:a,index:-1,entry:void 0}},n=function(d,b){var c=d.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=d.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},g=function(){var d=
{};return d.previous=d.next=d.head=d},w=0;return m},"es6","es3");
(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"0I+z":function(k,t,e){e("jSHE");e("98Qd");e("fppW")},"2j9u":function(k,t,e){e.d(t,"a",function(){return d});var m=e("oYeq"),q=e("ps+7"),n=e("M9Dn"),g;(function(b){b[b.Cross=0]="Cross";b[b.Circle=1]="Circle";b[b.Square=2]="Square";b[b.Triangle=3]="Triangle";b[b.L1=4]="L1";b[b.R1=5]="R1";b[b.Share=8]="Share";b[b.Options=9]="Options";b[b.LeftStick=10]="LeftStick";b[b.RightStick=11]="RightStick"})(g||(g={}));var w;(function(b){b[b.Up=12]="Up";
b[b.Down=13]="Down";b[b.Left=14]="Left";b[b.Right=15]="Right"})(w||(w={}));var d=function(b){function c(a,c,d){a=b.call(this,a.replace("STANDARD GAMEPAD","SONY PLAYSTATION DUALSHOCK"),c,d,0,1,2,3)||this;a._leftTrigger=0;a._rightTrigger=0;a.onButtonDownObservable=new q.a;a.onButtonUpObservable=new q.a;a.onPadDownObservable=new q.a;a.onPadUpObservable=new q.a;a._buttonCross=0;a._buttonCircle=0;a._buttonSquare=0;a._buttonTriangle=0;a._buttonShare=0;a._buttonOptions=0;a._buttonL1=0;a._buttonR1=0;a._buttonLeftStick=
0;a._buttonRightStick=0;a._dPadUp=0;a._dPadDown=0;a._dPadLeft=0;a._dPadRight=0;a.type=n.a.DUALSHOCK;return a}Object(m.d)(c,b);c.prototype.onlefttriggerchanged=function(a){this._onlefttriggerchanged=a};c.prototype.onrighttriggerchanged=function(a){this._onrighttriggerchanged=a};Object.defineProperty(c.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(a){this._onlefttriggerchanged&&this._leftTrigger!==a&&this._onlefttriggerchanged(a);this._leftTrigger=a},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(a){this._onrighttriggerchanged&&this._rightTrigger!==a&&this._onrighttriggerchanged(a);this._rightTrigger=a},enumerable:!1,configurable:!0});c.prototype.onbuttondown=function(a){this._onbuttondown=a};c.prototype.onbuttonup=function(a){this._onbuttonup=a};c.prototype.ondpaddown=function(a){this._ondpaddown=a};c.prototype.ondpadup=function(a){this._ondpadup=a};c.prototype._setButtonValue=function(a,
b,c){a!==b&&(1===a&&(this._onbuttondown&&this._onbuttondown(c),this.onButtonDownObservable.notifyObservers(c)),0===a&&(this._onbuttonup&&this._onbuttonup(c),this.onButtonUpObservable.notifyObservers(c)));return a};c.prototype._setDPadValue=function(a,b,c){a!==b&&(1===a&&(this._ondpaddown&&this._ondpaddown(c),this.onPadDownObservable.notifyObservers(c)),0===a&&(this._ondpadup&&this._ondpadup(c),this.onPadUpObservable.notifyObservers(c)));return a};Object.defineProperty(c.prototype,"buttonCross",{get:function(){return this._buttonCross},
set:function(a){this._buttonCross=this._setButtonValue(a,this._buttonCross,g.Cross)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonCircle",{get:function(){return this._buttonCircle},set:function(a){this._buttonCircle=this._setButtonValue(a,this._buttonCircle,g.Circle)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonSquare",{get:function(){return this._buttonSquare},set:function(a){this._buttonSquare=this._setButtonValue(a,this._buttonSquare,g.Square)},
enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonTriangle",{get:function(){return this._buttonTriangle},set:function(a){this._buttonTriangle=this._setButtonValue(a,this._buttonTriangle,g.Triangle)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonOptions",{get:function(){return this._buttonOptions},set:function(a){this._buttonOptions=this._setButtonValue(a,this._buttonOptions,g.Options)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"buttonShare",{get:function(){return this._buttonShare},set:function(a){this._buttonShare=this._setButtonValue(a,this._buttonShare,g.Share)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonL1",{get:function(){return this._buttonL1},set:function(a){this._buttonL1=this._setButtonValue(a,this._buttonL1,g.L1)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonR1",{get:function(){return this._buttonR1},set:function(a){this._buttonR1=this._setButtonValue(a,
this._buttonR1,g.R1)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(a){this._buttonLeftStick=this._setButtonValue(a,this._buttonLeftStick,g.LeftStick)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(a){this._buttonRightStick=this._setButtonValue(a,this._buttonRightStick,g.RightStick)},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(a){this._dPadUp=this._setDPadValue(a,this._dPadUp,w.Up)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(a){this._dPadDown=this._setDPadValue(a,this._dPadDown,w.Down)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(a){this._dPadLeft=this._setDPadValue(a,
this._dPadLeft,w.Left)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(a){this._dPadRight=this._setDPadValue(a,this._dPadRight,w.Right)},enumerable:!1,configurable:!0});c.prototype.update=function(){b.prototype.update.call(this);this.buttonCross=this.browserGamepad.buttons[0].value;this.buttonCircle=this.browserGamepad.buttons[1].value;this.buttonSquare=this.browserGamepad.buttons[2].value;this.buttonTriangle=this.browserGamepad.buttons[3].value;
this.buttonL1=this.browserGamepad.buttons[4].value;this.buttonR1=this.browserGamepad.buttons[5].value;this.leftTrigger=this.browserGamepad.buttons[6].value;this.rightTrigger=this.browserGamepad.buttons[7].value;this.buttonShare=this.browserGamepad.buttons[8].value;this.buttonOptions=this.browserGamepad.buttons[9].value;this.buttonLeftStick=this.browserGamepad.buttons[10].value;this.buttonRightStick=this.browserGamepad.buttons[11].value;this.dPadUp=this.browserGamepad.buttons[12].value;this.dPadDown=
this.browserGamepad.buttons[13].value;this.dPadLeft=this.browserGamepad.buttons[14].value;this.dPadRight=this.browserGamepad.buttons[15].value};c.prototype.dispose=function(){b.prototype.dispose.call(this);this.onButtonDownObservable.clear();this.onButtonUpObservable.clear();this.onPadDownObservable.clear();this.onPadUpObservable.clear()};return c}(n.a)},"6CiD":function(k,t,e){e.d(t,"a",function(){return c});var m=e("ps+7"),q=e("h87I"),n=e("dprs"),g=e("ddrY"),w=e("M9Dn"),d=e("qUIE"),b=e("2j9u"),c=
function(){function a(a){var b=this;this._scene=a;this._babylonGamepads=[];this._isMonitoring=this._oneGamepadConnected=!1;this.onGamepadDisconnectedObservable=new m.a;q.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1;this.onGamepadConnectedObservable=new m.a(function(a){for(var c in b._babylonGamepads){var d=b._babylonGamepads[c];
d&&d._isConnected&&b.onGamepadConnectedObservable.notifyObserver(a,d)}});this._onGamepadConnectedEvent=function(a){a=a.gamepad;if(!(a.index in b._babylonGamepads&&b._babylonGamepads[a.index].isConnected)){if(b._babylonGamepads[a.index]){var c=b._babylonGamepads[a.index];c.browserGamepad=a;c._isConnected=!0}else c=b._addNewGamepad(a);b.onGamepadConnectedObservable.notifyObservers(c);b._startMonitoringGamepads()}};this._onGamepadDisconnectedEvent=function(a){a=a.gamepad;for(var c in b._babylonGamepads)if(b._babylonGamepads[c].index===
a.index){c=b._babylonGamepads[c];c._isConnected=!1;b.onGamepadDisconnectedObservable.notifyObservers(c);c.dispose&&c.dispose();break}};if(this._gamepadSupport)if(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported){if(a=this._scene?this._scene.getEngine().getHostWindow():window)a.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),a.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)}else this._startMonitoringGamepads()}
Object.defineProperty(a.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!1,configurable:!0});a.prototype.getGamepadByType=function(a){void 0===a&&(a=w.a.XBOX);for(var b=0,c=this._babylonGamepads;b<c.length;b++){var d=c[b];if(d&&d.type===a)return d}return null};a.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",
this._onGamepadDisconnectedEvent),this._onGamepadDisconnectedEvent=this._onGamepadConnectedEvent=null);this._babylonGamepads.forEach(function(a){a.dispose()});this.onGamepadConnectedObservable.clear();this.onGamepadDisconnectedObservable.clear();this._oneGamepadConnected=!1;this._stopMonitoringGamepads();this._babylonGamepads=[]};a.prototype._addNewGamepad=function(a){this._oneGamepadConnected||(this._oneGamepadConnected=!0);var c=-1!==a.id.search("054c"),d=-1!==a.id.search("Xbox One");a=d||-1!==
a.id.search("Xbox 360")||-1!==a.id.search("xinput")?new g.b(a.id,a.index,a,d):c?new b.a(a.id,a.index,a):a.pose?n.b.InitiateController(a):new w.b(a.id,a.index,a);return this._babylonGamepads[a.index]=a};a.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())};a.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1};a.prototype._checkGamepadsStatus=function(){var a=this;this._updateGamepadObjects();for(var b in this._babylonGamepads){var c=
this._babylonGamepads[b];c&&c.isConnected&&c.update()}this._isMonitoring&&!this._scene&&d.a.QueueNewFrame(function(){a._checkGamepadsStatus()})};a.prototype._updateGamepadObjects=function(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],b=0;b<a.length;b++){var c=a[b];c&&(this._babylonGamepads[c.index]?(this._babylonGamepads[b].browserGamepad=c,this._babylonGamepads[b].isConnected||(this._babylonGamepads[b]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[b]))):
(c=this._addNewGamepad(c),this.onGamepadConnectedObservable.notifyObservers(c)))}};return a}()},"98Qd":function(k,t,e){e.d(t,"a",function(){return n});e.d(t,"c",function(){return g});e.d(t,"b",function(){return w});var m=e("oYeq"),q=e("/SR9"),n=function(){function d(){}d.POINTERDOWN=1;d.POINTERUP=2;d.POINTERMOVE=4;d.POINTERWHEEL=8;d.POINTERPICK=16;d.POINTERTAP=32;d.POINTERDOUBLETAP=64;return d}();k=function(){return function(d,b){this.type=d;this.event=b}}();var g=function(d){function b(b,a,g,e){b=
d.call(this,b,a)||this;b.ray=null;b.skipOnPointerObservable=!1;b.localPosition=new q.d(g,e);return b}Object(m.d)(b,d);return b}(k),w=function(d){function b(b,a,g){b=d.call(this,b,a)||this;b.pickInfo=g;return b}Object(m.d)(b,d);return b}(k)},K1vB:function(k,t,e){k=e("tVVT");var m=e("Yap0"),q=e("6CiD");t=e("g739");var n=e("5Jap"),g=e("HcSi"),w=e("gJ7H");Object.defineProperty(k.a.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new q.a(this);var b=this._getComponent(m.a.NAME_GAMEPAD);
b||(b=new d(this),this._addComponent(b))}return this._gamepadManager},enumerable:!0,configurable:!0});t.a.prototype.addGamepad=function(){this.add(new n.a);return this};g.a.prototype.addGamepad=function(){this.add(new w.a);return this};var d=function(){function b(b){this.name=m.a.NAME_GAMEPAD;this.scene=b}b.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(m.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)};b.prototype.rebuild=function(){};b.prototype.dispose=
function(){var b=this.scene._gamepadManager;b&&(b.dispose(),this.scene._gamepadManager=null)};b.prototype._beforeCameraUpdate=function(){var b=this.scene._gamepadManager;b&&b._isMonitoring&&b._checkGamepadsStatus()};return b}()},K5KS:function(k,t,e){e.d(t,"a",function(){return D});var m=e("oYeq"),q=e("ps+7"),n=e("/SR9"),g=e("qVgn"),w=e("wAMR"),d=e("5xLc"),b=e("6BCH");k=e("X/eg");var c=e("zRBM"),a=e("kdvT"),z=e("Xeau"),D=function(e){function x(d,g,k,A,y){void 0===g&&(g=z.a.Gray());void 0===k&&(k=c.a.DefaultUtilityLayer);
void 0===A&&(A=null);void 0===y&&(y=1);var h,p=e.call(this,k)||this;p._pointerObserver=null;p.snapDistance=0;p.onSnapObservable=new q.a;p._isEnabled=!0;p._parent=null;p._dragging=!1;p._parent=A;p._coloredMaterial=new a.a("",k.utilityLayerScene);p._coloredMaterial.diffuseColor=g;p._coloredMaterial.specularColor=g.subtract(new z.a(.1,.1,.1));p._hoverMaterial=new a.a("",k.utilityLayerScene);p._hoverMaterial.diffuseColor=z.a.Yellow();p._disableMaterial=new a.a("",k.utilityLayerScene);p._disableMaterial.diffuseColor=
z.a.Gray();p._disableMaterial.alpha=.4;g=x._CreateArrow(k.utilityLayerScene,p._coloredMaterial,y);y=x._CreateArrow(k.utilityLayerScene,p._coloredMaterial,y+4,!0);p._gizmoMesh=new w.a("",k.utilityLayerScene);p._gizmoMesh.addChild(g);p._gizmoMesh.addChild(y);p._gizmoMesh.lookAt(p._rootMesh.position.add(d));p._gizmoMesh.scaling.scaleInPlace(1/3);p._gizmoMesh.parent=p._rootMesh;var m=0,t=new n.e,D={snapDistance:0};p.dragBehavior=new b.a({dragAxis:d});p.dragBehavior.moveAttached=!1;p._rootMesh.addBehavior(p.dragBehavior);
p.dragBehavior.onDragObservable.add(function(a){if(p.attachedNode){if(0==p.snapDistance)p.attachedNode.position&&p.attachedNode.position.addInPlaceFromFloats(a.delta.x,a.delta.y,a.delta.z),p.attachedNode.getWorldMatrix().addTranslationFromFloats(a.delta.x,a.delta.y,a.delta.z),p.attachedNode.updateCache();else if(m+=a.dragDistance,Math.abs(m)>p.snapDistance){var b=Math.floor(Math.abs(m)/p.snapDistance);m%=p.snapDistance;a.delta.normalizeToRef(t);t.scaleInPlace(p.snapDistance*b);p.attachedNode.getWorldMatrix().addTranslationFromFloats(t.x,
t.y,t.z);p.attachedNode.updateCache();D.snapDistance=p.snapDistance*b;p.onSnapObservable.notifyObservers(D)}p._matrixChanged()}});p.dragBehavior.onDragStartObservable.add(function(){p._dragging=!0});p.dragBehavior.onDragEndObservable.add(function(){p._dragging=!1});d=k._getSharedGizmoLight();d.includedOnlyMeshes=d.includedOnlyMeshes.concat(p._rootMesh.getChildMeshes(!1));var F={gizmoMeshes:g.getChildMeshes(),colliderMeshes:y.getChildMeshes(),material:p._coloredMaterial,hoverMaterial:p._hoverMaterial,
disableMaterial:p._disableMaterial,active:!1};null===(h=p._parent)||void 0===h?void 0:h.addToAxisCache(y,F);p._pointerObserver=k.utilityLayerScene.onPointerObservable.add(function(a){var b;if(!p._customMeshSet&&(p._isHovered=-1!=F.colliderMeshes.indexOf(null===(b=null===a||void 0===a?void 0:a.pickInfo)||void 0===b?void 0:b.pickedMesh),!p._parent)){var c=p._isHovered||p._dragging?p._hoverMaterial:p._coloredMaterial;F.gizmoMeshes.forEach(function(a){a.material=c;a.color&&(a.color=c.diffuseColor)})}});
return p}Object(m.d)(x,e);x._CreateArrow=function(a,b,c,e){void 0===c&&(c=1);void 0===e&&(e=!1);var x=new g.a("arrow",a),h=d.a.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375*(1+(c-1)/4),tessellation:96},a);a=d.a.CreateCylinder("cylinder",{diameterTop:.005*c,height:.275,diameterBottom:.005*c,tessellation:96},a);h.parent=x;h.material=b;h.rotation.x=Math.PI/2;h.position.z+=.3;a.parent=x;a.material=b;a.position.z+=.1375;a.rotation.x=Math.PI/2;e&&(a.visibility=0,h.visibility=
0);return x};x._CreateArrowInstance=function(a,b){a=new g.a("arrow",a);var c=0;for(b=b.getChildMeshes();c<b.length;c++){var d=b[c];d.createInstance(d.name).parent=a}return a};x.prototype._attachedNodeChanged=function(a){this.dragBehavior&&(this.dragBehavior.enabled=a?!0:!1)};Object.defineProperty(x.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a;a?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):
this.attachedNode=this.attachedMesh=null},enumerable:!1,configurable:!0});x.prototype.dispose=function(){this.onSnapObservable.clear();this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);this.dragBehavior.detach();this._gizmoMesh&&this._gizmoMesh.dispose();[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(a){a&&a.dispose()});e.prototype.dispose.call(this)};return x}(k.a)},M9Dn:function(k,t,e){e.d(t,"a",function(){return n});e.d(t,"b",
function(){return g});var m=e("oYeq"),q=e("ps+7");(function(){return function(g,d){this.x=g;this.y=d}})();var n=function(){function g(d,b,c,a,e,k,x){void 0===a&&(a=0);void 0===e&&(e=1);void 0===k&&(k=2);void 0===x&&(x=3);this.id=d;this.index=b;this.browserGamepad=c;this._leftStick={x:0,y:0};this._rightStick={x:0,y:0};this._isConnected=!0;this._invertLeftStickY=!1;this.type=g.GAMEPAD;this._leftStickAxisX=a;this._leftStickAxisY=e;this._rightStickAxisX=k;this._rightStickAxisY=x;2<=this.browserGamepad.axes.length&&
(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]});4<=this.browserGamepad.axes.length&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}Object.defineProperty(g.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!1,configurable:!0});g.prototype.onleftstickchanged=function(d){this._onleftstickchanged=d};g.prototype.onrightstickchanged=function(d){this._onrightstickchanged=
d};Object.defineProperty(g.prototype,"leftStick",{get:function(){return this._leftStick},set:function(d){!this._onleftstickchanged||this._leftStick.x===d.x&&this._leftStick.y===d.y||this._onleftstickchanged(d);this._leftStick=d},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"rightStick",{get:function(){return this._rightStick},set:function(d){!this._onrightstickchanged||this._rightStick.x===d.x&&this._rightStick.y===d.y||this._onrightstickchanged(d);this._rightStick=d},enumerable:!1,
configurable:!0});g.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1));this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})};g.prototype.dispose=function(){};g.GAMEPAD=0;g.GENERIC=1;g.XBOX=2;g.POSE_ENABLED=3;g.DUALSHOCK=4;return g}(),g=function(g){function d(b,
c,a){b=g.call(this,b,c,a)||this;b.onButtonDownObservable=new q.a;b.onButtonUpObservable=new q.a;b.type=n.GENERIC;b._buttons=Array(a.buttons.length);return b}Object(m.d)(d,g);d.prototype.onbuttondown=function(b){this._onbuttondown=b};d.prototype.onbuttonup=function(b){this._onbuttonup=b};d.prototype._setButtonValue=function(b,c,a){b!==c&&(1===b&&(this._onbuttondown&&this._onbuttondown(a),this.onButtonDownObservable.notifyObservers(a)),0===b&&(this._onbuttonup&&this._onbuttonup(a),this.onButtonUpObservable.notifyObservers(a)));
return b};d.prototype.update=function(){g.prototype.update.call(this);for(var b=0;b<this._buttons.length;b++)this._buttons[b]=this._setButtonValue(this.browserGamepad.buttons[b].value,this._buttons[b],b)};d.prototype.dispose=function(){g.prototype.dispose.call(this);this.onButtonDownObservable.clear();this.onButtonUpObservable.clear()};return d}(n)},"X/eg":function(k,t,e){e.d(t,"a",function(){return w});var m=e("/SR9"),q=e("wAMR"),n=e("zRBM"),g=e("98Qd"),w=function(){function d(b){var c=this;void 0===
b&&(b=n.a.DefaultUtilityLayer);this.gizmoLayer=b;this._attachedNode=this._attachedMesh=null;this._scaleRatio=1;this._customMeshSet=this._isHovered=!1;this._interactionsEnabled=this.updateScale=this.updateGizmoPositionToMatchAttachedMesh=this._updateGizmoRotationToMatchAttachedMesh=!0;this._tempQuaternion=new m.b(0,0,0,1);this._tempVector=new m.e;this._tempVector2=new m.e;this._tempMatrix1=new m.a;this._tempMatrix2=new m.a;this._rightHandtoLeftHandMatrix=m.a.RotationY(Math.PI);this._rootMesh=new q.a("gizmoRootNode",
b.utilityLayerScene);this._rootMesh.rotationQuaternion=m.b.Identity();this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){c._update()})}Object.defineProperty(d.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(b){this._scaleRatio=b},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"isHovered",{get:function(){return this._isHovered},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"attachedMesh",
{get:function(){return this._attachedMesh},set:function(b){if(this._attachedMesh=b)this._attachedNode=b;this._rootMesh.setEnabled(b?!0:!1);this._attachedNodeChanged(b)},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"attachedNode",{get:function(){return this._attachedNode},set:function(b){this._attachedNode=b;this._attachedMesh=null;this._rootMesh.setEnabled(b?!0:!1);this._attachedNodeChanged(b)},enumerable:!1,configurable:!0});d.prototype.setCustomMesh=function(b){if(b.getScene()!=
this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(b){b.dispose()});b.parent=this._rootMesh;this._customMeshSet=!0};Object.defineProperty(d.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(b){this._updateGizmoRotationToMatchAttachedMesh=b},enumerable:!1,
configurable:!0});d.prototype._attachedNodeChanged=function(b){};d.prototype._update=function(){if(this.attachedNode){var b=this.attachedNode;this.attachedMesh&&(b=this.attachedMesh._effectiveMesh||this.attachedNode);if(this.updateGizmoPositionToMatchAttachedMesh){var c=b.getWorldMatrix().getRow(3);c=c?c.toVector3():new m.e(0,0,0);this._rootMesh.position.copyFrom(c)}this.updateGizmoRotationToMatchAttachedMesh?b.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion.set(0,
0,0,1);if(this.updateScale){c=this.gizmoLayer.utilityLayerScene.activeCamera;var a=c.globalPosition;c.devicePosition&&(a=c.devicePosition);this._rootMesh.position.subtractToRef(a,this._tempVector);c=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(c,c,c);0>b._getWorldMatrixDeterminant()&&(this._rootMesh.scaling.y*=-1)}else this._rootMesh.scaling.setAll(this.scaleRatio)}};d.prototype._matrixChanged=function(){if(this._attachedNode)if(this._attachedNode._isCamera){var b=this._attachedNode;
if(b.parent){var c=this._tempMatrix2;b.parent._worldMatrix.invertToRef(c);this._attachedNode._worldMatrix.multiplyToRef(c,this._tempMatrix1);c=this._tempMatrix1}else c=this._attachedNode._worldMatrix;b.getScene().useRightHandedSystem&&(this._rightHandtoLeftHandMatrix.multiplyToRef(c,this._tempMatrix2),c=this._tempMatrix2);c.decompose(this._tempVector2,this._tempQuaternion,this._tempVector);if("FreeCamera"===this._attachedNode.getClassName()||"FlyCamera"===this._attachedNode.getClassName()||"ArcFollowCamera"===
this._attachedNode.getClassName()||"TargetCamera"===this._attachedNode.getClassName()||"TouchCamera"===this._attachedNode.getClassName()||"UniversalCamera"===this._attachedNode.getClassName())c=this._attachedNode,c.rotation=this._tempQuaternion.toEulerAngles(),c.rotationQuaternion&&c.rotationQuaternion.copyFrom(this._tempQuaternion);b.position.copyFrom(this._tempVector)}else if(this._attachedNode._isMesh||"AbstractMesh"===this._attachedNode.getClassName()||"TransformNode"===this._attachedNode.getClassName()||
"InstancedMesh"===this._attachedNode.getClassName()){b=this._attachedNode;if(b.parent){c=this._tempMatrix1;var a=this._tempMatrix2;b.parent.getWorldMatrix().invertToRef(c);this._attachedNode.getWorldMatrix().multiplyToRef(c,a);a.decompose(b.scaling,this._tempQuaternion,b.position)}else this._attachedNode._worldMatrix.decompose(b.scaling,this._tempQuaternion,b.position);b.billboardMode||(b.rotationQuaternion?b.rotationQuaternion.copyFrom(this._tempQuaternion):b.rotation=this._tempQuaternion.toEulerAngles())}else if("Bone"===
this._attachedNode.getClassName()){b=this._attachedNode;if(a=b.getParent()){var d=this._tempMatrix1;c=this._tempMatrix2;a.getWorldMatrix().invertToRef(d);b.getWorldMatrix().multiplyToRef(d,c);a=b.getLocalMatrix();a.copyFrom(c)}else a=b.getLocalMatrix(),a.copyFrom(b.getWorldMatrix());b.markAsDirty()}};d.GizmoAxisPointerObserver=function(b,c){var a=!1;return b.utilityLayerScene.onPointerObservable.add(function(b){var d,e;if(b.pickInfo){if(b.type===g.a.POINTERMOVE){if(a)return;c.forEach(function(a){var c,
d;if(a.colliderMeshes&&a.gizmoMeshes){var g=-1!=(null===(c=a.colliderMeshes)||void 0===c?void 0:c.indexOf(null===(d=null===b||void 0===b?void 0:b.pickInfo)||void 0===d?void 0:d.pickedMesh))||a.active?a.hoverMaterial:a.material;a.gizmoMeshes.forEach(function(a){a.material=g;a.color&&(a.color=g.diffuseColor)})}})}b.type===g.a.POINTERDOWN&&c.has(null===(d=b.pickInfo.pickedMesh)||void 0===d?void 0:d.parent)&&(a=!0,c.get(null===(e=b.pickInfo.pickedMesh)||void 0===e?void 0:e.parent).active=!0,c.forEach(function(a){var c,
d,g=-1!=(null===(c=a.colliderMeshes)||void 0===c?void 0:c.indexOf(null===(d=null===b||void 0===b?void 0:b.pickInfo)||void 0===d?void 0:d.pickedMesh))||a.active?a.hoverMaterial:a.disableMaterial;a.gizmoMeshes.forEach(function(a){a.material=g;a.color&&(a.color=g.diffuseColor)})}));b.type===g.a.POINTERUP&&c.forEach(function(b){a=b.active=!1;b.gizmoMeshes.forEach(function(a){a.material=b.material;a.color&&(a.color=b.material.diffuseColor)})})}})};d.prototype.dispose=function(){this._rootMesh.dispose();
this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)};return d}()},ddrY:function(k,t,e){e.d(t,"a",function(){return g});e.d(t,"b",function(){return d});var m=e("oYeq"),q=e("ps+7"),n=e("M9Dn"),g;(function(b){b[b.A=0]="A";b[b.B=1]="B";b[b.X=2]="X";b[b.Y=3]="Y";b[b.LB=4]="LB";b[b.RB=5]="RB";b[b.Back=8]="Back";b[b.Start=9]="Start";b[b.LeftStick=10]="LeftStick";b[b.RightStick=11]="RightStick"})(g||(g={}));var w;(function(b){b[b.Up=12]=
"Up";b[b.Down=13]="Down";b[b.Left=14]="Left";b[b.Right=15]="Right"})(w||(w={}));var d=function(b){function c(a,c,d,g){void 0===g&&(g=!1);a=b.call(this,a,c,d,0,1,2,3)||this;a._leftTrigger=0;a._rightTrigger=0;a.onButtonDownObservable=new q.a;a.onButtonUpObservable=new q.a;a.onPadDownObservable=new q.a;a.onPadUpObservable=new q.a;a._buttonA=0;a._buttonB=0;a._buttonX=0;a._buttonY=0;a._buttonBack=0;a._buttonStart=0;a._buttonLB=0;a._buttonRB=0;a._buttonLeftStick=0;a._buttonRightStick=0;a._dPadUp=0;a._dPadDown=
0;a._dPadLeft=0;a._dPadRight=0;a._isXboxOnePad=!1;a.type=n.a.XBOX;a._isXboxOnePad=g;return a}Object(m.d)(c,b);c.prototype.onlefttriggerchanged=function(a){this._onlefttriggerchanged=a};c.prototype.onrighttriggerchanged=function(a){this._onrighttriggerchanged=a};Object.defineProperty(c.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(a){this._onlefttriggerchanged&&this._leftTrigger!==a&&this._onlefttriggerchanged(a);this._leftTrigger=a},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(a){this._onrighttriggerchanged&&this._rightTrigger!==a&&this._onrighttriggerchanged(a);this._rightTrigger=a},enumerable:!1,configurable:!0});c.prototype.onbuttondown=function(a){this._onbuttondown=a};c.prototype.onbuttonup=function(a){this._onbuttonup=a};c.prototype.ondpaddown=function(a){this._ondpaddown=a};c.prototype.ondpadup=function(a){this._ondpadup=a};c.prototype._setButtonValue=function(a,
b,c){a!==b&&(1===a&&(this._onbuttondown&&this._onbuttondown(c),this.onButtonDownObservable.notifyObservers(c)),0===a&&(this._onbuttonup&&this._onbuttonup(c),this.onButtonUpObservable.notifyObservers(c)));return a};c.prototype._setDPadValue=function(a,b,c){a!==b&&(1===a&&(this._ondpaddown&&this._ondpaddown(c),this.onPadDownObservable.notifyObservers(c)),0===a&&(this._ondpadup&&this._ondpadup(c),this.onPadUpObservable.notifyObservers(c)));return a};Object.defineProperty(c.prototype,"buttonA",{get:function(){return this._buttonA},
set:function(a){this._buttonA=this._setButtonValue(a,this._buttonA,g.A)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonB",{get:function(){return this._buttonB},set:function(a){this._buttonB=this._setButtonValue(a,this._buttonB,g.B)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonX",{get:function(){return this._buttonX},set:function(a){this._buttonX=this._setButtonValue(a,this._buttonX,g.X)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"buttonY",{get:function(){return this._buttonY},set:function(a){this._buttonY=this._setButtonValue(a,this._buttonY,g.Y)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(a){this._buttonStart=this._setButtonValue(a,this._buttonStart,g.Start)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(a){this._buttonBack=this._setButtonValue(a,
this._buttonBack,g.Back)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(a){this._buttonLB=this._setButtonValue(a,this._buttonLB,g.LB)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(a){this._buttonRB=this._setButtonValue(a,this._buttonRB,g.RB)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},
set:function(a){this._buttonLeftStick=this._setButtonValue(a,this._buttonLeftStick,g.LeftStick)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(a){this._buttonRightStick=this._setButtonValue(a,this._buttonRightStick,g.RightStick)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(a){this._dPadUp=this._setDPadValue(a,this._dPadUp,
w.Up)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(a){this._dPadDown=this._setDPadValue(a,this._dPadDown,w.Down)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(a){this._dPadLeft=this._setDPadValue(a,this._dPadLeft,w.Left)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"dPadRight",{get:function(){return this._dPadRight},
set:function(a){this._dPadRight=this._setDPadValue(a,this._dPadRight,w.Right)},enumerable:!1,configurable:!0});c.prototype.update=function(){b.prototype.update.call(this);this.buttonA=this.browserGamepad.buttons[0].value;this.buttonB=this.browserGamepad.buttons[1].value;this.buttonX=this.browserGamepad.buttons[2].value;this.buttonY=this.browserGamepad.buttons[3].value;this.buttonLB=this.browserGamepad.buttons[4].value;this.buttonRB=this.browserGamepad.buttons[5].value;this.leftTrigger=this.browserGamepad.buttons[6].value;
this.rightTrigger=this.browserGamepad.buttons[7].value;this.buttonBack=this.browserGamepad.buttons[8].value;this.buttonStart=this.browserGamepad.buttons[9].value;this.buttonLeftStick=this.browserGamepad.buttons[10].value;this.buttonRightStick=this.browserGamepad.buttons[11].value;this.dPadUp=this.browserGamepad.buttons[12].value;this.dPadDown=this.browserGamepad.buttons[13].value;this.dPadLeft=this.browserGamepad.buttons[14].value;this.dPadRight=this.browserGamepad.buttons[15].value};c.prototype.dispose=
function(){b.prototype.dispose.call(this);this.onButtonDownObservable.clear();this.onButtonUpObservable.clear();this.onPadDownObservable.clear();this.onPadUpObservable.clear()};return c}(n.a)},dprs:function(k,t,e){e.d(t,"c",function(){return b});e.d(t,"b",function(){return c});e.d(t,"a",function(){return a});var m=e("oYeq"),q=e("ps+7"),n=e("/SR9"),g=e("2/Cc"),w=e("e2Mr"),d=e("M9Dn"),b;(function(a){a[a.VIVE=0]="VIVE";a[a.OCULUS=1]="OCULUS";a[a.WINDOWS=2]="WINDOWS";a[a.GEAR_VR=3]="GEAR_VR";a[a.DAYDREAM=
4]="DAYDREAM";a[a.GENERIC=5]="GENERIC"})(b||(b={}));var c=function(){function a(){}a.InitiateController=function(a){for(var b=0,c=this._ControllerFactories;b<c.length;b++){var d=c[b];if(d.canCreate(a))return d.create(a)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(a);throw"The type of gamepad you are trying to load needs to be imported first or is not supported.";};a._ControllerFactories=[];a._DefaultControllerFactory=null;return a}(),a=function(a){function c(c){c=a.call(this,
c.id,c.index,c)||this;c.isXR=!1;c._deviceRoomPosition=n.e.Zero();c._deviceRoomRotationQuaternion=new n.b;c.devicePosition=n.e.Zero();c.deviceRotationQuaternion=new n.b;c.deviceScaleFactor=1;c._trackPosition=!0;c._maxRotationDistFromHeadset=Math.PI/5;c._draggedRoomRotation=0;c._leftHandSystemQuaternion=new n.b;c._deviceToWorld=n.a.Identity();c._pointingPoseNode=null;c._workingMatrix=n.a.Identity();c._meshAttachedObservable=new q.a;c.type=d.a.POSE_ENABLED;c.controllerType=b.GENERIC;c.position=n.e.Zero();
c.rotationQuaternion=new n.b;c._calculatedPosition=n.e.Zero();c._calculatedRotation=new n.b;n.b.RotationYawPitchRollToRef(Math.PI,0,0,c._leftHandSystemQuaternion);return c}Object(m.d)(c,a);c.prototype._disableTrackPosition=function(a){this._trackPosition&&(this._calculatedPosition.copyFrom(a),this._trackPosition=!1)};c.prototype.update=function(){a.prototype.update.call(this);this._updatePoseAndMesh()};c.prototype._updatePoseAndMesh=function(){if(!this.isXR){this.updateFromDevice(this.browserGamepad.pose);
if(!this._trackPosition&&w.a.LastCreatedScene&&w.a.LastCreatedScene.activeCamera&&w.a.LastCreatedScene.activeCamera.devicePosition){var a=w.a.LastCreatedScene.activeCamera;a._computeDevicePosition();this._deviceToWorld.setTranslation(a.devicePosition);if(a.deviceRotationQuaternion&&(a._deviceRoomRotationQuaternion.toEulerAnglesToRef(n.c.Vector3[0]),a=Math.atan2(Math.sin(n.c.Vector3[0].y-this._draggedRoomRotation),Math.cos(n.c.Vector3[0].y-this._draggedRoomRotation)),Math.abs(a)>this._maxRotationDistFromHeadset)){var b=
a-(0>a?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=b;a=Math.sin(-b);b=Math.cos(-b);this._calculatedPosition.x=this._calculatedPosition.x*b-this._calculatedPosition.z*a;this._calculatedPosition.z=this._calculatedPosition.x*a+this._calculatedPosition.z*b}}n.e.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition);this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix);n.b.FromRotationMatrixToRef(this._workingMatrix,
this.deviceRotationQuaternion);this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation);this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))}};c.prototype.updateFromDevice=function(a){if(!this.isXR&&a){this.rawPose=a;a.position&&(this._deviceRoomPosition.copyFromFloats(a.position[0],a.position[1],-a.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=
-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var b=this.rawPose;a.orientation&&b.orientation&&4===b.orientation.length&&(this._deviceRoomRotationQuaternion.copyFromFloats(b.orientation[0],b.orientation[1],-b.orientation[2],-b.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,
this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}};c.prototype.attachToMesh=function(a){this._mesh&&(this._mesh.parent=null);this._mesh=a;this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera);this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new n.b);if(!this.isXR&&(this._updatePoseAndMesh(),this._pointingPoseNode)){for(var b=[],c=this._pointingPoseNode;c.parent;)b.push(c.parent),
c=c.parent;b.reverse().forEach(function(a){a.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(a)};c.prototype.attachToPoseControlledCamera=function(a){this._poseControlledCamera=a;this._mesh&&(this._mesh.parent=this._poseControlledCamera)};c.prototype.dispose=function(){this._mesh&&this._mesh.dispose();this._mesh=null;a.prototype.dispose.call(this)};Object.defineProperty(c.prototype,"mesh",{get:function(){return this._mesh},enumerable:!1,configurable:!0});c.prototype.getForwardRay=
function(a){void 0===a&&(a=100);if(!this.mesh)return new g.a(n.e.Zero(),new n.e(0,0,1),a);var b=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),c=b.getTranslation(),d=new n.e(0,0,-1);b=n.e.TransformNormal(d,b);b=n.e.Normalize(b);return new g.a(c,b,a)};c.POINTING_POSE="POINTING_POSE";return c}(d.a)},fppW:function(k,t,e){e.d(t,"a",function(){return m});e.d(t,"b",function(){return q});var m=function(){function e(){}e.COPY=1;e.CUT=2;e.PASTE=3;return e}(),q=function(){function e(g,
e){this.type=g;this.event=e}e.GetTypeFromCharacter=function(g){switch(g){case 67:return m.COPY;case 86:return m.PASTE;case 88:return m.CUT;default:return-1}};return e}()},hY6D:function(k,t,e){e.d(t,"a",function(){return V});var m=e("K5KS"),q=e("oYeq"),n=e("ps+7"),g=e("/SR9"),w=e("wAMR"),d=e("HZbn"),b=e("5xLc"),c=e("kdvT"),a=e("6BCH"),z=e("X/eg"),D=e("zRBM"),x=e("Xeau"),K=function(e){function B(b,l,f,d,B){void 0===l&&(l=x.a.Gray());void 0===f&&(f=D.a.DefaultUtilityLayer);void 0===d&&(d=null);void 0===
B&&(B=1);var v,r,h,p,H,y,k,u=e.call(this,f)||this;u._pointerObserver=null;u.snapDistance=0;u.onSnapObservable=new n.a;u.uniformScaling=!1;u.sensitivity=1;u._isEnabled=!0;u._parent=null;u._dragging=!1;u._tmpVector=new g.e;u._tmpMatrix=new g.a;u._tmpMatrix2=new g.a;u._parent=d;u._coloredMaterial=new c.a("",f.utilityLayerScene);u._coloredMaterial.diffuseColor=l;u._coloredMaterial.specularColor=l.subtract(new x.a(.1,.1,.1));u._hoverMaterial=new c.a("",f.utilityLayerScene);u._hoverMaterial.diffuseColor=
x.a.Yellow();u._disableMaterial=new c.a("",f.utilityLayerScene);u._disableMaterial.diffuseColor=x.a.Gray();u._disableMaterial.alpha=.4;u._gizmoMesh=new w.a("axis",f.utilityLayerScene);l=u._createGizmoMesh(u._gizmoMesh,B);var m=l.arrowMesh,q=l.arrowTail;B=u._createGizmoMesh(u._gizmoMesh,B+4,!0);u._gizmoMesh.lookAt(u._rootMesh.position.add(b));u._rootMesh.addChild(u._gizmoMesh);u._gizmoMesh.scaling.scaleInPlace(1/3);var t=m.position.clone(),A=q.position.clone(),E=q.scaling.clone(),M=function(a){a=a*
(3/u._rootMesh.scaling.length())*6;m.position.z+=a/3.5;q.scaling.y+=a;q.position.z=m.position.z/2};l=function(){m.position.set(t.x,t.y,t.z);q.position.set(A.x,A.y,A.z);q.scaling.set(E.x,E.y,E.z);u._dragging=!1};u.dragBehavior=new a.a({dragAxis:b});u.dragBehavior.moveAttached=!1;u._rootMesh.addBehavior(u.dragBehavior);var G=0,C=new g.e,L={snapDistance:0};u.dragBehavior.onDragObservable.add(function(a){if(u.attachedNode){a=u.sensitivity*a.dragDistance*(3*u.scaleRatio/u._rootMesh.scaling.length());var f=
!1,v=0;u.uniformScaling?(u.attachedNode.getWorldMatrix().decompose(C),C.normalize(),0>C.y&&C.scaleInPlace(-1)):C.copyFrom(b);0==u.snapDistance?C.scaleToRef(a,C):(G+=a,Math.abs(G)>u.snapDistance?(v=Math.floor(Math.abs(G)/u.snapDistance),0>G&&(v*=-1),G%=u.snapDistance,C.scaleToRef(u.snapDistance*v,C),f=!0):C.scaleInPlace(0));g.a.ScalingToRef(1+C.x,1+C.y,1+C.z,u._tmpMatrix2);u._tmpMatrix2.multiplyToRef(u.attachedNode.getWorldMatrix(),u._tmpMatrix);u._tmpMatrix.decompose(u._tmpVector);1E5>Math.abs(u._tmpVector.x)&&
1E5>Math.abs(u._tmpVector.y)&&1E5>Math.abs(u._tmpVector.z)&&u.attachedNode.getWorldMatrix().copyFrom(u._tmpMatrix);f&&(L.snapDistance=u.snapDistance*v,u.onSnapObservable.notifyObservers(L));u._matrixChanged()}});u.dragBehavior.onDragStartObservable.add(function(){u._dragging=!0});u.dragBehavior.onDragObservable.add(function(a){return M(a.dragDistance)});u.dragBehavior.onDragEndObservable.add(l);null===(h=null===(r=null===(v=null===d||void 0===d?void 0:d.uniformScaleGizmo)||void 0===v?void 0:v.dragBehavior)||
void 0===r?void 0:r.onDragObservable)||void 0===h?void 0:h.add(function(a){return M(a.delta.y)});null===(y=null===(H=null===(p=null===d||void 0===d?void 0:d.uniformScaleGizmo)||void 0===p?void 0:p.dragBehavior)||void 0===H?void 0:H.onDragEndObservable)||void 0===y?void 0:y.add(l);var z={gizmoMeshes:[m,q],colliderMeshes:[B.arrowMesh,B.arrowTail],material:u._coloredMaterial,hoverMaterial:u._hoverMaterial,disableMaterial:u._disableMaterial,active:!1};null===(k=u._parent)||void 0===k?void 0:k.addToAxisCache(u._gizmoMesh,
z);u._pointerObserver=f.utilityLayerScene.onPointerObservable.add(function(a){var b;if(!u._customMeshSet&&(u._isHovered=-1!=z.colliderMeshes.indexOf(null===(b=null===a||void 0===a?void 0:a.pickInfo)||void 0===b?void 0:b.pickedMesh),!u._parent)){var f=u._isHovered||u._dragging?u._hoverMaterial:u._coloredMaterial;z.gizmoMeshes.forEach(function(a){a.material=f;a.color&&(a.color=f.diffuseColor)})}});f=f._getSharedGizmoLight();f.includedOnlyMeshes=f.includedOnlyMeshes.concat(u._rootMesh.getChildMeshes());
return u}Object(q.d)(B,e);B.prototype._createGizmoMesh=function(a,l,f){void 0===f&&(f=!1);var v=d.a.CreateBox("yPosMesh",{size:.4*(1+(l-1)/4)},this.gizmoLayer.utilityLayerScene);l=b.a.CreateCylinder("cylinder",{diameterTop:.005*l,height:.275,diameterBottom:.005*l,tessellation:96},this.gizmoLayer.utilityLayerScene);v.scaling.scaleInPlace(.1);v.material=this._coloredMaterial;v.rotation.x=Math.PI/2;v.position.z+=.3;l.material=this._coloredMaterial;l.position.z+=.1375;l.rotation.x=Math.PI/2;f&&(v.visibility=
0,l.visibility=0);a.addChild(v);a.addChild(l);return{arrowMesh:v,arrowTail:l}};B.prototype._attachedNodeChanged=function(a){this.dragBehavior&&(this.dragBehavior.enabled=a?!0:!1)};Object.defineProperty(B.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a;a?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):this.attachedNode=this.attachedMesh=null},enumerable:!1,configurable:!0});B.prototype.dispose=function(){this.onSnapObservable.clear();
this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);this.dragBehavior.detach();this._gizmoMesh&&this._gizmoMesh.dispose();[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(a){a&&a.dispose()});e.prototype.dispose.call(this)};B.prototype.setCustomMesh=function(a,b){var f=this;void 0===b&&(b=!1);e.prototype.setCustomMesh.call(this,a);b&&(this._rootMesh.getChildMeshes().forEach(function(a){a.material=f._coloredMaterial;a.color&&(a.color=
f._coloredMaterial.diffuseColor)}),this._customMeshSet=!1)};return B}(z.a),F=e("uyO6"),I=e("ikaq"),J=e("H22S"),A=e("IIC5"),y=e("l/Gj"),h=e("MhaC"),p=function(b){function e(v,l){void 0===v&&(v=x.a.Gray());void 0===l&&(l=D.a.DefaultKeepDepthUtilityLayer);var f=b.call(this,l)||this;f._boundingDimensions=new g.e(1,1,1);f._renderObserver=null;f._pointerObserver=null;f._scaleDragSpeed=.2;f._tmpQuaternion=new g.b;f._tmpVector=new g.e(0,0,0);f._tmpRotationMatrix=new g.a;f.ignoreChildren=!1;f.includeChildPredicate=
null;f.rotationSphereSize=.1;f.scaleBoxSize=.1;f.fixedDragMeshScreenSize=!1;f.fixedDragMeshBoundsSize=!1;f.fixedDragMeshScreenSizeDistanceFactor=10;f.onDragStartObservable=new n.a;f.onScaleBoxDragObservable=new n.a;f.onScaleBoxDragEndObservable=new n.a;f.onRotationSphereDragObservable=new n.a;f.onRotationSphereDragEndObservable=new n.a;f.scalePivot=null;f._existingMeshScale=new g.e;f._dragMesh=null;f.pointerDragBehavior=new a.a;f.updateScale=!1;f._anchorMesh=new I.a("anchor",l.utilityLayerScene);
f.coloredMaterial=new c.a("",l.utilityLayerScene);f.coloredMaterial.disableLighting=!0;f.hoverColoredMaterial=new c.a("",l.utilityLayerScene);f.hoverColoredMaterial.disableLighting=!0;f._lineBoundingBox=new I.a("",l.utilityLayerScene);f._lineBoundingBox.rotationQuaternion=new g.b;var e=[];e.push(A.a.CreateLines("lines",{points:[new g.e(0,0,0),new g.e(f._boundingDimensions.x,0,0)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(0,0,0),new g.e(0,f._boundingDimensions.y,0)]},l.utilityLayerScene));
e.push(A.a.CreateLines("lines",{points:[new g.e(0,0,0),new g.e(0,0,f._boundingDimensions.z)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(f._boundingDimensions.x,0,0),new g.e(f._boundingDimensions.x,f._boundingDimensions.y,0)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(f._boundingDimensions.x,0,0),new g.e(f._boundingDimensions.x,0,f._boundingDimensions.z)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(0,f._boundingDimensions.y,
0),new g.e(f._boundingDimensions.x,f._boundingDimensions.y,0)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(0,f._boundingDimensions.y,0),new g.e(0,f._boundingDimensions.y,f._boundingDimensions.z)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(0,0,f._boundingDimensions.z),new g.e(f._boundingDimensions.x,0,f._boundingDimensions.z)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(0,0,f._boundingDimensions.z),new g.e(0,f._boundingDimensions.y,
f._boundingDimensions.z)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(f._boundingDimensions.x,f._boundingDimensions.y,f._boundingDimensions.z),new g.e(0,f._boundingDimensions.y,f._boundingDimensions.z)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(f._boundingDimensions.x,f._boundingDimensions.y,f._boundingDimensions.z),new g.e(f._boundingDimensions.x,0,f._boundingDimensions.z)]},l.utilityLayerScene));e.push(A.a.CreateLines("lines",{points:[new g.e(f._boundingDimensions.x,
f._boundingDimensions.y,f._boundingDimensions.z),new g.e(f._boundingDimensions.x,f._boundingDimensions.y,0)]},l.utilityLayerScene));e.forEach(function(a){a.color=v;a.position.addInPlace(new g.e(-f._boundingDimensions.x/2,-f._boundingDimensions.y/2,-f._boundingDimensions.z/2));a.isPickable=!1;f._lineBoundingBox.addChild(a)});f._rootMesh.addChild(f._lineBoundingBox);f.setColor(v);f._rotateSpheresParent=new I.a("",l.utilityLayerScene);f._rotateSpheresParent.rotationQuaternion=new g.b;e=function(b){var v=
J.a.CreateSphere("",{diameter:1},l.utilityLayerScene);v.rotationQuaternion=new g.b;v.material=B.coloredMaterial;h=new a.a({});h.moveAttached=!1;h.updateDragPlane=!1;v.addBehavior(h);var c=new g.e(1,0,0),d=0;h.onDragStartObservable.add(function(){c.copyFrom(v.forward);d=0});h.onDragObservable.add(function(a){f.onRotationSphereDragObservable.notifyObservers({});if(f.attachedMesh){var v=f.attachedMesh.parent;if(v&&v.scaling&&v.scaling.isNonUniformWithinEpsilon(.001)){F.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");
return}y.a._RemoveAndStorePivotPoint(f.attachedMesh);var l=a.dragPlaneNormal.scale(g.e.Dot(a.dragPlaneNormal,c));l=c.subtract(l).normalizeToNew();a=0>g.e.Dot(l,a.delta)?Math.abs(a.delta.length()):-Math.abs(a.delta.length());a=a/f._boundingDimensions.length()*f._anchorMesh.scaling.length();f.attachedMesh.rotationQuaternion||(f.attachedMesh.rotationQuaternion=g.b.RotationYawPitchRoll(f.attachedMesh.rotation.y,f.attachedMesh.rotation.x,f.attachedMesh.rotation.z));f._anchorMesh.rotationQuaternion||(f._anchorMesh.rotationQuaternion=
g.b.RotationYawPitchRoll(f._anchorMesh.rotation.y,f._anchorMesh.rotation.x,f._anchorMesh.rotation.z));d+=a;Math.abs(d)<=2*Math.PI&&(8<=b?g.b.RotationYawPitchRollToRef(0,0,a,f._tmpQuaternion):4<=b?g.b.RotationYawPitchRollToRef(a,0,0,f._tmpQuaternion):g.b.RotationYawPitchRollToRef(0,a,0,f._tmpQuaternion),f._anchorMesh.addChild(f.attachedMesh),f._anchorMesh.rotationQuaternion.multiplyToRef(f._tmpQuaternion,f._anchorMesh.rotationQuaternion),f._anchorMesh.removeChild(f.attachedMesh),f.attachedMesh.setParent(v));
f.updateBoundingBox();y.a._RestorePivotPoint(f.attachedMesh)}f._updateDummy()});h.onDragStartObservable.add(function(){f.onDragStartObservable.notifyObservers({});f._selectNode(v)});h.onDragEndObservable.add(function(){f.onRotationSphereDragEndObservable.notifyObservers({});f._selectNode(null);f._updateDummy()});B._rotateSpheresParent.addChild(v)};for(var B=this,h,p=0;12>p;p++)e(p);f._rootMesh.addChild(f._rotateSpheresParent);f._scaleBoxesParent=new I.a("",l.utilityLayerScene);f._scaleBoxesParent.rotationQuaternion=
new g.b;for(var k=0;3>k;k++)for(var O=0;3>O;O++){e=function(){var b=(1===k?1:0)+(1===O?1:0)+(1===q?1:0);if(1===b||3===b)return"continue";var v=d.a.CreateBox("",{size:1},l.utilityLayerScene);v.material=m.coloredMaterial;v.metadata=2===b;var c=(new g.e(k-1,O-1,q-1)).normalize();h=new a.a({dragAxis:c});h.updateDragPlane=!1;h.moveAttached=!1;v.addBehavior(h);h.onDragObservable.add(function(a){f.onScaleBoxDragObservable.notifyObservers({});if(f.attachedMesh){var l=f.attachedMesh.parent;if(l&&l.scaling&&
l.scaling.isNonUniformWithinEpsilon(.001)){F.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");return}y.a._RemoveAndStorePivotPoint(f.attachedMesh);a=a.dragDistance/f._boundingDimensions.length()*f._anchorMesh.scaling.length();a=new g.e(a,a,a);2===b&&(a.x*=Math.abs(c.x),a.y*=Math.abs(c.y),a.z*=Math.abs(c.z));a.scaleInPlace(f._scaleDragSpeed);f.updateBoundingBox();f.scalePivot?(f.attachedMesh.getWorldMatrix().getRotationMatrixToRef(f._tmpRotationMatrix),
f._boundingDimensions.scaleToRef(.5,f._tmpVector),g.e.TransformCoordinatesToRef(f._tmpVector,f._tmpRotationMatrix,f._tmpVector),f._anchorMesh.position.subtractInPlace(f._tmpVector),f._boundingDimensions.multiplyToRef(f.scalePivot,f._tmpVector),g.e.TransformCoordinatesToRef(f._tmpVector,f._tmpRotationMatrix,f._tmpVector),f._anchorMesh.position.addInPlace(f._tmpVector)):(v.absolutePosition.subtractToRef(f._anchorMesh.position,f._tmpVector),f._anchorMesh.position.subtractInPlace(f._tmpVector));f._anchorMesh.addChild(f.attachedMesh);
f._anchorMesh.scaling.addInPlace(a);(0>f._anchorMesh.scaling.x||0>f._anchorMesh.scaling.y||0>f._anchorMesh.scaling.z)&&f._anchorMesh.scaling.subtractInPlace(a);f._anchorMesh.removeChild(f.attachedMesh);f.attachedMesh.setParent(l);y.a._RestorePivotPoint(f.attachedMesh)}f._updateDummy()});h.onDragStartObservable.add(function(){f.onDragStartObservable.notifyObservers({});f._selectNode(v)});h.onDragEndObservable.add(function(){f.onScaleBoxDragEndObservable.notifyObservers({});f._selectNode(null);f._updateDummy()});
m._scaleBoxesParent.addChild(v)};for(var m=this,q=0;3>q;q++)e()}f._rootMesh.addChild(f._scaleBoxesParent);var w=[];f._pointerObserver=l.utilityLayerScene.onPointerObservable.add(function(a){w[a.event.pointerId]?a.pickInfo&&a.pickInfo.pickedMesh!=w[a.event.pointerId]&&(w[a.event.pointerId].material=f.coloredMaterial,delete w[a.event.pointerId]):f._rotateSpheresParent.getChildMeshes().concat(f._scaleBoxesParent.getChildMeshes()).forEach(function(b){a.pickInfo&&a.pickInfo.pickedMesh==b&&(w[a.event.pointerId]=
b,b.material=f.hoverColoredMaterial)})});f._renderObserver=f.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){if(f.attachedMesh&&!f._existingMeshScale.equals(f.attachedMesh.scaling))f.updateBoundingBox();else if(f.fixedDragMeshScreenSize||f.fixedDragMeshBoundsSize)f._updateRotationSpheres(),f._updateScaleBoxes();f._dragMesh&&f.attachedMesh&&f.pointerDragBehavior.dragging&&(f._lineBoundingBox.position.rotateByQuaternionToRef(f._rootMesh.rotationQuaternion,f._tmpVector),f.attachedMesh.setAbsolutePosition(f._dragMesh.position.add(f._tmpVector.scale(-1))))});
f.updateBoundingBox();return f}Object(q.d)(e,b);e.prototype.setColor=function(a){this.coloredMaterial.emissiveColor=a;this.hoverColoredMaterial.emissiveColor=a.clone().add(new x.a(.3,.3,.3));this._lineBoundingBox.getChildren().forEach(function(b){b.color&&(b.color=a)})};e.prototype._attachedNodeChanged=function(a){var b=this;if(a){y.a._RemoveAndStorePivotPoint(a);var f=a.parent;this._anchorMesh.addChild(a);this._anchorMesh.removeChild(a);a.setParent(f);y.a._RestorePivotPoint(a);this.updateBoundingBox();
a.getChildMeshes(!1).forEach(function(a){a.markAsDirty("scaling")});this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){b._updateDummy()})}};e.prototype._selectNode=function(a){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(b){b.isVisible=!a||b==a})};e.prototype.updateBoundingBox=function(){if(this.attachedMesh){y.a._RemoveAndStorePivotPoint(this.attachedMesh);var a=this.attachedMesh.parent;this.attachedMesh.setParent(null);
var b=null;this.attachedMesh.skeleton&&(b=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null);this._update();this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=g.b.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z));this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=g.b.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z));
this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion);this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion);this._tmpVector.copyFrom(this.attachedMesh.position);this.attachedMesh.rotationQuaternion.set(0,0,0,1);this.attachedMesh.position.set(0,0,0);var f=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);f.max.subtractToRef(f.min,this._boundingDimensions);this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions);
this._lineBoundingBox.position.set((f.max.x+f.min.x)/2,(f.max.y+f.min.y)/2,(f.max.z+f.min.z)/2);this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position);this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position);this._lineBoundingBox.computeWorldMatrix();this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition);this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion);this.attachedMesh.position.copyFrom(this._tmpVector);this.attachedMesh.setParent(a);
this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=b)}this._updateRotationSpheres();this._updateScaleBoxes();this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),y.a._RestorePivotPoint(this.attachedMesh))};e.prototype._updateRotationSpheres=function(){for(var a=this._rotateSpheresParent.getChildMeshes(),b=0;3>b;b++)for(var f=0;2>f;f++)for(var c=0;2>c;c++){var d=4*b+2*f+c;0==b&&(a[d].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*f,
this._boundingDimensions.z*c),a[d].position.addInPlace(new g.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),a[d].lookAt(g.e.Cross(a[d].position.normalizeToNew(),g.e.Right()).normalizeToNew().add(a[d].position)));1==b&&(a[d].position.set(this._boundingDimensions.x*f,this._boundingDimensions.y/2,this._boundingDimensions.z*c),a[d].position.addInPlace(new g.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),a[d].lookAt(g.e.Cross(a[d].position.normalizeToNew(),
g.e.Up()).normalizeToNew().add(a[d].position)));2==b&&(a[d].position.set(this._boundingDimensions.x*f,this._boundingDimensions.y*c,this._boundingDimensions.z/2),a[d].position.addInPlace(new g.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),a[d].lookAt(g.e.Cross(a[d].position.normalizeToNew(),g.e.Forward()).normalizeToNew().add(a[d].position)));if(this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){a[d].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,
this._tmpVector);var e=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;a[d].scaling.set(e,e,e)}else this.fixedDragMeshBoundsSize?a[d].scaling.set(this.rotationSphereSize*this._boundingDimensions.x,this.rotationSphereSize*this._boundingDimensions.y,this.rotationSphereSize*this._boundingDimensions.z):a[d].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}};e.prototype._updateScaleBoxes=function(){for(var a=this._scaleBoxesParent.getChildMeshes(),
b=0,f=0;3>f;f++)for(var c=0;3>c;c++)for(var d=0;3>d;d++){var e=(1===f?1:0)+(1===c?1:0)+(1===d?1:0);1!==e&&3!==e&&(a[b]&&(a[b].position.set(f/2*this._boundingDimensions.x,c/2*this._boundingDimensions.y,d/2*this._boundingDimensions.z),a[b].position.addInPlace(new g.e(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera?(a[b].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,
this._tmpVector),e=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor,a[b].scaling.set(e,e,e)):this.fixedDragMeshBoundsSize?a[b].scaling.set(this.scaleBoxSize*this._boundingDimensions.x,this.scaleBoxSize*this._boundingDimensions.y,this.scaleBoxSize*this._boundingDimensions.z):a[b].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)),b++)}};e.prototype.setEnabledRotationAxis=function(a){this._rotateSpheresParent.getChildMeshes().forEach(function(b,
f){4>f?b.setEnabled(-1!=a.indexOf("x")):8>f?b.setEnabled(-1!=a.indexOf("y")):b.setEnabled(-1!=a.indexOf("z"))})};e.prototype.setEnabledScaling=function(a,b){void 0===b&&(b=!1);this._scaleBoxesParent.getChildMeshes().forEach(function(f,c){c=a;b&&!0===f.metadata&&(c=!1);f.setEnabled(c)})};e.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))};
e.prototype.enableDragBehavior=function(){this._dragMesh=w.a.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene);this._dragMesh.visibility=0;this._dragMesh.rotationQuaternion=new g.b;this.pointerDragBehavior.useObjectOrientationForDragging=!1;this._dragMesh.addBehavior(this.pointerDragBehavior)};e.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver);this._lineBoundingBox.dispose();
this._rotateSpheresParent.dispose();this._scaleBoxesParent.dispose();this._dragMesh&&this._dragMesh.dispose();b.prototype.dispose.call(this)};e.MakeNotPickableAndWrapInBoundingBox=function(a){var b=function(a){a.isPickable=!1;a.getChildMeshes().forEach(function(a){b(a)})};b(a);a.rotationQuaternion||(a.rotationQuaternion=g.b.RotationYawPitchRoll(a.rotation.y,a.rotation.x,a.rotation.z));var f=a.position.clone(),c=a.rotationQuaternion.clone();a.rotationQuaternion.set(0,0,0,1);a.position.set(0,0,0);var v=
d.a.CreateBox("box",{size:1},a.getScene()),e=a.getHierarchyBoundingVectors();e.max.subtractToRef(e.min,v.scaling);0===v.scaling.y&&(v.scaling.y=h.a);0===v.scaling.x&&(v.scaling.x=h.a);0===v.scaling.z&&(v.scaling.z=h.a);v.position.set((e.max.x+e.min.x)/2,(e.max.y+e.min.y)/2,(e.max.z+e.min.z)/2);a.addChild(v);a.rotationQuaternion.copyFrom(c);a.position.copyFrom(f);a.removeChild(v);v.addChild(a);v.visibility=0;return v};e.prototype.setCustomMesh=function(a){F.a.Error("Custom meshes are not supported on this gizmo")};
return e}(z.a),E=e("98Qd"),G=e("HL0w"),L=function(b){function d(v,l,f,d,e,h,p){void 0===l&&(l=x.a.Gray());void 0===f&&(f=D.a.DefaultUtilityLayer);void 0===d&&(d=32);void 0===e&&(e=null);void 0===h&&(h=!1);void 0===p&&(p=1);var B,r=b.call(this,f)||this;r._pointerObserver=null;r.snapDistance=0;r.onSnapObservable=new n.a;r._isEnabled=!0;r._parent=null;r._dragging=!1;r._parent=e;r._coloredMaterial=new c.a("",f.utilityLayerScene);r._coloredMaterial.diffuseColor=l;r._coloredMaterial.specularColor=l.subtract(new x.a(.1,
.1,.1));r._hoverMaterial=new c.a("",f.utilityLayerScene);r._hoverMaterial.diffuseColor=x.a.Yellow();r._disableMaterial=new c.a("",f.utilityLayerScene);r._disableMaterial.diffuseColor=x.a.Gray();r._disableMaterial.alpha=.4;r._gizmoMesh=new w.a("",f.utilityLayerScene);d=r._createGizmoMesh(r._gizmoMesh,p,d);l=d.rotationMesh;d=d.collider;var y=[];r._rotationCircle=r.setupRotationCircle(y,r._gizmoMesh);r._gizmoMesh.lookAt(r._rootMesh.position.add(v));r._rootMesh.addChild(r._gizmoMesh);r._gizmoMesh.scaling.scaleInPlace(1/
3);r.dragBehavior=new a.a({dragPlaneNormal:v});r.dragBehavior.moveAttached=!1;r.dragBehavior.maxDragAngle=9*Math.PI/20;r.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0;r._rootMesh.addBehavior(r.dragBehavior);var k=0,N=new g.e,m=new g.e,q=new g.a,t=new g.e,H=new g.e;r.dragBehavior.onDragStartObservable.add(function(a){if(r.attachedNode){N.copyFrom(a.dragPlanePoint);var b=new g.e(0,0,1),f=r._rotationCircle.getDirection(b);f.normalize();r._gizmoMesh.removeChild(r._rotationCircle);N.copyFrom(a.dragPlanePoint);
m=a.dragPlanePoint;b=r._rotationCircle.getAbsolutePosition().clone();f=r._rotationCircle.getAbsolutePosition().clone().addInPlace(f);a=a.dragPlanePoint;a=g.e.GetAngleBetweenVectors(f.subtract(b),a.subtract(b),r._rotationCircle.up);r._rotationCircle.addRotation(0,a,0);r._dragging=!0}});r.dragBehavior.onDragEndObservable.add(function(){k=0;r.updateRotationCircle(r._rotationCircle,y,k,m);r._gizmoMesh.addChild(r._rotationCircle);r._dragging=!1});var A={snapDistance:0},E=0,G=new g.a,C=new g.b;r.dragBehavior.onDragObservable.add(function(a){if(r.attachedNode){var b=
new g.e(1,1,1),c=new g.b(0,0,0,1),d=new g.e(0,0,0);r.attachedNode.getWorldMatrix().decompose(b,c,d);var l=a.dragPlanePoint.subtract(d).normalize(),e=N.subtract(d).normalize(),h=g.e.Cross(l,e);l=g.e.Dot(l,e);l=Math.atan2(h.length(),l);t.copyFrom(v);H.copyFrom(v);r.updateGizmoRotationToMatchAttachedMesh&&(c.toRotationMatrix(q),H=g.e.TransformCoordinates(t,q));e=!1;if(f.utilityLayerScene.activeCamera){var p=f.utilityLayerScene.activeCamera.position.subtract(d);0<g.e.Dot(p,H)&&(t.scaleInPlace(-1),H.scaleInPlace(-1),
e=!0)}0<g.e.Dot(H,h)&&(l=-l);h=!1;0!=r.snapDistance&&(E+=l,Math.abs(E)>r.snapDistance?(h=Math.floor(Math.abs(E)/r.snapDistance),0>E&&(h*=-1),E%=r.snapDistance,l=r.snapDistance*h,h=!0):l=0);k+=e?-l:l;r.updateRotationCircle(r._rotationCircle,y,k,m);e=Math.sin(l/2);C.set(t.x*e,t.y*e,t.z*e,Math.cos(l/2));0<G.determinant()&&(e=new g.e,C.toEulerAnglesToRef(e),g.b.RotationYawPitchRollToRef(e.y,-e.x,-e.z,C));r.updateGizmoRotationToMatchAttachedMesh?c.multiplyToRef(C,c):C.multiplyToRef(c,c);r.attachedNode.getWorldMatrix().copyFrom(g.a.Compose(b,
c,d));N.copyFrom(a.dragPlanePoint);h&&(A.snapDistance=l,r.onSnapObservable.notifyObservers(A));r._matrixChanged()}});e=f._getSharedGizmoLight();e.includedOnlyMeshes=e.includedOnlyMeshes.concat(r._rootMesh.getChildMeshes(!1));var M={colliderMeshes:[d],gizmoMeshes:[l],material:r._coloredMaterial,hoverMaterial:r._hoverMaterial,disableMaterial:r._disableMaterial,active:!1};null===(B=r._parent)||void 0===B?void 0:B.addToAxisCache(r._gizmoMesh,M);r._pointerObserver=f.utilityLayerScene.onPointerObservable.add(function(a){var b;
if(!r._customMeshSet&&(r._isHovered=-1!=M.colliderMeshes.indexOf(null===(b=null===a||void 0===a?void 0:a.pickInfo)||void 0===b?void 0:b.pickedMesh),!r._parent)){var f=r._isHovered||r._dragging?r._hoverMaterial:r._coloredMaterial;M.gizmoMeshes.forEach(function(a){a.material=f;a.color&&(a.color=f.diffuseColor)})}});return r}Object(q.d)(d,b);d.prototype._createGizmoMesh=function(a,b,f){var c=w.a.CreateTorus("ignore",.6,.03*b,f,this.gizmoLayer.utilityLayerScene);c.visibility=0;b=w.a.CreateTorus("",.6,
.005*b,f,this.gizmoLayer.utilityLayerScene);b.material=this._coloredMaterial;b.rotation.x=Math.PI/2;c.rotation.x=Math.PI/2;a.addChild(b);a.addChild(c);return{rotationMesh:b,collider:c}};d.prototype._attachedNodeChanged=function(a){this.dragBehavior&&(this.dragBehavior.enabled=a?!0:!1)};d.prototype.setupRotationCircle=function(a,b){for(var f=d._CircleConstants.pi2/d._CircleConstants.tessellation,l=-Math.PI/2;l<Math.PI/2-1.5;l+=f/2){for(var v=[],e=0;e<d._CircleConstants.pi2*d._CircleConstants.rotationCircleRange+
.01;e+=f)0>e?v.push(new g.e(d._CircleConstants.radius*Math.sin(e)*Math.cos(l),0,d._CircleConstants.radius*Math.cos(e)*Math.cos(l))):v.push(new g.e(0,0,0));a.push(v)}f=new c.a("",this.gizmoLayer.utilityLayerScene);f.diffuseColor=x.a.Yellow();f.backFaceCulling=!1;a=w.a.CreateRibbon("rotationCircle",a,!1,!1,0,this.gizmoLayer.utilityLayerScene,!0);a.material=f;a.material.alpha=.25;a.rotation.x=Math.PI/2;b.addChild(a);return a};d.prototype.updateRotationPath=function(a,b){for(var f=d._CircleConstants.pi2/
d._CircleConstants.tessellation,c=0,l=-Math.PI/2;l<Math.PI/2-1.5;l+=f/2){var v=a[c];if(v)for(var e=0,g=0;g<d._CircleConstants.pi2*d._CircleConstants.rotationCircleRange+.01;g+=f){if(v[e])if(g<Math.abs(b)){var h=0<b?g:-1*g,p=0<b?l:-1*l;v[e].set(d._CircleConstants.radius*Math.sin(h)*Math.cos(p),0,d._CircleConstants.radius*Math.cos(h)*Math.cos(p))}else v[e].set(0,0,0);e++}c++}};d.prototype.updateRotationCircle=function(a,b,f,c){this.updateRotationPath(b,f);w.a.CreateRibbon("rotationCircle",b,!1,!1,0,
this.gizmoLayer.utilityLayerScene,void 0,void 0,a.geometry?a:void 0)};Object.defineProperty(d.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a;a?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!1,configurable:!0});d.prototype.dispose=function(){this.onSnapObservable.clear();this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);this.dragBehavior.detach();this._gizmoMesh&&this._gizmoMesh.dispose();
this._rotationCircle&&this._rotationCircle.dispose();[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(a){a&&a.dispose()});b.prototype.dispose.call(this)};d._CircleConstants={radius:.3,pi2:2*Math.PI,tessellation:70,rotationCircleRange:4};return d}(z.a),T=function(a){function b(b,c,f,d,e){void 0===b&&(b=D.a.DefaultUtilityLayer);void 0===c&&(c=32);void 0===f&&(f=!1);void 0===d&&(d=1);var l=a.call(this,b)||this;l.onDragStartObservable=new n.a;l.onDragEndObservable=new n.a;
l._observables=[];l._gizmoAxisCache=new Map;l.xGizmo=new L(new g.e(1,0,0),x.a.Red().scale(.5),b,c,l,f,d);l.yGizmo=new L(new g.e(0,1,0),x.a.Green().scale(.5),b,c,l,f,d);l.zGizmo=new L(new g.e(0,0,1),x.a.Blue().scale(.5),b,c,l,f,d);[l.xGizmo,l.yGizmo,l.zGizmo].forEach(function(a){a.dragBehavior.onDragStartObservable.add(function(){l.onDragStartObservable.notifyObservers({})});a.dragBehavior.onDragEndObservable.add(function(){l.onDragEndObservable.notifyObservers({})})});l.attachedMesh=null;l.attachedNode=
null;e?e.addToAxisCache(l._gizmoAxisCache):z.a.GizmoAxisPointerObserver(b,l._gizmoAxisCache);return l}Object(q.d)(b,a);Object.defineProperty(b.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(a){this._nodeAttached=this._meshAttached=a;this._checkBillboardTransform();[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(b){b.attachedMesh=b.isEnabled?a:null})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"attachedNode",{get:function(){return this._nodeAttached},
set:function(a){this._meshAttached=null;this._nodeAttached=a;this._checkBillboardTransform();[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(b){b.attachedNode=b.isEnabled?a:null})},enumerable:!1,configurable:!0});b.prototype._checkBillboardTransform=function(){this._nodeAttached&&this._nodeAttached.billboardMode&&console.log("Rotation Gizmo will not work with transforms in billboard mode.")};Object.defineProperty(b.prototype,"isHovered",{get:function(){var a=!1;[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(b){a=
a||b.isHovered});return a},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(a){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=a,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=a,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},
set:function(a){this.xGizmo&&(this.xGizmo.snapDistance=a,this.yGizmo.snapDistance=a,this.zGizmo.snapDistance=a)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(a){this.xGizmo&&(this.xGizmo.scaleRatio=a,this.yGizmo.scaleRatio=a,this.zGizmo.scaleRatio=a)},enumerable:!1,configurable:!0});b.prototype.addToAxisCache=function(a,b){this._gizmoAxisCache.set(a,b)};b.prototype.dispose=function(){var a=this;this.xGizmo.dispose();
this.yGizmo.dispose();this.zGizmo.dispose();this.onDragStartObservable.clear();this.onDragEndObservable.clear();this._observables.forEach(function(b){a.gizmoLayer.utilityLayerScene.onPointerObservable.remove(b)})};b.prototype.setCustomMesh=function(a){F.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")};return b}(z.a),C=e("qVgn"),S=e("NNSw"),P=function(b){function d(e,l,f,r){void 0===
l&&(l=x.a.Gray());void 0===f&&(f=D.a.DefaultUtilityLayer);void 0===r&&(r=null);var v,h=b.call(this,f)||this;h._pointerObserver=null;h.snapDistance=0;h.onSnapObservable=new n.a;h._isEnabled=!1;h._parent=null;h._dragging=!1;h._parent=r;h._coloredMaterial=new c.a("",f.utilityLayerScene);h._coloredMaterial.diffuseColor=l;h._coloredMaterial.specularColor=l.subtract(new x.a(.1,.1,.1));h._hoverMaterial=new c.a("",f.utilityLayerScene);h._hoverMaterial.diffuseColor=x.a.Yellow();h._disableMaterial=new c.a("",
f.utilityLayerScene);h._disableMaterial.diffuseColor=x.a.Gray();h._disableMaterial.alpha=.4;h._gizmoMesh=d._CreatePlane(f.utilityLayerScene,h._coloredMaterial);h._gizmoMesh.lookAt(h._rootMesh.position.add(e));h._gizmoMesh.scaling.scaleInPlace(1/3);h._gizmoMesh.parent=h._rootMesh;var p=0,y=new g.e,k={snapDistance:0};h.dragBehavior=new a.a({dragPlaneNormal:e});h.dragBehavior.moveAttached=!1;h._rootMesh.addBehavior(h.dragBehavior);h.dragBehavior.onDragObservable.add(function(a){if(h.attachedNode){if(0==
h.snapDistance)h.attachedNode.getWorldMatrix().addTranslationFromFloats(a.delta.x,a.delta.y,a.delta.z);else if(p+=a.dragDistance,Math.abs(p)>h.snapDistance){var b=Math.floor(Math.abs(p)/h.snapDistance);p%=h.snapDistance;a.delta.normalizeToRef(y);y.scaleInPlace(h.snapDistance*b);h.attachedNode.getWorldMatrix().addTranslationFromFloats(y.x,y.y,y.z);k.snapDistance=h.snapDistance*b;h.onSnapObservable.notifyObservers(k)}h._matrixChanged()}});h.dragBehavior.onDragStartObservable.add(function(){h._dragging=
!0});h.dragBehavior.onDragEndObservable.add(function(){h._dragging=!1});e=f._getSharedGizmoLight();e.includedOnlyMeshes=e.includedOnlyMeshes.concat(h._rootMesh.getChildMeshes(!1));var B={gizmoMeshes:h._gizmoMesh.getChildMeshes(),colliderMeshes:h._gizmoMesh.getChildMeshes(),material:h._coloredMaterial,hoverMaterial:h._hoverMaterial,disableMaterial:h._disableMaterial,active:!1};null===(v=h._parent)||void 0===v?void 0:v.addToAxisCache(h._gizmoMesh,B);h._pointerObserver=f.utilityLayerScene.onPointerObservable.add(function(a){var b;
if(!h._customMeshSet&&(h._isHovered=-1!=B.colliderMeshes.indexOf(null===(b=null===a||void 0===a?void 0:a.pickInfo)||void 0===b?void 0:b.pickedMesh),!h._parent)){var f=h._isHovered||h._dragging?h._hoverMaterial:h._coloredMaterial;B.gizmoMeshes.forEach(function(a){a.material=f})}});return h}Object(q.d)(d,b);d._CreatePlane=function(a,b){var f=new C.a("plane",a);a=S.a.CreatePlane("dragPlane",{width:.1375,height:.1375,sideOrientation:2},a);a.material=b;return a.parent=f};d.prototype._attachedNodeChanged=
function(a){this.dragBehavior&&(this.dragBehavior.enabled=a?!0:!1)};Object.defineProperty(d.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a;a?this._parent&&(this.attachedNode=this._parent.attachedNode):this.attachedNode=null},enumerable:!1,configurable:!0});d.prototype.dispose=function(){this.onSnapObservable.clear();this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);this.dragBehavior.detach();b.prototype.dispose.call(this);
this._gizmoMesh&&this._gizmoMesh.dispose();[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(a){a&&a.dispose()})};return d}(z.a),U=function(a){function b(b,c,f){void 0===b&&(b=D.a.DefaultUtilityLayer);void 0===c&&(c=1);var d=a.call(this,b)||this;d._meshAttached=null;d._nodeAttached=null;d._observables=[];d._gizmoAxisCache=new Map;d.onDragStartObservable=new n.a;d.onDragEndObservable=new n.a;d._planarGizmoEnabled=!1;d.xGizmo=new m.a(new g.e(1,0,0),x.a.Red().scale(.5),
b,d,c);d.yGizmo=new m.a(new g.e(0,1,0),x.a.Green().scale(.5),b,d,c);d.zGizmo=new m.a(new g.e(0,0,1),x.a.Blue().scale(.5),b,d,c);d.xPlaneGizmo=new P(new g.e(1,0,0),x.a.Red().scale(.5),d.gizmoLayer,d);d.yPlaneGizmo=new P(new g.e(0,1,0),x.a.Green().scale(.5),d.gizmoLayer,d);d.zPlaneGizmo=new P(new g.e(0,0,1),x.a.Blue().scale(.5),d.gizmoLayer,d);[d.xGizmo,d.yGizmo,d.zGizmo,d.xPlaneGizmo,d.yPlaneGizmo,d.zPlaneGizmo].forEach(function(a){a.dragBehavior.onDragStartObservable.add(function(){d.onDragStartObservable.notifyObservers({})});
a.dragBehavior.onDragEndObservable.add(function(){d.onDragEndObservable.notifyObservers({})})});d.attachedMesh=null;f?f.addToAxisCache(d._gizmoAxisCache):z.a.GizmoAxisPointerObserver(b,d._gizmoAxisCache);return d}Object(q.d)(b,a);Object.defineProperty(b.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(a){this._nodeAttached=this._meshAttached=a;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(b){b.attachedMesh=
b.isEnabled?a:null})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(a){this._nodeAttached=this._meshAttached=null;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(b){b.attachedNode=b.isEnabled?a:null})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"isHovered",{get:function(){var a=!1;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,
this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(b){a=a||b.isHovered});return a},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"planarGizmoEnabled",{get:function(){return this._planarGizmoEnabled},set:function(a){var b=this;this._planarGizmoEnabled=a;[this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(f){f&&(f.isEnabled=a)&&(f.attachedMesh?f.attachedMesh=b.attachedMesh:f.attachedNode=b.attachedNode)},this)},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,
"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(a){this._updateGizmoRotationToMatchAttachedMesh=a;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(b){b&&(b.updateGizmoRotationToMatchAttachedMesh=a)})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(a){this._snapDistance=a;[this.xGizmo,
this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(b){b&&(b.snapDistance=a)})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(a){this._scaleRatio=a;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(b){b&&(b.scaleRatio=a)})},enumerable:!1,configurable:!0});b.prototype.addToAxisCache=function(a,b){this._gizmoAxisCache.set(a,
b)};b.prototype.dispose=function(){var a=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(a){a&&a.dispose()});this._observables.forEach(function(b){a.gizmoLayer.utilityLayerScene.onPointerObservable.remove(b)});this.onDragStartObservable.clear();this.onDragEndObservable.clear()};b.prototype.setCustomMesh=function(a){F.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)")};
return b}(z.a),Q=e("RV+K"),W=function(a){function b(b,d,f){void 0===b&&(b=D.a.DefaultUtilityLayer);void 0===d&&(d=1);var c=a.call(this,b)||this;c._meshAttached=null;c._nodeAttached=null;c._sensitivity=1;c._observables=[];c._gizmoAxisCache=new Map;c.onDragStartObservable=new n.a;c.onDragEndObservable=new n.a;c.uniformScaleGizmo=c._createUniformScaleMesh();c.xGizmo=new K(new g.e(1,0,0),x.a.Red().scale(.5),b,c,d);c.yGizmo=new K(new g.e(0,1,0),x.a.Green().scale(.5),b,c,d);c.zGizmo=new K(new g.e(0,0,1),
x.a.Blue().scale(.5),b,c,d);[c.xGizmo,c.yGizmo,c.zGizmo,c.uniformScaleGizmo].forEach(function(a){a.dragBehavior.onDragStartObservable.add(function(){c.onDragStartObservable.notifyObservers({})});a.dragBehavior.onDragEndObservable.add(function(){c.onDragEndObservable.notifyObservers({})})});c.attachedMesh=null;c.attachedNode=null;f?f.addToAxisCache(c._gizmoAxisCache):z.a.GizmoAxisPointerObserver(b,c._gizmoAxisCache);return c}Object(q.d)(b,a);Object.defineProperty(b.prototype,"attachedMesh",{get:function(){return this._meshAttached},
set:function(a){this._nodeAttached=this._meshAttached=a;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(b){b.attachedMesh=b.isEnabled?a:null})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(a){this._meshAttached=null;this._nodeAttached=a;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(b){b.attachedNode=b.isEnabled?a:null})},enumerable:!1,configurable:!0});
Object.defineProperty(b.prototype,"isHovered",{get:function(){var a=!1;[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(b){a=a||b.isHovered});return a},enumerable:!1,configurable:!0});b.prototype._createUniformScaleMesh=function(){this._coloredMaterial=new c.a("",this.gizmoLayer.utilityLayerScene);this._coloredMaterial.diffuseColor=x.a.Gray();this._hoverMaterial=new c.a("",this.gizmoLayer.utilityLayerScene);this._hoverMaterial.diffuseColor=x.a.Yellow();this._disableMaterial=new c.a("",this.gizmoLayer.utilityLayerScene);
this._disableMaterial.diffuseColor=x.a.Gray();this._disableMaterial.alpha=.4;var a=new K(new g.e(0,1,0),x.a.Gray().scale(.5),this.gizmoLayer,this);a.updateGizmoRotationToMatchAttachedMesh=!1;a.uniformScaling=!0;this._uniformScalingMesh=Q.a.CreatePolyhedron("uniform",{type:1},a.gizmoLayer.utilityLayerScene);this._uniformScalingMesh.scaling.scaleInPlace(.01);this._uniformScalingMesh.visibility=0;this._octahedron=Q.a.CreatePolyhedron("",{type:1},a.gizmoLayer.utilityLayerScene);this._octahedron.scaling.scaleInPlace(.007);
this._uniformScalingMesh.addChild(this._octahedron);a.setCustomMesh(this._uniformScalingMesh,!0);var b=this.gizmoLayer._getSharedGizmoLight();b.includedOnlyMeshes=b.includedOnlyMeshes.concat(this._octahedron);this.addToAxisCache(a._rootMesh,{gizmoMeshes:[this._octahedron,this._uniformScalingMesh],colliderMeshes:[this._uniformScalingMesh],material:this._coloredMaterial,hoverMaterial:this._hoverMaterial,disableMaterial:this._disableMaterial,active:!1});return a};Object.defineProperty(b.prototype,"updateGizmoRotationToMatchAttachedMesh",
{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(a){a?(this._updateGizmoRotationToMatchAttachedMesh=a,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(b){b&&(b.updateGizmoRotationToMatchAttachedMesh=a)})):F.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.")},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(a){this._snapDistance=
a;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(b){b&&(b.snapDistance=a)})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(a){this._scaleRatio=a;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(b){b&&(b.scaleRatio=a)})},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(a){this._sensitivity=
a;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(b){b&&(b.sensitivity=a)})},enumerable:!1,configurable:!0});b.prototype.addToAxisCache=function(a,b){this._gizmoAxisCache.set(a,b)};b.prototype.dispose=function(){var a=this;[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(a){a&&a.dispose()});this._observables.forEach(function(b){a.gizmoLayer.utilityLayerScene.onPointerObservable.remove(b)});this.onDragStartObservable.clear();this.onDragEndObservable.clear();
[this._uniformScalingMesh,this._octahedron].forEach(function(a){a&&a.dispose()});[this._coloredMaterial,this._hoverMaterial,this._disableMaterial].forEach(function(a){a&&a.dispose()})};return b}(z.a);(function(){function a(a,b,c,f){void 0===b&&(b=1);void 0===c&&(c=D.a.DefaultUtilityLayer);void 0===f&&(f=D.a.DefaultKeepDepthUtilityLayer);this.scene=a;this.clearGizmoOnEmptyPointerEvent=!1;this.onAttachedToMeshObservable=new n.a;this.onAttachedToNodeObservable=new n.a;this._gizmosEnabled={positionGizmo:!1,
rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1};this._pointerObservers=[];this._attachedNode=this._attachedMesh=null;this._boundingBoxColor=x.a.FromHexString("#0984e3");this._thickness=1;this._gizmoAxisCache=new Map;this.boundingBoxDragBehavior=new G.a;this.attachableNodes=this.attachableMeshes=null;this.usePointerToAttachGizmos=!0;this._defaultUtilityLayer=c;this._defaultKeepDepthUtilityLayer=f;this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1;this._thickness=b;
this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null};a=this._attachToMeshPointerObserver(a);b=z.a.GizmoAxisPointerObserver(this._defaultUtilityLayer,this._gizmoAxisCache);this._pointerObservers=[a,b]}Object.defineProperty(a.prototype,"keepDepthUtilityLayer",{get:function(){return this._defaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"utilityLayer",{get:function(){return this._defaultUtilityLayer},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"isHovered",{get:function(){var a=!1,b;for(b in this.gizmos){var c=this.gizmos[b];if(c&&c.isHovered){a=!0;break}}return a},enumerable:!1,configurable:!0});a.prototype._attachToMeshPointerObserver=function(a){var b=this;return a.onPointerObservable.add(function(a){if(b.usePointerToAttachGizmos&&a.type==E.a.POINTERDOWN)if(a.pickInfo&&a.pickInfo.pickedMesh){var c=a.pickInfo.pickedMesh;if(null==b.attachableMeshes)for(;c&&null!=c.parent;)c=c.parent;else{var d=!1;b.attachableMeshes.forEach(function(a){c&&
(c==a||c.isDescendantOf(a))&&(c=a,d=!0)});d||(c=null)}c instanceof I.a?b._attachedMesh!=c&&b.attachToMesh(c):b.clearGizmoOnEmptyPointerEvent&&b.attachToMesh(null)}else b.clearGizmoOnEmptyPointerEvent&&b.attachToMesh(null)})};a.prototype.attachToMesh=function(a){this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior);this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior);this._attachedMesh=a;this._attachedNode=null;for(var b in this.gizmos){var c=
this.gizmos[b];c&&this._gizmosEnabled[b]&&(c.attachedMesh=a)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior);this.onAttachedToMeshObservable.notifyObservers(a)};a.prototype.attachToNode=function(a){this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior);this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior);this._attachedMesh=null;this._attachedNode=a;for(var b in this.gizmos){var c=
this.gizmos[b];c&&this._gizmosEnabled[b]&&(c.attachedNode=a)}this.boundingBoxGizmoEnabled&&this._attachedNode&&this._attachedNode.addBehavior(this.boundingBoxDragBehavior);this.onAttachedToNodeObservable.notifyObservers(a)};Object.defineProperty(a.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(a){a?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new U(this._defaultUtilityLayer,this._thickness,this)),this._attachedNode?this.gizmos.positionGizmo.attachedNode=
this._attachedNode:this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedNode=null);this._gizmosEnabled.positionGizmo=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(a){a?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new T(this._defaultUtilityLayer,32,!1,this._thickness,this)),this._attachedNode?this.gizmos.rotationGizmo.attachedNode=
this._attachedNode:this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedNode=null);this._gizmosEnabled.rotationGizmo=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(a){a?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new W(this._defaultUtilityLayer,this._thickness,this),this._attachedNode?this.gizmos.scaleGizmo.attachedNode=
this._attachedNode:this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedNode=null);this._gizmosEnabled.scaleGizmo=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(a){a?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new p(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this._attachedMesh?this.gizmos.boundingBoxGizmo.attachedMesh=
this._attachedMesh:this.gizmos.boundingBoxGizmo.attachedNode=this._attachedNode,this._attachedMesh?(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)):this._attachedNode&&(this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh?this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior):this._attachedNode&&
this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedNode=null);this._gizmosEnabled.boundingBoxGizmo=a},enumerable:!1,configurable:!0});a.prototype.addToAxisCache=function(a){var b=this;0<a.size&&a.forEach(function(a,c){b._gizmoAxisCache.set(c,a)})};a.prototype.dispose=function(){var a=this;this._pointerObservers.forEach(function(b){a.scene.onPointerObservable.remove(b)});for(var b in this.gizmos){var c=this.gizmos[b];c&&c.dispose()}this._defaultKeepDepthUtilityLayer.dispose();
this._defaultUtilityLayer.dispose();this.boundingBoxDragBehavior.detach();this.onAttachedToMeshObservable.clear()};return a})();var X=e("SqLj"),Y=e("lFBE"),R=e("oW/l"),Z=e("pVyc"),V=function(a){function b(b){void 0===b&&(b=D.a.DefaultUtilityLayer);var d=a.call(this,b)||this;d._cachedPosition=new g.e;d._cachedForward=new g.e(0,0,1);d._pointerObserver=null;d.onClickedObservable=new n.a;d._light=null;d.attachedMesh=new I.a("",d.gizmoLayer.utilityLayerScene);d._attachedMeshParent=new C.a("parent",d.gizmoLayer.utilityLayerScene);
d.attachedMesh.parent=d._attachedMeshParent;d._material=new c.a("light",d.gizmoLayer.utilityLayerScene);d._material.diffuseColor=new x.a(.5,.5,.5);d._material.specularColor=new x.a(.1,.1,.1);d._pointerObserver=b.utilityLayerScene.onPointerObservable.add(function(a){d._light&&(d._isHovered=!(!a.pickInfo||-1==d._rootMesh.getChildMeshes().indexOf(a.pickInfo.pickedMesh)),d._isHovered&&0===a.event.button&&d.onClickedObservable.notifyObservers(d._light))},E.a.POINTERDOWN);return d}Object(q.d)(b,a);Object.defineProperty(b.prototype,
"light",{get:function(){return this._light},set:function(a){var c=this;if(this._light=a){this._lightMesh&&this._lightMesh.dispose();this._lightMesh=a instanceof X.a?b._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):a instanceof Y.a?b._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):a instanceof Z.a?b._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):b._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene);this._lightMesh.getChildMeshes(!1).forEach(function(a){a.material=
c._material});this._lightMesh.parent=this._rootMesh;var d=this.gizmoLayer._getSharedGizmoLight();d.includedOnlyMeshes=d.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1));this._lightMesh.rotationQuaternion=new g.b;this.attachedMesh.reservedDataStore||(this.attachedMesh.reservedDataStore={});this.attachedMesh.reservedDataStore.lightGizmo=this;a.parent&&this._attachedMeshParent.freezeWorldMatrix(a.parent.getWorldMatrix());a.position&&(this.attachedMesh.position.copyFrom(a.position),this.attachedMesh.computeWorldMatrix(!0),
this._cachedPosition.copyFrom(this.attachedMesh.position));a.direction&&(this.attachedMesh.setDirection(a.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward));this._update()}},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0});b.prototype._update=function(){a.prototype._update.call(this);this._light&&(this._light.parent&&this._attachedMeshParent.freezeWorldMatrix(this._light.parent.getWorldMatrix()),
this._light.position&&(this.attachedMesh.position.equals(this._cachedPosition)?(this.attachedMesh.position.copyFrom(this._light.position),this.attachedMesh.computeWorldMatrix(!0)):this._light.position.copyFrom(this.attachedMesh.position),this._cachedPosition.copyFrom(this.attachedMesh.position)),this._light.direction&&(1E-4<g.e.DistanceSquared(this.attachedMesh.forward,this._cachedForward)?(this._light.direction.copyFrom(this.attachedMesh.forward),this._cachedForward.copyFrom(this.attachedMesh.forward)):
1E-4<g.e.DistanceSquared(this.attachedMesh.forward,this._light.direction)&&(this.attachedMesh.setDirection(this._light.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward))))};b.prototype.dispose=function(){this.onClickedObservable.clear();this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);this._material.dispose();a.prototype.dispose.call(this);this._attachedMeshParent.dispose()};b._CreateHemisphericLightMesh=
function(a){var c=new w.a("hemisphereLight",a),d=R.a.CreateHemisphere(c.name,{segments:10,diameter:1},a);d.position.z=-.15;d.rotation.x=Math.PI/2;d.parent=c;a=this._CreateLightLines(3,a);a.parent=c;a.position.z-.15;c.scaling.scaleInPlace(b._Scale);c.rotation.x=Math.PI/2;return c};b._CreatePointLightMesh=function(a){var c=new w.a("pointLight",a),d=J.a.CreateSphere(c.name,{segments:10,diameter:1},a);d.rotation.x=Math.PI/2;d.parent=c;this._CreateLightLines(5,a).parent=c;c.scaling.scaleInPlace(b._Scale);
c.rotation.x=Math.PI/2;return c};b._CreateSpotLightMesh=function(a){var c=new w.a("spotLight",a);J.a.CreateSphere(c.name,{segments:10,diameter:1},a).parent=c;var d=R.a.CreateHemisphere(c.name,{segments:10,diameter:2},a);d.parent=c;d.rotation.x=-Math.PI/2;this._CreateLightLines(2,a).parent=c;c.scaling.scaleInPlace(b._Scale);c.rotation.x=Math.PI/2;return c};b._CreateDirectionalLightMesh=function(a){var c=new w.a("directionalLight",a),d=new w.a(c.name,a);d.parent=c;J.a.CreateSphere(c.name,{diameter:1.2,
segments:10},a).parent=d;var e=w.a.CreateCylinder(c.name,6,.3,.3,6,1,a);e.parent=d;var g=e.clone(c.name);g.scaling.y=.5;g.position.x+=1.25;g=e.clone(c.name);g.scaling.y=.5;g.position.x+=-1.25;a=w.a.CreateCylinder(c.name,1,0,.6,6,1,a);a.position.y+=3;a.parent=d;g=a.clone(c.name);g.position.y=1.5;g.position.x+=1.25;g=a.clone(c.name);g.position.y=1.5;g.position.x+=-1.25;d.scaling.scaleInPlace(b._Scale);d.rotation.z=Math.PI/2;d.rotation.y=Math.PI/2;return c};b._Scale=.007;b._CreateLightLines=function(a,
b){var c=new w.a("root",b);c.rotation.x=Math.PI/2;var d=new w.a("linePivot",b);d.parent=c;b=w.a.CreateCylinder("line",2,.2,.3,6,1,b);b.position.y=b.scaling.y/2+1.2;b.parent=d;if(2>a)return d;for(b=0;4>b;b++){var e=d.clone("lineParentClone");e.rotation.z=Math.PI/4;e.rotation.y=Math.PI/2+Math.PI/2*b;e.getChildMeshes()[0].scaling.y=.5;e.getChildMeshes()[0].scaling.x=e.getChildMeshes()[0].scaling.z=.8;e.getChildMeshes()[0].position.y=e.getChildMeshes()[0].scaling.y/2+1.2}if(3>a)return c;for(b=0;4>b;b++)e=
d.clone("linePivotClone"),e.rotation.z=Math.PI/2,e.rotation.y=Math.PI/2*b;if(4>a)return c;for(b=0;4>b;b++)e=d.clone("linePivotClone"),e.rotation.z=Math.PI+Math.PI/4,e.rotation.y=Math.PI/2+Math.PI/2*b,e.getChildMeshes()[0].scaling.y=.5,e.getChildMeshes()[0].scaling.x=e.getChildMeshes()[0].scaling.z=.8,e.getChildMeshes()[0].position.y=e.getChildMeshes()[0].scaling.y/2+1.2;if(5>a)return c;e=d.clone("linePivotClone");e.rotation.z=Math.PI;return c};return b}(z.a),aa=e("GR64");(function(a){function e(b){void 0===
b&&(b=D.a.DefaultUtilityLayer);var d=a.call(this,b)||this;d._pointerObserver=null;d.onClickedObservable=new n.a;d._camera=null;d._invProjection=new aa.e;d._material=new c.a("cameraGizmoMaterial",d.gizmoLayer.utilityLayerScene);d._material.diffuseColor=new x.a(.5,.5,.5);d._material.specularColor=new x.a(.1,.1,.1);d._pointerObserver=b.utilityLayerScene.onPointerObservable.add(function(a){d._camera&&(d._isHovered=!(!a.pickInfo||-1==d._rootMesh.getChildMeshes().indexOf(a.pickInfo.pickedMesh)),d._isHovered&&
0===a.event.button&&d.onClickedObservable.notifyObservers(d._camera))},E.a.POINTERDOWN);return d}Object(q.d)(e,a);Object.defineProperty(e.prototype,"displayFrustum",{get:function(){return this._cameraLinesMesh.isEnabled()},set:function(a){this._cameraLinesMesh.setEnabled(a)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},set:function(a){var b=this;if(this.attachedNode=this._camera=a)this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&
this._cameraLinesMesh.dispose(),this._cameraMesh=e._CreateCameraMesh(this.gizmoLayer.utilityLayerScene),this._cameraLinesMesh=e._CreateCameraFrustum(this.gizmoLayer.utilityLayerScene),this._cameraMesh.getChildMeshes(!1).forEach(function(a){a.material=b._material}),this._cameraMesh.parent=this._rootMesh,this._cameraLinesMesh.parent=this._rootMesh,this.gizmoLayer.utilityLayerScene.activeCamera&&this.gizmoLayer.utilityLayerScene.activeCamera.maxZ<1.5*a.maxZ&&(this.gizmoLayer.utilityLayerScene.activeCamera.maxZ=
1.5*a.maxZ),this.attachedNode.reservedDataStore||(this.attachedNode.reservedDataStore={}),this.attachedNode.reservedDataStore.cameraGizmo=this,a=this.gizmoLayer._getSharedGizmoLight(),a.includedOnlyMeshes=a.includedOnlyMeshes.concat(this._cameraMesh.getChildMeshes(!1)),this._update()},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0});e.prototype._update=function(){a.prototype._update.call(this);this._camera&&
(this._camera.getProjectionMatrix().invertToRef(this._invProjection),this._cameraLinesMesh.setPivotMatrix(this._invProjection,!1),this._cameraLinesMesh.scaling.x=1/this._rootMesh.scaling.x,this._cameraLinesMesh.scaling.y=1/this._rootMesh.scaling.y,this._cameraLinesMesh.scaling.z=1/this._rootMesh.scaling.z,this._cameraMesh.parent=null,this._cameraMesh.rotation.y=.5*Math.PI*(this._camera.getScene().useRightHandedSystem?1:-1),this._cameraMesh.parent=this._rootMesh)};e.prototype.dispose=function(){this.onClickedObservable.clear();
this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);this._cameraMesh&&this._cameraMesh.dispose();this._cameraLinesMesh&&this._cameraLinesMesh.dispose();this._material.dispose();a.prototype.dispose.call(this)};e._CreateCameraMesh=function(a){var c=new w.a("rootCameraGizmo",a),f=new w.a(c.name,a);f.parent=c;d.a.CreateBox(c.name,{width:1,height:.8,depth:.5},a).parent=f;var g=b.a.CreateCylinder(c.name,{height:.5,diameterTop:.8,diameterBottom:.8},a);g.parent=f;g.position.y=
.3;g.position.x=-.6;g.rotation.x=.5*Math.PI;g=b.a.CreateCylinder(c.name,{height:.5,diameterTop:.6,diameterBottom:.6},a);g.parent=f;g.position.y=.5;g.position.x=.4;g.rotation.x=.5*Math.PI;a=b.a.CreateCylinder(c.name,{height:.5,diameterTop:.5,diameterBottom:.5},a);a.parent=f;a.position.y=0;a.position.x=.6;a.rotation.z=.5*Math.PI;c.scaling.scaleInPlace(e._Scale);f.position.x=-.9;return c};e._CreateCameraFrustum=function(a){var b=new w.a("rootCameraGizmo",a),c=new w.a(b.name,a);c.parent=b;for(var d=0;4>
d;d+=2)for(var e=0;4>e;e+=2){var h=A.a.CreateLines("lines",{points:[new g.e(-1+e,-1+d,-1),new g.e(-1+e,-1+d,1)]},a);h.parent=c;h.alwaysSelectAsActiveMesh=!0;h.isPickable=!1;h=A.a.CreateLines("lines",{points:[new g.e(-1,-1+e,-1+d),new g.e(1,-1+e,-1+d)]},a);h.parent=c;h.alwaysSelectAsActiveMesh=!0;h.isPickable=!1;h=A.a.CreateLines("lines",{points:[new g.e(-1+e,-1,-1+d),new g.e(-1+e,1,-1+d)]},a);h.parent=c;h.alwaysSelectAsActiveMesh=!0;h.isPickable=!1}return b};e._Scale=.05;return e})(z.a)},jSHE:function(k,
t,e){e.d(t,"a",function(){return q});e.d(t,"b",function(){return n});e.d(t,"c",function(){return g});var m=e("oYeq"),q=function(){function e(){}e.KEYDOWN=1;e.KEYUP=2;return e}(),n=function(){return function(e,d){this.type=e;this.event=d}}(),g=function(e){function d(b,c){var a=e.call(this,b,c)||this;a.type=b;a.event=c;a.skipOnPointerObservable=!1;return a}Object(m.d)(d,e);return d}(n)},vpVX:function(k,t,e){e.d(t,"a",function(){return n});var m=e("oYeq"),q=e("ps+7"),n=function(e){function g(d){var b=
e.call(this,d)||this;b.onTriggerStateChangedObservable=new q.a;b.onMainButtonStateChangedObservable=new q.a;b.onSecondaryButtonStateChangedObservable=new q.a;b.onPadStateChangedObservable=new q.a;b.onPadValuesChangedObservable=new q.a;b.pad={x:0,y:0};b._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1};b._buttons=Array(d.buttons.length);b.hand=d.hand;return b}Object(m.d)(g,e);g.prototype.onButtonStateChange=function(d){this._onButtonStateChange=d};Object.defineProperty(g.prototype,
"defaultModel",{get:function(){return this._defaultModel},enumerable:!1,configurable:!0});g.prototype.update=function(){e.prototype.update.call(this);for(var d=0;d<this._buttons.length;d++)this._setButtonValue(this.browserGamepad.buttons[d],this._buttons[d],d);if(this.leftStick.x!==this.pad.x||this.leftStick.y!==this.pad.y)this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad)};g.prototype._setButtonValue=function(d,b,c){d||(d={pressed:!1,
touched:!1,value:0});b?(this._checkChanges(d,b),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,c,d),this._handleButtonChange(c,d,this._changes)),this._buttons[c].pressed=d.pressed,this._buttons[c].touched=d.touched,this._buttons[c].value=1E-8>d.value?0:d.value):this._buttons[c]={pressed:d.pressed,touched:d.touched,value:d.value}};g.prototype._checkChanges=function(d,b){this._changes.pressChanged=d.pressed!==b.pressed;this._changes.touchChanged=d.touched!==
b.touched;this._changes.valueChanged=d.value!==b.value;this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged;return this._changes};g.prototype.dispose=function(){e.prototype.dispose.call(this);this._defaultModel=null;this.onTriggerStateChangedObservable.clear();this.onMainButtonStateChangedObservable.clear();this.onSecondaryButtonStateChangedObservable.clear();this.onPadStateChangedObservable.clear();this.onPadValuesChangedObservable.clear()};return g}(e("dprs").a)},
yMjZ:function(k,t,e){var m=e("oYeq"),q=e("uyO6"),n=e("R0D4");k=e("vpVX");var g=e("dprs"),w=function(a){function b(b){b=a.call(this,b)||this;b.controllerType=g.c.DAYDREAM;return b}Object(m.d)(b,a);b.prototype.initControllerMesh=function(a,c){var d=this;n.a.ImportMesh("",b.MODEL_BASE_URL,b.MODEL_FILENAME,a,function(a){d._defaultModel=a[1];d.attachToMesh(d._defaultModel);c&&c(d._defaultModel)})};b.prototype._handleButtonChange=function(a,b,c){0===a?(a=this.onTriggerStateChangedObservable)&&a.notifyObservers(b):
q.a.Warn("Unrecognized Daydream button index: "+a)};b.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/";b.MODEL_FILENAME="generic.babylon";b.GAMEPAD_ID_PREFIX="Daydream";return b}(k.a);g.b._ControllerFactories.push({canCreate:function(a){return 0===a.id.indexOf(w.GAMEPAD_ID_PREFIX)},create:function(a){return new w(a)}});var d=e("/SR9"),b=e("wAMR"),c=function(a){function c(b){b=a.call(this,b)||this;b._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"];
b.controllerType=g.c.GEAR_VR;b._calculatedPosition=new d.e("left"==b.hand?-.15:.15,-.5,.25);b._disableTrackPosition(b._calculatedPosition);return b}Object(m.d)(c,a);c.prototype.initControllerMesh=function(a,d){var e=this;n.a.ImportMesh("",c.MODEL_BASE_URL,c.MODEL_FILENAME,a,function(c){var g=new b.a("",a);c[1].parent=g;c[1].position.z=-.15;e._defaultModel=g;e.attachToMesh(e._defaultModel);d&&d(e._defaultModel)})};c.prototype._handleButtonChange=function(a,b,c){a<this._buttonIndexToObservableNameMap.length&&
(a=this[this._buttonIndexToObservableNameMap[a]])&&a.notifyObservers(b)};c.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/";c.MODEL_FILENAME="generic.babylon";c.GAMEPAD_ID_PREFIX="Gear VR";return c}(k.a);g.b._ControllerFactories.push({canCreate:function(a){return 0===a.id.indexOf(c.GAMEPAD_ID_PREFIX)||-1!==a.id.indexOf("Oculus Go")||-1!==a.id.indexOf("Vive Focus")},create:function(a){return new c(a)}});var a=function(a){function b(b){return a.call(this,b)||this}Object(m.d)(b,a);b.prototype.initControllerMesh=
function(a,c){var d=this;n.a.ImportMesh("",b.MODEL_BASE_URL,b.MODEL_FILENAME,a,function(a){d._defaultModel=a[1];d.attachToMesh(d._defaultModel);c&&c(d._defaultModel)})};b.prototype._handleButtonChange=function(a,b,c){console.log("Button id: "+a+"state: ");console.dir(b)};b.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/";b.MODEL_FILENAME="generic.babylon";return b}(k.a);g.b._DefaultControllerFactory=function(b){return new a(b)};var z=e("ps+7"),D=e("qUIE"),x=function(a){function b(b){b=
a.call(this,b)||this;b.onSecondaryTriggerStateChangedObservable=new z.a;b.onThumbRestChangedObservable=new z.a;b.controllerType=g.c.OCULUS;return b}Object(m.d)(b,a);b.prototype.initControllerMesh=function(a,c){var d=this;n.a.ImportMesh("",b._IsQuest?b.QUEST_MODEL_BASE_URL:b.MODEL_BASE_URL,"left"===this.hand?b.MODEL_LEFT_FILENAME:b.MODEL_RIGHT_FILENAME,a,function(a){d._defaultModel=b._IsQuest?a[0]:a[1];d.attachToMesh(d._defaultModel);c&&c(d._defaultModel)})};Object.defineProperty(b.prototype,"onAButtonStateChangedObservable",
{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw Error("No A button on left hand");},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw Error("No B button on left hand");},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;
throw Error("No X button on right hand");},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw Error("No Y button on right hand");},enumerable:!1,configurable:!0});b.prototype._handleButtonChange=function(a,c,d){d="right"===this.hand?-1:1;switch(a){case 0:this.onPadStateChangedObservable.notifyObservers(c);break;case 1:!b._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=
.2*-c.value,this._defaultModel.getChildren()[3].position.y=.005*-c.value,this._defaultModel.getChildren()[3].position.z=.005*-c.value);this.onTriggerStateChangedObservable.notifyObservers(c);break;case 2:!b._IsQuest&&this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=d*c.value*.0035);this.onSecondaryTriggerStateChangedObservable.notifyObservers(c);break;case 3:!b._IsQuest&&this._defaultModel&&(c.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=
0);this.onMainButtonStateChangedObservable.notifyObservers(c);break;case 4:!b._IsQuest&&this._defaultModel&&(c.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0);this.onSecondaryButtonStateChangedObservable.notifyObservers(c);break;case 5:this.onThumbRestChangedObservable.notifyObservers(c)}};b.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/";b.MODEL_LEFT_FILENAME="left.babylon";b.MODEL_RIGHT_FILENAME="right.babylon";b.QUEST_MODEL_BASE_URL=
"https://controllers.babylonjs.com/oculusQuest/";b._IsQuest=!1;return b}(k.a);g.b._ControllerFactories.push({canCreate:function(a){D.a.LastCreatedEngine&&D.a.LastCreatedEngine._vrDisplay&&"Oculus Quest"===D.a.LastCreatedEngine._vrDisplay.displayName&&(x._IsQuest=!0);return-1!==a.id.indexOf("Oculus Touch")},create:function(a){return new x(a)}});var K=function(a){function b(b){b=a.call(this,b)||this;b.controllerType=g.c.VIVE;b._invertLeftStickY=!0;return b}Object(m.d)(b,a);b.prototype.initControllerMesh=
function(a,c){var d=this;n.a.ImportMesh("",b.MODEL_BASE_URL,b.MODEL_FILENAME,a,function(a){d._defaultModel=a[1];d.attachToMesh(d._defaultModel);c&&c(d._defaultModel)})};Object.defineProperty(b.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0});
Object.defineProperty(b.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0});b.prototype._handleButtonChange=function(a,b,c){switch(a){case 0:this.onPadStateChangedObservable.notifyObservers(b);break;case 1:this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-b.value);this.onTriggerStateChangedObservable.notifyObservers(b);break;case 2:this.onMainButtonStateChangedObservable.notifyObservers(b);
break;case 3:this._defaultModel&&(b.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),this.onSecondaryButtonStateChangedObservable.notifyObservers(b)}};b.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/";b.MODEL_FILENAME="wand.babylon";return b}(k.a);g.b._ControllerFactories.push({canCreate:function(a){return-1!==a.id.toLowerCase().indexOf("openvr")},create:function(a){return new K(a)}});var F=e("2/Cc"),I=function(){return function(){this.buttonMeshes=
{};this.axisMeshes={}}}(),J=function(c){function e(a){a=c.call(this,a)||this;a._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X",
"THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:g.a.POINTING_POSE};a.onTrackpadChangedObservable=new z.a;a.onTrackpadValuesChangedObservable=new z.a;a.trackpad={x:0,y:0};a.controllerType=g.c.WINDOWS;a._loadedMeshInfo=null;return a}Object(m.d)(e,c);Object.defineProperty(e.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"onMenuButtonStateChangedObservable",
{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"onTouchpadButtonStateChangedObservable",
{get:function(){return this.onTrackpadChangedObservable},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!1,configurable:!0});e.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_X")],
this.trackpad.y=this.browserGamepad.axes[this._mapping.axisMeshNames.indexOf("TOUCHPAD_TOUCH_Y")],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))};e.prototype.update=function(){c.prototype.update.call(this);if(this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var a=0;a<this._mapping.axisMeshNames.length;a++)this._lerpAxisTransform(a,this.browserGamepad.axes[a])};e.prototype._handleButtonChange=function(a,b,c){if(a=this._mapping.buttons[a])this._updateTrackpad(),
(c=this[this._mapping.buttonObservableNames[a]])&&c.notifyObservers(b),this._lerpButtonTransform(a,b.value)};e.prototype._lerpButtonTransform=function(a,b){this._loadedMeshInfo&&(a=this._loadedMeshInfo.buttonMeshes[a])&&a.unpressed.rotationQuaternion&&a.pressed.rotationQuaternion&&a.value.rotationQuaternion&&(d.b.SlerpToRef(a.unpressed.rotationQuaternion,a.pressed.rotationQuaternion,b,a.value.rotationQuaternion),d.e.LerpToRef(a.unpressed.position,a.pressed.position,b,a.value.position))};e.prototype._lerpAxisTransform=
function(a,b){this._loadedMeshInfo&&(a=this._loadedMeshInfo.axisMeshes[a])&&a.min.rotationQuaternion&&a.max.rotationQuaternion&&a.value.rotationQuaternion&&(b=.5*b+.5,d.b.SlerpToRef(a.min.rotationQuaternion,a.max.rotationQuaternion,b,a.value.rotationQuaternion),d.e.LerpToRef(a.min.position,a.max.position,b,a.value.position))};e.prototype.initControllerMesh=function(b,c,d){var g=this;void 0===d&&(d=!1);if(n.a.IsPluginForExtensionAvailable(".glb")){var h="default";if(this.id&&!d){var k=this.id.match(e.GAMEPAD_ID_PATTERN);
h=k&&k[0]||h}var p="left"===this.hand?e.MODEL_LEFT_FILENAME:e.MODEL_RIGHT_FILENAME;var m=e.MODEL_BASE_URL+h+"/"}else q.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),m=a.MODEL_BASE_URL,p=a.MODEL_FILENAME;n.a.ImportMesh("",m,p,b,function(a){g._loadedMeshInfo=g.processModel(b,a);g._loadedMeshInfo&&(g._defaultModel=g._loadedMeshInfo.rootNode,g.attachToMesh(g._defaultModel),c&&c(g._defaultModel))},null,function(a,b){q.a.Log(b);q.a.Warn("Failed to retrieve controller model from the remote server: "+
m+p);d||g.initControllerMesh(a,c,!0)})};e.prototype.processModel=function(a,c){var d=null;a=new b.a(this.id+" "+this.hand,a);for(var e=null,g=0;g<c.length;g++){var h=c[g];if(!h.parent){h.isPickable=!1;e=h;break}}e?(e.setParent(a),d=this.createMeshInfo(a)):q.a.Warn("Could not find root node in model file.");return d};e.prototype.createMeshInfo=function(a){function b(a,b){return a.getChildren(function(a){return a.name===b},!1)[0]}function c(a,b){return a.getChildren(function(a){return a.name==b},!0)[0]}
var d=new I,e;d.rootNode=a;d.buttonMeshes={};d.axisMeshes={};for(e=0;e<this._mapping.buttons.length;e++){var g=this._mapping.buttonMeshNames[this._mapping.buttons[e]];if(g){var h=b(a,g);h?(h={index:e,value:c(h,"VALUE"),pressed:c(h,"PRESSED"),unpressed:c(h,"UNPRESSED")},h.value&&h.pressed&&h.unpressed?d.buttonMeshes[this._mapping.buttons[e]]=h:q.a.Warn("Missing button submesh under mesh with name: "+g+"(VALUE: "+!!h.value+", PRESSED: "+!!h.pressed+", UNPRESSED:"+!!h.unpressed+")")):q.a.Warn("Missing button mesh with name: "+
g)}else q.a.Log("Skipping unknown button at index: "+e+" with mapped name: "+this._mapping.buttons[e])}for(e=0;e<this._mapping.axisMeshNames.length;e++)(g=this._mapping.axisMeshNames[e])?(h=b(a,g))?(h={index:e,value:c(h,"VALUE"),min:c(h,"MIN"),max:c(h,"MAX")},h.value&&h.min&&h.max?d.axisMeshes[e]=h:q.a.Warn("Missing axis submesh under mesh with name: "+g+"(VALUE: "+!!h.value+", MIN: "+!!h.min+", MAX:"+!!h.max+")")):q.a.Warn("Missing axis mesh with name: "+g):q.a.Log("Skipping unknown axis at index: "+
e);d.pointingPoseNode=b(a,this._mapping.pointingPoseMeshName);d.pointingPoseNode?this._pointingPoseNode=d.pointingPoseNode:q.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName);return d};e.prototype.getForwardRay=function(a){void 0===a&&(a=100);if(!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return c.prototype.getForwardRay.call(this,a);var b=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),e=b.getTranslation(),g=new d.e(0,0,-1);b=d.e.TransformNormal(g,
b);b=d.e.Normalize(b);return new F.a(e,b,a)};e.prototype.dispose=function(){c.prototype.dispose.call(this);this.onTrackpadChangedObservable.clear();this.onTrackpadValuesChangedObservable.clear()};e.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/";e.MODEL_LEFT_FILENAME="left.glb";e.MODEL_RIGHT_FILENAME="right.glb";e.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ";e.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/;return e}(k.a);(function(a){function b(b){b=a.call(this,
b)||this;b._mapping={buttons:["trigger","grip","trackpad","thumbstick","menu"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onThumbstickStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y","THUMBSTICK_X",
"THUMBSTICK_Y"],pointingPoseMeshName:g.a.POINTING_POSE};b.thumbstickValues={x:0,y:0};b.onThumbstickStateChangedObservable=new z.a;b.onThumbstickValuesChangedObservable=new z.a;b.onTrackpadChangedObservable=b.onPadStateChangedObservable;b.onTrackpadValuesChangedObservable=b.onPadValuesChangedObservable;return b}Object(m.d)(b,a);Object.defineProperty(b.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onThumbstickStateChangedObservable},enumerable:!1,configurable:!0});
b.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.thumbstickValues.x&&this.browserGamepad.axes[3]==this.thumbstickValues.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onThumbstickValuesChangedObservable.notifyObservers(this.trackpad))};b.prototype.dispose=function(){a.prototype.dispose.call(this);this.onThumbstickStateChangedObservable.clear();this.onThumbstickValuesChangedObservable.clear()};return b})(J);
g.b._ControllerFactories.push({canCreate:function(a){return 0===a.id.indexOf(J.GAMEPAD_ID_PREFIX)},create:function(a){return new J(a)}});e("M9Dn");e("6CiD");e("K1vB");e("ddrY");e("2j9u")}}]);
