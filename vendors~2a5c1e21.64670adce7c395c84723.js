var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(m){var n=0;return function(){return n<m.length?{done:!1,value:m[n++]}:{done:!0}}};$jscomp.arrayIterator=function(m){return{next:$jscomp.arrayIteratorImpl(m)}};$jscomp.makeIterator=function(m){var n="undefined"!=typeof Symbol&&Symbol.iterator&&m[Symbol.iterator];return n?n.call(m):$jscomp.arrayIterator(m)};
$jscomp.getGlobal=function(m){return"undefined"!=typeof window&&window===m?m:"undefined"!=typeof global&&null!=global?global:m};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(m,n,a){m!=Array.prototype&&m!=Object.prototype&&(m[n]=a.value)};
$jscomp.polyfill=function(m,n,a,r){if(n){a=$jscomp.global;m=m.split(".");for(r=0;r<m.length-1;r++){var e=m[r];e in a||(a[e]={});a=a[e]}m=m[m.length-1];r=a[m];n=n(r);n!=r&&null!=n&&$jscomp.defineProperty(a,m,{configurable:!0,writable:!0,value:n})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(m){function n(){this.batch_=null}function a(a){return a instanceof e?a:new e(function(u,e){u(a)})}if(m&&!$jscomp.FORCE_POLYFILL_PROMISE)return m;n.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var u=this;this.asyncExecuteFunction(function(){u.executeBatch_()})}this.batch_.push(a)};var r=$jscomp.global.setTimeout;n.prototype.asyncExecuteFunction=function(a){r(a,0)};n.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var e=0;e<a.length;++e){var l=a[e];a[e]=null;try{l()}catch(g){this.asyncThrow_(g)}}}this.batch_=null};n.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var e=this.createResolveAndReject_();try{a(e.resolve,e.reject)}catch(l){e.reject(l)}};e.prototype.createResolveAndReject_=function(){function a(g){return function(b){l||(l=!0,g.call(e,b))}}var e=this,l=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var u=null!=a;break a;case "function":u=!0;break a;default:u=!1}u?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var e=void 0;try{e=a.then}catch(l){this.reject_(l);return}"function"==typeof e?
this.settleSameAsThenable_(e,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,e){if(0!=this.state_)throw Error("Cannot settle("+a+", "+e+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=e;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)v.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var v=new n;e.prototype.settleSameAsPromise_=function(a){var e=this.createResolveAndReject_();a.callWhenSettled_(e.resolve,e.reject)};e.prototype.settleSameAsThenable_=function(a,e){var l=this.createResolveAndReject_();try{a.call(e,l.resolve,l.reject)}catch(g){l.reject(g)}};e.prototype.then=function(a,m){function l(c,a){return"function"==typeof c?function(a){try{g(c(a))}catch(B){b(B)}}:a}var g,b,c=new e(function(c,a){g=c;b=a});this.callWhenSettled_(l(a,g),l(m,b));return c};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,e){function l(){switch(g.state_){case 1:a(g.result_);break;case 2:e(g.result_);break;default:throw Error("Unexpected state: "+g.state_);}}var g=this;null==this.onSettledCallbacks_?v.asyncExecute(l):this.onSettledCallbacks_.push(l)};e.resolve=a;e.reject=function(a){return new e(function(e,l){l(a)})};e.race=function(m){return new e(function(e,l){for(var g=$jscomp.makeIterator(m),b=g.next();!b.done;b=g.next())a(b.value).callWhenSettled_(e,
l)})};e.all=function(m){var n=$jscomp.makeIterator(m),l=n.next();return l.done?a([]):new e(function(g,b){function c(b){return function(c){f[b]=c;e--;0==e&&g(f)}}var f=[],e=0;do f.push(void 0),e++,a(l.value).callWhenSettled_(c(f.length-1),b),l=n.next();while(!l.done)})};return e},"es6","es3");
(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"31XQ":function(m,n,a){a.d(n,"b",function(){return u});a.d(n,"c",function(){return A});a.d(n,"a",function(){return l});var r=a("f9H2"),e=a("lzMP"),v=a("ps+7"),u;(function(a){a[a.Compatible=0]="Compatible";a[a.TypeIncompatible=1]="TypeIncompatible";a[a.TargetIncompatible=2]="TargetIncompatible"})(u||(u={}));var A;(function(a){a[a.Input=0]="Input";a[a.Output=1]="Output"})(A||(A={}));var l=function(){function a(b,a,f){this._connectedPoint=null;
this._endpoints=[];this._acceptedConnectionPointType=this._linkedConnectionSource=this._typeConnectionSource=null;this._type=r.a.Float;this.needDualDirectionValidation=this._enforceAssociatedVariableName=!1;this.acceptedConnectionPointTypes=[];this.excludedConnectionPointTypes=[];this.onConnectionObservable=new v.a;this.isExposedOnFrame=!1;this.exposedPortPosition=-1;this._prioritizeVertex=!1;this._target=e.a.VertexAndFragment;this._ownerBlock=a;this.name=b;this._direction=f}a.AreEquivalentTypes=
function(b,a){switch(b){case r.a.Vector3:if(a===r.a.Color3)return!0;break;case r.a.Vector4:if(a===r.a.Color4)return!0;break;case r.a.Color3:if(a===r.a.Vector3)return!0;break;case r.a.Color4:if(a===r.a.Vector4)return!0}return!1};Object.defineProperty(a.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"associatedVariableName",{get:function(){return this._ownerBlock.isInput?this._ownerBlock.associatedVariableName:this._enforceAssociatedVariableName&&
this._associatedVariableName||!this._connectedPoint?this._associatedVariableName:this._connectedPoint.associatedVariableName},set:function(b){this._associatedVariableName=b},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"innerType",{get:function(){return this._linkedConnectionSource&&this._linkedConnectionSource.isConnected?this.type:this._type},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"type",{get:function(){if(this._type===r.a.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;
if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource&&this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type}return this._type===r.a.BasedOnInput&&this._typeConnectionSource?this._typeConnectionSource.type:this._type},set:function(b){this._type=b},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"target",{get:function(){return this._prioritizeVertex&&this._ownerBlock&&this._target===e.a.VertexAndFragment?this._ownerBlock.target===
e.a.Fragment?e.a.Fragment:e.a.Vertex:this._target},set:function(b){this._target=b},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isConnected",{get:function(){return null!==this.connectedPoint||this.hasEndpoints},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isConnectedToInputBlock",{get:function(){return null!==this.connectedPoint&&this.connectedPoint.ownerBlock.isInput},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"connectInputBlock",
{get:function(){return this.isConnectedToInputBlock?this.connectedPoint.ownerBlock:null},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"connectedPoint",{get:function(){return this._connectedPoint},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"ownerBlock",{get:function(){return this._ownerBlock},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"sourceBlock",{get:function(){return this._connectedPoint?this._connectedPoint.ownerBlock:null},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"connectedBlocks",{get:function(){return 0===this._endpoints.length?[]:this._endpoints.map(function(b){return b.ownerBlock})},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"endpoints",{get:function(){return this._endpoints},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hasEndpoints",{get:function(){return this._endpoints&&0<this._endpoints.length},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"isConnectedInVertexShader",{get:function(){if(this.target===e.a.Vertex)return!0;if(!this.hasEndpoints)return!1;for(var b=0,a=this._endpoints;b<a.length;b++){var f=a[b];if(f.ownerBlock.target===e.a.Vertex||f.target===e.a.Vertex||(f.ownerBlock.target===e.a.Neutral||f.ownerBlock.target===e.a.VertexAndFragment)&&f.ownerBlock.outputs.some(function(b){return b.isConnectedInVertexShader}))return!0}return!1},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isConnectedInFragmentShader",
{get:function(){if(this.target===e.a.Fragment)return!0;if(!this.hasEndpoints)return!1;for(var b=0,a=this._endpoints;b<a.length;b++){var f=a[b];if(f.ownerBlock.target===e.a.Fragment||(f.ownerBlock.target===e.a.Neutral||f.ownerBlock.target===e.a.VertexAndFragment)&&f.ownerBlock.outputs.some(function(b){return b.isConnectedInFragmentShader}))return!0}return!1},enumerable:!1,configurable:!0});a.prototype.createCustomInputBlock=function(){return null};a.prototype.getClassName=function(){return"NodeMaterialConnectionPoint"};
a.prototype.canConnectTo=function(b){return this.checkCompatibilityState(b)===u.Compatible};a.prototype.checkCompatibilityState=function(b){if(this._ownerBlock.target===e.a.Fragment){var c=b.ownerBlock;if(c.target===e.a.Vertex)return u.TargetIncompatible;var f=0;for(c=c.outputs;f<c.length;f++)if(c[f].isConnectedInVertexShader)return u.TargetIncompatible}return this.type!==b.type&&b.innerType!==r.a.AutoDetect?a.AreEquivalentTypes(this.type,b.type)?u.Compatible:b.acceptedConnectionPointTypes&&-1!==
b.acceptedConnectionPointTypes.indexOf(this.type)||b._acceptedConnectionPointType&&a.AreEquivalentTypes(b._acceptedConnectionPointType.type,this.type)?u.Compatible:u.TypeIncompatible:b.excludedConnectionPointTypes&&-1!==b.excludedConnectionPointTypes.indexOf(this.type)?1:u.Compatible};a.prototype.connectTo=function(b,a){void 0===a&&(a=!1);if(!a&&!this.canConnectTo(b))throw"Cannot connect these two connectors.";this._endpoints.push(b);b._connectedPoint=this;this._enforceAssociatedVariableName=!1;this.onConnectionObservable.notifyObservers(b);
b.onConnectionObservable.notifyObservers(this);return this};a.prototype.disconnectFrom=function(b){var a=this._endpoints.indexOf(b);if(-1===a)return this;this._endpoints.splice(a,1);b._connectedPoint=null;this._enforceAssociatedVariableName=!1;b._enforceAssociatedVariableName=!1;return this};a.prototype.serialize=function(b){void 0===b&&(b=!0);var a={};a.name=this.name;a.displayName=this.displayName;b&&this.connectedPoint&&(a.inputName=this.name,a.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,
a.targetConnectionName=this.connectedPoint.name,a.isExposedOnFrame=!0,a.exposedPortPosition=this.exposedPortPosition);if(this.isExposedOnFrame||0<=this.exposedPortPosition)a.isExposedOnFrame=!0,a.exposedPortPosition=this.exposedPortPosition;return a};a.prototype.dispose=function(){this.onConnectionObservable.clear()};return a}()},EPWA:function(m,n,a){a("g6DK");a("31XQ");a("XA4I");a("MNkK");a("K76V");a("+Ttz");a("O6Ub")},MNkK:function(m,n,a){a.d(n,"a",function(){return I});var r=a("oYeq");m=a("afLn");
var e=a("ikaq"),v=a("/SR9"),u=a("Xeau"),A=a("qUIE"),l=a("f9H2"),g=a("lzMP"),b=a("Z6Y1"),c=a("X2Ve"),f=function(){function a(){this.supportUniformBuffers=!1;this.attributes=[];this.uniforms=[];this.constants=[];this.samplers=[];this.functions={};this.extensions={};this.counters={};this._injectAtEnd=this._varyingTransfer=this._samplerDeclaration=this._constantDeclaration=this._uniformDeclaration=this._attributeDeclaration="";this._repeatableContentAnchorIndex=0;this.compilationString=this._builtCompilationString=
""}a.prototype.finalize=function(a){a=a.sharedData.emitComments;var d=this.target===g.a.Fragment;this.compilationString="\r\n"+(a?"//Entry point\r\n":"")+"void main(void) {\r\n"+this.compilationString;this._constantDeclaration&&(this.compilationString="\r\n"+(a?"//Constants\r\n":"")+this._constantDeclaration+"\r\n"+this.compilationString);var h="",k;for(k in this.functions)h+=this.functions[k]+"\r\n";this.compilationString="\r\n"+h+"\r\n"+this.compilationString;!d&&this._varyingTransfer&&(this.compilationString=
this.compilationString+"\r\n"+this._varyingTransfer);this._injectAtEnd&&(this.compilationString=this.compilationString+"\r\n"+this._injectAtEnd);this.compilationString+="\r\n}";this.sharedData.varyingDeclaration&&(this.compilationString="\r\n"+(a?"//Varyings\r\n":"")+this.sharedData.varyingDeclaration+"\r\n"+this.compilationString);this._samplerDeclaration&&(this.compilationString="\r\n"+(a?"//Samplers\r\n":"")+this._samplerDeclaration+"\r\n"+this.compilationString);this._uniformDeclaration&&(this.compilationString=
"\r\n"+(a?"//Uniforms\r\n":"")+this._uniformDeclaration+"\r\n"+this.compilationString);this._attributeDeclaration&&!d&&(this.compilationString="\r\n"+(a?"//Attributes\r\n":"")+this._attributeDeclaration+"\r\n"+this.compilationString);this.compilationString="precision highp float;\r\n"+this.compilationString;for(var b in this.extensions)this.compilationString="\r\n"+this.extensions[b]+"\r\n"+this.compilationString;this._builtCompilationString=this.compilationString};Object.defineProperty(a.prototype,
"_repeatableContentAnchor",{get:function(){return"###___ANCHOR"+this._repeatableContentAnchorIndex++ +"___###"},enumerable:!1,configurable:!0});a.prototype._getFreeVariableName=function(a){a=a.replace(/[^a-zA-Z_]+/g,"");if(void 0===this.sharedData.variableNames[a])return this.sharedData.variableNames[a]=0,"output"===a||"texture"===a?a+this.sharedData.variableNames[a]:a;this.sharedData.variableNames[a]++;return a+this.sharedData.variableNames[a]};a.prototype._getFreeDefineName=function(a){void 0===
this.sharedData.defineNames[a]?this.sharedData.defineNames[a]=0:this.sharedData.defineNames[a]++;return a+this.sharedData.defineNames[a]};a.prototype._excludeVariableName=function(a){this.sharedData.variableNames[a]=0};a.prototype._emit2DSampler=function(a){0>this.samplers.indexOf(a)&&(this._samplerDeclaration+="uniform sampler2D "+a+";\r\n",this.samplers.push(a))};a.prototype._getGLType=function(a){switch(a){case l.a.Float:return"float";case l.a.Int:return"int";case l.a.Vector2:return"vec2";case l.a.Color3:case l.a.Vector3:return"vec3";
case l.a.Color4:case l.a.Vector4:return"vec4";case l.a.Matrix:return"mat4"}return""};a.prototype._emitExtension=function(a,d,h){void 0===h&&(h="");this.extensions[a]||(h&&(d="#if "+h+"\r\n"+d+"\r\n#endif"),this.extensions[a]=d)};a.prototype._emitFunction=function(a,d,h){this.functions[a]||(this.sharedData.emitComments&&(d=h+"\r\n"+d),this.functions[a]=d)};a.prototype._emitCodeFromInclude=function(a,d,h){if(h&&h.repeatKey)return"#include<"+a+">[0.."+h.repeatKey+"]\r\n";a=b.a.IncludesShadersStore[a]+
"\r\n";this.sharedData.emitComments&&(a=d+"\r\n"+a);if(!h)return a;if(h.replaceStrings)for(d=0;d<h.replaceStrings.length;d++){var k=h.replaceStrings[d];a=a.replace(k.search,k.replace)}return a};a.prototype._emitFunctionFromInclude=function(a,d,h,k){void 0===k&&(k="");k=a+k;if(!this.functions[k])if(h&&(h.removeAttributes||h.removeUniforms||h.removeVaryings||h.removeIfDef||h.replaceStrings)){if(this.functions[k]=b.a.IncludesShadersStore[a],this.sharedData.emitComments&&(this.functions[k]=d+"\r\n"+this.functions[k]),
h.removeIfDef&&(this.functions[k]=this.functions[k].replace(/^\s*?#ifdef.+$/gm,""),this.functions[k]=this.functions[k].replace(/^\s*?#endif.*$/gm,""),this.functions[k]=this.functions[k].replace(/^\s*?#else.*$/gm,""),this.functions[k]=this.functions[k].replace(/^\s*?#elif.*$/gm,"")),h.removeAttributes&&(this.functions[k]=this.functions[k].replace(/^\s*?attribute.+$/gm,"")),h.removeUniforms&&(this.functions[k]=this.functions[k].replace(/^\s*?uniform.+$/gm,"")),h.removeVaryings&&(this.functions[k]=this.functions[k].replace(/^\s*?varying.+$/gm,
"")),h.replaceStrings)for(a=0;a<h.replaceStrings.length;a++)d=h.replaceStrings[a],this.functions[k]=this.functions[k].replace(d.search,d.replace)}else this.functions[k]=h&&h.repeatKey?"#include<"+a+">[0.."+h.repeatKey+"]\r\n":"#include<"+a+">\r\n",this.sharedData.emitComments&&(this.functions[k]=d+"\r\n"+this.functions[k])};a.prototype._registerTempVariable=function(a){if(-1!==this.sharedData.temps.indexOf(a))return!1;this.sharedData.temps.push(a);return!0};a.prototype._emitVaryingFromString=function(a,
d,h,k){void 0===h&&(h="");void 0===k&&(k=!1);if(-1!==this.sharedData.varyings.indexOf(a))return!1;this.sharedData.varyings.push(a);h&&(c.a.StartsWith(h,"defined(")?this.sharedData.varyingDeclaration+="#if "+h+"\r\n":this.sharedData.varyingDeclaration+=(k?"#ifndef":"#ifdef")+" "+h+"\r\n");this.sharedData.varyingDeclaration+="varying "+d+" "+a+";\r\n";h&&(this.sharedData.varyingDeclaration+="#endif\r\n");return!0};a.prototype._emitUniformFromString=function(a,d,h,k){void 0===h&&(h="");void 0===k&&(k=
!1);-1===this.uniforms.indexOf(a)&&(this.uniforms.push(a),h&&(c.a.StartsWith(h,"defined(")?this._uniformDeclaration+="#if "+h+"\r\n":this._uniformDeclaration+=(k?"#ifndef":"#ifdef")+" "+h+"\r\n"),this._uniformDeclaration+="uniform "+d+" "+a+";\r\n",h&&(this._uniformDeclaration+="#endif\r\n"))};a.prototype._emitFloat=function(a){return a.toString()===a.toFixed(0)?a+".0":a.toString()};return a}(),t=a("ps+7"),w=function(){function a(){this.temps=[];this.varyings=[];this.varyingDeclaration="";this.inputBlocks=
[];this.textureBlocks=[];this.bindableBlocks=[];this.blocksWithFallbacks=[];this.blocksWithDefines=[];this.repeatableContentBlocks=[];this.dynamicUniformBlocks=[];this.blockingBlocks=[];this.animatedInputs=[];this.variableNames={};this.defineNames={};this.hints={needWorldViewMatrix:!1,needWorldViewProjectionMatrix:!1,needAlphaBlending:!1,needAlphaTesting:!1};this.checks={emitVertex:!1,emitFragment:!1,notConnectedNonOptionalInputs:[]};this.allowEmptyVertexProgram=!1;this.variableNames.position=0;this.variableNames.normal=
0;this.variableNames.tangent=0;this.variableNames.uv=0;this.variableNames.uv2=0;this.variableNames.uv3=0;this.variableNames.uv4=0;this.variableNames.uv4=0;this.variableNames.uv5=0;this.variableNames.uv6=0;this.variableNames.color=0;this.variableNames.matricesIndices=0;this.variableNames.matricesWeights=0;this.variableNames.matricesIndicesExtra=0;this.variableNames.matricesWeightsExtra=0;this.variableNames.diffuseBase=0;this.variableNames.specularBase=0;this.variableNames.worldPos=0;this.variableNames.shadow=
0;this.variableNames.view=0;this.variableNames.vTBN=0;this.defineNames.MAINUV0=0;this.defineNames.MAINUV1=0;this.defineNames.MAINUV2=0;this.defineNames.MAINUV3=0;this.defineNames.MAINUV4=0;this.defineNames.MAINUV5=0;this.defineNames.MAINUV6=0;this.defineNames.MAINUV7=0}a.prototype.emitErrors=function(){var a="";this.checks.emitVertex||this.allowEmptyVertexProgram||(a+="NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\r\n");this.checks.emitFragment||
(a+="NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\r\n");for(var d=0,h=this.checks.notConnectedNonOptionalInputs;d<h.length;d++){var k=h[d];a+="input "+k.name+" from block "+k.ownerBlock.name+"["+k.ownerBlock.getClassName()+"] is not connected and is not optional.\r\n"}if(a)throw"Build of NodeMaterial failed:\r\n"+a;};return a}();n=a("Qdxt");var B=a("y4Ty"),J=a("YKqZ"),K=a("7S52"),F=a("1XPg"),D=a("vKbb"),y=a("sDlf"),L=a("WHS4"),
C=a("ADVu"),Q=a("aZIP"),R=a("scQo"),S=a("dNku"),T=a("XoJq"),U=a("UpSL"),V=a("Ksm9"),W=a("OJ6t"),G=a("62to"),X=a("0hZJ"),M=a("OGuY"),z=a("Jf/A"),Y=a("aCSs"),N=a("S4Gu"),Z=a("yYBB"),O=a("vYHP"),aa=a("jpcn"),ba=a("840t"),P=a("tYrF"),H={effect:null,subMesh:null},E=function(a){function b(){var d=a.call(this)||this;d.NORMAL=!1;d.TANGENT=!1;d.UV1=!1;d.NUM_BONE_INFLUENCERS=0;d.BonesPerMesh=0;d.BONETEXTURE=!1;d.MORPHTARGETS=!1;d.MORPHTARGETS_NORMAL=!1;d.MORPHTARGETS_TANGENT=!1;d.MORPHTARGETS_UV=!1;d.NUM_MORPH_INFLUENCERS=
0;d.IMAGEPROCESSING=!1;d.VIGNETTE=!1;d.VIGNETTEBLENDMODEMULTIPLY=!1;d.VIGNETTEBLENDMODEOPAQUE=!1;d.TONEMAPPING=!1;d.TONEMAPPING_ACES=!1;d.CONTRAST=!1;d.EXPOSURE=!1;d.COLORCURVES=!1;d.COLORGRADING=!1;d.COLORGRADING3D=!1;d.SAMPLER3DGREENDEPTH=!1;d.SAMPLER3DBGRMAP=!1;d.IMAGEPROCESSINGPOSTPROCESS=!1;d.BUMPDIRECTUV=0;d.rebuild();return d}Object(r.d)(b,a);b.prototype.setValue=function(d,a,k){void 0===k&&(k=!1);void 0===this[d]&&this._keys.push(d);k&&this[d]!==a&&this.markAsUnprocessed();this[d]=a};return b}(n.a),
I=function(a){function c(d,h,k){void 0===k&&(k={});d=a.call(this,d,h||A.a.LastCreatedScene)||this;d._buildId=c._BuildIdGenerator++;d._buildWasSuccessful=!1;d._cachedWorldViewMatrix=new v.a;d._cachedWorldViewProjectionMatrix=new v.a;d._optimizers=[];d._animationFrame=-1;d.BJSNODEMATERIALEDITOR=d._getGlobalNodeMaterialEditor();d.editorData=null;d.ignoreAlpha=!1;d.maxSimultaneousLights=4;d.onBuildObservable=new t.a;d._vertexOutputNodes=[];d._fragmentOutputNodes=[];d.attachedBlocks=[];d._mode=z.a.Material;
d._options=Object(r.a)({emitComments:!1},k);d._attachImageProcessingConfiguration(null);return d}Object(r.d)(c,a);c.prototype._getGlobalNodeMaterialEditor=function(){if("undefined"!==typeof NODEEDITOR)return NODEEDITOR;if("undefined"!==typeof BABYLON&&"undefined"!==typeof BABYLON.NodeEditor)return BABYLON};Object.defineProperty(c.prototype,"options",{get:function(){return this._options},set:function(d){this._options=d},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"imageProcessingConfiguration",
{get:function(){return this._imageProcessingConfiguration},set:function(d){this._attachImageProcessingConfiguration(d);this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"mode",{get:function(){return this._mode},enumerable:!1,configurable:!0});c.prototype.getClassName=function(){return"NodeMaterial"};c.prototype._attachImageProcessingConfiguration=function(d){var a=this;d!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&
this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=d?d:this.getScene().imageProcessingConfiguration)&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){a._markAllSubMeshesAsImageProcessingDirty()}))};c.prototype.getBlockByName=function(d){for(var a=null,k=0,b=this.attachedBlocks;k<b.length;k++){var c=b[k];if(c.name===d)if(a){J.b.Warn("More than one block was found with the name `"+
d+"`");break}else a=c}return a};c.prototype.getBlockByPredicate=function(d){for(var a=0,k=this.attachedBlocks;a<k.length;a++){var b=k[a];if(d(b))return b}return null};c.prototype.getInputBlockByPredicate=function(d){for(var a=0,k=this.attachedBlocks;a<k.length;a++){var b=k[a];if(b.isInput&&d(b))return b}return null};c.prototype.getInputBlocks=function(){for(var d=[],a=0,k=this.attachedBlocks;a<k.length;a++){var b=k[a];b.isInput&&d.push(b)}return d};c.prototype.registerOptimizer=function(a){if(!(-1<
this._optimizers.indexOf(a)))return this._optimizers.push(a),this};c.prototype.unregisterOptimizer=function(a){a=this._optimizers.indexOf(a);if(-1!==a)return this._optimizers.splice(a,1),this};c.prototype.addOutputNode=function(a){if(null===a.target)throw"This node is not meant to be an output node. You may want to explicitly set its target value.";0!==(a.target&g.a.Vertex)&&this._addVertexOutputNode(a);0!==(a.target&g.a.Fragment)&&this._addFragmentOutputNode(a);return this};c.prototype.removeOutputNode=
function(a){if(null===a.target)return this;0!==(a.target&g.a.Vertex)&&this._removeVertexOutputNode(a);0!==(a.target&g.a.Fragment)&&this._removeFragmentOutputNode(a);return this};c.prototype._addVertexOutputNode=function(a){if(-1===this._vertexOutputNodes.indexOf(a))return a.target=g.a.Vertex,this._vertexOutputNodes.push(a),this};c.prototype._removeVertexOutputNode=function(a){a=this._vertexOutputNodes.indexOf(a);if(-1!==a)return this._vertexOutputNodes.splice(a,1),this};c.prototype._addFragmentOutputNode=
function(a){if(-1===this._fragmentOutputNodes.indexOf(a))return a.target=g.a.Fragment,this._fragmentOutputNodes.push(a),this};c.prototype._removeFragmentOutputNode=function(a){a=this._fragmentOutputNodes.indexOf(a);if(-1!==a)return this._fragmentOutputNodes.splice(a,1),this};c.prototype.needAlphaBlending=function(){return this.ignoreAlpha?!1:1>this.alpha||this._sharedData&&this._sharedData.hints.needAlphaBlending};c.prototype.needAlphaTesting=function(){return this._sharedData&&this._sharedData.hints.needAlphaTesting};
c.prototype._initializeBlock=function(a,h,k){a.initialize(h);a.autoConfigure(this);a._preparationId=this._buildId;if(-1===this.attachedBlocks.indexOf(a)){if(a.isUnique)for(var d=a.getClassName(),b=0,c=this.attachedBlocks;b<c.length;b++)if(c[b].getClassName()===d)throw"Cannot have multiple blocks of type "+d+" in the same NodeMaterial";this.attachedBlocks.push(a)}d=0;for(b=a.inputs;d<b.length;d++)if(c=b[d],c.associatedVariableName="",c=c.connectedPoint)c=c.ownerBlock,c!==a&&(c.target===g.a.VertexAndFragment?
k.push(c):h.target===g.a.Fragment&&c.target===g.a.Vertex&&c._preparationId!==this._buildId&&k.push(c),this._initializeBlock(c,h,k));h=0;for(a=a.outputs;h<a.length;h++)a[h].associatedVariableName=""};c.prototype._resetDualBlocks=function(a,h){a.target===g.a.VertexAndFragment&&(a.buildId=h);for(var d=0,b=a.inputs;d<b.length;d++){var c=b[d].connectedPoint;c&&(c=c.ownerBlock,c!==a&&this._resetDualBlocks(c,h))}};c.prototype.removeBlock=function(a){var d=this.attachedBlocks.indexOf(a);-1<d&&this.attachedBlocks.splice(d,
1);a.isFinalMerger&&this.removeOutputNode(a)};c.prototype.build=function(a){void 0===a&&(a=!1);this._buildWasSuccessful=!1;var d=this.getScene().getEngine(),b=this._mode===z.a.Particle;if(0===this._vertexOutputNodes.length&&!b)throw"You must define at least one vertexOutputNode";if(0===this._fragmentOutputNodes.length)throw"You must define at least one fragmentOutputNode";this._vertexCompilationState=new f;this._vertexCompilationState.supportUniformBuffers=d.supportsUniformBuffers;this._vertexCompilationState.target=
g.a.Vertex;this._fragmentCompilationState=new f;this._fragmentCompilationState.supportUniformBuffers=d.supportsUniformBuffers;this._fragmentCompilationState.target=g.a.Fragment;this._sharedData=new w;this._vertexCompilationState.sharedData=this._sharedData;this._fragmentCompilationState.sharedData=this._sharedData;this._sharedData.buildId=this._buildId;this._sharedData.emitComments=this._options.emitComments;this._sharedData.verbose=a;this._sharedData.scene=this.getScene();this._sharedData.allowEmptyVertexProgram=
b;b=[];d=[];for(var p=0,x=this._vertexOutputNodes;p<x.length;p++){var q=x[p];b.push(q);this._initializeBlock(q,this._vertexCompilationState,d)}p=0;for(x=this._fragmentOutputNodes;p<x.length;p++)q=x[p],d.push(q),this._initializeBlock(q,this._fragmentCompilationState,b);this.optimize();for(p=0;p<b.length;p++)q=b[p],q.build(this._vertexCompilationState,b);this._fragmentCompilationState.uniforms=this._vertexCompilationState.uniforms.slice(0);this._fragmentCompilationState._uniformDeclaration=this._vertexCompilationState._uniformDeclaration;
this._fragmentCompilationState._constantDeclaration=this._vertexCompilationState._constantDeclaration;this._fragmentCompilationState._vertexState=this._vertexCompilationState;for(b=0;b<d.length;b++)q=d[b],this._resetDualBlocks(q,this._buildId-1);for(b=0;b<d.length;b++)q=d[b],q.build(this._fragmentCompilationState,d);this._vertexCompilationState.finalize(this._vertexCompilationState);this._fragmentCompilationState.finalize(this._fragmentCompilationState);this._buildId=c._BuildIdGenerator++;this._sharedData.emitErrors();
a&&(console.log("Vertex shader:"),console.log(this._vertexCompilationState.compilationString),console.log("Fragment shader:"),console.log(this._fragmentCompilationState.compilationString));this._buildWasSuccessful=!0;this.onBuildObservable.notifyObservers(this);a=0;for(d=this.getScene().meshes;a<d.length;a++)if(q=d[a],q.subMeshes)for(b=0,q=q.subMeshes;b<q.length;b++)p=q[b],p.getMaterial()===this&&p._materialDefines&&(p=p._materialDefines,p.markAllAsDirty(),p.reset())};c.prototype.optimize=function(){for(var a=
0,b=this._optimizers;a<b.length;a++)b[a].optimize(this._vertexOutputNodes,this._fragmentOutputNodes)};c.prototype._prepareDefinesForAttributes=function(a,b){var d=b.NORMAL,h=b.TANGENT,c=b.UV1;b.NORMAL=a.isVerticesDataPresent(B.b.NormalKind);b.TANGENT=a.isVerticesDataPresent(B.b.TangentKind);b.UV1=a.isVerticesDataPresent(B.b.UVKind);d===b.NORMAL&&h===b.TANGENT&&c===b.UV1||b.markAsAttributesDirty()};c.prototype.createPostProcess=function(a,b,k,c,f,q,e){void 0===b&&(b=1);void 0===k&&(k=1);void 0===q&&
(q=0);void 0===e&&(e=5);return this.mode!==z.a.PostProcess?(console.log("Incompatible material mode"),null):this._createEffectForPostProcess(null,a,b,k,c,f,q,e)};c.prototype.createEffectForPostProcess=function(a){this._createEffectForPostProcess(a)};c.prototype._createEffectForPostProcess=function(a,h,k,c,f,q,g,t){var d=this;void 0===k&&(k=1);void 0===c&&(c=1);void 0===g&&(g=0);void 0===t&&(t=5);var p=this.name+this._buildId,x=new E,l=new e.a(p+"PostProcess",this.getScene()),w=this._buildId;this._processDefines(l,
x);b.a.RegisterShader(p,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString);a?a.updateEffect(x.toString(),this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,{maxSimultaneousLights:this.maxSimultaneousLights},void 0,void 0,p,p):a=new W.a(this.name+"PostProcess",p,this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,k,h,c,f,q,x.toString(),g,p,{maxSimultaneousLights:this.maxSimultaneousLights},
!1,t);a.nodeMaterialSource=this;a.onApplyObservable.add(function(h){w!==d._buildId&&(delete b.a.ShadersStore[p+"VertexShader"],delete b.a.ShadersStore[p+"PixelShader"],p=d.name+d._buildId,x.markAsUnprocessed(),w=d._buildId);d._processDefines(l,x)&&(b.a.RegisterShader(p,d._fragmentCompilationState._builtCompilationString,d._vertexCompilationState._builtCompilationString),O.a.SetImmediate(function(){return a.updateEffect(x.toString(),d._fragmentCompilationState.uniforms,d._fragmentCompilationState.samplers,
{maxSimultaneousLights:d.maxSimultaneousLights},void 0,void 0,p,p)}));d._checkInternals(h)});return a};c.prototype.createProceduralTexture=function(a,h){var d=this;if(this.mode!==z.a.ProceduralTexture)return console.log("Incompatible material mode"),null;var c=this.name+this._buildId,f=new aa.a(c,a,null,h),q=new e.a(c+"Procedural",this.getScene());q.reservedDataStore={hidden:!0};var g=new E;a=this._processDefines(q,g);b.a.RegisterShader(c,this._fragmentCompilationState._builtCompilationString,this._vertexCompilationState._builtCompilationString);
var t=this.getScene().getEngine().createEffect({vertexElement:c,fragmentElement:c},[B.b.PositionKind],this._fragmentCompilationState.uniforms,this._fragmentCompilationState.samplers,g.toString(),null===a||void 0===a?void 0:a.fallbacks,void 0);f.nodeMaterialSource=this;f._effect=t;var l=this._buildId;f.onBeforeGenerationObservable.add(function(){l!==d._buildId&&(delete b.a.ShadersStore[c+"VertexShader"],delete b.a.ShadersStore[c+"PixelShader"],c=d.name+d._buildId,g.markAsUnprocessed(),l=d._buildId);
var a=d._processDefines(q,g);a&&(b.a.RegisterShader(c,d._fragmentCompilationState._builtCompilationString,d._vertexCompilationState._builtCompilationString),O.a.SetImmediate(function(){t=d.getScene().getEngine().createEffect({vertexElement:c,fragmentElement:c},[B.b.PositionKind],d._fragmentCompilationState.uniforms,d._fragmentCompilationState.samplers,g.toString(),null===a||void 0===a?void 0:a.fallbacks,void 0);f._effect=t}));d._checkInternals(t)});return f};c.prototype._createEffectForParticles=
function(a,h,c,p,f,q,g,t){var d=this;void 0===t&&(t="");var k=this.name+this._buildId+"_"+h;q||(q=new E);g||(g=this.getScene().getMeshByName(this.name+"Particle"),g||(g=new e.a(this.name+"Particle",this.getScene()),g.reservedDataStore={hidden:!0}));var x=this._buildId,l=[],w=t;f||(f=this._processDefines(g,q),b.a.RegisterShader(k,this._fragmentCompilationState._builtCompilationString),a.fillDefines(l,h),w=l.join("\n"),f=this.getScene().getEngine().createEffectForParticles(k,this._fragmentCompilationState.uniforms,
this._fragmentCompilationState.samplers,q.toString()+"\n"+w,null===f||void 0===f?void 0:f.fallbacks,c,p,a),a.setCustomEffect(f,h));f.onBindObservable.add(function(f){x!==d._buildId&&(delete b.a.ShadersStore[k+"PixelShader"],k=d.name+d._buildId+"_"+h,q.markAsUnprocessed(),x=d._buildId);l.length=0;a.fillDefines(l,h);var e=l.join("\n");e!==w&&(q.markAsUnprocessed(),w=e);(e=d._processDefines(g,q))?(b.a.RegisterShader(k,d._fragmentCompilationState._builtCompilationString),f=d.getScene().getEngine().createEffectForParticles(k,
d._fragmentCompilationState.uniforms,d._fragmentCompilationState.samplers,q.toString()+"\n"+w,null===e||void 0===e?void 0:e.fallbacks,c,p,a),a.setCustomEffect(f,h),d._createEffectForParticles(a,h,c,p,f,q,g,w)):d._checkInternals(f)})};c.prototype._checkInternals=function(a){if(this._sharedData.animatedInputs){var d=this.getScene(),b=d.getFrameId();if(this._animationFrame!==b){for(var c=0,f=this._sharedData.animatedInputs;c<f.length;c++)f[c].animate(d);this._animationFrame=b}}d=0;for(b=this._sharedData.bindableBlocks;d<
b.length;d++)b[d].bind(a,this);d=0;for(b=this._sharedData.inputBlocks;d<b.length;d++)b[d]._transmit(a,this.getScene())};c.prototype.createEffectForParticles=function(a,b,c){this.mode!==z.a.Particle?console.log("Incompatible material mode"):(this._createEffectForParticles(a,N.a.BLENDMODE_ONEONE,b,c),this._createEffectForParticles(a,N.a.BLENDMODE_MULTIPLY,b,c))};c.prototype._processDefines=function(a,b,c,p){var d=this;void 0===c&&(c=!1);var h=null;this._sharedData.blocksWithDefines.forEach(function(h){h.initializeDefines(a,
d,b,c)});this._sharedData.blocksWithDefines.forEach(function(h){h.prepareDefines(a,d,b,c,p)});if(b.isDirty){h=b._areLightsDisposed;b.markAsProcessed();this._vertexCompilationState.compilationString=this._vertexCompilationState._builtCompilationString;this._fragmentCompilationState.compilationString=this._fragmentCompilationState._builtCompilationString;this._sharedData.repeatableContentBlocks.forEach(function(c){c.replaceRepeatableContent(d._vertexCompilationState,d._fragmentCompilationState,a,b)});
var k=[];this._sharedData.dynamicUniformBlocks.forEach(function(a){a.updateUniformsAndSamples(d._vertexCompilationState,d,b,k)});var f=this._vertexCompilationState.uniforms;this._fragmentCompilationState.uniforms.forEach(function(a){-1===f.indexOf(a)&&f.push(a)});var g=this._vertexCompilationState.samplers;this._fragmentCompilationState.samplers.forEach(function(a){-1===g.indexOf(a)&&g.push(a)});var e=new U.a;this._sharedData.blocksWithFallbacks.forEach(function(b){b.provideFallbacks(a,e)});h={lightDisposed:h,
uniformBuffers:k,mergedUniforms:f,mergedSamplers:g,fallbacks:e}}return h};c.prototype.isReadyForSubMesh=function(a,b,c){var d=this;void 0===c&&(c=!1);if(!this._buildWasSuccessful)return!1;var h=this.getScene();if(this._sharedData.animatedInputs){var k=h.getFrameId();if(this._animationFrame!==k){for(var f=0,g=this._sharedData.animatedInputs;f<g.length;f++)g[f].animate(h);this._animationFrame=k}}if(b.effect&&this.isFrozen&&b.effect._wasPreviouslyReady)return!0;b._materialDefines||(b._materialDefines=
new E);var e=b._materialDefines;if(this._isReadyForSubMesh(b))return!0;g=h.getEngine();this._prepareDefinesForAttributes(a,e);if(this._sharedData.blockingBlocks.some(function(b){return!b.isReady(a,d,e,c)}))return!1;if(k=this._processDefines(a,e,c,b))if(f=b.effect,g=g.createEffect({vertex:"nodeMaterial"+this._buildId,fragment:"nodeMaterial"+this._buildId,vertexSource:this._vertexCompilationState.compilationString,fragmentSource:this._fragmentCompilationState.compilationString},{attributes:this._vertexCompilationState.attributes,
uniformsNames:k.mergedUniforms,uniformBuffersNames:k.uniformBuffers,samplers:k.mergedSamplers,defines:e.toString(),fallbacks:k.fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights,maxSimultaneousMorphTargets:e.NUM_MORPH_INFLUENCERS}},g))if(this._onEffectCreatedObservable&&(H.effect=g,H.subMesh=b,this._onEffectCreatedObservable.notifyObservers(H)),this.allowShaderHotSwapping&&f&&!g.isReady()){if(g=f,e.markAsUnprocessed(),k.lightDisposed)return e._areLightsDisposed=
!0,!1}else h.resetCachedMaterial(),b.setEffect(g,e);if(!b.effect||!b.effect.isReady())return!1;e._renderId=h.getRenderId();return b.effect._wasPreviouslyReady=!0};Object.defineProperty(c.prototype,"compiledShaders",{get:function(){return"// Vertex shader\r\n"+this._vertexCompilationState.compilationString+"\r\n\r\n// Fragment shader\r\n"+this._fragmentCompilationState.compilationString},enumerable:!1,configurable:!0});c.prototype.bindOnlyWorldMatrix=function(a){var b=this.getScene();if(this._activeEffect){var d=
this._sharedData.hints;d.needWorldViewMatrix&&a.multiplyToRef(b.getViewMatrix(),this._cachedWorldViewMatrix);d.needWorldViewProjectionMatrix&&a.multiplyToRef(b.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);b=0;for(d=this._sharedData.inputBlocks;b<d.length;b++)d[b]._transmitWorld(this._activeEffect,a,this._cachedWorldViewMatrix,this._cachedWorldViewProjectionMatrix)}};c.prototype.bindForSubMesh=function(a,b,c){var d=this.getScene(),h=c.effect;if(h){this._activeEffect=h;this.bindOnlyWorldMatrix(a);
if(this._mustRebind(d,h,b.visibility)&&(a=this._sharedData,h&&d.getCachedEffect()!==h)){for(var k=0,f=a.bindableBlocks;k<f.length;k++)f[k].bind(h,this,b,c);c=0;for(a=a.inputBlocks;c<a.length;c++)a[c]._transmit(h,d)}this._afterBind(b,this._activeEffect)}};c.prototype.getActiveTextures=function(){var b=a.prototype.getActiveTextures.call(this);this._sharedData&&b.push.apply(b,this._sharedData.textureBlocks.filter(function(a){return a.texture}).map(function(a){return a.texture}));return b};c.prototype.getTextureBlocks=
function(){return this._sharedData?this._sharedData.textureBlocks:[]};c.prototype.hasTexture=function(b){if(a.prototype.hasTexture.call(this,b))return!0;if(!this._sharedData)return!1;for(var d=0,c=this._sharedData.textureBlocks;d<c.length;d++)if(c[d].texture===b)return!0;return!1};c.prototype.dispose=function(b,c,k){if(c)for(var d=0,h=this._sharedData.textureBlocks.filter(function(a){return a.texture}).map(function(a){return a.texture});d<h.length;d++)h[d].dispose();d=0;for(h=this.attachedBlocks;d<
h.length;d++)h[d].dispose();this.onBuildObservable.clear();a.prototype.dispose.call(this,b,c,k)};c.prototype._createNodeEditor=function(){this.BJSNODEMATERIALEDITOR=this.BJSNODEMATERIALEDITOR||this._getGlobalNodeMaterialEditor();this.BJSNODEMATERIALEDITOR.NodeEditor.Show({nodeMaterial:this})};c.prototype.edit=function(a){var b=this;return new Promise(function(d,h){"undefined"==typeof b.BJSNODEMATERIALEDITOR?J.b.LoadScript(a&&a.editorURL?a.editorURL:c.EditorURL,function(){b._createNodeEditor();d()}):
(b._createNodeEditor(),d())})};c.prototype.clear=function(){this._vertexOutputNodes=[];this._fragmentOutputNodes=[];this.attachedBlocks=[]};c.prototype.setToDefault=function(){this.clear();this.editorData=null;var a=new y.a("Position");a.setAsAttribute("position");var b=new y.a("World");b.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);var c=new K.a("WorldPos");a.connectTo(c);b.connectTo(c);b=new y.a("ViewProjection");b.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);a=
new K.a("WorldPos * ViewProjectionTransform");c.connectTo(a);b.connectTo(a);c=new F.a("VertexOutput");a.connectTo(c);a=new y.a("color");a.value=new u.b(.8,.8,.8,1);b=new D.a("FragmentOutput");a.connectTo(b);this.addOutputNode(c);this.addOutputNode(b);this._mode=z.a.Material};c.prototype.setToDefaultPostProcess=function(){this.clear();this.editorData=null;var a=new y.a("Position");a.setAsAttribute("position2d");var b=new y.a("Constant1");b.isConstant=!0;b.value=1;var c=new G.a("Position3D");a.connectTo(c);
b.connectTo(c,{input:"w"});b=new F.a("VertexOutput");c.connectTo(b);c=new y.a("Scale");c.visibleInInspector=!0;c.value=new v.d(1,1);var f=new X.a("uv0");a.connectTo(f);a=new M.a("UV scale");f.connectTo(a);c.connectTo(a);c=new Q.a("CurrentScreen");a.connectTo(c);c.texture=new Y.a("https://assets.babylonjs.com/nme/currentScreenPostProcess.png",this.getScene());a=new D.a("FragmentOutput");c.connectTo(a,{output:"rgba"});this.addOutputNode(b);this.addOutputNode(a);this._mode=z.a.PostProcess};c.prototype.setToDefaultProceduralTexture=
function(){this.clear();this.editorData=null;var a=new y.a("Position");a.setAsAttribute("position2d");var b=new y.a("Constant1");b.isConstant=!0;b.value=1;var c=new G.a("Position3D");a.connectTo(c);b.connectTo(c,{input:"w"});b=new F.a("VertexOutput");c.connectTo(b);c=new y.a("Time");c.value=0;c.min=0;c.max=0;c.isBoolean=!1;c.matrixMode=0;c.animationType=ba.a.Time;c.isConstant=!1;var f=new y.a("Color3");f.value=new u.a(1,1,1);f.isConstant=!1;f=new D.a("FragmentOutput");var g=new G.a("VectorMerger");
g.visibleInInspector=!1;var e=new P.a("Cos");e.operation=P.b.Cos;a.connectTo(g);c.output.connectTo(e.input);e.output.connectTo(g.z);g.xyzOut.connectTo(f.rgb);this.addOutputNode(b);this.addOutputNode(f);this._mode=z.a.ProceduralTexture};c.prototype.setToDefaultParticle=function(){this.clear();this.editorData=null;var a=new y.a("uv");a.setAsAttribute("particle_uv");var b=new R.a("ParticleTexture");a.connectTo(b);var c=new y.a("Color");c.setAsAttribute("particle_color");var f=new M.a("Texture * Color");
b.connectTo(f);c.connectTo(f);a=new S.a("ParticleRampGradient");f.connectTo(a);f=new Z.a("ColorSplitter");c.connectTo(f);c=new T.a("ParticleBlendMultiply");a.connectTo(c);b.connectTo(c,{output:"a"});f.connectTo(c,{output:"a"});b=new D.a("FragmentOutput");c.connectTo(b);this.addOutputNode(b);this._mode=z.a.Particle};c.prototype.loadAsync=function(a){var b=this;return this.getScene()._loadFileAsync(a).then(function(a){a=JSON.parse(a);b.loadFromSerialization(a,"")})};c.prototype._gatherBlocks=function(a,
b){if(-1===b.indexOf(a)){b.push(a);for(var c=0,d=a.inputs;c<d.length;c++){var h=d[c].connectedPoint;h&&(h=h.ownerBlock,h!==a&&this._gatherBlocks(h,b))}}};c.prototype.generateCode=function(){for(var a=[],b=[],c=[],f=0,g=this._vertexOutputNodes;f<g.length;f++){var e=g[f];this._gatherBlocks(e,b)}g=[];f=0;for(var t=this._fragmentOutputNodes;f<t.length;f++)e=t[f],this._gatherBlocks(e,g);e='var nodeMaterial = new BABYLON.NodeMaterial("'+(this.name||"node material")+'");\r\n';for(t=0;t<b.length;t++)f=b[t],
f.isInput&&-1===a.indexOf(f)&&(e+=f._dumpCode(c,a));for(b=0;b<g.length;b++)f=g[b],f.isInput&&-1===a.indexOf(f)&&(e+=f._dumpCode(c,a));a=[];e+="\r\n// Connections\r\n";c=0;for(b=this._vertexOutputNodes;c<b.length;c++)f=b[c],e+=f._dumpCodeForOutputConnections(a);c=0;for(b=this._fragmentOutputNodes;c<b.length;c++)f=b[c],e+=f._dumpCodeForOutputConnections(a);e+="\r\n// Output nodes\r\n";a=0;for(c=this._vertexOutputNodes;a<c.length;a++)f=c[a],e+="nodeMaterial.addOutputNode("+f._codeVariableName+");\r\n";
a=0;for(c=this._fragmentOutputNodes;a<c.length;a++)f=c[a],e+="nodeMaterial.addOutputNode("+f._codeVariableName+");\r\n";return e+"nodeMaterial.build();\r\n"};c.prototype.serialize=function(a){var b=a?{}:C.a.Serialize(this);b.editorData=JSON.parse(JSON.stringify(this.editorData));var c=[];if(a)c=a;else{b.customType="BABYLON.NodeMaterial";b.outputNodes=[];for(var d=0,f=this._vertexOutputNodes;d<f.length;d++){var e=f[d];this._gatherBlocks(e,c);b.outputNodes.push(e.uniqueId)}d=0;for(f=this._fragmentOutputNodes;d<
f.length;d++)e=f[d],this._gatherBlocks(e,c),-1===b.outputNodes.indexOf(e.uniqueId)&&b.outputNodes.push(e.uniqueId)}b.blocks=[];d=0;for(f=c;d<f.length;d++)e=f[d],b.blocks.push(e.serialize());if(!a)for(a=0,d=this.attachedBlocks;a<d.length;a++)e=d[a],-1===c.indexOf(e)&&b.blocks.push(e.serialize());return b};c.prototype._restoreConnections=function(a,b,c){for(var d=0,f=a.outputs;d<f.length;d++)for(var h=f[d],e=0,g=b.blocks;e<g.length;e++){var k=g[e],t=c[k.id];if(t){var l=0;for(k=k.inputs;l<k.length;l++){var w=
k[l];c[w.targetBlockId]===a&&w.targetConnectionName===h.name&&(w=t.getInputByName(w.inputName))&&!w.isConnected&&(h.connectTo(w,!0),this._restoreConnections(t,b,c))}}}};c.prototype.loadFromSerialization=function(a,b,c){var d;void 0===b&&(b="");void 0===c&&(c=!1);c||this.clear();for(var f={},e=0,g=a.blocks;e<g.length;e++){var h=g[e],k=L.a.GetClass(h.customType);k&&(k=new k,k._deserialize(h,this.getScene(),b),f[h.id]=k,this.attachedBlocks.push(k))}for(b=0;b<a.blocks.length;b++)(k=f[a.blocks[b].id])&&
(!k.inputs.length||c)&&this._restoreConnections(k,a,f);if(a.outputNodes)for(b=0,e=a.outputNodes;b<e.length;b++)this.addOutputNode(f[e[b]]);if(a.locations||a.editorData&&a.editorData.locations){b=a.locations||a.editorData.locations;for(e=0;e<b.length;e++)g=b[e],f[g.blockId]&&(g.blockId=f[g.blockId].uniqueId);c&&this.editorData&&this.editorData.locations&&b.concat(this.editorData.locations);a.locations?this.editorData={locations:b}:(this.editorData=a.editorData,this.editorData.locations=b);b=[];for(var t in f)b[t]=
f[t].uniqueId;this.editorData.map=b}this.comment=a.comment;c||(this._mode=null!==(d=a.mode)&&void 0!==d?d:z.a.Material)};c.prototype.clone=function(a){var b=this,d=this.serialize(),f=C.a.Clone(function(){return new c(a,b.getScene(),b.options)},this);f.id=a;f.name=a;f.loadFromSerialization(d);f.build();return f};c.Parse=function(a,b,f){void 0===f&&(f="");var d=C.a.Parse(function(){return new c(a.name,b)},a,b,f);d.loadFromSerialization(a,f);d.build();return d};c.ParseFromFileAsync=function(a,b,f){var d=
new c(a,f);return new Promise(function(a,c){return d.loadAsync(b).then(function(){d.build();a(d)}).catch(c)})};c.ParseFromSnippetAsync=function(a,b,f,e){var d=this;void 0===f&&(f="");return"_BLANK"===a?Promise.resolve(this.CreateDefault("blank",b)):new Promise(function(g,h){var k=new V.a;k.addEventListener("readystatechange",function(){if(4==k.readyState)if(200==k.status){var d=JSON.parse(JSON.parse(k.responseText).jsonPayload);d=JSON.parse(d.nodeMaterial);e||(e=C.a.Parse(function(){return new c(a,
b)},d,b,f),e.uniqueId=b.getUniqueId());e.loadFromSerialization(d);e.snippetId=a;try{e.build(),g(e)}catch(ca){h(ca)}}else h("Unable to load the snippet "+a)});k.open("GET",d.SnippetUrl+"/"+a.replace(/#/g,"/"));k.send()})};c.CreateDefault=function(a,b){a=new c(a,b);a.setToDefault();a.build();return a};c._BuildIdGenerator=0;c.EditorURL="https://unpkg.com/babylonjs-node-editor@"+A.a.Version+"/babylon.nodeEditor.js";c.SnippetUrl="https://snippet.babylonjs.com";c.IgnoreTexturesAtLoadTime=!1;Object(r.c)([Object(C.c)("mode")],
c.prototype,"_mode",void 0);Object(r.c)([Object(C.c)("comment")],c.prototype,"comment",void 0);return c}(m.a);L.a.RegisteredTypes["BABYLON.NodeMaterial"]=I},O6Ub:function(m,n,a){function r(a,m,n,l){void 0===m&&(m=e.Boolean);void 0===n&&(n="PROPERTIES");return function(e,b){var c=e._propStore;c||(c=[],e._propStore=c);c.push({propertyName:b,displayName:a,type:m,groupName:n,options:null!==l&&void 0!==l?l:{}})}}a.d(n,"a",function(){return e});a.d(n,"b",function(){return r});var e;(function(a){a[a.Boolean=
0]="Boolean";a[a.Float=1]="Float";a[a.Vector2=2]="Vector2";a[a.List=3]="List"})(e||(e={}))},XA4I:function(m,n,a){a.d(n,"a",function(){return l});var r=a("f9H2"),e=a("31XQ"),v=a("lzMP"),u=a("Hy5V"),A=a("WHS4"),l=function(){function a(a,c,f,e){void 0===c&&(c=v.a.Vertex);void 0===f&&(f=!1);void 0===e&&(e=!1);this.inputsAreExclusive=this._isUnique=!1;this._codeVariableName="";this._inputs=[];this._outputs=[];this.comments="";this.visibleInInspector=!1;this._target=c;this._isFinalMerger=f;this._isInput=
e;this._name=a;this.uniqueId=u.a.UniqueId}Object.defineProperty(a.prototype,"name",{get:function(){return this._name},set:function(a){this.validateBlockName(a)&&(this._name=a)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isUnique",{get:function(){return this._isUnique},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isFinalMerger",{get:function(){return this._isFinalMerger},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"isInput",{get:function(){return this._isInput},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"buildId",{get:function(){return this._buildId},set:function(a){this._buildId=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"target",{get:function(){return this._target},set:function(a){0===(this._target&a)&&(this._target=a)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"inputs",{get:function(){return this._inputs},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"outputs",
{get:function(){return this._outputs},enumerable:!1,configurable:!0});a.prototype.getInputByName=function(a){var b=this._inputs.filter(function(b){return b.name===a});return b.length?b[0]:null};a.prototype.getOutputByName=function(a){var b=this._outputs.filter(function(b){return b.name===a});return b.length?b[0]:null};a.prototype.initialize=function(a){};a.prototype.bind=function(a,c,f,e){};a.prototype._declareOutput=function(a,c){return c._getGLType(a.type)+" "+a.associatedVariableName};a.prototype._writeVariable=
function(a){return a.connectedPoint?""+a.associatedVariableName:"0."};a.prototype._writeFloat=function(a){a=a.toString();-1===a.indexOf(".")&&(a+=".0");return""+a};a.prototype.getClassName=function(){return"NodeMaterialBlock"};a.prototype.registerInput=function(a,c,f,t,g){void 0===f&&(f=!1);g=null!==g&&void 0!==g?g:new e.a(a,this,e.c.Input);g.type=c;g.isOptional=f;t&&(g.target=t);this._inputs.push(g);return this};a.prototype.registerOutput=function(a,c,f,g){g=null!==g&&void 0!==g?g:new e.a(a,this,
e.c.Output);g.type=c;f&&(g.target=f);this._outputs.push(g);return this};a.prototype.getFirstAvailableInput=function(a){void 0===a&&(a=null);for(var b=0,f=this._inputs;b<f.length;b++){var e=f[b];if(!(e.connectedPoint||a&&a.type!==e.type&&e.type!==r.a.AutoDetect))return e}return null};a.prototype.getFirstAvailableOutput=function(a){void 0===a&&(a=null);for(var b=0,f=this._outputs;b<f.length;b++){var e=f[b];if(!a||!a.target||a.target===v.a.Neutral||0!==(a.target&e.target))return e}return null};a.prototype.getSiblingOutput=
function(a){a=this._outputs.indexOf(a);return-1===a||a>=this._outputs.length?null:this._outputs[a+1]};a.prototype.connectTo=function(a,c){if(0!==this._outputs.length){for(var b=c&&c.output?this.getOutputByName(c.output):this.getFirstAvailableOutput(a),e=!0;e;){var g=c&&c.input?a.getInputByName(c.input):a.getFirstAvailableInput(b);if(b&&g&&b.canConnectTo(g))b.connectTo(g),e=!1;else if(b)b=this.getSiblingOutput(b);else throw"Unable to find a compatible match";}return this}};a.prototype._buildBlock=
function(a){};a.prototype.updateUniformsAndSamples=function(a,c,f,e){};a.prototype.provideFallbacks=function(a,c){};a.prototype.initializeDefines=function(a,c,f,e){};a.prototype.prepareDefines=function(a,c,f,e,g){};a.prototype.autoConfigure=function(a){};a.prototype.replaceRepeatableContent=function(a,c,f,e){};a.prototype.isReady=function(a,c,f,e){return!0};a.prototype._linkConnectionTypes=function(a,c,f){void 0===f&&(f=!1);f?this._inputs[c]._acceptedConnectionPointType=this._inputs[a]:this._inputs[a]._linkedConnectionSource=
this._inputs[c];this._inputs[c]._linkedConnectionSource=this._inputs[a]};a.prototype._processBuild=function(a,c,f,e){a.build(c,e);e=a._buildTarget===v.a.Vertex&&a.target!==v.a.VertexAndFragment;null!=c._vertexState&&(0===(a.target&a._buildTarget)||0===(a.target&f.target)||this.target!==v.a.VertexAndFragment&&e)&&(!a.isInput&&c.target!==a._buildTarget||a.isInput&&a.isAttribute&&!a._noContextSwitch)&&(a=f.connectedPoint,c._vertexState._emitVaryingFromString("v_"+a.associatedVariableName,c._getGLType(a.type))&&
(c._vertexState.compilationString+="v_"+a.associatedVariableName+" = "+a.associatedVariableName+";\r\n"),f.associatedVariableName="v_"+a.associatedVariableName,f._enforceAssociatedVariableName=!0)};a.prototype.validateBlockName=function(a){for(var b=0,f="position normal tangent particle_positionw uv uv2 position2d particle_uv matricesIndices matricesWeights world0 world1 world2 world3 particle_color particle_texturemask".split(" ");b<f.length;b++)if(a===f[b])return!1;return!0};a.prototype.build=function(a,
c){if(this._buildId===a.sharedData.buildId)return!0;if(!this.isInput)for(var b=0,e=this._outputs;b<e.length;b++){var g=e[b];g.associatedVariableName||(g.associatedVariableName=a._getFreeVariableName(g.name))}b=0;for(e=this._inputs;b<e.length;b++){var l=e[b];if(l.connectedPoint){if(this.target!==v.a.Neutral){if(0===(l.target&this.target))continue;if(0===(l.target&a.target))continue}(g=l.connectedPoint.ownerBlock)&&g!==this&&this._processBuild(g,a,l,c)}else l.isOptional||a.sharedData.checks.notConnectedNonOptionalInputs.push(l)}if(this._buildId===
a.sharedData.buildId)return!0;a.sharedData.verbose&&console.log((a.target===v.a.Vertex?"Vertex shader":"Fragment shader")+": Building "+this.name+" ["+this.getClassName()+"]");if(this.isFinalMerger)switch(a.target){case v.a.Vertex:a.sharedData.checks.emitVertex=!0;break;case v.a.Fragment:a.sharedData.checks.emitFragment=!0}!this.isInput&&a.sharedData.emitComments&&(a.compilationString+="\r\n//"+this.name+"\r\n");this._buildBlock(a);this._buildId=a.sharedData.buildId;this._buildTarget=a.target;b=0;
for(e=this._outputs;b<e.length;b++)if(g=e[b],0!==(g.target&a.target)){l=0;for(var m=g.endpoints;l<m.length;l++){var n=m[l];(g=n.ownerBlock)&&0!==(g.target&a.target)&&-1!==c.indexOf(g)&&this._processBuild(g,a,n,c)}}return!1};a.prototype._inputRename=function(a){return a};a.prototype._outputRename=function(a){return a};a.prototype._dumpPropertiesCode=function(){return this._codeVariableName+".visibleInInspector = "+this.visibleInInspector+";\r\n"};a.prototype._dumpCode=function(a,c){c.push(this);var b;
this._codeVariableName=(b=this.name.replace(/[^A-Za-z_]+/g,""))||this.getClassName()+"_"+this.uniqueId;if(-1!==a.indexOf(this._codeVariableName)){var e=0;do e++,this._codeVariableName=b+e;while(-1!==a.indexOf(this._codeVariableName))}a.push(this._codeVariableName);b="\r\n// "+this.getClassName()+"\r\n";this.comments&&(b+="// "+this.comments+"\r\n");b+="var "+this._codeVariableName+" = new BABYLON."+this.getClassName()+'("'+this.name+'");\r\n';b+=this._dumpPropertiesCode();for(var g=0,l=this.inputs;g<
l.length;g++)e=l[g],e.isConnected&&(e=e.connectedPoint.ownerBlock,-1===c.indexOf(e)&&(b+=e._dumpCode(a,c)));g=0;for(l=this.outputs;g<l.length;g++)if(e=l[g],e.hasEndpoints)for(var m=0,n=e.endpoints;m<n.length;m++)(e=n[m].ownerBlock)&&-1===c.indexOf(e)&&(b+=e._dumpCode(a,c));return b};a.prototype._dumpCodeForOutputConnections=function(a){var b="";if(-1!==a.indexOf(this))return b;a.push(this);for(var e=0,g=this.inputs;e<g.length;e++){var l=g[e];if(l.isConnected){var m=l.connectedPoint,n=m.ownerBlock;
b+=n._dumpCodeForOutputConnections(a);b+=n._codeVariableName+"."+n._outputRename(m.name)+".connectTo("+this._codeVariableName+"."+this._inputRename(l.name)+");\r\n"}}return b};a.prototype.clone=function(a,c){void 0===c&&(c="");var b=this.serialize(),e=A.a.GetClass(b.customType);return e?(e=new e,e._deserialize(b,a,c),e):null};a.prototype.serialize=function(){var a={};a.customType="BABYLON."+this.getClassName();a.id=this.uniqueId;a.name=this.name;a.comments=this.comments;a.visibleInInspector=this.visibleInInspector;
a.inputs=[];a.outputs=[];for(var c=0,e=this.inputs;c<e.length;c++)a.inputs.push(e[c].serialize());c=0;for(e=this.outputs;c<e.length;c++)a.outputs.push(e[c].serialize(!1));return a};a.prototype._deserialize=function(a,c,e){this.name=a.name;this.comments=a.comments;this.visibleInInspector=!!a.visibleInInspector;this._deserializePortDisplayNamesAndExposedOnFrame(a)};a.prototype._deserializePortDisplayNamesAndExposedOnFrame=function(a){var b=this,e=a.inputs;a=a.outputs;e&&e.forEach(function(a,c){a.displayName&&
(b.inputs[c].displayName=a.displayName);a.isExposedOnFrame&&(b.inputs[c].isExposedOnFrame=a.isExposedOnFrame,b.inputs[c].exposedPortPosition=a.exposedPortPosition)});a&&a.forEach(function(a,c){a.displayName&&(b.outputs[c].displayName=a.displayName);a.isExposedOnFrame&&(b.outputs[c].isExposedOnFrame=a.isExposedOnFrame,b.outputs[c].exposedPortPosition=a.exposedPortPosition)})};a.prototype.dispose=function(){for(var a=0,c=this.inputs;a<c.length;a++)c[a].dispose();a=0;for(c=this.outputs;a<c.length;a++)c[a].dispose()};
return a}()},mVZL:function(m,n,a){a("ZxJR");a("dTg5");a("oXT7");a("kJpR");a("0iaI")},mdIh:function(m,n,a){a.d(n,"a",function(){return v});var r=a("oYeq"),e=a("31XQ"),v=function(a){function m(e,g,b,c,f,m){g=a.call(this,e,g,b)||this;g._blockType=c;g._blockName=f;g._nameForCheking=m;g._nameForCheking||(g._nameForCheking=e);g.needDualDirectionValidation=!0;return g}Object(r.d)(m,a);m.prototype.checkCompatibilityState=function(a){return a instanceof m&&a.name===this._nameForCheking?e.b.Compatible:e.b.TypeIncompatible};
m.prototype.createCustomInputBlock=function(){return[new this._blockType(this._blockName),this.name]};return m}(e.a)}}]);
