var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(v){var w=0;return function(){return w<v.length?{done:!1,value:v[w++]}:{done:!0}}};$jscomp.arrayIterator=function(v){return{next:$jscomp.arrayIteratorImpl(v)}};$jscomp.makeIterator=function(v){var w="undefined"!=typeof Symbol&&Symbol.iterator&&v[Symbol.iterator];return w?w.call(v):$jscomp.arrayIterator(v)};
$jscomp.getGlobal=function(v){return"undefined"!=typeof window&&window===v?v:"undefined"!=typeof global&&null!=global?global:v};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(v,w,g){v!=Array.prototype&&v!=Object.prototype&&(v[w]=g.value)};
$jscomp.polyfill=function(v,w,g,x){if(w){g=$jscomp.global;v=v.split(".");for(x=0;x<v.length-1;x++){var p=v[x];p in g||(g[p]={});g=g[p]}v=v[v.length-1];x=g[v];w=w(x);w!=x&&null!=w&&$jscomp.defineProperty(g,v,{configurable:!0,writable:!0,value:w})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(v){function w(){this.batch_=null}function g(c){return c instanceof p?c:new p(function(g,e){g(c)})}if(v&&!$jscomp.FORCE_POLYFILL_PROMISE)return v;w.prototype.asyncExecute=function(c){if(null==this.batch_){this.batch_=[];var g=this;this.asyncExecuteFunction(function(){g.executeBatch_()})}this.batch_.push(c)};var x=$jscomp.global.setTimeout;w.prototype.asyncExecuteFunction=function(c){x(c,0)};w.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=
this.batch_;this.batch_=[];for(var g=0;g<c.length;++g){var e=c[g];c[g]=null;try{e()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};w.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var p=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var g=this.createResolveAndReject_();try{c(g.resolve,g.reject)}catch(e){g.reject(e)}};p.prototype.createResolveAndReject_=function(){function c(c){return function(f){e||(e=!0,c.call(g,f))}}var g=this,e=!1;
return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};p.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof p)this.settleSameAsPromise_(c);else{a:switch(typeof c){case "object":var g=null!=c;break a;case "function":g=!0;break a;default:g=!1}g?this.resolveToNonPromiseObj_(c):this.fulfill_(c)}};p.prototype.resolveToNonPromiseObj_=function(c){var g=void 0;try{g=c.then}catch(e){this.reject_(e);return}"function"==typeof g?
this.settleSameAsThenable_(g,c):this.fulfill_(c)};p.prototype.reject_=function(c){this.settle_(2,c)};p.prototype.fulfill_=function(c){this.settle_(1,c)};p.prototype.settle_=function(c,g){if(0!=this.state_)throw Error("Cannot settle("+c+", "+g+"): Promise already settled in state"+this.state_);this.state_=c;this.result_=g;this.executeOnSettledCallbacks_()};p.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var c=0;c<this.onSettledCallbacks_.length;++c)q.asyncExecute(this.onSettledCallbacks_[c]);
this.onSettledCallbacks_=null}};var q=new w;p.prototype.settleSameAsPromise_=function(c){var g=this.createResolveAndReject_();c.callWhenSettled_(g.resolve,g.reject)};p.prototype.settleSameAsThenable_=function(c,g){var e=this.createResolveAndReject_();try{c.call(g,e.resolve,e.reject)}catch(f){e.reject(f)}};p.prototype.then=function(c,g){function e(c,e){return"function"==typeof c?function(e){try{f(c(e))}catch(aa){r(aa)}}:e}var f,r,u=new p(function(c,e){f=c;r=e});this.callWhenSettled_(e(c,f),e(g,r));
return u};p.prototype.catch=function(c){return this.then(void 0,c)};p.prototype.callWhenSettled_=function(c,g){function e(){switch(f.state_){case 1:c(f.result_);break;case 2:g(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?q.asyncExecute(e):this.onSettledCallbacks_.push(e)};p.resolve=g;p.reject=function(c){return new p(function(g,e){e(c)})};p.race=function(c){return new p(function(p,e){for(var f=$jscomp.makeIterator(c),r=f.next();!r.done;r=
f.next())g(r.value).callWhenSettled_(p,e)})};p.all=function(c){var q=$jscomp.makeIterator(c),e=q.next();return e.done?g([]):new p(function(c,r){function f(e){return function(f){p[e]=f;u--;0==u&&c(p)}}var p=[],u=0;do p.push(void 0),u++,g(e.value).callWhenSettled_(f(p.length-1),r),e=q.next();while(!e.done)})};return p},"es6","es3");
(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"9lcB":function(v,w,g){g.d(w,"a",function(){return q});var x=g("Dc3z"),p=g("/SR9"),q=function(){function c(){this.particlePositionGenerator=function(){};this.particleDestinationGenerator=function(){}}c.prototype.startDirectionFunction=function(c,e,f,g){var r=p.c.Vector3[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,f,r);var q=p.c.Vector3[1];r.subtractToRef(f.position,q);q.scaleToRef(1/f.lifeTime,r)}else r.set(0,
0,0);g?e.copyFrom(r):p.e.TransformNormalToRef(r,c,e)};c.prototype.startPositionFunction=function(c,e,f,g){var r=p.c.Vector3[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,f,r):r.set(0,0,0);g?e.copyFrom(r):p.e.TransformCoordinatesToRef(r,c,e)};c.prototype.clone=function(){var g=new c;x.a.DeepCopy(this,g);return g};c.prototype.applyToShader=function(c){};c.prototype.getEffectDefines=function(){return"#define CUSTOMEMITTER"};c.prototype.getClassName=function(){return"CustomParticleEmitter"};
c.prototype.serialize=function(){var c={};c.type=this.getClassName();return c};c.prototype.parse=function(c){};return c}()},IJA2:function(v,w,g){g.d(w,"a",function(){return c});var x=g("Dc3z"),p=g("/SR9"),q=g("sH6m"),c=function(){function c(){this.direction1=new p.e(0,1,0);this.direction2=new p.e(0,1,0);this.minEmitBox=new p.e(-.5,-.5,-.5);this.maxEmitBox=new p.e(.5,.5,.5)}c.prototype.startDirectionFunction=function(c,f,g,u){g=q.a.RandomRange(this.direction1.x,this.direction2.x);var e=q.a.RandomRange(this.direction1.y,
this.direction2.y),r=q.a.RandomRange(this.direction1.z,this.direction2.z);u?(f.x=g,f.y=e,f.z=r):p.e.TransformNormalFromFloatsToRef(g,e,r,c,f)};c.prototype.startPositionFunction=function(c,f,g,u){g=q.a.RandomRange(this.minEmitBox.x,this.maxEmitBox.x);var e=q.a.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),r=q.a.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);u?(f.x=g,f.y=e,f.z=r):p.e.TransformCoordinatesFromFloatsToRef(g,e,r,c,f)};c.prototype.clone=function(){var e=new c;x.a.DeepCopy(this,e);return e};
c.prototype.applyToShader=function(c){c.setVector3("direction1",this.direction1);c.setVector3("direction2",this.direction2);c.setVector3("minEmitBox",this.minEmitBox);c.setVector3("maxEmitBox",this.maxEmitBox)};c.prototype.getEffectDefines=function(){return"#define BOXEMITTER"};c.prototype.getClassName=function(){return"BoxParticleEmitter"};c.prototype.serialize=function(){var c={};c.type=this.getClassName();c.direction1=this.direction1.asArray();c.direction2=this.direction2.asArray();c.minEmitBox=
this.minEmitBox.asArray();c.maxEmitBox=this.maxEmitBox.asArray();return c};c.prototype.parse=function(c){p.e.FromArrayToRef(c.direction1,0,this.direction1);p.e.FromArrayToRef(c.direction2,0,this.direction2);p.e.FromArrayToRef(c.minEmitBox,0,this.minEmitBox);p.e.FromArrayToRef(c.maxEmitBox,0,this.maxEmitBox)};return c}()},OGO2:function(v,w,g){g.d(w,"a",function(){return Z});var x=g("oYeq"),p=g("dLGY"),q=g("ps+7"),c=g("/SR9"),u=g("sH6m"),e=g("y4Ty"),f=g("stmW"),r=g("T5W1"),ea=g("e2Mr"),K=g("YSMO");
v=g("S4Gu");var ia=g("ltZq"),D=g("gmvZ"),aa=g("ADVu"),N=g("WHS4");g("mJze");g("yURT");var F=g("Xeau"),b=g("h13i"),G=g("QCD/");g("+zdb");var Z=function(g){function l(a,d,b,m,h,e){void 0===m&&(m=null);void 0===h&&(h=!1);void 0===e&&(e=.01);var k=g.call(this,a)||this;k._inheritedVelocityOffset=new c.e;k.onDisposeObservable=new q.a;k.onStoppedObservable=new q.a;k._particles=[];k._stockParticles=[];k._newPartsExcess=0;k._vertexBuffers={};k._scaledColorStep=new F.b(0,0,0,0);k._colorDiff=new F.b(0,0,0,0);
k._scaledDirection=c.e.Zero();k._scaledGravity=c.e.Zero();k._currentRenderId=-1;k._useInstancing=!1;k._started=!1;k._stopped=!1;k._actualFrame=0;k._currentEmitRate1=0;k._currentEmitRate2=0;k._currentStartSize1=0;k._currentStartSize2=0;k._rawTextureWidth=256;k._useRampGradients=!1;k._disposeEmitterOnDispose=!1;k.isLocal=!1;k._onBeforeDrawParticlesObservable=null;k.recycleParticle=function(a){var d=k._particles.pop();d!==a&&d.copyTo(a);k._stockParticles.push(d)};k._createParticle=function(){if(0!==
k._stockParticles.length){var a=k._stockParticles.pop();a._reset()}else a=new ia.a(k);if(k._subEmitters&&0<k._subEmitters.length){var d=k._subEmitters[Math.floor(Math.random()*k._subEmitters.length)];a._attachedSubEmitters=[];d.forEach(function(d){d.type===D.b.ATTACHED&&(d=d.clone(),a._attachedSubEmitters.push(d),d.particleSystem.start())})}return a};k._emitFromParticle=function(a){k._subEmitters&&0!==k._subEmitters.length&&k._subEmitters[Math.floor(Math.random()*k._subEmitters.length)].forEach(function(d){d.type===
D.b.END&&(d=d.clone(),a._inheritParticleInfoToSubEmitter(d),d.particleSystem._rootParticleSystem=k,k.activeSubSystems.push(d.particleSystem),d.particleSystem.start())})};k._capacity=d;k._epsilon=e;k._isAnimationSheetEnabled=h;b&&"Scene"!==b.getClassName()?(k._engine=b,k.defaultProjectionMatrix=c.a.PerspectiveFovLH(.8,1,.1,100)):(k._scene=b||ea.a.LastCreatedScene,k._engine=k._scene.getEngine(),k.uniqueId=k._scene.getUniqueId(),k._scene.particleSystems.push(k));k._engine.getCaps().vertexArrayObject&&
(k._vertexArrayObject=null);k._attachImageProcessingConfiguration(null);k._customEffect={0:m};k._useInstancing=k._engine.getCaps().instancedArrays;k._createIndexBuffer();k._createVertexBuffers();k.particleEmitterType=new K.a;k.updateFunction=function(a){var d=null,h=null;k.noiseTexture&&(d=k.noiseTexture.getSize(),h=k.noiseTexture.getContent());for(var m=function(){b=a[e];var m=k._scaledUpdateSpeed,f=b.age;b.age+=m;b.age>b.lifeTime&&(m=(b.lifeTime-f)*m/(b.age-f),b.age=b.lifeTime);f=b.age/b.lifeTime;
k._colorGradients&&0<k._colorGradients.length?p.d.GetCurrentGradient(f,k._colorGradients,function(a,d,h){a!==b._currentColorGradient&&(b._currentColor1.copyFrom(b._currentColor2),d.getColorToRef(b._currentColor2),b._currentColorGradient=a);F.b.LerpToRef(b._currentColor1,b._currentColor2,h,b.color)}):(b.colorStep.scaleToRef(m,k._scaledColorStep),b.color.addInPlace(k._scaledColorStep),0>b.color.a&&(b.color.a=0));k._angularSpeedGradients&&0<k._angularSpeedGradients.length&&p.d.GetCurrentGradient(f,k._angularSpeedGradients,
function(a,d,h){a!==b._currentAngularSpeedGradient&&(b._currentAngularSpeed1=b._currentAngularSpeed2,b._currentAngularSpeed2=d.getFactor(),b._currentAngularSpeedGradient=a);b.angularSpeed=u.a.Lerp(b._currentAngularSpeed1,b._currentAngularSpeed2,h)});b.angle+=b.angularSpeed*m;var fa=m;k._velocityGradients&&0<k._velocityGradients.length&&p.d.GetCurrentGradient(f,k._velocityGradients,function(a,d,h){a!==b._currentVelocityGradient&&(b._currentVelocity1=b._currentVelocity2,b._currentVelocity2=d.getFactor(),
b._currentVelocityGradient=a);fa*=u.a.Lerp(b._currentVelocity1,b._currentVelocity2,h)});b.direction.scaleToRef(fa,k._scaledDirection);k._limitVelocityGradients&&0<k._limitVelocityGradients.length&&p.d.GetCurrentGradient(f,k._limitVelocityGradients,function(a,d,h){a!==b._currentLimitVelocityGradient&&(b._currentLimitVelocity1=b._currentLimitVelocity2,b._currentLimitVelocity2=d.getFactor(),b._currentLimitVelocityGradient=a);a=u.a.Lerp(b._currentLimitVelocity1,b._currentLimitVelocity2,h);b.direction.length()>
a&&b.direction.scaleInPlace(k.limitVelocityDamping)});k._dragGradients&&0<k._dragGradients.length&&p.d.GetCurrentGradient(f,k._dragGradients,function(a,d,h){a!==b._currentDragGradient&&(b._currentDrag1=b._currentDrag2,b._currentDrag2=d.getFactor(),b._currentDragGradient=a);a=u.a.Lerp(b._currentDrag1,b._currentDrag2,h);k._scaledDirection.scaleInPlace(1-a)});k.isLocal&&b._localPosition?(b._localPosition.addInPlace(k._scaledDirection),c.e.TransformCoordinatesToRef(b._localPosition,k._emitterWorldMatrix,
b.position)):b.position.addInPlace(k._scaledDirection);if(h&&d&&b._randomNoiseCoordinates1){var g=k._fetchR(b._randomNoiseCoordinates1.x,b._randomNoiseCoordinates1.y,d.width,d.height,h),l=k._fetchR(b._randomNoiseCoordinates1.z,b._randomNoiseCoordinates2.x,d.width,d.height,h),pa=k._fetchR(b._randomNoiseCoordinates2.y,b._randomNoiseCoordinates2.z,d.width,d.height,h),G=c.c.Vector3[0],Z=c.c.Vector3[1];G.copyFromFloats((2*g-1)*k.noiseStrength.x,(2*l-1)*k.noiseStrength.y,(2*pa-1)*k.noiseStrength.z);G.scaleToRef(m,
Z);b.direction.addInPlace(Z)}k.gravity.scaleToRef(m,k._scaledGravity);b.direction.addInPlace(k._scaledGravity);k._sizeGradients&&0<k._sizeGradients.length&&p.d.GetCurrentGradient(f,k._sizeGradients,function(a,d,h){a!==b._currentSizeGradient&&(b._currentSize1=b._currentSize2,b._currentSize2=d.getFactor(),b._currentSizeGradient=a);b.size=u.a.Lerp(b._currentSize1,b._currentSize2,h)});k._useRampGradients&&(k._colorRemapGradients&&0<k._colorRemapGradients.length&&p.d.GetCurrentGradient(f,k._colorRemapGradients,
function(a,d,h){var c=u.a.Lerp(a.factor1,d.factor1,h);a=u.a.Lerp(a.factor2,d.factor2,h);b.remapData.x=c;b.remapData.y=a-c}),k._alphaRemapGradients&&0<k._alphaRemapGradients.length&&p.d.GetCurrentGradient(f,k._alphaRemapGradients,function(a,d,h){var c=u.a.Lerp(a.factor1,d.factor1,h);a=u.a.Lerp(a.factor2,d.factor2,h);b.remapData.z=c;b.remapData.w=a-c}));k._isAnimationSheetEnabled&&b.updateCellIndex();b._inheritParticleInfoToSubEmitters();if(b.age>=b.lifeTime)return k._emitFromParticle(b),b._attachedSubEmitters&&
(b._attachedSubEmitters.forEach(function(a){a.particleSystem.disposeOnStop=!0;a.particleSystem.stop()}),b._attachedSubEmitters=null),k.recycleParticle(b),e--,"continue"},b,e=0;e<a.length;e++)m()};return k}Object(x.d)(l,g);Object.defineProperty(l.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"useRampGradients",
{get:function(){return this._useRampGradients},set:function(a){this._useRampGradients!==a&&(this._useRampGradients=a,this._resetEffect())},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"particles",{get:function(){return this._particles},enumerable:!1,configurable:!0});l.prototype.getActiveCount=function(){return this._particles.length};l.prototype.getClassName=function(){return"ParticleSystem"};l.prototype.isStopping=function(){return this._stopped&&this.isAlive()};l.prototype.getCustomEffect=
function(a){var d;void 0===a&&(a=0);return null!==(d=this._customEffect[a])&&void 0!==d?d:this._customEffect[0]};l.prototype.setCustomEffect=function(a,d){void 0===d&&(d=0);this._customEffect[d]=a};Object.defineProperty(l.prototype,"onBeforeDrawParticlesObservable",{get:function(){this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new q.a);return this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0});Object.defineProperty(l.prototype,"vertexShaderName",{get:function(){return"particles"},
enumerable:!1,configurable:!0});l.prototype._addFactorGradient=function(a,d,b,c){d=new p.c(d,b,c);a.push(d);a.sort(function(a,d){return a.gradient<d.gradient?-1:a.gradient>d.gradient?1:0})};l.prototype._removeFactorGradient=function(a,d){if(a)for(var b=0,c=0;c<a.length;c++){if(a[c].gradient===d){a.splice(b,1);break}b++}};l.prototype.addLifeTimeGradient=function(a,d,b){this._lifeTimeGradients||(this._lifeTimeGradients=[]);this._addFactorGradient(this._lifeTimeGradients,a,d,b);return this};l.prototype.removeLifeTimeGradient=
function(a){this._removeFactorGradient(this._lifeTimeGradients,a);return this};l.prototype.addSizeGradient=function(a,d,b){this._sizeGradients||(this._sizeGradients=[]);this._addFactorGradient(this._sizeGradients,a,d,b);return this};l.prototype.removeSizeGradient=function(a){this._removeFactorGradient(this._sizeGradients,a);return this};l.prototype.addColorRemapGradient=function(a,d,b){this._colorRemapGradients||(this._colorRemapGradients=[]);this._addFactorGradient(this._colorRemapGradients,a,d,
b);return this};l.prototype.removeColorRemapGradient=function(a){this._removeFactorGradient(this._colorRemapGradients,a);return this};l.prototype.addAlphaRemapGradient=function(a,d,b){this._alphaRemapGradients||(this._alphaRemapGradients=[]);this._addFactorGradient(this._alphaRemapGradients,a,d,b);return this};l.prototype.removeAlphaRemapGradient=function(a){this._removeFactorGradient(this._alphaRemapGradients,a);return this};l.prototype.addAngularSpeedGradient=function(a,d,b){this._angularSpeedGradients||
(this._angularSpeedGradients=[]);this._addFactorGradient(this._angularSpeedGradients,a,d,b);return this};l.prototype.removeAngularSpeedGradient=function(a){this._removeFactorGradient(this._angularSpeedGradients,a);return this};l.prototype.addVelocityGradient=function(a,d,b){this._velocityGradients||(this._velocityGradients=[]);this._addFactorGradient(this._velocityGradients,a,d,b);return this};l.prototype.removeVelocityGradient=function(a){this._removeFactorGradient(this._velocityGradients,a);return this};
l.prototype.addLimitVelocityGradient=function(a,d,b){this._limitVelocityGradients||(this._limitVelocityGradients=[]);this._addFactorGradient(this._limitVelocityGradients,a,d,b);return this};l.prototype.removeLimitVelocityGradient=function(a){this._removeFactorGradient(this._limitVelocityGradients,a);return this};l.prototype.addDragGradient=function(a,d,b){this._dragGradients||(this._dragGradients=[]);this._addFactorGradient(this._dragGradients,a,d,b);return this};l.prototype.removeDragGradient=function(a){this._removeFactorGradient(this._dragGradients,
a);return this};l.prototype.addEmitRateGradient=function(a,d,b){this._emitRateGradients||(this._emitRateGradients=[]);this._addFactorGradient(this._emitRateGradients,a,d,b);return this};l.prototype.removeEmitRateGradient=function(a){this._removeFactorGradient(this._emitRateGradients,a);return this};l.prototype.addStartSizeGradient=function(a,d,b){this._startSizeGradients||(this._startSizeGradients=[]);this._addFactorGradient(this._startSizeGradients,a,d,b);return this};l.prototype.removeStartSizeGradient=
function(a){this._removeFactorGradient(this._startSizeGradients,a);return this};l.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture&&this._scene){for(var a=new Uint8Array(4*this._rawTextureWidth),d=F.c.Color3[0],b=0;b<this._rawTextureWidth;b++)p.d.GetCurrentGradient(b/this._rawTextureWidth,this._rampGradients,function(c,h,e){F.a.LerpToRef(c.color,h.color,e,d);a[4*b]=255*d.r;a[4*b+1]=255*d.g;a[4*b+2]=255*d.b;a[4*b+3]=255});
this._rampGradientsTexture=r.a.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,1)}};l.prototype.getRampGradients=function(){return this._rampGradients};l.prototype.forceRefreshGradients=function(){this._syncRampGradientTexture()};l.prototype._syncRampGradientTexture=function(){this._rampGradients&&(this._rampGradients.sort(function(a,d){return a.gradient<d.gradient?-1:a.gradient>d.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=
null),this._createRampGradientTexture())};l.prototype.addRampGradient=function(a,d){this._rampGradients||(this._rampGradients=[]);a=new p.a(a,d);this._rampGradients.push(a);this._syncRampGradientTexture();return this};l.prototype.removeRampGradient=function(a){this._removeGradientAndTexture(a,this._rampGradients,this._rampGradientsTexture);this._rampGradientsTexture=null;this._rampGradients&&0<this._rampGradients.length&&this._createRampGradientTexture();return this};l.prototype.addColorGradient=
function(a,d,b){this._colorGradients||(this._colorGradients=[]);a=new p.b(a,d,b);this._colorGradients.push(a);this._colorGradients.sort(function(a,d){return a.gradient<d.gradient?-1:a.gradient>d.gradient?1:0});return this};l.prototype.removeColorGradient=function(a){if(!this._colorGradients)return this;for(var d=0,b=0,c=this._colorGradients;b<c.length;b++){if(c[b].gradient===a){this._colorGradients.splice(d,1);break}d++}return this};l.prototype._fetchR=function(a,d,b,c,h){a=.5*Math.abs(a)+.5;d=.5*
Math.abs(d)+.5;return h[4*((a*b%b|0)+(d*c%c|0)*b)]/255};l.prototype._reset=function(){this._resetEffect()};l.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null);this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null);this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null);this._createVertexBuffers()};l.prototype._createVertexBuffers=function(){this._vertexBufferSize=
this._useInstancing?10:12;this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1);this._isBillboardBased&&this.billboardMode!==l.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3);this._useRampGradients&&(this._vertexBufferSize+=4);var a=this._engine;this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4));this._vertexBuffer=new e.a(a,this._vertexData,!0,this._vertexBufferSize);var d=0,b=this._vertexBuffer.createVertexBuffer(e.b.PositionKind,d,3,this._vertexBufferSize,
this._useInstancing);this._vertexBuffers[e.b.PositionKind]=b;d+=3;b=this._vertexBuffer.createVertexBuffer(e.b.ColorKind,d,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[e.b.ColorKind]=b;d+=4;b=this._vertexBuffer.createVertexBuffer("angle",d,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=b;d+=1;b=this._vertexBuffer.createVertexBuffer("size",d,2,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.size=b;d+=2;this._isAnimationSheetEnabled&&(b=this._vertexBuffer.createVertexBuffer("cellIndex",
d,1,this._vertexBufferSize,this._useInstancing),this._vertexBuffers.cellIndex=b,d+=1);this._isBillboardBased&&this.billboardMode!==l.BILLBOARDMODE_STRETCHED||(b=this._vertexBuffer.createVertexBuffer("direction",d,3,this._vertexBufferSize,this._useInstancing),this._vertexBuffers.direction=b,d+=3);this._useRampGradients&&(b=this._vertexBuffer.createVertexBuffer("remapData",d,4,this._vertexBufferSize,this._useInstancing),this._vertexBuffers.remapData=b,d+=4);this._useInstancing?(d=new Float32Array([0,
0,1,0,1,1,0,1]),this._spriteBuffer=new e.a(a,d,!1,2),a=this._spriteBuffer.createVertexBuffer("offset",0,2)):a=this._vertexBuffer.createVertexBuffer("offset",d,2,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.offset=a};l.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var a=[],d=0,b=0;b<this._capacity;b++)a.push(d),a.push(d+1),a.push(d+2),a.push(d),a.push(d+2),a.push(d+3),d+=4;this._indexBuffer=this._engine.createIndexBuffer(a)}};l.prototype.getCapacity=function(){return this._capacity};
l.prototype.isAlive=function(){return this._alive};l.prototype.isStarted=function(){return this._started};l.prototype._prepareSubEmitterInternalArray=function(){var a=this;this._subEmitters=[];this.subEmitters&&this.subEmitters.forEach(function(d){d instanceof l?a._subEmitters.push([new D.a(d)]):d instanceof D.a?a._subEmitters.push([d]):d instanceof Array&&a._subEmitters.push(d)})};l.prototype.start=function(a){var d=this,b;void 0===a&&(a=this.startDelay);if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";
if(a)setTimeout(function(){d.start(0)},a);else{this._prepareSubEmitterInternalArray();this._started=!0;this._stopped=!1;this._actualFrame=0;this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[]);this._emitRateGradients&&(0<this._emitRateGradients.length&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate2=this._currentEmitRate1=this._currentEmitRateGradient.getFactor()),1<this._emitRateGradients.length&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor()));
this._startSizeGradients&&(0<this._startSizeGradients.length&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize2=this._currentStartSize1=this._currentStartSizeGradient.getFactor()),1<this._startSizeGradients.length&&(this._currentStartSize2=this._startSizeGradients[1].getFactor()));if(this.preWarmCycles){-1!==(null===(b=this.emitter)||void 0===b?void 0:b.getClassName().indexOf("Mesh"))&&this.emitter.computeWorldMatrix(!0);var c=this.noiseTexture;if(c&&c.onGeneratedObservable)c.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var a=
0;a<d.preWarmCycles;a++)d.animate(!0),c.render()})});else for(a=0;a<this.preWarmCycles;a++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&0<this.animations.length&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}};l.prototype.stop=function(a){void 0===a&&(a=!0);this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,a&&this._stopSubEmitters())};l.prototype.reset=function(){this._stockParticles=
[];this._particles=[]};l.prototype._appendParticleVertex=function(a,d,b,m){a*=this._vertexBufferSize;this._vertexData[a++]=d.position.x+this.worldOffset.x;this._vertexData[a++]=d.position.y+this.worldOffset.y;this._vertexData[a++]=d.position.z+this.worldOffset.z;this._vertexData[a++]=d.color.r;this._vertexData[a++]=d.color.g;this._vertexData[a++]=d.color.b;this._vertexData[a++]=d.color.a;this._vertexData[a++]=d.angle;this._vertexData[a++]=d.scale.x*d.size;this._vertexData[a++]=d.scale.y*d.size;this._isAnimationSheetEnabled&&
(this._vertexData[a++]=d.cellIndex);if(this._isBillboardBased)this.billboardMode===l.BILLBOARDMODE_STRETCHED&&(this._vertexData[a++]=d.direction.x,this._vertexData[a++]=d.direction.y,this._vertexData[a++]=d.direction.z);else if(d._initialDirection){var h=d._initialDirection;this.isLocal&&(c.e.TransformNormalToRef(h,this._emitterWorldMatrix,c.c.Vector3[0]),h=c.c.Vector3[0]);0===h.x&&0===h.z&&(h.x=.001);this._vertexData[a++]=h.x;this._vertexData[a++]=h.y;this._vertexData[a++]=h.z}else h=d.direction,
this.isLocal&&(c.e.TransformNormalToRef(h,this._emitterWorldMatrix,c.c.Vector3[0]),h=c.c.Vector3[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[a++]=h.x,this._vertexData[a++]=h.y,this._vertexData[a++]=h.z;this._useRampGradients&&d.remapData&&(this._vertexData[a++]=d.remapData.x,this._vertexData[a++]=d.remapData.y,this._vertexData[a++]=d.remapData.z,this._vertexData[a++]=d.remapData.w);this._useInstancing||(this._isAnimationSheetEnabled&&(0===b?b=this._epsilon:1===b&&(b=1-this._epsilon),0===m?m=
this._epsilon:1===m&&(m=1-this._epsilon)),this._vertexData[a++]=b,this._vertexData[a++]=m)};l.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(a){a.stop(!0)}),this.activeSubSystems=[])};l.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var a=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==a&&this._rootParticleSystem.activeSubSystems.splice(a,1);this._rootParticleSystem=null}};l.prototype._update=function(a){var d=this;
this._alive=0<this._particles.length;if(this.emitter.position)this._emitterWorldMatrix=this.emitter.getWorldMatrix();else{var b=this.emitter;this._emitterWorldMatrix=c.a.Translation(b.x,b.y,b.z)}this.updateFunction(this._particles);var m;b=function(){if(h._particles.length===h._capacity)return"break";m=h._createParticle();h._particles.push(m);if(h.targetStopDuration&&h._lifeTimeGradients&&0<h._lifeTimeGradients.length){var a=u.a.Clamp(h._actualFrame/h.targetStopDuration);p.d.GetCurrentGradient(a,
h._lifeTimeGradients,function(d,b){var c=d.getFactor(),h=b.getFactor();m.lifeTime=u.a.Lerp(c,h,(a-d.gradient)/(b.gradient-d.gradient))})}else m.lifeTime=u.a.RandomRange(h.minLifeTime,h.maxLifeTime);var b=u.a.RandomRange(h.minEmitPower,h.maxEmitPower);h.startPositionFunction?h.startPositionFunction(h._emitterWorldMatrix,m.position,m,h.isLocal):h.particleEmitterType.startPositionFunction(h._emitterWorldMatrix,m.position,m,h.isLocal);h.isLocal&&(m._localPosition?m._localPosition.copyFrom(m.position):
m._localPosition=m.position.clone(),c.e.TransformCoordinatesToRef(m._localPosition,h._emitterWorldMatrix,m.position));h.startDirectionFunction?h.startDirectionFunction(h._emitterWorldMatrix,m.direction,m,h.isLocal):h.particleEmitterType.startDirectionFunction(h._emitterWorldMatrix,m.direction,m,h.isLocal);0===b?m._initialDirection?m._initialDirection.copyFrom(m.direction):m._initialDirection=m.direction.clone():m._initialDirection=null;m.direction.scaleInPlace(b);h._sizeGradients&&0!==h._sizeGradients.length?
(m._currentSizeGradient=h._sizeGradients[0],m._currentSize1=m._currentSizeGradient.getFactor(),m.size=m._currentSize1,m._currentSize2=1<h._sizeGradients.length?h._sizeGradients[1].getFactor():m._currentSize1):m.size=u.a.RandomRange(h.minSize,h.maxSize);m.scale.copyFromFloats(u.a.RandomRange(h.minScaleX,h.maxScaleX),u.a.RandomRange(h.minScaleY,h.maxScaleY));h._startSizeGradients&&h._startSizeGradients[0]&&h.targetStopDuration&&p.d.GetCurrentGradient(h._actualFrame/h.targetStopDuration,h._startSizeGradients,
function(a,b,c){a!==d._currentStartSizeGradient&&(d._currentStartSize1=d._currentStartSize2,d._currentStartSize2=b.getFactor(),d._currentStartSizeGradient=a);a=u.a.Lerp(d._currentStartSize1,d._currentStartSize2,c);m.scale.scaleInPlace(a)});h._angularSpeedGradients&&0!==h._angularSpeedGradients.length?(m._currentAngularSpeedGradient=h._angularSpeedGradients[0],m.angularSpeed=m._currentAngularSpeedGradient.getFactor(),m._currentAngularSpeed1=m.angularSpeed,m._currentAngularSpeed2=1<h._angularSpeedGradients.length?
h._angularSpeedGradients[1].getFactor():m._currentAngularSpeed1):m.angularSpeed=u.a.RandomRange(h.minAngularSpeed,h.maxAngularSpeed);m.angle=u.a.RandomRange(h.minInitialRotation,h.maxInitialRotation);h._velocityGradients&&0<h._velocityGradients.length&&(m._currentVelocityGradient=h._velocityGradients[0],m._currentVelocity1=m._currentVelocityGradient.getFactor(),m._currentVelocity2=1<h._velocityGradients.length?h._velocityGradients[1].getFactor():m._currentVelocity1);h._limitVelocityGradients&&0<h._limitVelocityGradients.length&&
(m._currentLimitVelocityGradient=h._limitVelocityGradients[0],m._currentLimitVelocity1=m._currentLimitVelocityGradient.getFactor(),m._currentLimitVelocity2=1<h._limitVelocityGradients.length?h._limitVelocityGradients[1].getFactor():m._currentLimitVelocity1);h._dragGradients&&0<h._dragGradients.length&&(m._currentDragGradient=h._dragGradients[0],m._currentDrag1=m._currentDragGradient.getFactor(),m._currentDrag2=1<h._dragGradients.length?h._dragGradients[1].getFactor():m._currentDrag1);h._colorGradients&&
0!==h._colorGradients.length?(m._currentColorGradient=h._colorGradients[0],m._currentColorGradient.getColorToRef(m.color),m._currentColor1.copyFrom(m.color),1<h._colorGradients.length?h._colorGradients[1].getColorToRef(m._currentColor2):m._currentColor2.copyFrom(m.color)):(e=u.a.RandomRange(0,1),F.b.LerpToRef(h.color1,h.color2,e,m.color),h.colorDead.subtractToRef(m.color,h._colorDiff),h._colorDiff.scaleToRef(1/m.lifeTime,m.colorStep));h._isAnimationSheetEnabled&&(m._initialStartSpriteCellID=h.startSpriteCellID,
m._initialEndSpriteCellID=h.endSpriteCellID);m.direction.addInPlace(h._inheritedVelocityOffset);h._useRampGradients&&(m.remapData=new c.f(0,1,0,1));h.noiseTexture&&(m._randomNoiseCoordinates1?(m._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),m._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(m._randomNoiseCoordinates1=new c.e(Math.random(),Math.random(),Math.random()),m._randomNoiseCoordinates2=new c.e(Math.random(),Math.random(),
Math.random())));m._inheritParticleInfoToSubEmitters()};for(var h=this,e,k=0;k<a&&"break"!==b();k++);};l._GetAttributeNamesOrOptions=function(a,d,b){void 0===a&&(a=!1);void 0===d&&(d=!1);void 0===b&&(b=!1);var c=[e.b.PositionKind,e.b.ColorKind,"angle","offset","size"];a&&c.push("cellIndex");d||c.push("direction");b&&c.push("remapData");return c};l._GetEffectCreationOptions=function(a){void 0===a&&(a=!1);var d="invView view projection vClipPlane vClipPlane2 vClipPlane3 vClipPlane4 vClipPlane5 vClipPlane6 textureMask translationPivot eyePosition".split(" ");
a&&d.push("particlesInfos");return d};l.prototype.fillDefines=function(a,d){this._scene&&(this._scene.clipPlane&&a.push("#define CLIPPLANE"),this._scene.clipPlane2&&a.push("#define CLIPPLANE2"),this._scene.clipPlane3&&a.push("#define CLIPPLANE3"),this._scene.clipPlane4&&a.push("#define CLIPPLANE4"),this._scene.clipPlane5&&a.push("#define CLIPPLANE5"),this._scene.clipPlane6&&a.push("#define CLIPPLANE6"));this._isAnimationSheetEnabled&&a.push("#define ANIMATESHEET");d===l.BLENDMODE_MULTIPLY&&a.push("#define BLENDMULTIPLYMODE");
this._useRampGradients&&a.push("#define RAMPGRADIENT");if(this._isBillboardBased)switch(a.push("#define BILLBOARD"),this.billboardMode){case l.BILLBOARDMODE_Y:a.push("#define BILLBOARDY");break;case l.BILLBOARDMODE_STRETCHED:a.push("#define BILLBOARDSTRETCHED");break;case l.BILLBOARDMODE_ALL:a.push("#define BILLBOARDMODE_ALL")}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a.push(this._imageProcessingConfigurationDefines.toString()))};
l.prototype.fillUniformsAttributesAndSamplerNames=function(a,d,b){d.push.apply(d,l._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==l.BILLBOARDMODE_STRETCHED,this._useRampGradients));a.push.apply(a,l._GetEffectCreationOptions(this._isAnimationSheetEnabled));b.push("diffuseSampler","rampSampler");this._imageProcessingConfiguration&&(f.a.PrepareUniforms(a,this._imageProcessingConfigurationDefines),f.a.PrepareSamplers(b,this._imageProcessingConfigurationDefines))};
l.prototype._getEffect=function(a){var d=this.getCustomEffect(a);if(d)return d;d=[];this.fillDefines(d,a);a=d.join("\n");if(this._cachedDefines!==a){this._cachedDefines=a;d=[];var b=[],c=[];this.fillUniformsAttributesAndSamplerNames(b,d,c);this._effect=this._engine.createEffect("particles",d,b,c,a)}return this._effect};l.prototype.animate=function(a){var d=this,b;void 0===a&&(a=!1);if(this._started){if(!a&&this._scene){if(!this.isReady()||this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=
this._scene.getFrameId()}this._scaledUpdateSpeed=this.updateSpeed*(a?this.preWarmStepOffset:(null===(b=this._scene)||void 0===b?void 0:b.getAnimationRatio())||1);if(-1<this.manualEmitCount)b=this.manualEmitCount,this.manualEmitCount=this._newPartsExcess=0;else{var c=this.emitRate;this._emitRateGradients&&0<this._emitRateGradients.length&&this.targetStopDuration&&p.d.GetCurrentGradient(this._actualFrame/this.targetStopDuration,this._emitRateGradients,function(a,b,k){a!==d._currentEmitRateGradient&&
(d._currentEmitRate1=d._currentEmitRate2,d._currentEmitRate2=b.getFactor(),d._currentEmitRateGradient=a);c=u.a.Lerp(d._currentEmitRate1,d._currentEmitRate2,k)});b=c*this._scaledUpdateSpeed>>0;this._newPartsExcess+=c*this._scaledUpdateSpeed-b}1<this._newPartsExcess&&(b+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0);this._alive=!1;this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop());this._update(b);
if(this._stopped&&!this._alive){this._started=!1;if(this.onAnimationEnd)this.onAnimationEnd();this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this)}if(!a){for(b=a=0;b<this._particles.length;b++)this._appendParticleVertices(a,this._particles[b]),a+=this._useInstancing?1:4;this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}};l.prototype._appendParticleVertices=function(a,b){this._appendParticleVertex(a++,b,0,0);this._useInstancing||
(this._appendParticleVertex(a++,b,1,0),this._appendParticleVertex(a++,b,1,1),this._appendParticleVertex(a++,b,0,1))};l.prototype.rebuild=function(){this._createIndexBuffer();this._vertexBuffer&&this._vertexBuffer._rebuild();for(var a in this._vertexBuffers)this._vertexBuffers[a]._rebuild()};l.prototype.isReady=function(){if(!this.emitter||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==
l.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else if(!this._getEffect(l.BLENDMODE_MULTIPLY).isReady()||!this._getEffect(l.BLENDMODE_ADD).isReady())return!1;return!0};l.prototype._render=function(a){var b,e,f=this._getEffect(a),h=this._engine;h.enableEffect(f);var g=null!==(b=this.defaultViewMatrix)&&void 0!==b?b:this._scene.getViewMatrix();f.setTexture("diffuseSampler",this.particleTexture);f.setMatrix("view",g);f.setMatrix("projection",null!==(e=this.defaultProjectionMatrix)&&
void 0!==e?e:this._scene.getProjectionMatrix());this._isAnimationSheetEnabled&&this.particleTexture&&(b=this.particleTexture.getBaseSize(),f.setFloat3("particlesInfos",this.spriteCellWidth/b.width,this.spriteCellHeight/b.height,this.spriteCellWidth/b.width));f.setVector2("translationPivot",this.translationPivot);f.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a);this._isBillboardBased&&this._scene&&f.setVector3("eyePosition",this._scene.activeCamera.globalPosition);
this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),f.setTexture("rampSampler",this._rampGradientsTexture));b=f.defines;this._scene&&(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&G.a.BindClipPlane(f,this._scene);0<=b.indexOf("#define BILLBOARDMODE_ALL")&&(g.invertToRef(c.c.Matrix[0]),f.setMatrix("invView",
c.c.Matrix[0]));void 0!==this._vertexArrayObject?(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,f)),this._engine.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):h.bindBuffers(this._vertexBuffers,this._indexBuffer,f);this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(f);switch(a){case l.BLENDMODE_ADD:h.setAlphaMode(1);break;
case l.BLENDMODE_ONEONE:h.setAlphaMode(6);break;case l.BLENDMODE_STANDARD:h.setAlphaMode(2);break;case l.BLENDMODE_MULTIPLY:h.setAlphaMode(4)}this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(f);this._useInstancing?h.drawArraysType(8,0,4,this._particles.length):h.drawElementsType(0,0,6*this._particles.length);return this._particles.length};l.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var a=this._engine;a.setState&&(a.setState(!1),
this.forceDepthWrite&&a.setDepthWrite(!0));a=this.blendMode===l.BLENDMODE_MULTIPLYADD?this._render(l.BLENDMODE_MULTIPLY)+this._render(l.BLENDMODE_ADD):this._render(this.blendMode);this._engine.unbindInstanceAttributes();this._engine.setAlphaMode(0);return a};l.prototype.dispose=function(a){void 0===a&&(a=!0);this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null);this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null);this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),
this._indexBuffer=null);this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null);a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null);this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null);this._removeFromRoot();if(this._subEmitters&&this._subEmitters.length){for(a=0;a<this._subEmitters.length;a++)for(var b=
0,c=this._subEmitters[a];b<c.length;b++)c[b].dispose();this._subEmitters=[];this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0);this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear();this._scene&&(a=this._scene.particleSystems.indexOf(this),-1<a&&this._scene.particleSystems.splice(a,1),this._scene._activeParticleSystems.dispose());this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();
this.onStoppedObservable.clear();this.reset()};l.prototype.clone=function(a,b){var d=Object(x.a)({},this._customEffect),c=null,h=this._engine;if(h.createEffectForParticles&&null!=this.customShader){c=this.customShader;var f=0<c.shaderOptions.defines.length?c.shaderOptions.defines.join("\n"):"";d[0]=h.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,f)}h=this.serialize();h=l.Parse(h,this._scene||this._engine,"");h.name=a;h.customShader=c;h._customEffect=
d;void 0===b&&(b=this.emitter);this.noiseTexture&&(h.noiseTexture=this.noiseTexture.clone());h.emitter=b;this.preventAutoStart||h.start();return h};l.prototype.serialize=function(a){void 0===a&&(a=!1);var b={};l._Serialize(b,this,a);b.textureMask=this.textureMask.asArray();b.customShader=this.customShader;b.preventAutoStart=this.preventAutoStart;if(this.subEmitters){b.subEmitters=[];this._subEmitters||this._prepareSubEmitterInternalArray();a=0;for(var c=this._subEmitters;a<c.length;a++){for(var f=
[],h=0,e=c[a];h<e.length;h++)f.push(e[h].serialize());b.subEmitters.push(f)}}return b};l._Serialize=function(a,b,c){a.name=b.name;a.id=b.id;a.capacity=b.getCapacity();b.emitter.position?a.emitterId=b.emitter.id:a.emitter=b.emitter.asArray();b.particleEmitterType&&(a.particleEmitterType=b.particleEmitterType.serialize());b.particleTexture&&(c?a.texture=b.particleTexture.serialize():(a.textureName=b.particleTexture.name,a.invertY=!!b.particleTexture._invertY));a.isLocal=b.isLocal;aa.a.AppendSerializedAnimations(b,
a);a.beginAnimationOnStart=b.beginAnimationOnStart;a.beginAnimationFrom=b.beginAnimationFrom;a.beginAnimationTo=b.beginAnimationTo;a.beginAnimationLoop=b.beginAnimationLoop;a.startDelay=b.startDelay;a.renderingGroupId=b.renderingGroupId;a.isBillboardBased=b.isBillboardBased;a.billboardMode=b.billboardMode;a.minAngularSpeed=b.minAngularSpeed;a.maxAngularSpeed=b.maxAngularSpeed;a.minSize=b.minSize;a.maxSize=b.maxSize;a.minScaleX=b.minScaleX;a.maxScaleX=b.maxScaleX;a.minScaleY=b.minScaleY;a.maxScaleY=
b.maxScaleY;a.minEmitPower=b.minEmitPower;a.maxEmitPower=b.maxEmitPower;a.minLifeTime=b.minLifeTime;a.maxLifeTime=b.maxLifeTime;a.emitRate=b.emitRate;a.gravity=b.gravity.asArray();a.noiseStrength=b.noiseStrength.asArray();a.color1=b.color1.asArray();a.color2=b.color2.asArray();a.colorDead=b.colorDead.asArray();a.updateSpeed=b.updateSpeed;a.targetStopDuration=b.targetStopDuration;a.blendMode=b.blendMode;a.preWarmCycles=b.preWarmCycles;a.preWarmStepOffset=b.preWarmStepOffset;a.minInitialRotation=b.minInitialRotation;
a.maxInitialRotation=b.maxInitialRotation;a.startSpriteCellID=b.startSpriteCellID;a.endSpriteCellID=b.endSpriteCellID;a.spriteCellChangeSpeed=b.spriteCellChangeSpeed;a.spriteCellWidth=b.spriteCellWidth;a.spriteCellHeight=b.spriteCellHeight;a.spriteRandomStartCell=b.spriteRandomStartCell;a.isAnimationSheetEnabled=b.isAnimationSheetEnabled;var d=b.getColorGradients();if(d){a.colorGradients=[];for(var h=0;h<d.length;h++){var f=d[h];c={gradient:f.gradient,color1:f.color1.asArray()};c.color2=f.color2?
f.color2.asArray():f.color1.asArray();a.colorGradients.push(c)}}if(d=b.getRampGradients()){a.rampGradients=[];for(h=0;h<d.length;h++)c=d[h],c={gradient:c.gradient,color:c.color.asArray()},a.rampGradients.push(c);a.useRampGradients=b.useRampGradients}if(d=b.getColorRemapGradients())for(a.colorRemapGradients=[],h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?f.factor2:f.factor1,a.colorRemapGradients.push(c);if(d=b.getAlphaRemapGradients())for(a.alphaRemapGradients=
[],h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?f.factor2:f.factor1,a.alphaRemapGradients.push(c);if(d=b.getSizeGradients())for(a.sizeGradients=[],h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?f.factor2:f.factor1,a.sizeGradients.push(c);if(d=b.getAngularSpeedGradients())for(a.angularSpeedGradients=[],h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?
f.factor2:f.factor1,a.angularSpeedGradients.push(c);if(d=b.getVelocityGradients())for(a.velocityGradients=[],h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?f.factor2:f.factor1,a.velocityGradients.push(c);if(d=b.getDragGradients())for(a.dragGradients=[],h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?f.factor2:f.factor1,a.dragGradients.push(c);if(d=b.getEmitRateGradients())for(a.emitRateGradients=[],
h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?f.factor2:f.factor1,a.emitRateGradients.push(c);if(d=b.getStartSizeGradients())for(a.startSizeGradients=[],h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?f.factor2:f.factor1,a.startSizeGradients.push(c);if(d=b.getLifeTimeGradients())for(a.lifeTimeGradients=[],h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?
f.factor2:f.factor1,a.lifeTimeGradients.push(c);if(d=b.getLimitVelocityGradients()){a.limitVelocityGradients=[];for(h=0;h<d.length;h++)f=d[h],c={gradient:f.gradient,factor1:f.factor1},c.factor2=void 0!==f.factor2?f.factor2:f.factor1,a.limitVelocityGradients.push(c);a.limitVelocityDamping=b.limitVelocityDamping}b.noiseTexture&&(a.noiseTexture=b.noiseTexture.serialize())};l._Parse=function(a,d,f,e){f=f instanceof b.a?null:f;var h=N.a.GetClass("BABYLON.Texture");h&&f&&(a.texture?d.particleTexture=h.Parse(a.texture,
f,e):a.textureName&&(d.particleTexture=new h(e+a.textureName,f,!1,void 0!==a.invertY?a.invertY:!0),d.particleTexture.name=a.textureName));d.emitter=a.emitterId||0===a.emitterId||void 0!==a.emitter?a.emitterId&&f?f.getLastMeshByID(a.emitterId):c.e.FromArray(a.emitter):c.e.Zero();d.isLocal=!!a.isLocal;void 0!==a.renderingGroupId&&(d.renderingGroupId=a.renderingGroupId);void 0!==a.isBillboardBased&&(d.isBillboardBased=a.isBillboardBased);void 0!==a.billboardMode&&(d.billboardMode=a.billboardMode);if(a.animations){for(h=
0;h<a.animations.length;h++){var g=a.animations[h],k=N.a.GetClass("BABYLON.Animation");k&&d.animations.push(k.Parse(g))}d.beginAnimationOnStart=a.beginAnimationOnStart;d.beginAnimationFrom=a.beginAnimationFrom;d.beginAnimationTo=a.beginAnimationTo;d.beginAnimationLoop=a.beginAnimationLoop}a.autoAnimate&&f&&f.beginAnimation(d,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1);d.startDelay=a.startDelay|0;d.minAngularSpeed=a.minAngularSpeed;d.maxAngularSpeed=a.maxAngularSpeed;
d.minSize=a.minSize;d.maxSize=a.maxSize;a.minScaleX&&(d.minScaleX=a.minScaleX,d.maxScaleX=a.maxScaleX,d.minScaleY=a.minScaleY,d.maxScaleY=a.maxScaleY);void 0!==a.preWarmCycles&&(d.preWarmCycles=a.preWarmCycles,d.preWarmStepOffset=a.preWarmStepOffset);void 0!==a.minInitialRotation&&(d.minInitialRotation=a.minInitialRotation,d.maxInitialRotation=a.maxInitialRotation);d.minLifeTime=a.minLifeTime;d.maxLifeTime=a.maxLifeTime;d.minEmitPower=a.minEmitPower;d.maxEmitPower=a.maxEmitPower;d.emitRate=a.emitRate;
d.gravity=c.e.FromArray(a.gravity);a.noiseStrength&&(d.noiseStrength=c.e.FromArray(a.noiseStrength));d.color1=F.b.FromArray(a.color1);d.color2=F.b.FromArray(a.color2);d.colorDead=F.b.FromArray(a.colorDead);d.updateSpeed=a.updateSpeed;d.targetStopDuration=a.targetStopDuration;d.blendMode=a.blendMode;if(a.colorGradients)for(h=0,g=a.colorGradients;h<g.length;h++)k=g[h],d.addColorGradient(k.gradient,F.b.FromArray(k.color1),k.color2?F.b.FromArray(k.color2):void 0);if(a.rampGradients){h=0;for(g=a.rampGradients;h<
g.length;h++)k=g[h],d.addRampGradient(k.gradient,F.a.FromArray(k.color));d.useRampGradients=a.useRampGradients}if(a.colorRemapGradients)for(h=0,g=a.colorRemapGradients;h<g.length;h++)k=g[h],d.addColorRemapGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(a.alphaRemapGradients)for(h=0,g=a.alphaRemapGradients;h<g.length;h++)k=g[h],d.addAlphaRemapGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(a.sizeGradients)for(h=0,g=a.sizeGradients;h<g.length;h++)k=g[h],
d.addSizeGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(a.angularSpeedGradients)for(h=0,g=a.angularSpeedGradients;h<g.length;h++)k=g[h],d.addAngularSpeedGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(a.velocityGradients)for(h=0,g=a.velocityGradients;h<g.length;h++)k=g[h],d.addVelocityGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(a.dragGradients)for(h=0,g=a.dragGradients;h<g.length;h++)k=g[h],d.addDragGradient(k.gradient,void 0!==
k.factor1?k.factor1:k.factor,k.factor2);if(a.emitRateGradients)for(h=0,g=a.emitRateGradients;h<g.length;h++)k=g[h],d.addEmitRateGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(a.startSizeGradients)for(h=0,g=a.startSizeGradients;h<g.length;h++)k=g[h],d.addStartSizeGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);if(a.lifeTimeGradients)for(h=0,g=a.lifeTimeGradients;h<g.length;h++)k=g[h],d.addLifeTimeGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,
k.factor2);if(a.limitVelocityGradients){h=0;for(g=a.limitVelocityGradients;h<g.length;h++)k=g[h],d.addLimitVelocityGradient(k.gradient,void 0!==k.factor1?k.factor1:k.factor,k.factor2);d.limitVelocityDamping=a.limitVelocityDamping}a.noiseTexture&&f&&(h=N.a.GetClass("BABYLON.ProceduralTexture"),d.noiseTexture=h.Parse(a.noiseTexture,f,e));if(a.particleEmitterType){switch(a.particleEmitterType.type){case "SphereParticleEmitter":e=new K.i;break;case "SphereDirectedParticleEmitter":e=new K.h;break;case "ConeEmitter":case "ConeParticleEmitter":e=
new K.b;break;case "CylinderParticleEmitter":e=new K.d;break;case "CylinderDirectedParticleEmitter":e=new K.c;break;case "HemisphericParticleEmitter":e=new K.e;break;case "PointParticleEmitter":e=new K.g;break;case "MeshParticleEmitter":e=new K.f;break;default:e=new K.a}e.parse(a.particleEmitterType,f)}else e=new K.a,e.parse(a,f);d.particleEmitterType=e;d.startSpriteCellID=a.startSpriteCellID;d.endSpriteCellID=a.endSpriteCellID;d.spriteCellWidth=a.spriteCellWidth;d.spriteCellHeight=a.spriteCellHeight;
d.spriteCellChangeSpeed=a.spriteCellChangeSpeed;d.spriteRandomStartCell=a.spriteRandomStartCell};l.Parse=function(a,c,f,e){void 0===e&&(e=!1);var d=a.name,g=null,k=null;var G=c instanceof b.a?c:c.getEngine();a.customShader&&G.createEffectForParticles&&(k=a.customShader,g=0<k.shaderOptions.defines.length?k.shaderOptions.defines.join("\n"):"",g=G.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,g));d=new l(d,a.capacity,c,g,a.isAnimationSheetEnabled);
d.customShader=k;a.id&&(d.id=a.id);if(a.subEmitters)for(d.subEmitters=[],k=0,G=a.subEmitters;k<G.length;k++){g=[];for(var Z=0,m=G[k];Z<m.length;Z++)g.push(D.a.Parse(m[Z],c,f));d.subEmitters.push(g)}l._Parse(a,d,c,f);a.textureMask&&(d.textureMask=F.b.FromArray(a.textureMask));a.preventAutoStart&&(d.preventAutoStart=a.preventAutoStart);e||d.preventAutoStart||d.start();return d};l.BILLBOARDMODE_Y=2;l.BILLBOARDMODE_ALL=7;l.BILLBOARDMODE_STRETCHED=8;return l}(v.a);D.a._ParseParticleSystem=Z.Parse},S4Gu:function(v,
w,g){g.d(w,"a",function(){return u});var x=g("/SR9"),p=g("stmW"),q=g("YSMO"),c=g("Xeau");g("/4XI");var u=function(){function e(f){this.animations=[];this.renderingGroupId=0;this.emitter=x.e.Zero();this.emitRate=10;this.manualEmitCount=-1;this.updateSpeed=.01;this.targetStopDuration=0;this.disposeOnStop=!1;this.maxScaleY=this.minScaleY=this.maxScaleX=this.minScaleX=this.maxSize=this.minSize=this.maxLifeTime=this.minLifeTime=this.maxEmitPower=this.minEmitPower=1;this.maxAngularSpeed=this.minAngularSpeed=
this.maxInitialRotation=this.minInitialRotation=0;this.layerMask=268435455;this.customShader=null;this.preventAutoStart=!1;this.noiseStrength=new x.e(10,10,10);this.onAnimationEnd=null;this.blendMode=e.BLENDMODE_ONEONE;this.forceDepthWrite=!1;this.preWarmCycles=0;this.spriteCellChangeSpeed=this.preWarmStepOffset=1;this.spriteCellHeight=this.spriteCellWidth=this.endSpriteCellID=this.startSpriteCellID=0;this.spriteRandomStartCell=!1;this.translationPivot=new x.d(0,0);this.beginAnimationOnStart=!1;this.beginAnimationFrom=
0;this.beginAnimationTo=60;this.beginAnimationLoop=!1;this.worldOffset=new x.e(0,0,0);this.gravity=x.e.Zero();this._alphaRemapGradients=this._colorRemapGradients=this._rampGradients=this._startSizeGradients=this._emitRateGradients=this._dragGradients=this._limitVelocityGradients=this._velocityGradients=this._angularSpeedGradients=this._lifeTimeGradients=this._sizeGradients=this._colorGradients=null;this.startDelay=0;this.limitVelocityDamping=.4;this.color1=new c.b(1,1,1,1);this.color2=new c.b(1,1,
1,1);this.colorDead=new c.b(0,0,0,1);this.textureMask=new c.b(1,1,1,1);this._isSubEmitter=!1;this.billboardMode=7;this._isBillboardBased=!0;this._imageProcessingConfigurationDefines=new p.b;this.name=this.id=f}Object.defineProperty(e.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(c){this._noiseTexture!==c&&(this._noiseTexture=c,this._reset())},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},
set:function(c){this._isAnimationSheetEnabled!=c&&(this._isAnimationSheetEnabled=c,this._reset())},enumerable:!1,configurable:!0});e.prototype.getScene=function(){return this._scene};e.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&0<this._startSizeGradients.length||this._emitRateGradients&&0<this._emitRateGradients.length||this._lifeTimeGradients&&0<this._lifeTimeGradients.length};e.prototype.getDragGradients=function(){return this._dragGradients};e.prototype.getLimitVelocityGradients=
function(){return this._limitVelocityGradients};e.prototype.getColorGradients=function(){return this._colorGradients};e.prototype.getSizeGradients=function(){return this._sizeGradients};e.prototype.getColorRemapGradients=function(){return this._colorRemapGradients};e.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients};e.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients};e.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients};
e.prototype.getVelocityGradients=function(){return this._velocityGradients};e.prototype.getStartSizeGradients=function(){return this._startSizeGradients};e.prototype.getEmitRateGradients=function(){return this._emitRateGradients};Object.defineProperty(e.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:x.e.Zero()},set:function(c){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=c)},enumerable:!1,configurable:!0});
Object.defineProperty(e.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:x.e.Zero()},set:function(c){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=c)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:x.e.Zero()},set:function(c){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=
c)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:x.e.Zero()},set:function(c){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=c)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(c){this._isBillboardBased!==c&&(this._isBillboardBased=c,this._reset())},
enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(c){this._attachImageProcessingConfiguration(c)},enumerable:!1,configurable:!0});e.prototype._attachImageProcessingConfiguration=function(c){c!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration=!c&&this._scene?this._scene.imageProcessingConfiguration:c)};e.prototype._reset=function(){};e.prototype._removeGradientAndTexture=
function(c,e,g){if(!e)return this;for(var f=0,r=0;r<e.length;r++){if(e[r].gradient===c){e.splice(f,1);break}f++}g&&g.dispose();return this};e.prototype.createPointEmitter=function(c,e){var f=new q.g;f.direction1=c;f.direction2=e;return this.particleEmitterType=f};e.prototype.createHemisphericEmitter=function(c,e){void 0===c&&(c=1);void 0===e&&(e=1);return this.particleEmitterType=c=new q.e(c,e)};e.prototype.createSphereEmitter=function(c,e){void 0===c&&(c=1);void 0===e&&(e=1);return this.particleEmitterType=
c=new q.i(c,e)};e.prototype.createDirectedSphereEmitter=function(c,e,g){void 0===c&&(c=1);void 0===e&&(e=new x.e(0,1,0));void 0===g&&(g=new x.e(0,1,0));return this.particleEmitterType=c=new q.h(c,e,g)};e.prototype.createCylinderEmitter=function(c,e,g,p){void 0===c&&(c=1);void 0===e&&(e=1);void 0===g&&(g=1);void 0===p&&(p=0);return this.particleEmitterType=c=new q.d(c,e,g,p)};e.prototype.createDirectedCylinderEmitter=function(c,e,g,p,u){void 0===c&&(c=1);void 0===e&&(e=1);void 0===g&&(g=1);void 0===
p&&(p=new x.e(0,1,0));void 0===u&&(u=new x.e(0,1,0));return this.particleEmitterType=c=new q.c(c,e,g,p,u)};e.prototype.createConeEmitter=function(c,e){void 0===c&&(c=1);void 0===e&&(e=Math.PI/4);return this.particleEmitterType=c=new q.b(c,e)};e.prototype.createBoxEmitter=function(c,e,g,p){var f=new q.a;this.particleEmitterType=f;this.direction1=c;this.direction2=e;this.minEmitBox=g;this.maxEmitBox=p;return f};e.BLENDMODE_ONEONE=0;e.BLENDMODE_STANDARD=1;e.BLENDMODE_ADD=2;e.BLENDMODE_MULTIPLY=3;e.BLENDMODE_MULTIPLYADD=
4;return e}()},YSMO:function(v,w,g){g.d(w,"a",function(){return x.a});g.d(w,"b",function(){return u});g.d(w,"d",function(){return f});g.d(w,"c",function(){return r});g.d(w,"e",function(){return ea});g.d(w,"g",function(){return K});g.d(w,"i",function(){return ia});g.d(w,"h",function(){return D});g.d(w,"f",function(){return N});var x=g("IJA2"),p=g("Dc3z"),q=g("/SR9"),c=g("sH6m"),u=function(){function e(b,c,e){void 0===b&&(b=1);void 0===c&&(c=Math.PI);void 0===e&&(e=0);this.directionRandomizer=e;this.heightRange=
this.radiusRange=1;this.emitFromSpawnPointOnly=!1;this.angle=c;this.radius=b}Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(b){this._radius=b;this._buildHeight()},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(b){this._angle=b;this._buildHeight()},enumerable:!1,configurable:!0});e.prototype._buildHeight=function(){this._height=0!==this._angle?this._radius/Math.tan(this._angle/
2):1};e.prototype.startDirectionFunction=function(b,e,f,g){g?q.c.Vector3[0].copyFrom(f._localPosition).normalize():f.position.subtractToRef(b.getTranslation(),q.c.Vector3[0]).normalize();b=c.a.RandomRange(0,this.directionRandomizer);f=c.a.RandomRange(0,this.directionRandomizer);g=c.a.RandomRange(0,this.directionRandomizer);e.x=q.c.Vector3[0].x+b;e.y=q.c.Vector3[0].y+f;e.z=q.c.Vector3[0].z+g;e.normalize()};e.prototype.startPositionFunction=function(b,e,f,g){var l=c.a.RandomRange(0,2*Math.PI);if(this.emitFromSpawnPointOnly)var a=
1E-4;else a=c.a.RandomRange(0,this.heightRange),a=1-a*a;var d=this._radius-c.a.RandomRange(0,this._radius*this.radiusRange);d*=a;f=d*Math.sin(l);l=d*Math.cos(l);a*=this._height;g?(e.x=f,e.y=a,e.z=l):q.e.TransformCoordinatesFromFloatsToRef(f,a,l,b,e)};e.prototype.clone=function(){var b=new e(this._radius,this._angle,this.directionRandomizer);p.a.DeepCopy(this,b);return b};e.prototype.applyToShader=function(b){b.setFloat2("radius",this._radius,this.radiusRange);b.setFloat("coneAngle",this._angle);b.setFloat2("height",
this._height,this.heightRange);b.setFloat("directionRandomizer",this.directionRandomizer)};e.prototype.getEffectDefines=function(){var b="#define CONEEMITTER";this.emitFromSpawnPointOnly&&(b+="\n#define CONEEMITTERSPAWNPOINT");return b};e.prototype.getClassName=function(){return"ConeParticleEmitter"};e.prototype.serialize=function(){var b={};b.type=this.getClassName();b.radius=this._radius;b.angle=this._angle;b.directionRandomizer=this.directionRandomizer;b.radiusRange=this.radiusRange;b.heightRange=
this.heightRange;b.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly;return b};e.prototype.parse=function(b){this.radius=b.radius;this.angle=b.angle;this.directionRandomizer=b.directionRandomizer;this.radiusRange=void 0!==b.radiusRange?b.radiusRange:1;this.heightRange=void 0!==b.radiusRange?b.heightRange:1;this.emitFromSpawnPointOnly=void 0!==b.emitFromSpawnPointOnly?b.emitFromSpawnPointOnly:!1};return e}(),e=g("oYeq"),f=function(){function e(b,c,e,f){void 0===b&&(b=1);void 0===c&&(c=1);void 0===
e&&(e=1);void 0===f&&(f=0);this.radius=b;this.height=c;this.radiusRange=e;this.directionRandomizer=f}e.prototype.startDirectionFunction=function(b,e,f,g){f=f.position.subtract(b.getTranslation()).normalize();var l=c.a.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),a=Math.atan2(f.x,f.z);a+=c.a.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer;f.y=l;f.x=Math.sin(a);f.z=Math.cos(a);f.normalize();g?e.copyFrom(f):q.e.TransformNormalFromFloatsToRef(f.x,f.y,f.z,b,e)};e.prototype.startPositionFunction=
function(b,e,f,g){f=c.a.RandomRange(-this.height/2,this.height/2);var l=c.a.RandomRange(0,2*Math.PI),a=c.a.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),d=Math.sqrt(a)*this.radius;a=d*Math.cos(l);l=d*Math.sin(l);g?e.copyFromFloats(a,f,l):q.e.TransformCoordinatesFromFloatsToRef(a,f,l,b,e)};e.prototype.clone=function(){var b=new e(this.radius,this.directionRandomizer);p.a.DeepCopy(this,b);return b};e.prototype.applyToShader=function(b){b.setFloat("radius",this.radius);b.setFloat("height",
this.height);b.setFloat("radiusRange",this.radiusRange);b.setFloat("directionRandomizer",this.directionRandomizer)};e.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"};e.prototype.getClassName=function(){return"CylinderParticleEmitter"};e.prototype.serialize=function(){var b={};b.type=this.getClassName();b.radius=this.radius;b.height=this.height;b.radiusRange=this.radiusRange;b.directionRandomizer=this.directionRandomizer;return b};e.prototype.parse=function(b){this.radius=b.radius;
this.height=b.height;this.radiusRange=b.radiusRange;this.directionRandomizer=b.directionRandomizer};return e}(),r=function(f){function b(b,c,e,g,a){void 0===b&&(b=1);void 0===c&&(c=1);void 0===e&&(e=1);void 0===g&&(g=new q.e(0,1,0));void 0===a&&(a=new q.e(0,1,0));b=f.call(this,b,c,e)||this;b.direction1=g;b.direction2=a;return b}Object(e.d)(b,f);b.prototype.startDirectionFunction=function(b,e,f){f=c.a.RandomRange(this.direction1.x,this.direction2.x);var g=c.a.RandomRange(this.direction1.y,this.direction2.y),
a=c.a.RandomRange(this.direction1.z,this.direction2.z);q.e.TransformNormalFromFloatsToRef(f,g,a,b,e)};b.prototype.clone=function(){var c=new b(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);p.a.DeepCopy(this,c);return c};b.prototype.applyToShader=function(b){b.setFloat("radius",this.radius);b.setFloat("height",this.height);b.setFloat("radiusRange",this.radiusRange);b.setVector3("direction1",this.direction1);b.setVector3("direction2",this.direction2)};b.prototype.getEffectDefines=
function(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"};b.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"};b.prototype.serialize=function(){var b=f.prototype.serialize.call(this);b.direction1=this.direction1.asArray();b.direction2=this.direction2.asArray();return b};b.prototype.parse=function(b){f.prototype.parse.call(this,b);this.direction1.copyFrom(b.direction1);this.direction2.copyFrom(b.direction2)};return b}(f),ea=function(){function e(b,c,e){void 0===
b&&(b=1);void 0===c&&(c=1);void 0===e&&(e=0);this.radius=b;this.radiusRange=c;this.directionRandomizer=e}e.prototype.startDirectionFunction=function(b,e,f,g){f=f.position.subtract(b.getTranslation()).normalize();var l=c.a.RandomRange(0,this.directionRandomizer),a=c.a.RandomRange(0,this.directionRandomizer),d=c.a.RandomRange(0,this.directionRandomizer);f.x+=l;f.y+=a;f.z+=d;f.normalize();g?e.copyFrom(f):q.e.TransformNormalFromFloatsToRef(f.x,f.y,f.z,b,e)};e.prototype.startPositionFunction=function(b,
e,f,g){f=this.radius-c.a.RandomRange(0,this.radius*this.radiusRange);var l=c.a.RandomRange(0,1),a=c.a.RandomRange(0,2*Math.PI),d=Math.acos(2*l-1);l=f*Math.cos(a)*Math.sin(d);var p=f*Math.cos(d);f=f*Math.sin(a)*Math.sin(d);g?e.copyFromFloats(l,Math.abs(p),f):q.e.TransformCoordinatesFromFloatsToRef(l,Math.abs(p),f,b,e)};e.prototype.clone=function(){var b=new e(this.radius,this.directionRandomizer);p.a.DeepCopy(this,b);return b};e.prototype.applyToShader=function(b){b.setFloat("radius",this.radius);
b.setFloat("radiusRange",this.radiusRange);b.setFloat("directionRandomizer",this.directionRandomizer)};e.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"};e.prototype.getClassName=function(){return"HemisphericParticleEmitter"};e.prototype.serialize=function(){var b={};b.type=this.getClassName();b.radius=this.radius;b.radiusRange=this.radiusRange;b.directionRandomizer=this.directionRandomizer;return b};e.prototype.parse=function(b){this.radius=b.radius;this.radiusRange=b.radiusRange;
this.directionRandomizer=b.directionRandomizer};return e}(),K=function(){function e(){this.direction1=new q.e(0,1,0);this.direction2=new q.e(0,1,0)}e.prototype.startDirectionFunction=function(b,e,f,g){f=c.a.RandomRange(this.direction1.x,this.direction2.x);var l=c.a.RandomRange(this.direction1.y,this.direction2.y),a=c.a.RandomRange(this.direction1.z,this.direction2.z);g?e.copyFromFloats(f,l,a):q.e.TransformNormalFromFloatsToRef(f,l,a,b,e)};e.prototype.startPositionFunction=function(b,c,e,f){f?c.copyFromFloats(0,
0,0):q.e.TransformCoordinatesFromFloatsToRef(0,0,0,b,c)};e.prototype.clone=function(){var b=new e;p.a.DeepCopy(this,b);return b};e.prototype.applyToShader=function(b){b.setVector3("direction1",this.direction1);b.setVector3("direction2",this.direction2)};e.prototype.getEffectDefines=function(){return"#define POINTEMITTER"};e.prototype.getClassName=function(){return"PointParticleEmitter"};e.prototype.serialize=function(){var b={};b.type=this.getClassName();b.direction1=this.direction1.asArray();b.direction2=
this.direction2.asArray();return b};e.prototype.parse=function(b){q.e.FromArrayToRef(b.direction1,0,this.direction1);q.e.FromArrayToRef(b.direction2,0,this.direction2)};return e}(),ia=function(){function e(b,c,e){void 0===b&&(b=1);void 0===c&&(c=1);void 0===e&&(e=0);this.radius=b;this.radiusRange=c;this.directionRandomizer=e}e.prototype.startDirectionFunction=function(b,e,f,g){f=f.position.subtract(b.getTranslation()).normalize();var l=c.a.RandomRange(0,this.directionRandomizer),a=c.a.RandomRange(0,
this.directionRandomizer),d=c.a.RandomRange(0,this.directionRandomizer);f.x+=l;f.y+=a;f.z+=d;f.normalize();g?e.copyFrom(f):q.e.TransformNormalFromFloatsToRef(f.x,f.y,f.z,b,e)};e.prototype.startPositionFunction=function(b,e,f,g){f=this.radius-c.a.RandomRange(0,this.radius*this.radiusRange);var l=c.a.RandomRange(0,1),a=c.a.RandomRange(0,2*Math.PI),d=Math.acos(2*l-1);l=f*Math.cos(a)*Math.sin(d);var p=f*Math.cos(d);f=f*Math.sin(a)*Math.sin(d);g?e.copyFromFloats(l,p,f):q.e.TransformCoordinatesFromFloatsToRef(l,
p,f,b,e)};e.prototype.clone=function(){var b=new e(this.radius,this.directionRandomizer);p.a.DeepCopy(this,b);return b};e.prototype.applyToShader=function(b){b.setFloat("radius",this.radius);b.setFloat("radiusRange",this.radiusRange);b.setFloat("directionRandomizer",this.directionRandomizer)};e.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"};e.prototype.getClassName=function(){return"SphereParticleEmitter"};e.prototype.serialize=function(){var b={};b.type=this.getClassName();
b.radius=this.radius;b.radiusRange=this.radiusRange;b.directionRandomizer=this.directionRandomizer;return b};e.prototype.parse=function(b){this.radius=b.radius;this.radiusRange=b.radiusRange;this.directionRandomizer=b.directionRandomizer};return e}(),D=function(f){function b(b,c,e){void 0===b&&(b=1);void 0===c&&(c=new q.e(0,1,0));void 0===e&&(e=new q.e(0,1,0));b=f.call(this,b)||this;b.direction1=c;b.direction2=e;return b}Object(e.d)(b,f);b.prototype.startDirectionFunction=function(b,e,f){f=c.a.RandomRange(this.direction1.x,
this.direction2.x);var g=c.a.RandomRange(this.direction1.y,this.direction2.y),a=c.a.RandomRange(this.direction1.z,this.direction2.z);q.e.TransformNormalFromFloatsToRef(f,g,a,b,e)};b.prototype.clone=function(){var c=new b(this.radius,this.direction1,this.direction2);p.a.DeepCopy(this,c);return c};b.prototype.applyToShader=function(b){b.setFloat("radius",this.radius);b.setFloat("radiusRange",this.radiusRange);b.setVector3("direction1",this.direction1);b.setVector3("direction2",this.direction2)};b.prototype.getEffectDefines=
function(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"};b.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"};b.prototype.serialize=function(){var b=f.prototype.serialize.call(this);b.direction1=this.direction1.asArray();b.direction2=this.direction2.asArray();return b};b.prototype.parse=function(b){f.prototype.parse.call(this,b);this.direction1.copyFrom(b.direction1);this.direction2.copyFrom(b.direction2)};return b}(ia);g("9lcB");var aa=g("y4Ty"),N=function(){function e(b){void 0===
b&&(b=null);this._normals=this._positions=this._indices=null;this._storedNormal=q.e.Zero();this._mesh=null;this.direction1=new q.e(0,1,0);this.direction2=new q.e(0,1,0);this.useMeshNormalsForDirection=!0;this.mesh=b}Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},set:function(b){this._mesh!==b&&((this._mesh=b)?(this._indices=b.getIndices(),this._positions=b.getVerticesData(aa.b.PositionKind),this._normals=b.getVerticesData(aa.b.NormalKind)):this._normals=this._positions=
this._indices=null)},enumerable:!1,configurable:!0});e.prototype.startDirectionFunction=function(b,e,f,g){if(this.useMeshNormalsForDirection&&this._normals)q.e.TransformNormalToRef(this._storedNormal,b,e);else{f=c.a.RandomRange(this.direction1.x,this.direction2.x);var l=c.a.RandomRange(this.direction1.y,this.direction2.y),a=c.a.RandomRange(this.direction1.z,this.direction2.z);g?e.copyFromFloats(f,l,a):q.e.TransformNormalFromFloatsToRef(f,l,a,b,e)}};e.prototype.startPositionFunction=function(b,c,e,
f){if(this._indices&&this._positions){var g=this._indices.length/3*Math.random()*3|0;e=Math.random();var a=Math.random()*(1-e),d=1-e-a,p=this._indices[g],m=this._indices[g+1];g=this._indices[g+2];var h=q.c.Vector3[0],r=q.c.Vector3[1],k=q.c.Vector3[2],u=q.c.Vector3[3];q.e.FromArrayToRef(this._positions,3*p,h);q.e.FromArrayToRef(this._positions,3*m,r);q.e.FromArrayToRef(this._positions,3*g,k);u.x=e*h.x+a*r.x+d*k.x;u.y=e*h.y+a*r.y+d*k.y;u.z=e*h.z+a*r.z+d*k.z;f?c.copyFromFloats(u.x,u.y,u.z):q.e.TransformCoordinatesFromFloatsToRef(u.x,
u.y,u.z,b,c);this.useMeshNormalsForDirection&&this._normals&&(q.e.FromArrayToRef(this._normals,3*p,h),q.e.FromArrayToRef(this._normals,3*m,r),q.e.FromArrayToRef(this._normals,3*g,k),this._storedNormal.x=e*h.x+a*r.x+d*k.x,this._storedNormal.y=e*h.y+a*r.y+d*k.y,this._storedNormal.z=e*h.z+a*r.z+d*k.z)}};e.prototype.clone=function(){var b=new e(this.mesh);p.a.DeepCopy(this,b);return b};e.prototype.applyToShader=function(b){b.setVector3("direction1",this.direction1);b.setVector3("direction2",this.direction2)};
e.prototype.getEffectDefines=function(){return""};e.prototype.getClassName=function(){return"MeshParticleEmitter"};e.prototype.serialize=function(){var b,c={};c.type=this.getClassName();c.direction1=this.direction1.asArray();c.direction2=this.direction2.asArray();c.meshId=null===(b=this.mesh)||void 0===b?void 0:b.id;c.useMeshNormalsForDirection=this.useMeshNormalsForDirection;return c};e.prototype.parse=function(b,c){q.e.FromArrayToRef(b.direction1,0,this.direction1);q.e.FromArrayToRef(b.direction2,
0,this.direction2);b.meshId&&c&&(this.mesh=c.getLastMeshByID(b.meshId));this.useMeshNormalsForDirection=b.useMeshNormalsForDirection};return e}()},gmvZ:function(v,w,g){g.d(w,"b",function(){return c});g.d(w,"a",function(){return u});var x=g("/SR9"),p=g("n5HA"),q=g("WHS4"),c;(function(c){c[c.ATTACHED=0]="ATTACHED";c[c.END=1]="END"})(c||(c={}));var u=function(){function e(e){this.particleSystem=e;this.type=c.END;this.inheritDirection=!1;this.inheritedVelocityAmount=0;if(!e.emitter||!e.emitter.dispose){var f=
q.a.GetClass("BABYLON.AbstractMesh");e.emitter=new f("SubemitterSystemEmitter",e.getScene())}e.onDisposeObservable.add(function(){e.emitter&&e.emitter.dispose&&e.emitter.dispose()})}e.prototype.clone=function(){var c=this.particleSystem.emitter;c?c instanceof x.e?c=c.clone():-1!==c.getClassName().indexOf("Mesh")&&(c=new (q.a.GetClass("BABYLON.Mesh"))("",c.getScene()),c.isVisible=!1):c=new x.e;c=new e(this.particleSystem.clone("",c));c.particleSystem.name+="Clone";c.type=this.type;c.inheritDirection=
this.inheritDirection;c.inheritedVelocityAmount=this.inheritedVelocityAmount;c.particleSystem._disposeEmitterOnDispose=!0;c.particleSystem.disposeOnStop=!0;return c};e.prototype.serialize=function(){var c={};c.type=this.type;c.inheritDirection=this.inheritDirection;c.inheritedVelocityAmount=this.inheritedVelocityAmount;c.particleSystem=this.particleSystem.serialize();return c};e._ParseParticleSystem=function(c,e,g){throw p.a.WarnImport("ParseParticle");};e.Parse=function(c,g,p){g=new e(e._ParseParticleSystem(c.particleSystem,
g,p));g.type=c.type;g.inheritDirection=c.inheritDirection;g.inheritedVelocityAmount=c.inheritedVelocityAmount;g.particleSystem._isSubEmitter=!0;return g};e.prototype.dispose=function(){this.particleSystem.dispose()};return e}()},ltZq:function(v,w,g){g.d(w,"a",function(){return c});var x=g("/SR9"),p=g("Xeau"),q=g("sH6m"),c=function(){function c(e){this.particleSystem=e;this.position=x.e.Zero();this.direction=x.e.Zero();this.color=new p.b(0,0,0,0);this.colorStep=new p.b(0,0,0,0);this.lifeTime=1;this.size=
this.age=0;this.scale=new x.d(1,1);this.cellIndex=this.angularSpeed=this.angle=0;this._attachedSubEmitters=null;this._currentColor1=new p.b(0,0,0,0);this._currentColor2=new p.b(0,0,0,0);this._currentDrag2=this._currentDrag1=this._currentLimitVelocity2=this._currentLimitVelocity1=this._currentVelocity2=this._currentVelocity1=this._currentAngularSpeed2=this._currentAngularSpeed1=this._currentSize2=this._currentSize1=0;this.id=c._Count++;this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}
c.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID};c.prototype.updateCellIndex=function(){var c=this.age,f=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===f?(f=1,c=this._randomCellOffset):c+=this._randomCellOffset);var g=this._initialEndSpriteCellID-this._initialStartSpriteCellID;c=q.a.Clamp(c*f%this.lifeTime/this.lifeTime);
this.cellIndex=this._initialStartSpriteCellID+c*g|0};c.prototype._inheritParticleInfoToSubEmitter=function(c){if(c.particleSystem.emitter.position){var e=c.particleSystem.emitter;e.position.copyFrom(this.position);if(c.inheritDirection){var g=x.c.Vector3[0];this.direction.normalizeToRef(g);e.setDirection(g,0,Math.PI/2)}}else c.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(c.inheritedVelocityAmount/2,x.c.Vector3[0]);c.particleSystem._inheritedVelocityOffset.copyFrom(x.c.Vector3[0])};
c.prototype._inheritParticleInfoToSubEmitters=function(){var c=this;this._attachedSubEmitters&&0<this._attachedSubEmitters.length&&this._attachedSubEmitters.forEach(function(e){c._inheritParticleInfoToSubEmitter(e)})};c.prototype._reset=function(){this.age=0;this.id=c._Count++;this._currentDragGradient=this._currentLimitVelocityGradient=this._currentVelocityGradient=this._currentAngularSpeedGradient=this._currentSizeGradient=this._currentColorGradient=null;this.cellIndex=this.particleSystem.startSpriteCellID;
this._randomCellOffset=void 0};c.prototype.copyTo=function(c){c.position.copyFrom(this.position);this._initialDirection?c._initialDirection?c._initialDirection.copyFrom(this._initialDirection):c._initialDirection=this._initialDirection.clone():c._initialDirection=null;c.direction.copyFrom(this.direction);this._localPosition&&(c._localPosition?c._localPosition.copyFrom(this._localPosition):c._localPosition=this._localPosition.clone());c.color.copyFrom(this.color);c.colorStep.copyFrom(this.colorStep);
c.lifeTime=this.lifeTime;c.age=this.age;c._randomCellOffset=this._randomCellOffset;c.size=this.size;c.scale.copyFrom(this.scale);c.angle=this.angle;c.angularSpeed=this.angularSpeed;c.particleSystem=this.particleSystem;c.cellIndex=this.cellIndex;c.id=this.id;c._attachedSubEmitters=this._attachedSubEmitters;this._currentColorGradient&&(c._currentColorGradient=this._currentColorGradient,c._currentColor1.copyFrom(this._currentColor1),c._currentColor2.copyFrom(this._currentColor2));this._currentSizeGradient&&
(c._currentSizeGradient=this._currentSizeGradient,c._currentSize1=this._currentSize1,c._currentSize2=this._currentSize2);this._currentAngularSpeedGradient&&(c._currentAngularSpeedGradient=this._currentAngularSpeedGradient,c._currentAngularSpeed1=this._currentAngularSpeed1,c._currentAngularSpeed2=this._currentAngularSpeed2);this._currentVelocityGradient&&(c._currentVelocityGradient=this._currentVelocityGradient,c._currentVelocity1=this._currentVelocity1,c._currentVelocity2=this._currentVelocity2);
this._currentLimitVelocityGradient&&(c._currentLimitVelocityGradient=this._currentLimitVelocityGradient,c._currentLimitVelocity1=this._currentLimitVelocity1,c._currentLimitVelocity2=this._currentLimitVelocity2);this._currentDragGradient&&(c._currentDragGradient=this._currentDragGradient,c._currentDrag1=this._currentDrag1,c._currentDrag2=this._currentDrag2);this.particleSystem.isAnimationSheetEnabled&&(c._initialStartSpriteCellID=this._initialStartSpriteCellID,c._initialEndSpriteCellID=this._initialEndSpriteCellID);
this.particleSystem.useRampGradients&&(c.remapData&&this.remapData?c.remapData.copyFrom(this.remapData):c.remapData=new x.f(0,0,0,0));this._randomNoiseCoordinates1&&(c._randomNoiseCoordinates1?(c._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),c._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(c._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),c._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))};c._Count=0;return c}()},zL3h:function(v,
w,g){v=g("S4Gu");g("YSMO");var x=g("oYeq"),p=g("dLGY"),q=g("ps+7"),c=g("/SR9"),u=g("Xeau"),e=g("sH6m"),f=g("y4Ty"),r=g("OGO2"),ea=g("IJA2"),K=g("Z6Y1"),ia=g("/eyM"),D=g("stmW"),aa=g("T5W1"),N=g("e2Mr"),F=g("9lcB");g("rObL");g("Nyk9");g("l6vU");g("Y79l");var b=function(b){function a(a,n,e,d,f){void 0===d&&(d=!1);void 0===f&&(f=null);a=b.call(this,a)||this;a.layerMask=268435455;a._accumulatedCount=0;a._targetIndex=0;a._currentRenderId=-1;a._started=!1;a._stopped=!1;a._timeDelta=0;a._actualFrame=0;a._rawTextureWidth=
256;a.onDisposeObservable=new q.a;a.onStoppedObservable=new q.a;a.forceDepthWrite=!1;a._preWarmDone=!1;a.isLocal=!1;a._onBeforeDrawParticlesObservable=null;e&&"Scene"!==e.getClassName()?(a._engine=e,a.defaultProjectionMatrix=c.a.PerspectiveFovLH(.8,1,.1,100)):(a._scene=e||N.a.LastCreatedScene,a._engine=a._scene.getEngine(),a.uniqueId=a._scene.getUniqueId(),a._scene.particleSystems.push(a));a._customEffect={0:f};a._attachImageProcessingConfiguration(null);n.randomTextureSize||delete n.randomTextureSize;
f=Object(x.a)({capacity:5E4,randomTextureSize:a._engine.getCaps().maxTextureSize},n);isFinite(n)&&(f.capacity=n);a._capacity=f.capacity;a._activeCount=f.capacity;a._currentActiveCount=0;a._isAnimationSheetEnabled=d;a._updateEffectOptions={attributes:"position initialPosition age life seed size color direction initialDirection angle cellIndex cellStartOffset noiseCoordinates1 noiseCoordinates2".split(" "),uniformsNames:"currentCount timeDelta emitterWM lifeTime color1 color2 sizeRange scaleRange gravity emitPower direction1 direction2 minEmitBox maxEmitBox radius directionRandomizer height coneAngle stopFactor angleRange radiusRange cellInfos noiseStrength limitVelocityDamping".split(" "),
uniformBuffersNames:[],samplers:"randomSampler randomSampler2 sizeGradientSampler angularSpeedGradientSampler velocityGradientSampler limitVelocityGradientSampler noiseSampler dragGradientSampler".split(" "),defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]};a.particleEmitterType=new ea.a;n=Math.min(a._engine.getCaps().maxTextureSize,f.randomTextureSize);d=[];for(f=0;f<n;++f)d.push(Math.random()),d.push(Math.random()),
d.push(Math.random()),d.push(Math.random());a._randomTexture=new aa.a(new Float32Array(d),n,1,5,e,!1,!1,1,1);a._randomTexture.wrapU=1;a._randomTexture.wrapV=1;d=[];for(f=0;f<n;++f)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());a._randomTexture2=new aa.a(new Float32Array(d),n,1,5,e,!1,!1,1,1);a._randomTexture2.wrapU=1;a._randomTexture2.wrapV=1;a._randomTextureSize=n;return a}Object(x.d)(a,b);Object.defineProperty(a,"IsSupported",{get:function(){return N.a.LastCreatedEngine?
1<N.a.LastCreatedEngine.webGLVersion:!1},enumerable:!1,configurable:!0});a.prototype.getCapacity=function(){return this._capacity};Object.defineProperty(a.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(a){this._activeCount=Math.min(a,this._capacity)},enumerable:!1,configurable:!0});a.prototype.isReady=function(){return this._updateEffect?this.emitter&&this._updateEffect.isReady()&&(!this._imageProcessingConfiguration||this._imageProcessingConfiguration.isReady())&&
this._getEffect().isReady()&&this.particleTexture&&this.particleTexture.isReady()?!0:!1:(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)};a.prototype.isStarted=function(){return this._started};a.prototype.isStopped=function(){return this._stopped};a.prototype.isStopping=function(){return!1};a.prototype.getActiveCount=function(){return this._currentActiveCount};a.prototype.start=function(a){var c=this;void 0===a&&(a=this.startDelay);if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";
a?setTimeout(function(){c.start(0)},a):(this._started=!0,this._preWarmDone=this._stopped=!1,this.beginAnimationOnStart&&this.animations&&0<this.animations.length&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))};a.prototype.stop=function(){this._stopped||(this._stopped=!0)};a.prototype.reset=function(){this._releaseBuffers();this._releaseVAOs();this._targetIndex=this._currentActiveCount=0};a.prototype.getClassName=function(){return"GPUParticleSystem"};
a.prototype.getCustomEffect=function(a){var c;void 0===a&&(a=0);return null!==(c=this._customEffect[a])&&void 0!==c?c:this._customEffect[0]};a.prototype.setCustomEffect=function(a,c){void 0===c&&(c=0);this._customEffect[c]=a};Object.defineProperty(a.prototype,"onBeforeDrawParticlesObservable",{get:function(){this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new q.a);return this._onBeforeDrawParticlesObservable},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"vertexShaderName",{get:function(){return"gpuRenderParticles"},enumerable:!1,configurable:!0});a.prototype._removeGradientAndTexture=function(a,c,n){b.prototype._removeGradientAndTexture.call(this,a,c,n);this._releaseBuffers();return this};a.prototype.addColorGradient=function(a,c,b){this._colorGradients||(this._colorGradients=[]);a=new p.b(a,c);this._colorGradients.push(a);this._refreshColorGradient(!0);this._releaseBuffers();return this};a.prototype._refreshColorGradient=function(a){void 0===a&&
(a=!1);this._colorGradients&&(a&&this._colorGradients.sort(function(a,c){return a.gradient<c.gradient?-1:a.gradient>c.gradient?1:0}),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))};a.prototype.forceRefreshGradients=function(){this._refreshColorGradient();this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture");this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture");this._refreshFactorGradient(this._velocityGradients,
"_velocityGradientsTexture");this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture");this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture");this.reset()};a.prototype.removeColorGradient=function(a){this._removeGradientAndTexture(a,this._colorGradients,this._colorGradientsTexture);this._colorGradientsTexture=null;return this};a.prototype._addFactorGradient=function(a,c,b){c=new p.c(c,b);a.push(c);this._releaseBuffers()};a.prototype.addSizeGradient=
function(a,c){this._sizeGradients||(this._sizeGradients=[]);this._addFactorGradient(this._sizeGradients,a,c);this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0);this._releaseBuffers();return this};a.prototype.removeSizeGradient=function(a){this._removeGradientAndTexture(a,this._sizeGradients,this._sizeGradientsTexture);this._sizeGradientsTexture=null;return this};a.prototype._refreshFactorGradient=function(a,c,b){void 0===b&&(b=!1);a&&(b&&a.sort(function(a,c){return a.gradient<
c.gradient?-1:a.gradient>c.gradient?1:0}),this[c]&&(this[c].dispose(),this[c]=null))};a.prototype.addAngularSpeedGradient=function(a,c){this._angularSpeedGradients||(this._angularSpeedGradients=[]);this._addFactorGradient(this._angularSpeedGradients,a,c);this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0);this._releaseBuffers();return this};a.prototype.removeAngularSpeedGradient=function(a){this._removeGradientAndTexture(a,this._angularSpeedGradients,this._angularSpeedGradientsTexture);
this._angularSpeedGradientsTexture=null;return this};a.prototype.addVelocityGradient=function(a,c){this._velocityGradients||(this._velocityGradients=[]);this._addFactorGradient(this._velocityGradients,a,c);this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0);this._releaseBuffers();return this};a.prototype.removeVelocityGradient=function(a){this._removeGradientAndTexture(a,this._velocityGradients,this._velocityGradientsTexture);this._velocityGradientsTexture=null;return this};
a.prototype.addLimitVelocityGradient=function(a,c){this._limitVelocityGradients||(this._limitVelocityGradients=[]);this._addFactorGradient(this._limitVelocityGradients,a,c);this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0);this._releaseBuffers();return this};a.prototype.removeLimitVelocityGradient=function(a){this._removeGradientAndTexture(a,this._limitVelocityGradients,this._limitVelocityGradientsTexture);this._limitVelocityGradientsTexture=null;return this};
a.prototype.addDragGradient=function(a,c){this._dragGradients||(this._dragGradients=[]);this._addFactorGradient(this._dragGradients,a,c);this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0);this._releaseBuffers();return this};a.prototype.removeDragGradient=function(a){this._removeGradientAndTexture(a,this._dragGradients,this._dragGradientsTexture);this._dragGradientsTexture=null;return this};a.prototype.addEmitRateGradient=function(a,c,b){return this};a.prototype.removeEmitRateGradient=
function(a){return this};a.prototype.addStartSizeGradient=function(a,c,b){return this};a.prototype.removeStartSizeGradient=function(a){return this};a.prototype.addColorRemapGradient=function(a,c,b){return this};a.prototype.removeColorRemapGradient=function(){return this};a.prototype.addAlphaRemapGradient=function(a,c,b){return this};a.prototype.removeAlphaRemapGradient=function(){return this};a.prototype.addRampGradient=function(a,c){return this};a.prototype.removeRampGradient=function(){return this};
a.prototype.getRampGradients=function(){return null};Object.defineProperty(a.prototype,"useRampGradients",{get:function(){return!1},set:function(a){},enumerable:!1,configurable:!0});a.prototype.addLifeTimeGradient=function(a,c,b){return this};a.prototype.removeLifeTimeGradient=function(a){return this};a.prototype._reset=function(){this._releaseBuffers()};a.prototype._createUpdateVAO=function(a){var c={};c.position=a.createVertexBuffer("position",0,3);var b=3;this.particleEmitterType instanceof F.a&&
(c.initialPosition=a.createVertexBuffer("initialPosition",b,3),b+=3);c.age=a.createVertexBuffer("age",b,1);b+=1;c.life=a.createVertexBuffer("life",b,1);b+=1;c.seed=a.createVertexBuffer("seed",b,4);b+=4;c.size=a.createVertexBuffer("size",b,3);b+=3;this._colorGradientsTexture||(c.color=a.createVertexBuffer("color",b,4),b+=4);c.direction=a.createVertexBuffer("direction",b,3);b+=3;this._isBillboardBased||(c.initialDirection=a.createVertexBuffer("initialDirection",b,3),b+=3);this._angularSpeedGradientsTexture?
(c.angle=a.createVertexBuffer("angle",b,1),b+=1):(c.angle=a.createVertexBuffer("angle",b,2),b+=2);this._isAnimationSheetEnabled&&(c.cellIndex=a.createVertexBuffer("cellIndex",b,1),b+=1,this.spriteRandomStartCell&&(c.cellStartOffset=a.createVertexBuffer("cellStartOffset",b,1),b+=1));this.noiseTexture&&(c.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",b,3),c.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",b+3,3));a=this._engine.recordVertexArrayObject(c,null,this._updateEffect);
this._engine.bindArrayBuffer(null);return a};a.prototype._createRenderVAO=function(a,c){var b={};b.position=a.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);var n=3;this.particleEmitterType instanceof F.a&&(n+=3);b.age=a.createVertexBuffer("age",n,1,this._attributesStrideSize,!0);n+=1;b.life=a.createVertexBuffer("life",n,1,this._attributesStrideSize,!0);n+=5;b.size=a.createVertexBuffer("size",n,3,this._attributesStrideSize,!0);n+=3;this._colorGradientsTexture||(b.color=a.createVertexBuffer("color",
n,4,this._attributesStrideSize,!0),n+=4);this.billboardMode===r.a.BILLBOARDMODE_STRETCHED&&(b.direction=a.createVertexBuffer("direction",n,3,this._attributesStrideSize,!0));n+=3;this._isBillboardBased||(b.initialDirection=a.createVertexBuffer("initialDirection",n,3,this._attributesStrideSize,!0),n+=3);b.angle=a.createVertexBuffer("angle",n,1,this._attributesStrideSize,!0);this._angularSpeedGradientsTexture?n++:n+=2;this._isAnimationSheetEnabled&&(b.cellIndex=a.createVertexBuffer("cellIndex",n,1,this._attributesStrideSize,
!0),n+=1,this.spriteRandomStartCell&&(b.cellStartOffset=a.createVertexBuffer("cellStartOffset",n,1,this._attributesStrideSize,!0),n+=1));this.noiseTexture&&(b.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",n,3,this._attributesStrideSize,!0),b.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",n+3,3,this._attributesStrideSize,!0));b.offset=c.createVertexBuffer("offset",0,2);b.uv=c.createVertexBuffer("uv",2,2);a=this._engine.recordVertexArrayObject(b,null,this._getEffect());this._engine.bindArrayBuffer(null);
return a};a.prototype._initialize=function(a){void 0===a&&(a=!1);if(!this._buffer0||a){a=this._engine;var b=[];this._attributesStrideSize=21;this._targetIndex=0;this.particleEmitterType instanceof F.a&&(this._attributesStrideSize+=3);this.isBillboardBased||(this._attributesStrideSize+=3);this._colorGradientsTexture&&(this._attributesStrideSize-=4);this._angularSpeedGradientsTexture&&--this._attributesStrideSize;this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&
(this._attributesStrideSize+=1));this.noiseTexture&&(this._attributesStrideSize+=6);for(var n=this.particleEmitterType instanceof F.a,t=c.c.Vector3[0],d=0;d<this._capacity;d++)b.push(0),b.push(0),b.push(0),n&&(this.particleEmitterType.particlePositionGenerator(d,null,t),b.push(t.x),b.push(t.y),b.push(t.z)),b.push(0),b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(0),b.push(0),b.push(0),this._colorGradientsTexture||(b.push(0),b.push(0),b.push(0),
b.push(0)),n?(this.particleEmitterType.particleDestinationGenerator(d,null,t),b.push(t.x),b.push(t.y),b.push(t.z)):(b.push(0),b.push(0),b.push(0)),this.isBillboardBased||(b.push(0),b.push(0),b.push(0)),b.push(0),this._angularSpeedGradientsTexture||b.push(0),this._isAnimationSheetEnabled&&(b.push(0),this.spriteRandomStartCell&&b.push(0)),this.noiseTexture&&(b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()));n=new Float32Array([.5,
.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new f.a(a,b,!1,this._attributesStrideSize);this._buffer1=new f.a(a,b,!1,this._attributesStrideSize);this._spriteBuffer=new f.a(a,n,!1,4);this._updateVAO=[];this._updateVAO.push(this._createUpdateVAO(this._buffer0));this._updateVAO.push(this._createUpdateVAO(this._buffer1));this._renderVAO=[];this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer));this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer));
this._sourceBuffer=this._buffer0;this._targetBuffer=this._buffer1}};a.prototype._recreateUpdateEffect=function(){var a=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(a+="\n#define BILLBOARD");this._colorGradientsTexture&&(a+="\n#define COLORGRADIENTS");this._sizeGradientsTexture&&(a+="\n#define SIZEGRADIENTS");this._angularSpeedGradientsTexture&&(a+="\n#define ANGULARSPEEDGRADIENTS");this._velocityGradientsTexture&&(a+="\n#define VELOCITYGRADIENTS");
this._limitVelocityGradientsTexture&&(a+="\n#define LIMITVELOCITYGRADIENTS");this._dragGradientsTexture&&(a+="\n#define DRAGGRADIENTS");this.isAnimationSheetEnabled&&(a+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(a+="\n#define ANIMATESHEETRANDOMSTART"));this.noiseTexture&&(a+="\n#define NOISE");this.isLocal&&(a+="\n#define LOCAL");this._updateEffect&&this._updateEffectOptions.defines===a||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this.particleEmitterType instanceof
F.a&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),
this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),
this._updateEffectOptions.defines=a,this._updateEffect=new K.a("gpuUpdateParticles",this._updateEffectOptions,this._engine))};a.prototype._getEffect=function(){var a;return null!==(a=this.getCustomEffect())&&void 0!==a?a:this._renderEffect};a.prototype.fillDefines=function(a,c){this._scene&&(this._scene.clipPlane&&a.push("#define CLIPPLANE"),this._scene.clipPlane2&&a.push("#define CLIPPLANE2"),this._scene.clipPlane3&&a.push("#define CLIPPLANE3"),this._scene.clipPlane4&&a.push("#define CLIPPLANE4"),
this._scene.clipPlane5&&a.push("#define CLIPPLANE5"),this._scene.clipPlane6&&a.push("#define CLIPPLANE6"));this.blendMode===r.a.BLENDMODE_MULTIPLY&&a.push("#define BLENDMULTIPLYMODE");this.isLocal&&a.push("#define LOCAL");if(this._isBillboardBased)switch(a.push("#define BILLBOARD"),this.billboardMode){case r.a.BILLBOARDMODE_Y:a.push("#define BILLBOARDY");break;case r.a.BILLBOARDMODE_STRETCHED:a.push("#define BILLBOARDSTRETCHED");break;case r.a.BILLBOARDMODE_ALL:a.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&
a.push("#define COLORGRADIENTS");this.isAnimationSheetEnabled&&a.push("#define ANIMATESHEET");this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a.push(""+this._imageProcessingConfigurationDefines.toString()))};a.prototype.fillUniformsAttributesAndSamplerNames=function(a,c,b){c.push("position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex");a.push("emitterWM","worldOffset",
"view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","sheetInfos","translationPivot","eyePosition");b.push("diffuseSampler","colorGradientSampler");this._imageProcessingConfiguration&&(D.a.PrepareUniforms(a,this._imageProcessingConfigurationDefines),D.a.PrepareSamplers(b,this._imageProcessingConfigurationDefines))};a.prototype._recreateRenderEffect=function(){var a=this.getCustomEffect();if(a)return a;a=[];this.fillDefines(a);
a=a.join("\n");if(this._renderEffect&&this._renderEffect.defines===a)return this._renderEffect;var c=[],b=[],n=[];this.fillUniformsAttributesAndSamplerNames(b,c,n);return this._renderEffect=new K.a("gpuRenderParticles",c,b,n,this._engine,a)};a.prototype.animate=function(a){var c;void 0===a&&(a=!1);this._timeDelta=this.updateSpeed*(a?this.preWarmStepOffset:(null===(c=this._scene)||void 0===c?void 0:c.getAnimationRatio())||1);this._actualFrame+=this._timeDelta;this._stopped||this.targetStopDuration&&
this._actualFrame>=this.targetStopDuration&&this.stop()};a.prototype._createFactorGradientTexture=function(a,c){var b=this[c];if(a&&a.length&&!b){for(var n=new Float32Array(this._rawTextureWidth),d=0;d<this._rawTextureWidth;d++)p.d.GetCurrentGradient(d/this._rawTextureWidth,a,function(a,c,b){n[d]=e.a.Lerp(a.factor1,c.factor1,b)});this[c]=aa.a.CreateRTexture(n,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1)}};a.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,
"_sizeGradientsTexture")};a.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")};a.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")};a.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")};a.prototype._createDragGradientTexture=
function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")};a.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var a=new Uint8Array(4*this._rawTextureWidth),c=u.c.Color4[0],b=0;b<this._rawTextureWidth;b++)p.d.GetCurrentGradient(b/this._rawTextureWidth,this._colorGradients,function(n,d,e){u.b.LerpToRef(n.color1,d.color1,e,c);a[4*b]=255*c.r;a[4*b+1]=255*c.g;a[4*b+2]=255*c.b;a[4*b+3]=
255*c.a});this._colorGradientsTexture=aa.a.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,1)}};a.prototype.render=function(a){var b,n;void 0===a&&(a=!1);if(!this._started)return 0;this._createColorGradientTexture();this._createSizeGradientTexture();this._createAngularSpeedGradientTexture();this._createVelocityGradientTexture();this._createLimitVelocityGradientTexture();this._createDragGradientTexture();this._recreateUpdateEffect();this._recreateRenderEffect();if(!this.isReady())return 0;
if(!a&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(var d=0;d<this.preWarmCycles;d++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId())return 0;this._currentRenderId=this._scene.getFrameId()}this._initialize();this._accumulatedCount+=this.emitRate*this._timeDelta;1<this._accumulatedCount&&(d=this._accumulatedCount|0,this._accumulatedCount-=d,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+d));if(!this._currentActiveCount)return 0;
this._engine.enableEffect(this._updateEffect);d=this._engine;if(!d.setState)throw Error("GPU particles cannot work with a full Engine. ThinEngine is not supported");this._updateEffect.setFloat("currentCount",this._currentActiveCount);this._updateEffect.setFloat("timeDelta",this._timeDelta);this._updateEffect.setFloat("stopFactor",this._stopped?0:1);this._updateEffect.setTexture("randomSampler",this._randomTexture);this._updateEffect.setTexture("randomSampler2",this._randomTexture2);this._updateEffect.setFloat2("lifeTime",
this.minLifeTime,this.maxLifeTime);this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower);this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2));this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize);this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY);this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,
this.minInitialRotation,this.maxInitialRotation);this._updateEffect.setVector3("gravity",this.gravity);this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture);this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture);this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture);this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",
this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping));this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture);this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect);this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed);this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",
this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength));if(this.emitter.position)var e=this.emitter.getWorldMatrix();else{var f=this.emitter;e=c.a.Translation(f.x,f.y,f.z)}this.isLocal||this._updateEffect.setMatrix("emitterWM",e);this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null);d.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer());d.setRasterizerState(!1);d.beginTransformFeedback(!0);d.drawArraysType(3,0,this._currentActiveCount);d.endTransformFeedback();
d.setRasterizerState(!0);d.bindTransformFeedbackBuffer(null);if(!a){a=this._getEffect();this._engine.enableEffect(a);f=(null===(b=this._scene)||void 0===b?void 0:b.getViewMatrix())||c.a.IdentityReadOnly;a.setMatrix("view",f);a.setMatrix("projection",null!==(n=this.defaultProjectionMatrix)&&void 0!==n?n:this._scene.getProjectionMatrix());a.setTexture("diffuseSampler",this.particleTexture);a.setVector2("translationPivot",this.translationPivot);a.setVector3("worldOffset",this.worldOffset);this.isLocal&&
a.setMatrix("emitterWM",e);this._colorGradientsTexture?a.setTexture("colorGradientSampler",this._colorGradientsTexture):a.setDirectColor4("colorDead",this.colorDead);this._isAnimationSheetEnabled&&this.particleTexture&&(b=this.particleTexture.getBaseSize(),a.setFloat3("sheetInfos",this.spriteCellWidth/b.width,this.spriteCellHeight/b.height,b.width/this.spriteCellWidth));this._isBillboardBased&&this._scene&&a.setVector3("eyePosition",this._scene.activeCamera.globalPosition);b=a.defines;this._scene&&
(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4||this._scene.clipPlane5||this._scene.clipPlane6)&&ia.a.BindClipPlane(a,this._scene);0<=b.indexOf("#define BILLBOARDMODE_ALL")&&(b=f.clone(),b.invert(),a.setMatrix("invView",b));this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(a);switch(this.blendMode){case r.a.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case r.a.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);
break;case r.a.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case r.a.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}this.forceDepthWrite&&d.setDepthWrite(!0);this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null);this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(a);this._engine.drawArraysType(8,0,4,this._currentActiveCount);this._engine.setAlphaMode(0)}this._targetIndex++;2===this._targetIndex&&(this._targetIndex=0);d=this._sourceBuffer;
this._sourceBuffer=this._targetBuffer;this._targetBuffer=d;return this._currentActiveCount};a.prototype.rebuild=function(){this._initialize(!0)};a.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null);this._buffer1&&(this._buffer1.dispose(),this._buffer1=null);this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)};a.prototype._releaseVAOs=function(){if(this._updateVAO){for(var a=0;a<this._updateVAO.length;a++)this._engine.releaseVertexArrayObject(this._updateVAO[a]);
this._updateVAO=[];for(a=0;a<this._renderVAO.length;a++)this._engine.releaseVertexArrayObject(this._renderVAO[a]);this._renderVAO=[]}};a.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._scene){var b=this._scene.particleSystems.indexOf(this);-1<b&&this._scene.particleSystems.splice(b,1)}this._releaseBuffers();this._releaseVAOs();this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null);this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),
this._sizeGradientsTexture=null);this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null);this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null);this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null);this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null);this._randomTexture&&
(this._randomTexture.dispose(),this._randomTexture=null);this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null);a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null);this.onStoppedObservable.clear();this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear()};a.prototype.clone=function(b,c){var n=this.serialize();n=a.Parse(n,this._scene||this._engine,
"");var d=Object(x.a)({},this._customEffect);n.name=b;n._customEffect=d;void 0===c&&(c=this.emitter);n.emitter=c;n.noiseTexture=this.noiseTexture;return n};a.prototype.serialize=function(a){void 0===a&&(a=!1);var b={};r.a._Serialize(b,this,a);b.activeParticleCount=this.activeParticleCount;b.randomTextureSize=this._randomTextureSize;return b};a.Parse=function(b,c,n,d){void 0===d&&(d=!1);var e=new a(b.name,{capacity:b.capacity,randomTextureSize:b.randomTextureSize},c);b.activeParticleCount&&(e.activeParticleCount=
b.activeParticleCount);r.a._Parse(b,e,c,n);b.preventAutoStart&&(e.preventAutoStart=b.preventAutoStart);d||e.preventAutoStart||e.start();return e};return a}(v.a);g("ltZq");var G=g("YKqZ"),Z=g("aCSs"),Ea=g("H22S"),l=g("kdvT");(function(){return function(){}})();var a=function(){function a(){this.systems=[]}Object.defineProperty(a.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!1,configurable:!0});a.prototype.setEmitterAsSphere=function(a,b,c){this._emitterNode&&this._emitterNode.dispose();
this._emitterCreationOptions={kind:"Sphere",options:a,renderingGroupId:b};var n=Ea.a.CreateSphere("emitterSphere",{diameter:a.diameter,segments:a.segments},c);n.renderingGroupId=b;b=new l.a("emitterSphereMaterial",c);b.emissiveColor=a.color;n.material=b;a=0;for(b=this.systems;a<b.length;a++)b[a].emitter=n;this._emitterNode=n};a.prototype.start=function(a){for(var b=0,c=this.systems;b<c.length;b++){var n=c[b];a&&(n.emitter=a);n.start()}};a.prototype.dispose=function(){for(var a=0,b=this.systems;a<
b.length;a++)b[a].dispose();this.systems=[];this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)};a.prototype.serialize=function(a){void 0===a&&(a=!1);for(var b={systems:[]},c=0,n=this.systems;c<n.length;c++)b.systems.push(n[c].serialize(a));this._emitterNode&&(b.emitter=this._emitterCreationOptions);return b};a.Parse=function(c,d,e){void 0===e&&(e=!1);var n=new a,f=this.BaseAssetsUrl+"/textures/";d=d||N.a.LastCreatedScene;for(var g=0,h=c.systems;g<h.length;g++){var t=h[g];n.systems.push(e?
b.Parse(t,d,f,!0):r.a.Parse(t,d,f,!0))}if(c.emitter)switch(e=c.emitter.options,c.emitter.kind){case "Sphere":n.setEmitterAsSphere({diameter:e.diameter,segments:e.segments,color:u.a.FromArray(e.color)},c.emitter.renderingGroupId,d)}return n};a.BaseAssetsUrl="https://assets.babylonjs.com/particles";return a}(),d=g("Ksm9");(function(){function c(){}c.CreateDefault=function(a,c,d,e){void 0===c&&(c=500);void 0===e&&(e=!1);c=e?new b("default system",{capacity:c},d):new r.a("default system",c,d);c.emitter=
a;c.particleTexture=new Z.a("https://www.babylonjs.com/assets/Flare.png",c.getScene());c.createConeEmitter(.1,Math.PI/4);c.color1=new u.b(1,1,1,1);c.color2=new u.b(1,1,1,1);c.colorDead=new u.b(1,1,1,0);c.minSize=.1;c.maxSize=.1;c.minEmitPower=2;c.maxEmitPower=2;c.updateSpeed=1/60;c.emitRate=30;return c};c.CreateAsync=function(n,d,e){void 0===e&&(e=!1);d||(d=N.a.LastCreatedScene);var f={};d._addPendingData(f);return new Promise(function(g,h){if(e&&!b.IsSupported)return d._removePendingData(f),h("Particle system with GPU is not supported.");
G.b.LoadFile(c.BaseAssetsUrl+"/systems/"+n+".json",function(c){d._removePendingData(f);c=JSON.parse(c.toString());return g(a.Parse(c,d,e))},void 0,void 0,void 0,function(){d._removePendingData(f);return h("An error occured while the creation of your particle system. Check if your type '"+n+"' exists.")})})};c.ExportSet=function(c){for(var b=new a,n=0;n<c.length;n++)b.systems.push(c[n]);return b};c.ParseFromFileAsync=function(a,c,e,f,g){void 0===f&&(f=!1);void 0===g&&(g="");return new Promise(function(n,
h){var t=new d.a;t.addEventListener("readystatechange",function(){if(4==t.readyState)if(200==t.status){var c=JSON.parse(t.responseText);c=f?b.Parse(c,e,g):r.a.Parse(c,e,g);a&&(c.name=a);n(c)}else h("Unable to load the particle system")});t.open("GET",c);t.send()})};c.CreateFromSnippetAsync=function(a,c,e,f){var n=this;void 0===e&&(e=!1);void 0===f&&(f="");if("_BLANK"===a){var g=this.CreateDefault(null);g.start();return Promise.resolve(g)}return new Promise(function(g,h){var t=new d.a;t.addEventListener("readystatechange",
function(){if(4==t.readyState)if(200==t.status){var n=JSON.parse(JSON.parse(t.responseText).jsonPayload);n=JSON.parse(n.particleSystem);n=e?b.Parse(n,c,f):r.a.Parse(n,c,f);n.snippetId=a;g(n)}else h("Unable to load the snippet "+a)});t.open("GET",n.SnippetUrl+"/"+a.replace(/#/g,"/"));t.send()})};c.BaseAssetsUrl=a.BaseAssetsUrl;c.SnippetUrl="https://snippet.babylonjs.com";return c})();var fa=g("wAMR"),m=g("KbzI");v=g("qUIE");var h=g("Yap0");g("yURT");m.a.AddParser(h.a.NAME_PARTICLESYSTEM,function(a,
c,b,d){var n=m.a.GetIndividualParser(h.a.NAME_PARTICLESYSTEM);if(n&&void 0!==a.particleSystems&&null!==a.particleSystems)for(var e=0,f=a.particleSystems.length;e<f;e++)b.particleSystems.push(n(a.particleSystems[e],c,d))});m.a.AddIndividualParser(h.a.NAME_PARTICLESYSTEM,function(a,c,d){return a.activeParticleCount?b.Parse(a,c,d):r.a.Parse(a,c,d)});v.a.prototype.createEffectForParticles=function(a,c,b,d,e,f,g,h){var n;void 0===c&&(c=[]);void 0===b&&(b=[]);void 0===d&&(d="");var t=[],k=[],X=[];h?h.fillUniformsAttributesAndSamplerNames(k,
t,X):(t=r.a._GetAttributeNamesOrOptions(),k=r.a._GetEffectCreationOptions());-1===d.indexOf(" BILLBOARD")&&(d+="\n#define BILLBOARD\n");-1===b.indexOf("diffuseSampler")&&b.push("diffuseSampler");return this.createEffect({vertex:null!==(n=null===h||void 0===h?void 0:h.vertexShaderName)&&void 0!==n?n:"particles",fragmentElement:a},t,k.concat(c),X.concat(b),d,e,f,g)};fa.a.prototype.getEmittedParticleSystems=function(){for(var a=[],c=0;c<this.getScene().particleSystems.length;c++){var b=this.getScene().particleSystems[c];
b.emitter===this&&a.push(b)}return a};fa.a.prototype.getHierarchyEmittedParticleSystems=function(){var a=[],c=this.getDescendants();c.push(this);for(var b=0;b<this.getScene().particleSystems.length;b++){var d=this.getScene().particleSystems[b],e=d.emitter;e.position&&-1!==c.indexOf(e)&&a.push(d)}return a};var pa=g("T5H4"),k=g("vvwx"),Fa=g("ikaq"),Aa=function(){function a(a,b,d,e,f,g,h,k,l,m){void 0===l&&(l=null);void 0===m&&(m=null);this.id=this.idx=0;this.color=new u.b(1,1,1,1);this.position=c.e.Zero();
this.rotation=c.e.Zero();this.scaling=c.e.One();this.uvs=new c.f(0,0,1,1);this.velocity=c.e.Zero();this.pivot=c.e.Zero();this.translateFromPivot=!1;this.isVisible=this.alive=!0;this.idxInShape=this.shapeId=this._ind=this._pos=0;this._stillInvisible=!1;this._rotationMatrix=[1,0,0,0,1,0,0,0,1];this.props=this.materialIndex=this.parentId=null;this.cullingStrategy=Fa.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY;this._globalPosition=c.e.Zero();this.idx=a;this.id=b;this._pos=d;this._ind=e;this._model=f;this.shapeId=
g;this.idxInShape=h;this._sps=k;l&&(this._modelBoundingInfo=l,this._boundingInfo=new pa.a(l.minimum,l.maximum));null!==m&&(this.materialIndex=m)}a.prototype.copyToRef=function(a){a.position.copyFrom(this.position);a.rotation.copyFrom(this.rotation);this.rotationQuaternion&&(a.rotationQuaternion?a.rotationQuaternion.copyFrom(this.rotationQuaternion):a.rotationQuaternion=this.rotationQuaternion.clone());a.scaling.copyFrom(this.scaling);this.color&&(a.color?a.color.copyFrom(this.color):a.color=this.color.clone());
a.uvs.copyFrom(this.uvs);a.velocity.copyFrom(this.velocity);a.pivot.copyFrom(this.pivot);a.translateFromPivot=this.translateFromPivot;a.alive=this.alive;a.isVisible=this.isVisible;a.parentId=this.parentId;a.cullingStrategy=this.cullingStrategy;null!==this.materialIndex&&(a.materialIndex=this.materialIndex);return this};Object.defineProperty(a.prototype,"scale",{get:function(){return this.scaling},set:function(a){this.scaling=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"quaternion",
{get:function(){return this.rotationQuaternion},set:function(a){this.rotationQuaternion=a},enumerable:!1,configurable:!0});a.prototype.intersectsMesh=function(a){return this._boundingInfo&&a._boundingInfo?this._sps._bSphereOnly?k.a.Intersects(this._boundingInfo.boundingSphere,a._boundingInfo.boundingSphere):this._boundingInfo.intersects(a._boundingInfo,!1):!1};a.prototype.isInFrustum=function(a){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(a,this.cullingStrategy)};a.prototype.getRotationMatrix=
function(a){if(this.rotationQuaternion)var b=this.rotationQuaternion;else{b=c.c.Quaternion[0];var d=this.rotation;c.b.RotationYawPitchRollToRef(d.y,d.x,d.z,b)}b.toRotationMatrix(a)};return a}(),sa=function(){return function(a,c,b,d,e,f,g,h,k){this._indicesLength=0;this.shapeID=a;this._shape=c;this._indices=b;this._indicesLength=b.length;this._shapeUV=f;this._shapeColors=e;this._normals=d;this._positionFunction=g;this._vertexFunction=h;this._material=k}}(),rb=function(){return function(a,c,b,d){this.sqDistance=
this.ind=this.idx=0;this.idx=a;this.ind=c;this.indicesLength=b;this.materialIndex=d}}(),Ga=function(){function a(){this.position=c.e.Zero();this.color=new u.b(1,1,1,1);this.uv=c.d.Zero()}Object.defineProperty(a.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"z",{get:function(){return this.position.z},set:function(a){this.position.z=a},enumerable:!1,configurable:!0});return a}(),Ba=g("UtUh"),Ha=g("e993"),qb=g("SYzJ"),Ka=g("C1Wc"),ta=g("jI0L");(function(){function a(a,c,b){this.particles=[];this.nbParticles=0;this.recomputeNormals=this.billboard=!1;this.counter=0;this.vars={};this._bSphereOnly=!1;this._bSphereRadiusFactor=1;this._positions=[];this._indices=[];this._normals=[];this._colors=[];this._uvs=[];this._index=0;this._updatable=!0;this._expandable=
this._depthSort=this._alwaysVisible=this._isVisibilityBoxLocked=this._pickable=!1;this._shapeCounter=0;this._copy=new Aa(0,0,0,0,null,0,0,this);this._color=new u.b(0,0,0,0);this._computeParticleRotation=this._computeParticleTexture=this._computeParticleColor=!0;this._computeBoundingBox=this._computeParticleVertex=!1;this._depthSortParticles=!0;this._needs32Bits=this._particlesIntersect=this._mustUnrotateFixedNormals=!1;this._isNotBuilt=!0;this._lastParticleId=0;this._idxOfId=[];this._useModelMaterial=
this._multimaterialEnabled=!1;this._depthSortFunction=function(a,b){return b.sqDistance-a.sqDistance};this._materialSortFunction=function(a,b){return a.materialIndex-b.materialIndex};this._autoUpdateSubMeshes=!1;this.name=a;this._scene=c||N.a.LastCreatedScene;this._camera=c.activeCamera;this._pickable=b?b.isPickable:!1;this._depthSort=b?b.enableDepthSort:!1;this._multimaterialEnabled=b?b.enableMultiMaterial:!1;this._multimaterialEnabled=(this._useModelMaterial=b?b.useModelMaterial:!1)?!0:this._multimaterialEnabled;
this._expandable=b?b.expandable:!1;this._particlesIntersect=b?b.particleIntersection:!1;this._bSphereOnly=b?b.boundingSphereOnly:!1;this._bSphereRadiusFactor=b&&b.bSphereRadiusFactor?b.bSphereRadiusFactor:1;this._updatable=b&&void 0!==b.updatable?b.updatable:!0;this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);if(this._depthSort||this._multimaterialEnabled)this.depthSortedParticles=[];this._multimaterialEnabled&&(this._multimaterial=new ta.a(this.name+"MultiMaterial",
this._scene),this._materials=[],this._materialIndexesById={});this._tmpVertex=new Ga}a.prototype.buildMesh=function(){if(!this._isNotBuilt&&this.mesh)return this.mesh;if(0===this.nbParticles&&!this.mesh){var a=Ha.a.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(a,1);a.dispose()}this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices);this._positions32=new Float32Array(this._positions);this._uvs32=new Float32Array(this._uvs);this._colors32=
new Float32Array(this._colors);this.mesh||(this.mesh=new fa.a(this.name,this._scene));!this._updatable&&this._multimaterialEnabled&&this._sortParticlesByMaterial();this.recomputeNormals&&Ba.a.ComputeNormals(this._positions32,this._indices32,this._normals);this._normals32=new Float32Array(this._normals);this._fixedNormal32=new Float32Array(this._normals);this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();a=new Ba.a;a.indices=this._depthSort?this._indices:this._indices32;a.set(this._positions32,
f.b.PositionKind);a.set(this._normals32,f.b.NormalKind);0<this._uvs32.length&&a.set(this._uvs32,f.b.UVKind);0<this._colors32.length&&a.set(this._colors32,f.b.ColorKind);a.applyToMesh(this.mesh,this._updatable);if(this.mesh.isPickable=this._pickable)for(var b=a=0;b<this.nbParticles;b++)for(var c=this.particles[b],d=c._model._indicesLength,e=0;e<d;e++)0==e%3&&(this.pickedParticles[a]={idx:c.idx,faceId:a},a++);this._multimaterialEnabled&&this.setMultiMaterial(this._materials);this._expandable||(this._depthSort||
this._multimaterialEnabled||(this._indices=null),this._colors=this._uvs=this._normals=this._positions=null,this._updatable||(this.particles.length=0));this.recomputeNormals=this._isNotBuilt=!1;return this.mesh};a.prototype.digest=function(a,b){var d=b&&b.facetNb||1,e=b&&b.number||0,n=b&&b.delta||0,g=a.getVerticesData(f.b.PositionKind),h=a.getIndices(),k=a.getVerticesData(f.b.UVKind),t=a.getVerticesData(f.b.ColorKind),l=a.getVerticesData(f.b.NormalKind);b=b&&b.storage?b.storage:null;var m=0,p=h.length/
3;e?(d=Math.round(p/(e>p?p:e)),n=0):d=d>p?p:d;e=[];for(var q=[],r=[],qa=[],ca=[],u=c.e.Zero(),x=d;m<p;){d=x+Math.floor((1+n)*Math.random());m>p-d&&(d=p-m);e.length=0;q.length=0;r.length=0;qa.length=0;for(var w=ca.length=0,B=3*m;B<3*(m+d);B++){r.push(w);var y=h[B],da=3*y;e.push(g[da],g[da+1],g[da+2]);q.push(l[da],l[da+1],l[da+2]);k&&(da=2*y,qa.push(k[da],k[da+1]));t&&(y*=4,ca.push(t[y],t[y+1],t[y+2],t[y+3]));w++}w=this.nbParticles;B=this._posToShape(e);var v=this._uvsToShapeUV(qa);y=G.b.Slice(r);da=
G.b.Slice(ca);var z=G.b.Slice(q);u.copyFromFloats(0,0,0);var A;for(A=0;A<B.length;A++)u.addInPlace(B[A]);u.scaleInPlace(1/B.length);var xa=new c.e(Infinity,Infinity,Infinity),M=new c.e(-Infinity,-Infinity,-Infinity);for(A=0;A<B.length;A++)B[A].subtractInPlace(u),xa.minimizeInPlaceFromFloats(B[A].x,B[A].y,B[A].z),M.maximizeInPlaceFromFloats(B[A].x,B[A].y,B[A].z);var F;this._particlesIntersect&&(F=new pa.a(xa,M));A=null;this._useModelMaterial&&(A=a.material?a.material:this._setDefaultMaterial());v=
new sa(this._shapeCounter,B,y,z,da,v,null,null,A);A=this._positions.length;xa=this._indices.length;this._meshBuilder(this._index,xa,B,this._positions,y,this._indices,qa,this._uvs,da,this._colors,z,this._normals,w,0,null,v);this._addParticle(w,this._lastParticleId,A,xa,v,this._shapeCounter,0,F,b);this.particles[this.nbParticles].position.addInPlace(u);b||(this._index+=B.length,this.nbParticles++,this._lastParticleId++);this._shapeCounter++;m+=d}this._isNotBuilt=!0;return this};a.prototype._unrotateFixedNormals=
function(){for(var a=0,b=0,d=c.c.Vector3[0],e=c.c.Quaternion[0],f=c.c.Matrix[0],g=0;g<this.particles.length;g++){var h=this.particles[g],k=h._model._shape;h.rotationQuaternion?h.rotationQuaternion.conjugateToRef(e):(h=h.rotation,c.b.RotationYawPitchRollToRef(h.y,h.x,h.z,e),e.conjugateInPlace());e.toRotationMatrix(f);for(h=0;h<k.length;h++)b=a+3*h,c.e.TransformNormalFromFloatsToRef(this._normals32[b],this._normals32[b+1],this._normals32[b+2],f,d),d.toArray(this._fixedNormal32,b);a=b+3}};a.prototype._resetCopy=
function(){var a=this._copy;a.position.setAll(0);a.rotation.setAll(0);a.rotationQuaternion=null;a.scaling.setAll(1);a.uvs.copyFromFloats(0,0,1,1);a.color=null;a.translateFromPivot=!1;a.shapeId=0;a.materialIndex=null};a.prototype._meshBuilder=function(a,b,d,e,f,g,h,k,l,m,p,q,u,r,A,ca){var n=0,t=0,X=0;this._resetCopy();var R=this._copy,na=A&&A.storage?!0:!1;R.idx=u;R.idxInShape=r;R.shapeId=ca.shapeID;if(this._useModelMaterial){var ha=ca._material.uniqueId,ja=this._materialIndexesById;ja.hasOwnProperty(ha)||
(ja[ha]=this._materials.length,this._materials.push(ca._material));R.materialIndex=ja[ha]}A&&A.positionFunction&&(A.positionFunction(R,u,r),this._mustUnrotateFixedNormals=!0);if(na)return R;ca=c.c.Matrix[0];na=this._tmpVertex;ha=na.position;ja=na.color;var Ma=na.uv,va=c.c.Vector3[1],qa=c.c.Vector3[2],w=c.c.Vector3[3];c.a.IdentityToRef(ca);R.getRotationMatrix(ca);R.pivot.multiplyToRef(R.scaling,w);R.translateFromPivot?qa.setAll(0):qa.copyFrom(w);var x=A&&A.vertexFunction;for(r=0;r<d.length;r++){ha.copyFrom(d[r]);
R.color&&ja.copyFrom(R.color);h&&Ma.copyFromFloats(h[n],h[n+1]);x&&A.vertexFunction(R,na,r);ha.multiplyInPlace(R.scaling).subtractInPlace(w);c.e.TransformCoordinatesToRef(ha,ca,va);va.addInPlace(qa).addInPlace(R.position);e.push(va.x,va.y,va.z);if(h){var v=R.uvs;k.push((v.z-v.x)*Ma.x+v.x,(v.w-v.y)*Ma.y+v.y);n+=2}R.color?this._color.copyFrom(ja):(v=this._color,l&&void 0!==l[t]?(v.r=l[t],v.g=l[t+1],v.b=l[t+2],v.a=l[t+3]):(v.r=1,v.g=1,v.b=1,v.a=1));m.push(this._color.r,this._color.g,this._color.b,this._color.a);
t+=4;!this.recomputeNormals&&p&&(c.e.TransformNormalFromFloatsToRef(p[X],p[X+1],p[X+2],ca,ha),q.push(ha.x,ha.y,ha.z),X+=3)}for(r=0;r<f.length;r++)d=a+f[r],g.push(d),65535<d&&(this._needs32Bits=!0);(this._depthSort||this._multimaterialEnabled)&&this.depthSortedParticles.push(new rb(u,b,f.length,null!==R.materialIndex?R.materialIndex:0));return R};a.prototype._posToShape=function(a){for(var b=[],d=0;d<a.length;d+=3)b.push(c.e.FromArray(a,d));return b};a.prototype._uvsToShapeUV=function(a){var b=[];
if(a)for(var c=0;c<a.length;c++)b.push(a[c]);return b};a.prototype._addParticle=function(a,b,c,d,e,f,g,h,k){void 0===h&&(h=null);void 0===k&&(k=null);a=new Aa(a,b,c,d,e,f,g,this,h);(k?k:this.particles).push(a);return a};a.prototype.addShape=function(a,b,c){var d=a.getVerticesData(f.b.PositionKind),e=a.getIndices(),n=a.getVerticesData(f.b.UVKind),g=a.getVerticesData(f.b.ColorKind),h=a.getVerticesData(f.b.NormalKind);this.recomputeNormals=h?!1:!0;var k=G.b.SliceToArray(e),t=G.b.SliceToArray(h),l=g?
G.b.SliceToArray(g):[],X=c&&c.storage?c.storage:null,m=null;this._particlesIntersect&&(m=a.getBoundingInfo());d=this._posToShape(d);var p=this._uvsToShapeUV(n),q=c?c.positionFunction:null,r=c?c.vertexFunction:null,A=null;this._useModelMaterial&&(A=a.material?a.material:this._setDefaultMaterial());a=new sa(this._shapeCounter,d,k,t,l,p,q,r,A);for(k=0;k<b;k++)this._insertNewParticle(this.nbParticles,k,a,d,e,n,g,h,m,X,c);this._shapeCounter++;this._isNotBuilt=!0;return this._shapeCounter-1};a.prototype._rebuildParticle=
function(a,b){void 0===b&&(b=!1);this._resetCopy();var d=this._copy;a._model._positionFunction&&a._model._positionFunction(d,a.idx,a.idxInShape);var e=c.c.Matrix[0],f=c.c.Vector3[0],n=c.c.Vector3[1],g=c.c.Vector3[2],h=c.c.Vector3[3];d.getRotationMatrix(e);a.pivot.multiplyToRef(a.scaling,h);d.translateFromPivot?g.copyFromFloats(0,0,0):g.copyFrom(h);for(var k=a._model._shape,t=0;t<k.length;t++)f.copyFrom(k[t]),a._model._vertexFunction&&a._model._vertexFunction(d,f,t),f.multiplyInPlace(d.scaling).subtractInPlace(h),
c.e.TransformCoordinatesToRef(f,e,n),n.addInPlace(g).addInPlace(d.position).toArray(this._positions32,a._pos+3*t);b&&(a.position.setAll(0),a.rotation.setAll(0),a.rotationQuaternion=null,a.scaling.setAll(1),a.uvs.setAll(0),a.pivot.setAll(0),a.translateFromPivot=!1,a.parentId=null)};a.prototype.rebuildMesh=function(a){void 0===a&&(a=!1);for(var b=0;b<this.particles.length;b++)this._rebuildParticle(this.particles[b],a);this.mesh.updateVerticesData(f.b.PositionKind,this._positions32,!1,!1);return this};
a.prototype.removeParticles=function(a,b){var c=b-a+1;if(!this._expandable||0>=c||c>=this.nbParticles||!this._updatable)return[];var d=this.particles,e=this.nbParticles;if(b<e-1){var f=b+1;b=d[f]._pos-d[a]._pos;for(var g=d[f]._ind-d[a]._ind;f<e;f++){var n=d[f];n._pos-=b;n._ind-=g}}a=d.splice(a,c);this._positions.length=0;this._indices.length=0;this._colors.length=0;this._uvs.length=0;this._index=this._normals.length=0;this._idxOfId.length=0;if(this._depthSort||this._multimaterialEnabled)this.depthSortedParticles=
[];e=0;b=d.length;for(g=0;g<b;g++){f=d[g];n=f._model;var h=n._shape,k=n._indices,t=n._normals,l=n._shapeColors,m=n._shapeUV;f.idx=g;this._idxOfId[f.id]=g;this._meshBuilder(this._index,e,h,this._positions,k,this._indices,m,this._uvs,l,this._colors,t,this._normals,f.idx,f.idxInShape,null,n);this._index+=h.length;e+=k.length}this.nbParticles-=c;this._isNotBuilt=!0;return a};a.prototype.insertParticlesFromArray=function(a){if(!this._expandable)return this;for(var b=0,c=a[0].shapeId,d=a.length,e=0;e<d;e++){var f=
a[e],g=f._model,n=g._shape,h=g._indices,k=g._shapeUV,l=g._shapeColors,m=g._normals;this.recomputeNormals=(m?!1:!0)||this.recomputeNormals;g=this._insertNewParticle(this.nbParticles,b,g,n,h,k,l,m,f._boundingInfo,null,null);f.copyToRef(g);b++;c!=f.shapeId&&(c=f.shapeId,b=0)}this._isNotBuilt=!0;return this};a.prototype._insertNewParticle=function(a,b,c,d,e,f,g,h,k,l,m){var n=this._positions.length,t=this._indices.length;a=this._meshBuilder(this._index,t,d,this._positions,e,this._indices,f,this._uvs,
g,this._colors,h,this._normals,a,b,m,c);e=null;this._updatable&&(e=this._addParticle(this.nbParticles,this._lastParticleId,n,t,c,this._shapeCounter,b,k,l),e.position.copyFrom(a.position),e.rotation.copyFrom(a.rotation),a.rotationQuaternion&&(e.rotationQuaternion?e.rotationQuaternion.copyFrom(a.rotationQuaternion):e.rotationQuaternion=a.rotationQuaternion.clone()),a.color&&(e.color?e.color.copyFrom(a.color):e.color=a.color.clone()),e.scaling.copyFrom(a.scaling),e.uvs.copyFrom(a.uvs),null!==a.materialIndex&&
(e.materialIndex=a.materialIndex),this.expandable&&(this._idxOfId[e.id]=e.idx));l||(this._index+=d.length,this.nbParticles++,this._lastParticleId++);return e};a.prototype.setParticles=function(a,b,d){void 0===a&&(a=0);void 0===b&&(b=this.nbParticles-1);void 0===d&&(d=!0);if(!this._updatable||this._isNotBuilt)return this;this.beforeUpdateParticles(a,b,d);var e=c.c.Matrix[0],g=c.c.Matrix[1],h=this.mesh,n=this._colors32,k=this._positions32,t=this._normals32,l=this._uvs32,m=this._indices32,p=this._indices,
X=this._fixedNormal32,q=c.c.Vector3,r=q[5].copyFromFloats(1,0,0),A=q[6].copyFromFloats(0,1,0),u=q[7].copyFromFloats(0,0,1),v=q[8].setAll(Number.MAX_VALUE),w=q[9].setAll(-Number.MAX_VALUE),B=q[10].setAll(0),y=this._tmpVertex,x=y.position,wa=y.color,z=y.uv;if(this.billboard||this._depthSort)this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(g);if(this.billboard){var F=q[0];this._camera.getDirectionToRef(qb.a.Z,F);c.e.TransformNormalToRef(F,g,u);u.normalize();var Q=this._camera.getViewMatrix(!0);
c.e.TransformNormalFromFloatsToRef(Q.m[1],Q.m[5],Q.m[9],g,A);c.e.CrossToRef(A,u,r);A.normalize();r.normalize()}this._depthSort&&c.e.TransformCoordinatesToRef(this._camera.globalPosition,g,B);c.a.IdentityToRef(e);var M=0,G=0,L=0,K=0,S=0,ya=0,I=0;this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0);b=b>=this.nbParticles?this.nbParticles-1:b;if(this._computeBoundingBox&&(0!=a||b!=this.nbParticles-1)){var T=this.mesh._boundingInfo;T&&(v.copyFrom(T.minimum),w.copyFrom(T.maximum))}G=this.particles[a]._pos;
var O=G/3|0;K=4*O;ya=2*O;for(var P=a;P<=b;P++){var C=this.particles[P];this.updateParticle(C);var V=C._model._shape,U=C._model._shapeUV,E=C._rotationMatrix,W=C.position,Y=C.rotation,N=C.scaling,D=C._globalPosition;if(this._depthSort&&this._depthSortParticles){var aa=this.depthSortedParticles[P];aa.idx=C.idx;aa.ind=C._ind;aa.indicesLength=C._model._indicesLength;aa.sqDistance=c.e.DistanceSquared(C.position,B)}if(!C.alive||C._stillInvisible&&!C.isVisible)I=V.length,G+=3*I,K+=4*I,ya+=2*I;else{if(C.isVisible){C._stillInvisible=
!1;var Z=q[12];C.pivot.multiplyToRef(N,Z);this.billboard&&(Y.x=0,Y.y=0);(this._computeParticleRotation||this.billboard)&&C.getRotationMatrix(e);if(null!==C.parentId){var fa=this.getParticleById(C.parentId);if(fa){var J=fa._rotationMatrix,ia=fa._globalPosition,ka=W.x*J[1]+W.y*J[4]+W.z*J[7],la=W.x*J[0]+W.y*J[3]+W.z*J[6],ma=W.x*J[2]+W.y*J[5]+W.z*J[8];D.x=ia.x+la;D.y=ia.y+ka;D.z=ia.z+ma;if(this._computeParticleRotation||this.billboard){var H=e.m;E[0]=H[0]*J[0]+H[1]*J[3]+H[2]*J[6];E[1]=H[0]*J[1]+H[1]*
J[4]+H[2]*J[7];E[2]=H[0]*J[2]+H[1]*J[5]+H[2]*J[8];E[3]=H[4]*J[0]+H[5]*J[3]+H[6]*J[6];E[4]=H[4]*J[1]+H[5]*J[4]+H[6]*J[7];E[5]=H[4]*J[2]+H[5]*J[5]+H[6]*J[8];E[6]=H[8]*J[0]+H[9]*J[3]+H[10]*J[6];E[7]=H[8]*J[1]+H[9]*J[4]+H[10]*J[7];E[8]=H[8]*J[2]+H[9]*J[5]+H[10]*J[8]}}else C.parentId=null}else if(D.x=W.x,D.y=W.y,D.z=W.z,this._computeParticleRotation||this.billboard)H=e.m,E[0]=H[0],E[1]=H[1],E[2]=H[2],E[3]=H[4],E[4]=H[5],E[5]=H[6],E[6]=H[8],E[7]=H[9],E[8]=H[10];var ea=q[11];C.translateFromPivot?ea.setAll(0):
ea.copyFrom(Z);for(I=0;I<V.length;I++){M=G+3*I;L=K+4*I;S=ya+2*I;var ra=2*I,Aa=ra+1;x.copyFrom(V[I]);this._computeParticleColor&&C.color&&wa.copyFrom(C.color);this._computeParticleTexture&&z.copyFromFloats(U[ra],U[Aa]);this._computeParticleVertex&&this.updateParticleVertex(C,y,I);var Na=x.x*N.x-Z.x,Oa=x.y*N.y-Z.y,Pa=x.z*N.z-Z.z;la=Na*E[0]+Oa*E[3]+Pa*E[6];ka=Na*E[1]+Oa*E[4]+Pa*E[7];ma=Na*E[2]+Oa*E[5]+Pa*E[8];la+=ea.x;ka+=ea.y;ma+=ea.z;var sa=k[M]=D.x+r.x*la+A.x*ka+u.x*ma,ta=k[M+1]=D.y+r.y*la+A.y*ka+
u.y*ma,ua=k[M+2]=D.z+r.z*la+A.z*ka+u.z*ma;this._computeBoundingBox&&(v.minimizeInPlaceFromFloats(sa,ta,ua),w.maximizeInPlaceFromFloats(sa,ta,ua));if(!this._computeParticleVertex){var Qa=X[M],Ra=X[M+1],Sa=X[M+2],Ta=Qa*E[0]+Ra*E[3]+Sa*E[6],Ua=Qa*E[1]+Ra*E[4]+Sa*E[7],Va=Qa*E[2]+Ra*E[5]+Sa*E[8];t[M]=r.x*Ta+A.x*Ua+u.x*Va;t[M+1]=r.y*Ta+A.y*Ua+u.y*Va;t[M+2]=r.z*Ta+A.z*Ua+u.z*Va}if(this._computeParticleColor&&C.color){var Ca=this._colors32;Ca[L]=wa.r;Ca[L+1]=wa.g;Ca[L+2]=wa.b;Ca[L+3]=wa.a}if(this._computeParticleTexture){var ba=
C.uvs;l[S]=z.x*(ba.z-ba.x)+ba.x;l[S+1]=z.y*(ba.w-ba.y)+ba.y}}}else for(C._stillInvisible=!0,I=0;I<V.length;I++){M=G+3*I;L=K+4*I;S=ya+2*I;k[M]=k[M+1]=k[M+2]=0;t[M]=t[M+1]=t[M+2]=0;if(this._computeParticleColor&&C.color){var Da=C.color;n[L]=Da.r;n[L+1]=Da.g;n[L+2]=Da.b;n[L+3]=Da.a}this._computeParticleTexture&&(ba=C.uvs,l[S]=U[2*I]*(ba.z-ba.x)+ba.x,l[S+1]=U[2*I+1]*(ba.w-ba.y)+ba.y)}if(this._particlesIntersect){var gb=C._boundingInfo,Ea=gb.boundingBox,Fa=gb.boundingSphere,Wa=C._modelBoundingInfo;if(!this._bSphereOnly){var Xa=
Wa.boundingBox.vectors,Ya=q[1],Za=q[2];Ya.setAll(Number.MAX_VALUE);Za.setAll(-Number.MAX_VALUE);for(var za=0;8>za;za++){var $a=Xa[za].x*N.x,ab=Xa[za].y*N.y,bb=Xa[za].z*N.z;la=$a*E[0]+ab*E[3]+bb*E[6];ka=$a*E[1]+ab*E[4]+bb*E[7];ma=$a*E[2]+ab*E[5]+bb*E[8];var hb=W.x+r.x*la+A.x*ka+u.x*ma,ib=W.y+r.y*la+A.y*ka+u.y*ma,jb=W.z+r.z*la+A.z*ka+u.z*ma;Ya.minimizeInPlaceFromFloats(hb,ib,jb);Za.maximizeInPlaceFromFloats(hb,ib,jb)}Ea.reConstruct(Ya,Za,h._worldMatrix)}var kb=Wa.minimum.multiplyToRef(N,q[1]),lb=Wa.maximum.multiplyToRef(N,
q[2]),mb=lb.addToRef(kb,q[3]).scaleInPlace(.5).addInPlace(D),nb=lb.subtractToRef(kb,q[4]).scaleInPlace(.5*this._bSphereRadiusFactor),Ga=mb.subtractToRef(nb,q[1]),Ha=mb.addToRef(nb,q[2]);Fa.reConstruct(Ga,Ha,h._worldMatrix)}G=M+3;K=L+4;ya=S+2}}if(d){this._computeParticleColor&&h.updateVerticesData(f.b.ColorKind,n,!1,!1);this._computeParticleTexture&&h.updateVerticesData(f.b.UVKind,l,!1,!1);h.updateVerticesData(f.b.PositionKind,k,!1,!1);if(!h.areNormalsFrozen||h.isFacetDataEnabled){if(this._computeParticleVertex||
h.isFacetDataEnabled){var Ia=h.isFacetDataEnabled?h.getFacetDataParameters():null;Ba.a.ComputeNormals(k,m,t,Ia);for(var oa=0;oa<t.length;oa++)X[oa]=t[oa]}h.areNormalsFrozen||h.updateVerticesData(f.b.NormalKind,t,!1,!1)}if(this._depthSort&&this._depthSortParticles){var cb=this.depthSortedParticles;cb.sort(this._depthSortFunction);for(var Ja=cb.length,ob=0,db=0,eb=0;eb<Ja;eb++){var fb=cb[eb],Ka=fb.indicesLength,La=fb.ind;for(oa=0;oa<Ka;oa++)if(m[ob]=p[La+oa],ob++,this._pickable&&0==oa%3){var pb=this.pickedParticles[db];
pb.idx=fb.idx;pb.faceId=db;db++}}h.updateIndices(m)}}this._computeBoundingBox&&(h._boundingInfo?h._boundingInfo.reConstruct(v,w,h._worldMatrix):h._boundingInfo=new pa.a(v,w,h._worldMatrix));this._autoUpdateSubMeshes&&this.computeSubMeshes();this.afterUpdateParticles(a,b,d);return this};a.prototype.dispose=function(){this.mesh.dispose();this._idxOfId=this._indicesByMaterial=this._materialIndexes=this._materials=this.pickedBySubMesh=this.pickedParticles=this._colors32=this._uvs32=this._fixedNormal32=
this._normals32=this._positions32=this._indices32=this._colors=this._uvs=this._normals=this._indices=this._positions=this.vars=null};a.prototype.pickedParticle=function(a){if(a.hit){var b=a.subMeshId;a=a.faceId;var c=this.pickedBySubMesh;if(c[b]&&c[b][a])return c[b][a]}return null};a.prototype.getParticleById=function(a){var b=this.particles[a];if(b&&b.id==a)return b;b=this.particles;var c=this._idxOfId[a];if(void 0!==c)return b[c];c=0;for(var d=this.nbParticles;c<d;){var e=b[c];if(e.id==a)return e;
c++}return null};a.prototype.getParticlesByShapeId=function(a){var b=[];this.getParticlesByShapeIdToRef(a,b);return b};a.prototype.getParticlesByShapeIdToRef=function(a,b){for(var c=b.length=0;c<this.nbParticles;c++){var d=this.particles[c];d.shapeId==a&&b.push(d)}return this};a.prototype.computeSubMeshes=function(){if(!this.mesh||!this._multimaterialEnabled)return this;var a=this.depthSortedParticles;if(0<this.particles.length)for(var b=0;b<this.particles.length;b++){var c=this.particles[b];c.materialIndex||
(c.materialIndex=0);var d=a[b];d.materialIndex=c.materialIndex;d.ind=c._ind;d.indicesLength=c._model._indicesLength;d.idx=c.idx}this._sortParticlesByMaterial();a=this._indicesByMaterial;b=this._materialIndexes;c=this.mesh;c.subMeshes=[];d=c.getTotalVertices();for(var e=0;e<b.length;e++){var f=a[e];new Ka.a(b[e],0,d,f,a[e+1]-f,c)}return this};a.prototype._sortParticlesByMaterial=function(){var a=[0];this._indicesByMaterial=a;var b=[];this._materialIndexes=b;var c=this.depthSortedParticles;c.sort(this._materialSortFunction);
var d=c.length,e=this._indices32,f=this._indices,g=0,h=0,k=0,l=c[0].materialIndex;b.push(l);this._pickable&&(this.pickedBySubMesh=[[]],this.pickedParticles=this.pickedBySubMesh[0]);for(var m=0;m<d;m++){var p=c[m],q=p.indicesLength,r=p.ind;p.materialIndex!==l&&(l=p.materialIndex,a.push(k),b.push(l),this._pickable&&(g++,this.pickedBySubMesh[g]=[],h=0));for(var A=0,u=0;u<q;u++){e[k]=f[r+u];if(this._pickable&&0==u%3){var v=this.pickedBySubMesh[g][h];v?(v.idx=p.idx,v.faceId=A):this.pickedBySubMesh[g][h]=
{idx:p.idx,faceId:A};h++;A++}k++}}a.push(e.length);this._updatable&&this.mesh.updateIndices(e);return this};a.prototype._setMaterialIndexesById=function(){this._materialIndexesById={};for(var a=0;a<this._materials.length;a++)this._materialIndexesById[this._materials[a].uniqueId]=a};a.prototype._filterUniqueMaterialId=function(a){return a.filter(function(a,b,c){return c.indexOf(a)===b})};a.prototype._setDefaultMaterial=function(){this._defaultMaterial||(this._defaultMaterial=new l.a(this.name+"DefaultMaterial",
this._scene));return this._defaultMaterial};a.prototype.refreshVisibleSize=function(){this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo();return this};a.prototype.setVisibilityBox=function(a){a/=2;this.mesh._boundingInfo=new pa.a(new c.e(-a,-a,-a),new c.e(a,a,a))};Object.defineProperty(a.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(a){this._alwaysVisible=a;this.mesh.alwaysSelectAsActiveMesh=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(a){this._isVisibilityBoxLocked=a;this.mesh.getBoundingInfo().isLocked=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(a){this._computeParticleRotation=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(a){this._computeParticleColor=
a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(a){this._computeParticleTexture=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(a){this._computeParticleVertex=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},
set:function(a){this._computeBoundingBox=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(a){this._depthSortParticles=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"expandable",{get:function(){return this._expandable},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"multimaterialEnabled",{get:function(){return this._multimaterialEnabled},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"useModelMaterial",{get:function(){return this._useModelMaterial},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"materials",{get:function(){return this._materials},enumerable:!1,configurable:!0});a.prototype.setMultiMaterial=function(a){this._materials=this._filterUniqueMaterialId(a);this._setMaterialIndexesById();this._multimaterial&&this._multimaterial.dispose();this._multimaterial=new ta.a(this.name+"MultiMaterial",this._scene);for(a=0;a<this._materials.length;a++)this._multimaterial.subMaterials.push(this._materials[a]);
this.computeSubMeshes();this.mesh.material=this._multimaterial};Object.defineProperty(a.prototype,"multimaterial",{get:function(){return this._multimaterial},set:function(a){this._multimaterial=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"autoUpdateSubMeshes",{get:function(){return this._autoUpdateSubMeshes},set:function(a){this._autoUpdateSubMeshes=a},enumerable:!1,configurable:!0});a.prototype.initParticles=function(){};a.prototype.recycleParticle=function(a){return a};
a.prototype.updateParticle=function(a){return a};a.prototype.updateParticleVertex=function(a,b,c){return this};a.prototype.beforeUpdateParticles=function(a,b,c){};a.prototype.afterUpdateParticles=function(a,b,c){};return a})();var Q=g("GR64"),La=function(){function a(a,b,c,d,e){this.idx=0;this.color=new Q.c(1,1,1,1);this.position=Q.j.Zero();this.rotation=Q.j.Zero();this.uv=new Q.i(0,0);this.velocity=Q.j.Zero();this.pivot=Q.j.Zero();this.translateFromPivot=!1;this.idxInGroup=this.groupId=this._ind=
this._pos=0;this._stillInvisible=!1;this._rotationMatrix=[1,0,0,0,1,0,0,0,1];this.parentId=null;this._globalPosition=Q.j.Zero();this.idx=a;this._group=b;this.groupId=c;this.idxInGroup=d;this._pcs=e}Object.defineProperty(a.prototype,"size",{get:function(){return this.size},set:function(a){this.size=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(a){this.rotationQuaternion=a},enumerable:!1,configurable:!0});
a.prototype.intersectsMesh=function(a,b){if(!a._boundingInfo)return!1;if(b&&b)return a.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));b=a.getBoundingInfo().boundingBox.maximumWorld.x;var c=a.getBoundingInfo().boundingBox.minimumWorld.x;var d=a.getBoundingInfo().boundingBox.maximumWorld.y;var e=a.getBoundingInfo().boundingBox.minimumWorld.y;var f=a.getBoundingInfo().boundingBox.maximumWorld.z;a=a.getBoundingInfo().boundingBox.minimumWorld.z;var g=this.position.x+
this._pcs.mesh.position.x,h=this.position.y+this._pcs.mesh.position.y,k=this.position.z+this._pcs.mesh.position.z;return c<=g&&g<=b&&e<=h&&h<=d&&a<=k&&k<=f};a.prototype.getRotationMatrix=function(a){if(this.rotationQuaternion)var b=this.rotationQuaternion;else{b=Q.h.Quaternion[0];var c=this.rotation;Q.f.RotationYawPitchRollToRef(c.y,c.x,c.z,b)}b.toRotationMatrix(a)};return a}(),ra=function(){return function(a,b){this.groupID=a;this._positionFunction=b}}(),ua=g("uyO6"),Ia=g("2/Cc"),Ja=g("WIi2"),Y;
(function(a){a[a.Color=2]="Color";a[a.UV=1]="UV";a[a.Random=0]="Random";a[a.Stated=3]="Stated"})(Y||(Y={}));(function(){function a(a,b,c,d){this.particles=[];this.counter=this.nbParticles=0;this.vars={};this._promises=[];this._positions=[];this._indices=[];this._normals=[];this._colors=[];this._uvs=[];this._updatable=!0;this._alwaysVisible=this._isVisibilityBoxLocked=!1;this._groups=[];this._groupCounter=0;this._computeParticleRotation=this._computeParticleTexture=this._computeParticleColor=!0;this._isReady=
this._computeBoundingBox=!1;this.name=a;this._size=b;this._scene=c||N.a.LastCreatedScene;this._updatable=d&&void 0!==d.updatable?d.updatable:!0}a.prototype.buildMeshAsync=function(){var a=this;return Promise.all(this._promises).then(function(){a._isReady=!0;return a._buildMesh()})};a.prototype._buildMesh=function(){0===this.nbParticles&&this.addPoints(1);this._positions32=new Float32Array(this._positions);this._uvs32=new Float32Array(this._uvs);this._colors32=new Float32Array(this._colors);var a=
new Ba.a;a.set(this._positions32,f.b.PositionKind);0<this._uvs32.length&&a.set(this._uvs32,f.b.UVKind);var b=0;0<this._colors32.length&&(b=1,a.set(this._colors32,f.b.ColorKind));var c=new fa.a(this.name,this._scene);a.applyToMesh(c,this._updatable);this.mesh=c;this._colors=this._uvs=this._positions=null;this._updatable||(this.particles.length=0);a=new l.a("point cloud material",this._scene);a.emissiveColor=new Q.b(b,b,b);a.disableLighting=!0;a.pointsCloud=!0;a.pointSize=this._size;c.material=a;return new Promise(function(a){return a(c)})};
a.prototype._addParticle=function(a,b,c,d){a=new La(a,b,c,d,this);this.particles.push(a);return a};a.prototype._randomUnitVector=function(a){a.position=new c.e(Math.random(),Math.random(),Math.random());a.color=new Q.c(1,1,1,1)};a.prototype._getColorIndicesForCoord=function(a,b,c,d){a=a._groupImageData;b=4*c*d+4*b;b=[b,b+1,b+2,b+3];return new Q.c(a[b[0]]/255,a[b[1]]/255,a[b[2]]/255,a[b[3]])};a.prototype._setPointsColorOrUV=function(a,b,d,g,h,k,l){d&&a.updateFacetData();var n=2*a.getBoundingInfo().boundingSphere.radius,
m=a.getVerticesData(f.b.PositionKind),p=a.getIndices(),t=a.getVerticesData(f.b.UVKind),q=a.getVerticesData(f.b.ColorKind),r=c.e.Zero();a.computeWorldMatrix();var u=a.getWorldMatrix();if(!u.isIdentity())for(var v=0;v<m.length/3;v++)c.e.TransformCoordinatesFromFloatsToRef(m[3*v],m[3*v+1],m[3*v+2],u,r),m[3*v]=r.x,m[3*v+1]=r.y,m[3*v+2]=r.z;u=c.e.Zero();v=c.e.Zero();var R=c.e.Zero(),X=c.e.Zero(),w=c.e.Zero(),x=c.d.Zero(),B=c.d.Zero(),y=c.d.Zero(),A=c.d.Zero(),na=c.d.Zero(),z=c.f.Zero(),F=c.f.Zero(),G=
c.f.Zero(),M=c.f.Zero(),N=c.f.Zero();l=l?l:0;var L=new c.f(0,0,0,0);c.e.Zero();c.e.Zero();c.e.Zero();c.e.Zero();var K=new Ia.a(c.e.Zero(),new c.e(1,0,0));c.e.Zero();for(r=0;r<p.length/3;r++){var S=p[3*r];var D=p[3*r+1];var I=p[3*r+2];var T=m[3*S];var O=m[3*S+1];var P=m[3*S+2];var C=m[3*D];var V=m[3*D+1];var U=m[3*D+2];var E=m[3*I];var W=m[3*I+1];var ja=m[3*I+2];u.set(T,O,P);v.set(C,V,U);R.set(E,W,ja);v.subtractToRef(u,X);R.subtractToRef(v,w);t&&(T=t[2*S],O=t[2*S+1],P=t[2*D],C=t[2*D+1],V=t[2*I],U=
t[2*I+1],x.set(T,O),B.set(P,C),y.set(V,U),B.subtractToRef(x,A),y.subtractToRef(B,na));q&&g&&(T=q[4*S],O=q[4*S+1],P=q[4*S+2],S=q[4*S+3],C=q[4*D],V=q[4*D+1],U=q[4*D+2],D=q[4*D+3],E=q[4*I],W=q[4*I+1],ja=q[4*I+2],I=q[4*I+3],z.set(T,O,P,S),F.set(C,V,U,D),G.set(E,W,ja,I),F.subtractToRef(z,M),G.subtractToRef(F,N));I=new Q.b(0,0,0);D=new Q.b(0,0,0);for(S=0;S<b._groupDensity[r];S++)T=this.particles.length,this._addParticle(T,b,this._groupCounter,r+S),T=this.particles[T],O=e.a.RandomRange(0,1),P=e.a.RandomRange(0,
1),C=u.add(X.scale(O)).add(w.scale(O*P)),d&&(V=a.getFacetNormal(r).normalize().scale(-1),E=X.clone().normalize(),W=c.e.Cross(V,E),U=e.a.RandomRange(0,2*Math.PI),E=E.scale(Math.cos(U)).add(W.scale(Math.sin(U))),U=e.a.RandomRange(.1,Math.PI/2),V=E.scale(Math.cos(U)).add(V.scale(Math.sin(U))),K.origin=C.add(V.scale(1E-5)),K.direction=V,K.length=n,U=K.intersectsMesh(a),U.hit&&(U=U.pickedPoint.subtract(C).length(),U*=e.a.RandomRange(0,1),C.addInPlace(V.scale(U)))),T.position=C.clone(),this._positions.push(T.position.x,
T.position.y,T.position.z),void 0!==g?t&&(C=x.add(A.scale(O)).add(na.scale(O*P)),g?h&&null!==b._groupImageData?(O=b._groupImgWidth,P=b._groupImgHeight,O=this._getColorIndicesForCoord(b,Math.round(C.x*O),Math.round(C.y*P),O),T.color=O,this._colors.push(O.r,O.g,O.b,O.a)):(L=q?z.add(M.scale(O)).add(N.scale(O*P)):z.set(Math.random(),Math.random(),Math.random(),1),T.color=new Q.c(L.x,L.y,L.z,L.w),this._colors.push(L.x,L.y,L.z,L.w)):(T.uv=C.clone(),this._uvs.push(T.uv.x,T.uv.y))):(k?(I.set(k.r,k.g,k.b),
C=e.a.RandomRange(-l,l),P=e.a.RandomRange(-l,l),V=I.toHSV(),O=V.r,C=V.g+C,P=V.b+P,0>C&&(C=0),1<C&&(C=1),0>P&&(P=0),1<P&&(P=1),Q.b.HSVtoRGBToRef(O,C,P,D),L.set(D.r,D.g,D.b,1)):L=z.set(Math.random(),Math.random(),Math.random(),1),T.color=new Q.c(L.x,L.y,L.z,L.w),this._colors.push(L.x,L.y,L.z,L.w))}};a.prototype._colorFromTexture=function(a,b,c){var d=this;if(null===a.material)ua.a.Warn(a.name+"has no material."),b._groupImageData=null,this._setPointsColorOrUV(a,b,c,!0,!1);else{var e=a.material.getActiveTextures();
if(0===e.length)ua.a.Warn(a.name+"has no useable texture."),b._groupImageData=null,this._setPointsColorOrUV(a,b,c,!0,!1);else{var f=a.clone();f.setEnabled(!1);this._promises.push(new Promise(function(a){Ja.a.WhenAllReady(e,function(){var g=b._textureNb;0>g&&(g=0);g>e.length-1&&(g=e.length-1);b._groupImageData=e[g].readPixels();b._groupImgWidth=e[g].getSize().width;b._groupImgHeight=e[g].getSize().height;d._setPointsColorOrUV(f,b,c,!0,!0);f.dispose();return a()})}))}}};a.prototype._calculateDensity=
function(a,b,d){var e=[],f,g=c.e.Zero(),h=c.e.Zero(),k=c.e.Zero(),n=c.e.Zero(),l=c.e.Zero(),m=c.e.Zero(),p=[],q=0,r=d.length/3;for(f=0;f<r;f++){var t=d[3*f];var u=d[3*f+1];var v=d[3*f+2];var w=b[3*t];var x=b[3*t+1];t=b[3*t+2];var X=b[3*u];var y=b[3*u+1];u=b[3*u+2];var A=b[3*v];var D=b[3*v+1];v=b[3*v+2];g.set(w,x,t);h.set(X,y,u);k.set(A,D,v);h.subtractToRef(g,n);k.subtractToRef(h,l);k.subtractToRef(g,m);w=n.length();x=l.length();v=m.length();t=(w+x+v)/2;w=Math.sqrt(t*(t-w)*(t-x)*(t-v));q+=w;p[f]=w}for(f=
b=0;f<r;f++)e[f]=Math.floor(a*p[f]/q),b+=e[f];f=a-b;var z=Math.floor(f/r);r=f%r;0<z&&(e=e.map(function(a){return a+z}));for(f=0;f<r;f++)e[f]+=1;return e};a.prototype.addPoints=function(a,b){void 0===b&&(b=this._randomUnitVector);b=new ra(this._groupCounter,b);for(var c,d=this.nbParticles,e=0;e<a;e++)c=this._addParticle(d,b,this._groupCounter,e),b&&b._positionFunction&&b._positionFunction(c,d,e),this._positions.push(c.position.x,c.position.y,c.position.z),c.color&&this._colors.push(c.color.r,c.color.g,
c.color.b,c.color.a),c.uv&&this._uvs.push(c.uv.x,c.uv.y),d++;this.nbParticles+=a;this._groupCounter++;return this._groupCounter};a.prototype.addSurfacePoints=function(a,b,c,d,e){c=c?c:Y.Random;if(isNaN(c)||0>c||3<c)c=Y.Random;var g=a.getVerticesData(f.b.PositionKind),h=a.getIndices();this._groups.push(this._groupCounter);var k=new ra(this._groupCounter,null);k._groupDensity=this._calculateDensity(b,g,h);c===Y.Color?k._textureNb=d?d:0:d=d?d:new Q.c(1,1,1,1);switch(c){case Y.Color:this._colorFromTexture(a,
k,!1);break;case Y.UV:this._setPointsColorOrUV(a,k,!1,!1,!1);break;case Y.Random:this._setPointsColorOrUV(a,k,!1);break;case Y.Stated:this._setPointsColorOrUV(a,k,!1,void 0,void 0,d,e)}this.nbParticles+=b;this._groupCounter++;return this._groupCounter-1};a.prototype.addVolumePoints=function(a,b,c,d,e){c=c?c:Y.Random;if(isNaN(c)||0>c||3<c)c=Y.Random;var g=a.getVerticesData(f.b.PositionKind),h=a.getIndices();this._groups.push(this._groupCounter);var k=new ra(this._groupCounter,null);k._groupDensity=
this._calculateDensity(b,g,h);c===Y.Color?k._textureNb=d?d:0:d=d?d:new Q.c(1,1,1,1);switch(c){case Y.Color:this._colorFromTexture(a,k,!0);break;case Y.UV:this._setPointsColorOrUV(a,k,!0,!1,!1);break;case Y.Random:this._setPointsColorOrUV(a,k,!0);break;case Y.Stated:this._setPointsColorOrUV(a,k,!0,void 0,void 0,d,e)}this.nbParticles+=b;this._groupCounter++;return this._groupCounter-1};a.prototype.setParticles=function(a,b,d){void 0===a&&(a=0);void 0===b&&(b=this.nbParticles-1);void 0===d&&(d=!0);if(!this._updatable||
!this._isReady)return this;this.beforeUpdateParticles(a,b,d);var e=c.c.Matrix[0],g=this.mesh,h=this._colors32,k=this._positions32,l=this._uvs32,n=c.c.Vector3,m=n[5].copyFromFloats(1,0,0),p=n[6].copyFromFloats(0,1,0),q=n[7].copyFromFloats(0,0,1),r=n[8].setAll(Number.MAX_VALUE),u=n[9].setAll(-Number.MAX_VALUE);c.a.IdentityToRef(e);this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0);b=b>=this.nbParticles?this.nbParticles-1:b;if(this._computeBoundingBox&&(0!=a||b!=this.nbParticles-1)){var v=this.mesh._boundingInfo;
v&&(r.copyFrom(v.minimum),u.copyFrom(v.maximum))}for(v=a;v<=b;v++){var t=this.particles[v];var w=t.idx;var x=3*w;var A=4*w;w*=2;this.updateParticle(t);var B=t._rotationMatrix,y=t.position,D=t._globalPosition;this._computeParticleRotation&&t.getRotationMatrix(e);if(null!==t.parentId){var F=this.particles[t.parentId],z=F._rotationMatrix;F=F._globalPosition;var G=y.x*z[1]+y.y*z[4]+y.z*z[7],K=y.x*z[2]+y.y*z[5]+y.z*z[8];D.x=F.x+(y.x*z[0]+y.y*z[3]+y.z*z[6]);D.y=F.y+G;D.z=F.z+K;this._computeParticleRotation&&
(y=e.m,B[0]=y[0]*z[0]+y[1]*z[3]+y[2]*z[6],B[1]=y[0]*z[1]+y[1]*z[4]+y[2]*z[7],B[2]=y[0]*z[2]+y[1]*z[5]+y[2]*z[8],B[3]=y[4]*z[0]+y[5]*z[3]+y[6]*z[6],B[4]=y[4]*z[1]+y[5]*z[4]+y[6]*z[7],B[5]=y[4]*z[2]+y[5]*z[5]+y[6]*z[8],B[6]=y[8]*z[0]+y[9]*z[3]+y[10]*z[6],B[7]=y[8]*z[1]+y[9]*z[4]+y[10]*z[7],B[8]=y[8]*z[2]+y[9]*z[5]+y[10]*z[8])}else D.x=0,D.y=0,D.z=0,this._computeParticleRotation&&(y=e.m,B[0]=y[0],B[1]=y[1],B[2]=y[2],B[3]=y[4],B[4]=y[5],B[5]=y[6],B[6]=y[8],B[7]=y[9],B[8]=y[10]);F=n[11];t.translateFromPivot?
F.setAll(0):F.copyFrom(t.pivot);z=n[0];z.copyFrom(t.position);G=z.x-t.pivot.x;K=z.y-t.pivot.y;var M=z.z-t.pivot.z;z=G*B[0]+K*B[3]+M*B[6];y=G*B[1]+K*B[4]+M*B[7];B=G*B[2]+K*B[5]+M*B[8];z+=F.x;y+=F.y;B+=F.z;F=k[x]=D.x+m.x*z+p.x*y+q.x*B;G=k[x+1]=D.y+m.y*z+p.y*y+q.y*B;x=k[x+2]=D.z+m.z*z+p.z*y+q.z*B;this._computeBoundingBox&&(r.minimizeInPlaceFromFloats(F,G,x),u.maximizeInPlaceFromFloats(F,G,x));this._computeParticleColor&&t.color&&(x=t.color,D=this._colors32,D[A]=x.r,D[A+1]=x.g,D[A+2]=x.b,D[A+3]=x.a);
this._computeParticleTexture&&t.uv&&(A=t.uv,t=this._uvs32,t[w]=A.x,t[w+1]=A.y)}d&&(this._computeParticleColor&&g.updateVerticesData(f.b.ColorKind,h,!1,!1),this._computeParticleTexture&&g.updateVerticesData(f.b.UVKind,l,!1,!1),g.updateVerticesData(f.b.PositionKind,k,!1,!1));this._computeBoundingBox&&(g._boundingInfo?g._boundingInfo.reConstruct(r,u,g._worldMatrix):g._boundingInfo=new pa.a(r,u,g._worldMatrix));this.afterUpdateParticles(a,b,d);return this};a.prototype.dispose=function(){this.mesh.dispose();
this._colors32=this._uvs32=this._positions32=this._indices32=this._colors=this._uvs=this._normals=this._indices=this._positions=this.vars=null};a.prototype.refreshVisibleSize=function(){this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo();return this};a.prototype.setVisibilityBox=function(a){a/=2;this.mesh._boundingInfo=new pa.a(new c.e(-a,-a,-a),new c.e(a,a,a))};Object.defineProperty(a.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(a){this._alwaysVisible=
a;this.mesh.alwaysSelectAsActiveMesh=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"computeParticleRotation",{set:function(a){this._computeParticleRotation=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(a){this._computeParticleColor=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},
set:function(a){this._computeParticleTexture=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(a){this._computeBoundingBox=a},enumerable:!1,configurable:!0});a.prototype.initParticles=function(){};a.prototype.recycleParticle=function(a){return a};a.prototype.updateParticle=function(a){return a};a.prototype.beforeUpdateParticles=function(a,b,c){};a.prototype.afterUpdateParticles=function(a,b,c){};
return a})();g("gmvZ")}}]);
