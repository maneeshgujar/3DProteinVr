(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"0Mre":function(u,v,b){u=b("tVVT");var l=b("y4Ty");v=b("ikaq");var t=b("UtUh"),p=b("/SR9"),g=b("Bfey"),c=b("Yap0"),f=b("cdI9"),m=b("NDL1");b("HZbn");b("go3B");b("c403");var x=b("Xeau"),h=b("ps+7");Object.defineProperty(u.a.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(k){(this._forceShowBoundingBoxes=k)&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0});u.a.prototype.getBoundingBoxRenderer=
function(){this._boundingBoxRenderer||(this._boundingBoxRenderer=new r(this));return this._boundingBoxRenderer};Object.defineProperty(v.a.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(k){(this._showBoundingBox=k)&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var r=function(){function k(e){this.name=c.a.NAME_BOUNDINGBOXRENDERER;this.frontColor=new x.a(1,1,1);this.backColor=new x.a(.1,.1,.1);this.showBackLines=!0;this.onBeforeBoxRenderingObservable=
new h.a;this.onAfterBoxRenderingObservable=new h.a;this.onResourcesReadyObservable=new h.a;this.enabled=!0;this.renderList=new g.a(32);this._vertexBuffers={};this._fillIndexData=this._fillIndexBuffer=null;this.scene=e;e._addComponent(this)}k.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(c.a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset);this.scene._preActiveMeshStage.registerStep(c.a.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER,this,this._preActiveMesh);
this.scene._evaluateSubMeshStage.registerStep(c.a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh);this.scene._afterRenderingGroupDrawStage.registerStep(c.a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)};k.prototype._evaluateSubMesh=function(e,q){e.showSubMeshesBoundingBox&&(q=q.getBoundingInfo(),null!==q&&void 0!==q&&(q.boundingBox._tag=e.renderingGroupId,this.renderList.push(q.boundingBox)))};k.prototype._preActiveMesh=function(e){if(e.showBoundingBox||this.scene.forceShowBoundingBoxes){var q=
e.getBoundingInfo();q.boundingBox._tag=e.renderingGroupId;this.renderList.push(q.boundingBox)}};k.prototype._prepareResources=function(){if(!this._colorShader){this._colorShader=new m.a("colorShader",this.scene,"color",{attributes:[l.b.PositionKind],uniforms:["world","viewProjection","color"]});this._colorShader.reservedDataStore={hidden:!0};var e=this.scene.getEngine(),q=t.a.CreateBox({size:1});this._vertexBuffers[l.b.PositionKind]=new l.b(e,q.positions,l.b.PositionKind,!1);this._createIndexBuffer();
this._fillIndexData=q.indices;this.onResourcesReadyObservable.notifyObservers(this)}};k.prototype._createIndexBuffer=function(){this._indexBuffer=this.scene.getEngine().createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])};k.prototype.rebuild=function(){var e=this._vertexBuffers[l.b.PositionKind];e&&e._rebuild();this._createIndexBuffer()};k.prototype.reset=function(){this.renderList.reset()};k.prototype.render=function(e){if(0!==this.renderList.length&&this.enabled&&(this._prepareResources(),
this._colorShader.isReady())){var q=this.scene.getEngine();q.setDepthWrite(!1);this._colorShader._preBind();for(var k=0;k<this.renderList.length;k++){var a=this.renderList.data[k];if(a._tag===e){this.onBeforeBoxRenderingObservable.notifyObservers(a);var c=a.minimum,d=a.maximum.subtract(c);c=c.add(d.scale(.5));d=p.a.Scaling(d.x,d.y,d.z).multiply(p.a.Translation(c.x,c.y,c.z)).multiply(a.getWorldMatrix());q.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect());this.showBackLines&&
(q.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(d),q.drawElementsType(f.a.LineListDrawMode,0,24));q.setDepthFunctionToLess();this.scene.resetCachedMaterial();this._colorShader.setColor4("color",this.frontColor.toColor4());this._colorShader.bind(d);q.drawElementsType(f.a.LineListDrawMode,0,24);this.onAfterBoxRenderingObservable.notifyObservers(a)}}this._colorShader.unbind();q.setDepthFunctionToLessOrEqual();
q.setDepthWrite(!0)}};k.prototype.renderOcclusionBoundingBox=function(e){this._prepareResources();if(this._colorShader.isReady()&&e._boundingInfo){var q=this.scene.getEngine();this._fillIndexBuffer||(this._fillIndexBuffer=q.createIndexBuffer(this._fillIndexData));q.setDepthWrite(!1);q.setColorWrite(!1);this._colorShader._preBind();e=e._boundingInfo.boundingBox;var k=e.minimum,a=e.maximum.subtract(k);k=k.add(a.scale(.5));e=p.a.Scaling(a.x,a.y,a.z).multiply(p.a.Translation(k.x,k.y,k.z)).multiply(e.getWorldMatrix());
q.bindBuffers(this._vertexBuffers,this._fillIndexBuffer,this._colorShader.getEffect());q.setDepthFunctionToLess();this.scene.resetCachedMaterial();this._colorShader.bind(e);q.drawElementsType(f.a.TriangleFillMode,0,36);this._colorShader.unbind();q.setDepthFunctionToLessOrEqual();q.setDepthWrite(!0);q.setColorWrite(!0)}};k.prototype.dispose=function(){if(this._colorShader){this.onBeforeBoxRenderingObservable.clear();this.onAfterBoxRenderingObservable.clear();this.onResourcesReadyObservable.clear();
this.renderList.dispose();this._colorShader.dispose();var e=this._vertexBuffers[l.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[l.b.PositionKind]=null);this.scene.getEngine()._releaseBuffer(this._indexBuffer);this._fillIndexBuffer&&(this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer),this._fillIndexBuffer=null)}};return k}(),w=b("kJhO");u.a.prototype.enableDepthRenderer=function(k,e,q){void 0===e&&(e=!1);void 0===q&&(q=!1);k=k||this.activeCamera;if(!k)throw"No camera available to enable depth renderer";
this._depthRenderer||(this._depthRenderer={});if(!this._depthRenderer[k.id]){var a=!!this.getEngine().getCaps().textureFloatRender;q=!this.getEngine().getCaps().textureHalfFloatRender||q&&a?a?1:0:2;this._depthRenderer[k.id]=new w.a(this,q,k,e)}return this._depthRenderer[k.id]};u.a.prototype.disableDepthRenderer=function(a){(a=a||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[a.id]&&(this._depthRenderer[a.id].dispose(),delete this._depthRenderer[a.id])};var d=function(){function a(e){this.name=
c.a.NAME_DEPTHRENDERER;this.scene=e}a.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(c.a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets);this.scene._gatherActiveCameraRenderTargetsStage.registerStep(c.a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)};a.prototype.rebuild=function(){};a.prototype.dispose=function(){for(var e in this.scene._depthRenderer)this.scene._depthRenderer[e].dispose()};a.prototype._gatherRenderTargets=
function(e){if(this.scene._depthRenderer)for(var q in this.scene._depthRenderer){var a=this.scene._depthRenderer[q];a.enabled&&!a.useOnlyInActiveCamera&&e.push(a.getDepthMap())}};a.prototype._gatherActiveCameraRenderTargets=function(e){if(this.scene._depthRenderer)for(var q in this.scene._depthRenderer){var a=this.scene._depthRenderer[q];a.enabled&&a.useOnlyInActiveCamera&&this.scene.activeCamera.id===q&&e.push(a.getDepthMap())}};return a}();w.a._SceneComponentInitialization=function(a){var e=a._getComponent(c.a.NAME_DEPTHRENDERER);
e||(e=new d(a),a._addComponent(e))};var a=b("oYeq"),n=b("CFrw"),B=b("CAkI");b("oaOt");b("o0gj");var M=b("YKqZ");v.a.prototype.disableEdgesRendering=function(){this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null);return this};v.a.prototype.enableEdgesRendering=function(a,e,q){void 0===a&&(a=.95);void 0===e&&(e=!1);this.disableEdgesRendering();this._edgesRenderer=new A(this,a,e,!0,q);return this};Object.defineProperty(v.a.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},
enumerable:!0,configurable:!0});n.b.prototype.enableEdgesRendering=function(a,e){void 0===a&&(a=.95);void 0===e&&(e=!1);this.disableEdgesRendering();this._edgesRenderer=new F(this,a,e);return this};n.a.prototype.enableEdgesRendering=function(a,e){void 0===a&&(a=.95);void 0===e&&(e=!1);n.b.prototype.enableEdgesRendering.apply(this,arguments);return this};var G=function(){return function(){this.edges=[];this.edgesConnectedCount=0}}(),A=function(){function a(e,a,c,k,d){var q=this;void 0===a&&(a=.95);
void 0===c&&(c=!1);void 0===k&&(k=!0);var z;this.edgesWidthScalerForOrthographic=1E3;this.edgesWidthScalerForPerspective=50;this._linesPositions=[];this._linesNormals=[];this._linesIndices=[];this._buffers={};this._buffersForInstances={};this._checkVerticesInsteadOfIndices=!1;this.isEnabled=!0;this.customInstances=new g.a(32);this._source=e;this._checkVerticesInsteadOfIndices=c;this._options=null!==d&&void 0!==d?d:null;this._epsilon=a;this._prepareRessources();k&&((null!==(z=null===d||void 0===d?
void 0:d.useAlternateEdgeFinder)&&void 0!==z?z:1)?this._generateEdgesLinesAlternate():this._generateEdgesLines());this._meshRebuildObserver=this._source.onRebuildObservable.add(function(){q._rebuild()});this._meshDisposeObserver=this._source.onDisposeObservable.add(function(){q.dispose()})}Object.defineProperty(a.prototype,"linesPositions",{get:function(){return this._linesPositions},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"linesNormals",{get:function(){return this._linesNormals},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"linesIndices",{get:function(){return this._linesIndices},enumerable:!1,configurable:!0});a.GetShader=function(e){if(!e._edgeRenderLineShader){var a=new m.a("lineShader",e,"line",{attributes:["position","normal"],uniforms:["world","viewProjection","color","width","aspectRatio"]});a.disableDepthWrite=!0;a.backFaceCulling=!1;e._edgeRenderLineShader=a}return e._edgeRenderLineShader};a.prototype._prepareRessources=function(){this._lineShader||
(this._lineShader=a.GetShader(this._source.getScene()))};a.prototype._rebuild=function(){var e=this._buffers[l.b.PositionKind];e&&e._rebuild();(e=this._buffers[l.b.NormalKind])&&e._rebuild();this._ib=this._source.getScene().getEngine().createIndexBuffer(this._linesIndices)};a.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver);this._source.onDisposeObservable.remove(this._meshDisposeObserver);var e=this._buffers[l.b.PositionKind];e&&(e.dispose(),this._buffers[l.b.PositionKind]=
null);if(e=this._buffers[l.b.NormalKind])e.dispose(),this._buffers[l.b.NormalKind]=null;this._ib&&this._source.getScene().getEngine()._releaseBuffer(this._ib);this._lineShader.dispose()};a.prototype._processEdgeForAdjacencies=function(e,a,c,k,d){return e===c&&a===k||e===k&&a===c?0:e===k&&a===d||e===d&&a===k?1:e===d&&a===c||e===c&&a===d?2:-1};a.prototype._processEdgeForAdjacenciesWithVertices=function(e,a,c,k,d){return e.equalsWithEpsilon(c,1E-10)&&a.equalsWithEpsilon(k,1E-10)||e.equalsWithEpsilon(k,
1E-10)&&a.equalsWithEpsilon(c,1E-10)?0:e.equalsWithEpsilon(k,1E-10)&&a.equalsWithEpsilon(d,1E-10)||e.equalsWithEpsilon(d,1E-10)&&a.equalsWithEpsilon(k,1E-10)?1:e.equalsWithEpsilon(d,1E-10)&&a.equalsWithEpsilon(c,1E-10)||e.equalsWithEpsilon(c,1E-10)&&a.equalsWithEpsilon(d,1E-10)?2:-1};a.prototype._checkEdge=function(e,a,c,k,d){(void 0===a||p.e.Dot(c[e],c[a])<this._epsilon)&&this.createLine(k,d,this._linesPositions.length/3)};a.prototype.createLine=function(e,a,c){this._linesPositions.push(e.x,e.y,
e.z,e.x,e.y,e.z,a.x,a.y,a.z,a.x,a.y,a.z);this._linesNormals.push(a.x,a.y,a.z,-1,a.x,a.y,a.z,1,e.x,e.y,e.z,-1,e.x,e.y,e.z,1);this._linesIndices.push(c,c+1,c+2,c,c+2,c+3)};a.prototype._tessellateTriangle=function(e,a,c,k){var q=function(e,a,c){0<=c&&a.push(c);for(c=0;c<e.length;++c)a.push(e[c][0])},d=0;e[1].length>=e[0].length&&e[1].length>=e[2].length?d=1:e[2].length>=e[0].length&&e[2].length>=e[1].length&&(d=2);for(var f=0;3>f;++f)f===d?e[f].sort(function(e,a){return e[1]<a[1]?-1:e[1]>a[1]?1:0}):
e[f].sort(function(e,a){return e[1]>a[1]?-1:e[1]<a[1]?1:0});f=[];var z=[];q(e[d],f,-1);for(var b=f.length,y=d+2;y>=d+1;--y)q(e[y%3],z,y!==d+2?k[c[a+(y+1)%3]]:-1);y=z.length;c.push(k[c[a+d]],f[0],z[0]);c.push(k[c[a+(d+1)%3]],z[y-1],f[b-1]);var g=b<=y;k=g?b:y;d=g?y:b;e=g?b-1:y-1;q=g?0:1;b=b+y-2;var m=y=0,l=g?f:z;f=g?z:f;for(z=0;0<b--;)q?c.push(l[y],f[m]):c.push(f[m],l[y]),z+=k,g=void 0,z>=d&&y<e?(g=l[++y],z-=d):g=f[++m],c.push(g);c[a+0]=c[c.length-3];c[a+1]=c[c.length-2];c[a+2]=c[c.length-1];c.length-=
3};a.prototype._generateEdgesLinesAlternate=function(){var e,a,c,d,k,f,b,g,m,h=this._source.getVerticesData(l.b.PositionKind),r=this._source.getIndices();if(r&&h){Array.isArray(r)||(r=M.b.SliceToArray(r));var n=null!==(a=null===(e=this._options)||void 0===e?void 0:e.useFastVertexMerger)&&void 0!==a?a:!0;e=n?Math.round(-Math.log(null!==(d=null===(c=this._options)||void 0===c?void 0:c.epsilonVertexMerge)&&void 0!==d?d:1E-6)/Math.log(10)):null!==(f=null===(k=this._options)||void 0===k?void 0:k.epsilonVertexMerge)&&
void 0!==f?f:1E-6;c=[];d=[];if(n){var x={};for(n=0;n<h.length;n+=3){k=h[n+0];f=h[n+1];a=h[n+2];var w=k.toFixed(e)+"|"+f.toFixed(e)+"|"+a.toFixed(e);void 0!==x[w]?c.push(x[w]):(k=n/3,x[w]=k,c.push(k),d.push(k))}}else for(n=0;n<h.length;n+=3){k=h[n+0];f=h[n+1];a=h[n+2];x=!1;for(var A=0;A<n&&!x;A+=3){var B=h[A+1],D=h[A+2];if(Math.abs(k-h[A+0])<e&&Math.abs(f-B)<e&&Math.abs(a-D)<e){c.push(A/3);x=!0;break}}x||(c.push(n/3),d.push(n/3))}if(null===(b=this._options)||void 0===b?0:b.applyTessellation){n=null!==
(m=null===(g=this._options)||void 0===g?void 0:g.epsilonVertexAligned)&&void 0!==m?m:1E-6;k=[];for(g=0;g<r.length;g+=3)for(a=void 0,m=0;3>m;++m)if(b=c[r[g+m]],e=c[r[g+(m+1)%3]],f=c[r[g+(m+2)%3]],b!==e){x=h[3*b];A=h[3*b+1];B=h[3*b+2];D=h[3*e];for(var F=h[3*e+1],G=h[3*e+2],t=Math.sqrt((D-x)*(D-x)+(F-A)*(F-A)+(G-B)*(G-B)),H=0;H<d.length-1;H++){var u=d[H];if(u!==b&&u!==e&&u!==f){var v=h[3*u],C=h[3*u+1],E=h[3*u+2],I=Math.sqrt((v-x)*(v-x)+(C-A)*(C-A)+(E-B)*(E-B));Math.abs(I+Math.sqrt((v-D)*(v-D)+(C-F)*
(C-F)+(E-G)*(E-G))-t)<n&&(a||(a={index:g,edgesPoints:[[],[],[]]},k.push(a)),a.edgesPoints[m].push([u,I]))}}}for(d=0;d<k.length;++d)g=k[d],this._tessellateTriangle(g.edgesPoints,g.index,r,c)}d={};for(g=0;g<r.length;g+=3)for(n=void 0,m=0;3>m;++m)b=c[r[g+m]],e=c[r[g+(m+1)%3]],f=c[r[g+(m+2)%3]],b!==e&&(p.c.Vector3[0].copyFromFloats(h[3*b],h[3*b+1],h[3*b+2]),p.c.Vector3[1].copyFromFloats(h[3*e],h[3*e+1],h[3*e+2]),p.c.Vector3[2].copyFromFloats(h[3*f],h[3*f+1],h[3*f+2]),n||(p.c.Vector3[1].subtractToRef(p.c.Vector3[0],
p.c.Vector3[3]),p.c.Vector3[2].subtractToRef(p.c.Vector3[1],p.c.Vector3[4]),n=p.e.Cross(p.c.Vector3[3],p.c.Vector3[4]),n.normalize()),b>e&&(w=b,b=e,e=w),w=b+"_"+e,(e=d[w])?e.done||(p.e.Dot(n,e.normal)<this._epsilon&&this.createLine(p.c.Vector3[0],p.c.Vector3[1],this._linesPositions.length/3),e.done=!0):d[w]={normal:n,done:!1,index:g,i:m});for(w in d)e=d[w],e.done||(b=c[r[e.index+e.i]],e=c[r[e.index+(e.i+1)%3]],p.c.Vector3[0].copyFromFloats(h[3*b],h[3*b+1],h[3*b+2]),p.c.Vector3[1].copyFromFloats(h[3*
e],h[3*e+1],h[3*e+2]),this.createLine(p.c.Vector3[0],p.c.Vector3[1],this._linesPositions.length/3));h=this._source.getScene().getEngine();this._buffers[l.b.PositionKind]=new l.b(h,this._linesPositions,l.b.PositionKind,!1);this._buffers[l.b.NormalKind]=new l.b(h,this._linesNormals,l.b.NormalKind,!1,!1,4);this._buffersForInstances[l.b.PositionKind]=this._buffers[l.b.PositionKind];this._buffersForInstances[l.b.NormalKind]=this._buffers[l.b.NormalKind];this._ib=h.createIndexBuffer(this._linesIndices);
this._indicesCount=this._linesIndices.length}};a.prototype._generateEdgesLines=function(){var e=this._source.getVerticesData(l.b.PositionKind),a=this._source.getIndices();if(a&&e){var c=[],d=[],k;for(k=0;k<a.length;k+=3){var f=new G;var b=a[k],g=a[k+1],h=a[k+2];f.p0=new p.e(e[3*b],e[3*b+1],e[3*b+2]);f.p1=new p.e(e[3*g],e[3*g+1],e[3*g+2]);f.p2=new p.e(e[3*h],e[3*h+1],e[3*h+2]);b=p.e.Cross(f.p1.subtract(f.p0),f.p2.subtract(f.p1));b.normalize();d.push(b);c.push(f)}for(k=0;k<c.length;k++)for(f=c[k],e=
k+1;e<c.length;e++){b=c[e];if(3===f.edgesConnectedCount)break;if(3!==b.edgesConnectedCount){g=a[3*e];h=a[3*e+1];for(var m=a[3*e+2],n=0;3>n;n++){var r=0;if(void 0===f.edges[n]){switch(n){case 0:r=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(f.p0,f.p1,b.p0,b.p1,b.p2):this._processEdgeForAdjacencies(a[3*k],a[3*k+1],g,h,m);break;case 1:r=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(f.p1,f.p2,b.p0,b.p1,b.p2):this._processEdgeForAdjacencies(a[3*
k+1],a[3*k+2],g,h,m);break;case 2:r=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(f.p2,f.p0,b.p0,b.p1,b.p2):this._processEdgeForAdjacencies(a[3*k+2],a[3*k],g,h,m)}if(-1!==r&&(f.edges[n]=e,b.edges[r]=k,f.edgesConnectedCount++,b.edgesConnectedCount++,3===f.edgesConnectedCount))break}}}}for(k=0;k<c.length;k++)a=c[k],this._checkEdge(k,a.edges[0],d,a.p0,a.p1),this._checkEdge(k,a.edges[1],d,a.p1,a.p2),this._checkEdge(k,a.edges[2],d,a.p2,a.p0);c=this._source.getScene().getEngine();
this._buffers[l.b.PositionKind]=new l.b(c,this._linesPositions,l.b.PositionKind,!1);this._buffers[l.b.NormalKind]=new l.b(c,this._linesNormals,l.b.NormalKind,!1,!1,4);this._buffersForInstances[l.b.PositionKind]=this._buffers[l.b.PositionKind];this._buffersForInstances[l.b.NormalKind]=this._buffers[l.b.NormalKind];this._ib=c.createIndexBuffer(this._linesIndices);this._indicesCount=this._linesIndices.length}};a.prototype.isReady=function(){return this._lineShader.isReady(this._source,this._source.hasInstances&&
0<this.customInstances.length||this._source.hasThinInstances)};a.prototype.render=function(){var e=this._source.getScene();if(this.isReady()&&e.activeCamera){var a=e.getEngine();this._lineShader._preBind();1!==this._source.edgesColor.a?a.setAlphaMode(2):a.setAlphaMode(0);var c=this._source.hasInstances&&0<this.customInstances.length,k=c||this._source.hasThinInstances,d=0;if(k)if(this._buffersForInstances.world0=this._source.getVertexBuffer("world0"),this._buffersForInstances.world1=this._source.getVertexBuffer("world1"),
this._buffersForInstances.world2=this._source.getVertexBuffer("world2"),this._buffersForInstances.world3=this._source.getVertexBuffer("world3"),c){if(c=this._source._instanceDataStorage,d=this.customInstances.length,!c.isFrozen){for(var b=0,g=0;g<d;++g)this.customInstances.data[g].copyToArray(c.instancesData,b),b+=16;c.instancesBuffer.updateDirectly(c.instancesData,0,d)}}else d=this._source.thinInstanceCount;a.bindBuffers(k?this._buffersForInstances:this._buffers,this._ib,this._lineShader.getEffect());
e.resetCachedMaterial();this._lineShader.setColor4("color",this._source.edgesColor);e.activeCamera.mode===B.a.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective);this._lineShader.setFloat("aspectRatio",a.getAspectRatio(e.activeCamera));this._lineShader.bind(this._source.getWorldMatrix());a.drawElementsType(f.a.TriangleFillMode,0,this._indicesCount,
d);this._lineShader.unbind();k&&a.unbindInstanceAttributes();this._source.getScene()._activeMeshesFrozen||this.customInstances.reset()}};return a}(),F=function(c){function e(e,a,k){void 0===a&&(a=.95);void 0===k&&(k=!1);e=c.call(this,e,a,k,!1)||this;e._generateEdgesLines();return e}Object(a.d)(e,c);e.prototype._generateEdgesLines=function(){var e=this._source.getVerticesData(l.b.PositionKind),a=this._source.getIndices();if(a&&e){for(var c=p.c.Vector3[0],k=p.c.Vector3[1],d=a.length-1,f=0,b=0;f<d;f+=
2,b+=4)p.e.FromArrayToRef(e,3*a[f],c),p.e.FromArrayToRef(e,3*a[f+1],k),this.createLine(c,k,b);e=this._source.getScene().getEngine();this._buffers[l.b.PositionKind]=new l.b(e,this._linesPositions,l.b.PositionKind,!1);this._buffers[l.b.NormalKind]=new l.b(e,this._linesNormals,l.b.NormalKind,!1,!1,4);this._ib=e.createIndexBuffer(this._linesIndices);this._indicesCount=this._linesIndices.length}};return e}(A),C=b("6Fho");b("aypA");var D=b("RWrB"),H=b("c7Ru"),E=b("n5HA"),I=function(){function a(e){this._textureFormats=
[{type:0,format:2},{type:1,format:2},{type:2,format:2},{type:3,format:0},{type:4,format:2},{type:5,format:2},{type:6,format:0}];this.excludedSkinnedMesh=[];this.excludedMaterials=[];this._textureIndices=[];this._isDirty=!1;this.mrtCount=0;this._postProcesses=[];this._clearColor=new x.b(0,0,0,0);this._effectConfigurations=[];this._mrtFormats=[];this.disableGammaTransform=this._useGeometryBufferFallback=this._enabled=!1;this._scene=e;this._engine=e.getEngine();a._SceneComponentInitialization(this._scene);
this._resetLayout()}Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"samples",{get:function(){return this.prePassRT.samples},set:function(a){this.imageProcessingPostProcess||this._createCompositionEffect();this.prePassRT.samples=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"useGeometryBufferFallback",{get:function(){return this._useGeometryBufferFallback},set:function(a){(this._useGeometryBufferFallback=
a)?(this._geometryBuffer=this._scene.enableGeometryBufferRenderer())?(this._geometryBuffer.renderList=[],this._geometryBuffer._linkPrePassRenderer(this),this._updateGeometryBufferLayout()):this._useGeometryBufferFallback=!1:(this._geometryBuffer&&this._geometryBuffer._unlinkPrePassRenderer(),this._geometryBuffer=null,this._scene.disableGeometryBufferRenderer())},enumerable:!1,configurable:!0});a.prototype._initializeAttachments=function(){for(var a=[],c=[!1],d=[!0],k=0;k<this.mrtCount;k++)a.push(!0),
0<k&&(c.push(!0),d.push(!1));this._multiRenderAttachments=this._engine.buildTextureLayout(a);this._clearAttachments=this._engine.buildTextureLayout(c);this._defaultAttachments=this._engine.buildTextureLayout(d)};a.prototype._createCompositionEffect=function(){this.prePassRT=new D.a("sceneprePassRT",{width:this._engine.getRenderWidth(),height:this._engine.getRenderHeight()},this.mrtCount,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:0,types:this._mrtFormats});this.prePassRT.samples=
1;this._initializeAttachments();this._useGeometryBufferFallback&&!this._geometryBuffer&&(this.useGeometryBufferFallback=!0);this.imageProcessingPostProcess=new H.a("sceneCompositionPass",1,null,void 0,this._engine);this.imageProcessingPostProcess.autoClear=!1};Object.defineProperty(a.prototype,"isSupported",{get:function(){return 1<this._engine.webGLVersion||this._scene.getEngine().getCaps().drawBuffersExtension},enumerable:!1,configurable:!0});a.prototype.bindAttachmentsForEffect=function(a,c){this.enabled&&
(a._multiTarget?this._engine.bindAttachments(this._multiRenderAttachments):(this._engine.bindAttachments(this._defaultAttachments),this._geometryBuffer&&(a=c.getMaterial())&&-1===this.excludedMaterials.indexOf(a)&&this._geometryBuffer.renderList.push(c.getRenderingMesh())))};a.prototype.restoreAttachments=function(){this.enabled&&this._defaultAttachments&&this._engine.bindAttachments(this._defaultAttachments)};a.prototype._beforeCameraDraw=function(){this._isDirty&&this._update();this._geometryBuffer&&
(this._geometryBuffer.renderList.length=0);this._bindFrameBuffer()};a.prototype._afterCameraDraw=function(){if(this._enabled){var a=this._scene.activeCamera&&this._scene.activeCamera._getFirstPostProcess();a&&this._postProcesses.length&&this._scene.postProcessManager._prepareFrame();this._scene.postProcessManager.directRender(this._postProcesses,a?a.inputTexture:null)}};a.prototype._checkRTSize=function(){var a=this._engine.getRenderWidth(!0),c=this._engine.getRenderHeight(!0),d=this.prePassRT.getRenderWidth(),
k=this.prePassRT.getRenderHeight();if(d!==a||k!==c)this.prePassRT.resize({width:a,height:c}),this._updateGeometryBufferLayout(),this._bindPostProcessChain()};a.prototype._bindFrameBuffer=function(){if(this._enabled){this._checkRTSize();var a=this.prePassRT.getInternalTexture();a&&this._engine.bindFramebuffer(a)}};a.prototype.clear=function(){this._enabled&&(this._bindFrameBuffer(),this._engine.clear(this._scene.clearColor,this._scene.autoClear||this._scene.forceWireframe||this._scene.forcePointsCloud,
this._scene.autoClearDepthAndStencil,this._scene.autoClearDepthAndStencil),this._engine.bindAttachments(this._clearAttachments),this._engine.clear(this._clearColor,!0,!1,!1),this._engine.bindAttachments(this._defaultAttachments))};a.prototype._setState=function(a){this._enabled=a;this._scene.prePass=a;this.imageProcessingPostProcess&&(this.imageProcessingPostProcess.imageProcessingConfiguration.applyByPostProcess=a)};a.prototype._updateGeometryBufferLayout=function(){if(this._geometryBuffer){this._geometryBuffer._resetLayout();
for(var a=[],c=0;c<this._mrtLayout.length;c++)a.push(!1);this._geometryBuffer._linkInternalTexture(this.prePassRT.getInternalTexture());var d=[{prePassConstant:5,geometryBufferConstant:C.a.DEPTHNORMAL_TEXTURE_TYPE},{prePassConstant:1,geometryBufferConstant:C.a.POSITION_TEXTURE_TYPE},{prePassConstant:3,geometryBufferConstant:C.a.REFLECTIVITY_TEXTURE_TYPE},{prePassConstant:2,geometryBufferConstant:C.a.VELOCITY_TEXTURE_TYPE}];for(c=0;c<d.length;c++){var k=this._mrtLayout.indexOf(d[c].prePassConstant);
-1!==k&&(this._geometryBuffer._forceTextureType(d[c].geometryBufferConstant,k),a[k]=!0)}this._geometryBuffer._setAttachments(this._engine.buildTextureLayout(a))}};a.prototype.addEffectConfiguration=function(a){for(var e=0;e<this._effectConfigurations.length;e++)if(this._effectConfigurations[e].name===a.name)return this._effectConfigurations[e];this._effectConfigurations.push(a);return a};a.prototype.getIndex=function(a){return this._textureIndices[a]};a.prototype._enable=function(){for(var a,c,d=
this.mrtCount,k=0;k<this._effectConfigurations.length;k++)this._effectConfigurations[k].enabled&&this._enableTextures(this._effectConfigurations[k].texturesRequired);this.prePassRT&&this.mrtCount!==d&&this.prePassRT.updateCount(this.mrtCount,{types:this._mrtFormats});this._updateGeometryBufferLayout();this._resetPostProcessChain();for(k=0;k<this._effectConfigurations.length;k++)this._effectConfigurations[k].enabled&&(!this._effectConfigurations[k].postProcess&&this._effectConfigurations[k].createPostProcess&&
this._effectConfigurations[k].createPostProcess(),this._effectConfigurations[k].postProcess&&this._postProcesses.push(this._effectConfigurations[k].postProcess));this._initializeAttachments();this.imageProcessingPostProcess||this._createCompositionEffect();d=!1;if(null===(a=this._scene.activeCamera)||void 0===a?0:a._postProcesses)for(k=0;k<this._scene.activeCamera._postProcesses.length;k++)"ImageProcessingPostProcess"===(null===(c=this._scene.activeCamera._postProcesses[k])||void 0===c?void 0:c.getClassName())&&
(d=!0);d||this.disableGammaTransform||this._postProcesses.push(this.imageProcessingPostProcess);this._bindPostProcessChain();this._setState(!0)};a.prototype._disable=function(){this._setState(!1);this._resetLayout();for(var a=0;a<this._effectConfigurations.length;a++)this._effectConfigurations[a].enabled=!1};a.prototype._resetLayout=function(){for(var a=0;a<this._textureFormats.length;a++)this._textureIndices[this._textureFormats[a].type]=-1;this._textureIndices[4]=0;this._mrtLayout=[4];this._mrtFormats=
[2];this.mrtCount=1};a.prototype._resetPostProcessChain=function(){this._postProcesses=[];this.imageProcessingPostProcess&&this.imageProcessingPostProcess.restoreDefaultInputTexture();for(var a=0;a<this._effectConfigurations.length;a++)this._effectConfigurations[a].postProcess&&this._effectConfigurations[a].postProcess.restoreDefaultInputTexture()};a.prototype._bindPostProcessChain=function(){var a;if(this._postProcesses.length)this._postProcesses[0].inputTexture=this.prePassRT.getInternalTexture();
else{var c=null===(a=this._scene.activeCamera)||void 0===a?void 0:a._getFirstPostProcess();c&&(c.inputTexture=this.prePassRT.getInternalTexture())}};a.prototype.markAsDirty=function(){this._isDirty=!0};a.prototype._enableTextures=function(a){for(var e=0;e<a.length;e++){var c=a[e];-1===this._textureIndices[c]&&(this._textureIndices[c]=this._mrtLayout.length,this._mrtLayout.push(c),this._mrtFormats.push(this._textureFormats[c].format),this.mrtCount++)}};a.prototype._update=function(){this._disable();
for(var a=!1,c=0;c<this._scene.materials.length;c++)this._scene.materials[c].setPrePassRenderer(this)&&(a=!0);if(c=this._scene.activeCamera){var k=c._postProcesses.filter(function(a){return null!=a});if(k)for(c=0;c<k.length;c++)k[c].setPrePassRenderer(this)&&(a=!0);this._markAllMaterialsAsPrePassDirty();this._isDirty=!1;a&&this._enable();this.enabled||(this._engine.restoreDefaultFramebuffer(),this._engine.restoreSingleAttachment())}};a.prototype._markAllMaterialsAsPrePassDirty=function(){for(var a=
this._scene.materials,c=0;c<a.length;c++)a[c].markAsDirty(f.a.PrePassDirtyFlag)};a.prototype.dispose=function(){for(var a=0;a<this._effectConfigurations.length;a++)this._effectConfigurations[a].dispose&&this._effectConfigurations[a].dispose();this.imageProcessingPostProcess.dispose();this.prePassRT.dispose()};a._SceneComponentInitialization=function(a){throw E.a.WarnImport("PrePassRendererSceneComponent");};return a}(),K=b("uyO6");Object.defineProperty(u.a.prototype,"prePassRenderer",{get:function(){return this._prePassRenderer},
set:function(a){a&&a.isSupported&&(this._prePassRenderer=a)},enumerable:!0,configurable:!0});u.a.prototype.enablePrePassRenderer=function(){if(this._prePassRenderer)return this._prePassRenderer;this._prePassRenderer=new I(this);this._prePassRenderer.isSupported||(this._prePassRenderer=null,K.a.Error("PrePassRenderer needs WebGL 2 support.\nMaybe you tried to use the following features that need the PrePassRenderer :\n + Subsurface Scattering"));return this._prePassRenderer};u.a.prototype.disablePrePassRenderer=
function(){this._prePassRenderer&&(this._prePassRenderer.dispose(),this._prePassRenderer=null)};var N=function(){function a(a){this.name=c.a.NAME_PREPASSRENDERER;this.scene=a}a.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(c.a.STEP_BEFORECAMERADRAW_PREPASS,this,this._beforeCameraDraw);this.scene._afterCameraDrawStage.registerStep(c.a.STEP_AFTERCAMERADRAW_PREPASS,this,this._afterCameraDraw);this.scene._beforeClearStage.registerStep(c.a.STEP_BEFORECLEARSTAGE_PREPASS,this,
this._beforeClearStage);this.scene._beforeRenderingMeshStage.registerStep(c.a.STEP_BEFORERENDERINGMESH_PREPASS,this,this._beforeRenderingMeshStage);this.scene._afterRenderingMeshStage.registerStep(c.a.STEP_AFTERRENDERINGMESH_PREPASS,this,this._afterRenderingMeshStage)};a.prototype._beforeCameraDraw=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer._beforeCameraDraw()};a.prototype._afterCameraDraw=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer._afterCameraDraw()};
a.prototype._beforeClearStage=function(){this.scene.prePassRenderer&&this.scene.prePassRenderer.clear()};a.prototype._beforeRenderingMeshStage=function(a,c,d,k){k&&(a=a.getScene(),a.prePassRenderer&&a.prePassRenderer.bindAttachmentsForEffect(k,c))};a.prototype._afterRenderingMeshStage=function(a){a=a.getScene();a.prePassRenderer&&a.prePassRenderer.restoreAttachments()};a.prototype.rebuild=function(){};a.prototype.dispose=function(){};return a}();I._SceneComponentInitialization=function(a){var e=a._getComponent(c.a.NAME_PREPASSRENDERER);
e||(e=new N(a),a._addComponent(e))};var O=b("eFYt"),L=function(){function a(e){this._ssDiffusionS=[];this._ssFilterRadii=[];this._ssDiffusionD=[];this.enabled=!1;this.name=c.a.NAME_SUBSURFACE;this.ssDiffusionProfileColors=[];this.metersPerUnit=1;this.texturesRequired=[5,6,4,0];this.addDiffusionProfile(new x.a(1,1,1));this._scene=e;a._SceneComponentInitialization(this._scene)}Object.defineProperty(a.prototype,"ssDiffusionS",{get:function(){return this._ssDiffusionS},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"ssDiffusionD",{get:function(){return this._ssDiffusionD},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"ssFilterRadii",{get:function(){return this._ssFilterRadii},enumerable:!1,configurable:!0});a.prototype.addDiffusionProfile=function(a){if(5<=this.ssDiffusionD.length)return K.a.Error("You already reached the maximum number of diffusion profiles."),0;for(var c=0;c<this._ssDiffusionS.length/3;c++)if(this._ssDiffusionS[3*c]===a.r&&this._ssDiffusionS[3*
c+1]===a.g&&this._ssDiffusionS[3*c+2]===a.b)return c;this._ssDiffusionS.push(a.r,a.b,a.g);this._ssDiffusionD.push(Math.max(Math.max(a.r,a.b),a.g));this._ssFilterRadii.push(this.getDiffusionProfileParameters(a));this.ssDiffusionProfileColors.push(a);return this._ssDiffusionD.length-1};a.prototype.createPostProcess=function(){this.postProcess=new O.a("subSurfaceScattering",this._scene,1,null,void 0,this._scene.getEngine());this.postProcess.autoClear=!1;return this.postProcess};a.prototype.clearAllDiffusionProfiles=
function(){this._ssDiffusionD=[];this._ssDiffusionS=[];this._ssFilterRadii=[];this.ssDiffusionProfileColors=[]};a.prototype.dispose=function(){this.clearAllDiffusionProfiles();this.postProcess.dispose()};a.prototype.getDiffusionProfileParameters=function(a){return this._sampleBurleyDiffusionProfile(.997,Math.max(a.r,a.g,a.b))};a.prototype._sampleBurleyDiffusionProfile=function(a,c){a=1-a;var e=1+4*a*(2*a+Math.sqrt(1+4*a*a)),d=Math.pow(e,-1/3);return 3*Math.log((1+e*d*d+d)/(4*a))*c};a._SceneComponentInitialization=
function(a){throw E.a.WarnImport("PrePassRendererSceneComponent");};return a}();b("KbzI").a.AddParser(c.a.NAME_SUBSURFACE,function(a,c){if(void 0!==a.ssDiffusionProfileColors&&null!==a.ssDiffusionProfileColors&&(c.enableSubSurfaceForPrePass(),c.subSurfaceConfiguration))for(var e=0,d=a.ssDiffusionProfileColors.length;e<d;e++){var k=a.ssDiffusionProfileColors[e];c.subSurfaceConfiguration.addDiffusionProfile(new x.a(k.r,k.g,k.b))}});Object.defineProperty(u.a.prototype,"subSurfaceConfiguration",{get:function(){return this._subSurfaceConfiguration},
set:function(a){a&&this.enablePrePassRenderer()&&(this._subSurfaceConfiguration=a)},enumerable:!0,configurable:!0});u.a.prototype.enableSubSurfaceForPrePass=function(){if(this._subSurfaceConfiguration)return this._subSurfaceConfiguration;var a=this.enablePrePassRenderer();return a?(this._subSurfaceConfiguration=new L(this),a.addEffectConfiguration(this._subSurfaceConfiguration),this._subSurfaceConfiguration):null};u.a.prototype.disableSubSurfaceForPrePass=function(){this._subSurfaceConfiguration&&
(this._subSurfaceConfiguration.dispose(),this._subSurfaceConfiguration=null)};var P=function(){function a(a){this.name=c.a.NAME_PREPASSRENDERER;this.scene=a}a.prototype.register=function(){};a.prototype.serialize=function(a){if(this.scene.subSurfaceConfiguration){var c=this.scene.subSurfaceConfiguration.ssDiffusionProfileColors;a.ssDiffusionProfileColors=[];for(var e=0;e<c.length;e++)a.ssDiffusionProfileColors.push({r:c[e].r,g:c[e].g,b:c[e].b})}};a.prototype.addFromContainer=function(a){};a.prototype.removeFromContainer=
function(a,c){this.scene.prePassRenderer&&this.scene.subSurfaceConfiguration&&this.scene.subSurfaceConfiguration.clearAllDiffusionProfiles()};a.prototype.rebuild=function(){};a.prototype.dispose=function(){};return a}();L._SceneComponentInitialization=function(a){var e=a._getComponent(c.a.NAME_SUBSURFACE);e||(e=new P(a),a._addComponent(e))};v=b("wAMR");var J=b("/eyM");b("RzR7");b("LOHu");u.a.prototype.getOutlineRenderer=function(){this._outlineRenderer||(this._outlineRenderer=new Q(this));return this._outlineRenderer};
Object.defineProperty(v.a.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(a){a&&this.getScene().getOutlineRenderer();this._renderOutline=a},enumerable:!0,configurable:!0});Object.defineProperty(v.a.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(a){a&&this.getScene().getOutlineRenderer();this._renderOverlay=a},enumerable:!0,configurable:!0});var Q=function(){function a(a){this.name=c.a.NAME_OUTLINERENDERER;this.zOffset=1;this.scene=
a;this._engine=a.getEngine();this.scene._addComponent(this)}a.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(c.a.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh);this.scene._afterRenderingMeshStage.registerStep(c.a.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)};a.prototype.rebuild=function(){};a.prototype.dispose=function(){};a.prototype.render=function(a,c,d){var e=this;void 0===d&&(d=!1);var f=this.scene,b=f.getEngine(),k=b.getCaps().instancedArrays&&
(null!==c.visibleInstances[a._id]&&void 0!==c.visibleInstances[a._id]||a.getRenderingMesh().hasThinInstances);if(this.isReady(a,k)){var g=a.getMesh(),h=g._internalAbstractMeshDataInfo._actAsRegularMesh?g:null;g=a.getRenderingMesh();h=h?h:g;var m=a.getMaterial();m&&f.activeCamera&&(b.enableEffect(this._effect),m.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(f.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",d?0:g.outlineWidth),this._effect.setColor4("color",
d?g.overlayColor:g.outlineColor,d?g.overlayAlpha:m.alpha),this._effect.setMatrix("viewProjection",f.getTransformMatrix()),this._effect.setMatrix("world",h.getWorldMatrix()),g.useBones&&g.computeBonesUsingShaders&&g.skeleton&&this._effect.setMatrices("mBones",g.skeleton.getTransformMatrices(g)),J.a.BindMorphTargetParameters(g,this._effect),g._bind(a,this._effect,m.fillMode),m&&m.needAlphaTesting()&&(d=m.getAlphaTestTexture())&&(this._effect.setTexture("diffuseSampler",d),this._effect.setMatrix("diffuseMatrix",
d.getTextureMatrix())),b.setZOffset(-this.zOffset),g._processRendering(h,a,this._effect,m.fillMode,c,k,function(a,c){e._effect.setMatrix("world",c)}),b.setZOffset(0))}};a.prototype.isReady=function(a,c){var e=[],d=[l.b.PositionKind,l.b.NormalKind],f=a.getMesh(),b=a.getMaterial();b&&(b.needAlphaTesting()&&(e.push("#define ALPHATEST"),f.isVerticesDataPresent(l.b.UVKind)&&(d.push(l.b.UVKind),e.push("#define UV1")),f.isVerticesDataPresent(l.b.UV2Kind)&&(d.push(l.b.UV2Kind),e.push("#define UV2"))),b.useLogarithmicDepth&&
e.push("#define LOGARITHMICDEPTH"));f.useBones&&f.computeBonesUsingShaders?(d.push(l.b.MatricesIndicesKind),d.push(l.b.MatricesWeightsKind),4<f.numBoneInfluencers&&(d.push(l.b.MatricesIndicesExtraKind),d.push(l.b.MatricesWeightsExtraKind)),e.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),e.push("#define BonesPerMesh "+(f.skeleton?f.skeleton.bones.length+1:0))):e.push("#define NUM_BONE_INFLUENCERS 0");var g=f.morphTargetManager;b=0;g&&0<g.numInfluencers&&(b=g.numInfluencers,e.push("#define MORPHTARGETS"),
e.push("#define NUM_MORPH_INFLUENCERS "+b),J.a.PrepareAttributesForMorphTargetsInfluencers(d,f,b));c&&(e.push("#define INSTANCES"),J.a.PushAttributesForInstances(d),a.getRenderingMesh().hasThinInstances&&e.push("#define THIN_INSTANCES"));a=e.join("\n");this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this.scene.getEngine().createEffect("outline",d,"world mBones viewProjection diffuseMatrix offset color logarithmicDepthConstant morphTargetInfluences".split(" "),["diffuseSampler"],a,void 0,
void 0,void 0,{maxSimultaneousMorphTargets:b}));return this._effect.isReady()};a.prototype._beforeRenderingMesh=function(c,d,f){this._savedDepthWrite=this._engine.getDepthWrite();if(c.renderOutline){var e=d.getMaterial();e&&e.needAlphaBlendingForMesh(c)&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(7681),this._engine.setStencilFunction(519),this._engine.setStencilMask(a._StencilReference),
this._engine.setStencilFunctionReference(a._StencilReference),this.render(d,f,!0),this._engine.setColorWrite(!0),this._engine.setStencilFunction(517));this._engine.setDepthWrite(!1);this.render(d,f);this._engine.setDepthWrite(this._savedDepthWrite);e&&e.needAlphaBlendingForMesh(c)&&this._engine.restoreStencilState()}};a.prototype._afterRenderingMesh=function(a,c,d){if(a.renderOverlay){var e=this._engine.getAlphaMode(),f=this._engine.alphaState.alphaBlend;this._engine.setAlphaMode(2);this.render(c,
d,!0);this._engine.setAlphaMode(e);this._engine.setDepthWrite(this._savedDepthWrite);this._engine.alphaState.alphaBlend=f}a.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(c,d),this._engine.setColorWrite(!0))};a._StencilReference=4;return a}();b("I8OS");b("F24J");b("zRBM")},"4nLD":function(u,v,b){b("gyD2")},"6Fho":function(u,v,b){b.d(v,"a",function(){return w});var l=b("/SR9"),t=b("y4Ty"),p=b("aCSs"),g=b("RWrB"),c=b("/eyM"),f=b("Xeau"),
m=b("kdvT"),x=b("oXT7"),h=b("n5HA"),r=b("cdI9");b("5al/");b("ksxC");var w=function(){function d(a,c){void 0===c&&(c=1);this._previousTransformationMatrices={};this._previousBonesTransformationMatrices={};this.excludedSkinnedMeshesFromVelocity=[];this.renderTransparentMeshes=!0;this._resizeObserver=null;this._enableReflectivity=this._enableVelocity=this._enablePosition=!1;this._depthNormalIndex=this._reflectivityIndex=this._velocityIndex=this._positionIndex=-1;this._linkedWithPrePass=!1;this._scene=
a;this._ratio=c;d._SceneComponentInitialization(this._scene);this._createRenderTargets()}d.prototype._linkPrePassRenderer=function(a){this._linkedWithPrePass=!0;this._prePassRenderer=a;this._multiRenderTarget&&(this._multiRenderTarget.onClearObservable.clear(),this._multiRenderTarget.onClearObservable.add(function(a){}))};d.prototype._unlinkPrePassRenderer=function(){this._linkedWithPrePass=!1;this._createRenderTargets()};d.prototype._resetLayout=function(){this._enableVelocity=this._enableReflectivity=
this._enablePosition=!1;this._attachments=[]};d.prototype._forceTextureType=function(a,c){a===d.POSITION_TEXTURE_TYPE?(this._positionIndex=c,this._enablePosition=!0):a===d.VELOCITY_TEXTURE_TYPE?(this._velocityIndex=c,this._enableVelocity=!0):a===d.REFLECTIVITY_TEXTURE_TYPE?(this._reflectivityIndex=c,this._enableReflectivity=!0):a===d.DEPTHNORMAL_TEXTURE_TYPE&&(this._depthNormalIndex=c)};d.prototype._setAttachments=function(a){this._attachments=a};d.prototype._linkInternalTexture=function(a){this._multiRenderTarget._texture=
a};Object.defineProperty(d.prototype,"renderList",{get:function(){return this._multiRenderTarget.renderList},set:function(a){this._multiRenderTarget.renderList=a},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!1,configurable:!0});d.prototype.getTextureIndex=function(a){switch(a){case d.POSITION_TEXTURE_TYPE:return this._positionIndex;case d.VELOCITY_TEXTURE_TYPE:return this._velocityIndex;case d.REFLECTIVITY_TEXTURE_TYPE:return this._reflectivityIndex;
default:return-1}};Object.defineProperty(d.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(a){this._enablePosition=a;this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"enableVelocity",{get:function(){return this._enableVelocity},set:function(a){this._enableVelocity=a;a||(this._previousTransformationMatrices={});this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},
enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"enableReflectivity",{get:function(){return this._enableReflectivity},set:function(a){this._enableReflectivity=a;this._linkedWithPrePass||(this.dispose(),this._createRenderTargets())},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0});Object.defineProperty(d.prototype,"ratio",{get:function(){return this._ratio},enumerable:!1,configurable:!0});
d.prototype.isReady=function(a,d){var f=a.getMaterial();if(f&&f.disableDepthWrite)return!1;var b=[],g=[t.b.PositionKind,t.b.NormalKind],h=a.getMesh();if(f){var r=!1;f.needAlphaTesting()&&(b.push("#define ALPHATEST"),r=!0);f.bumpTexture&&m.a.BumpTextureEnabled&&(b.push("#define BUMP"),b.push("#define BUMPDIRECTUV 0"),r=!0);this._enableReflectivity&&(f instanceof m.a&&f.specularTexture?(b.push("#define HAS_SPECULAR"),r=!0):f instanceof x.a&&f.reflectivityTexture&&(b.push("#define HAS_REFLECTIVITY"),
r=!0));r&&(b.push("#define NEED_UV"),h.isVerticesDataPresent(t.b.UVKind)&&(g.push(t.b.UVKind),b.push("#define UV1")),h.isVerticesDataPresent(t.b.UV2Kind)&&(g.push(t.b.UV2Kind),b.push("#define UV2")))}this._linkedWithPrePass&&(b.push("#define PREPASS"),-1!==this._depthNormalIndex&&(b.push("#define DEPTHNORMAL_INDEX "+this._depthNormalIndex),b.push("#define PREPASS_DEPTHNORMAL")));this._enablePosition&&(b.push("#define POSITION"),b.push("#define POSITION_INDEX "+this._positionIndex));this._enableVelocity&&
(b.push("#define VELOCITY"),b.push("#define VELOCITY_INDEX "+this._velocityIndex),-1===this.excludedSkinnedMeshesFromVelocity.indexOf(h)&&b.push("#define BONES_VELOCITY_ENABLED"));this._enableReflectivity&&(b.push("#define REFLECTIVITY"),b.push("#define REFLECTIVITY_INDEX "+this._reflectivityIndex));h.useBones&&h.computeBonesUsingShaders?(g.push(t.b.MatricesIndicesKind),g.push(t.b.MatricesWeightsKind),4<h.numBoneInfluencers&&(g.push(t.b.MatricesIndicesExtraKind),g.push(t.b.MatricesWeightsExtraKind)),
b.push("#define NUM_BONE_INFLUENCERS "+h.numBoneInfluencers),b.push("#define BonesPerMesh "+(h.skeleton?h.skeleton.bones.length+1:0))):b.push("#define NUM_BONE_INFLUENCERS 0");r=h.morphTargetManager;f=0;r&&0<r.numInfluencers&&(f=r.numInfluencers,b.push("#define MORPHTARGETS"),b.push("#define NUM_MORPH_INFLUENCERS "+f),c.a.PrepareAttributesForMorphTargetsInfluencers(g,h,f));d&&(b.push("#define INSTANCES"),c.a.PushAttributesForInstances(g),a.getRenderingMesh().hasThinInstances&&b.push("#define THIN_INSTANCES"));
this._linkedWithPrePass?b.push("#define RENDER_TARGET_COUNT "+this._attachments.length):b.push("#define RENDER_TARGET_COUNT "+this._multiRenderTarget.textures.length);a=b.join("\n");this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("geometry",g,"world mBones viewProjection diffuseMatrix view previousWorld previousViewProjection mPreviousBones morphTargetInfluences bumpMatrix reflectivityMatrix vTangentSpaceParams vBumpInfos".split(" "),["diffuseSampler",
"bumpSampler","reflectivitySampler"],a,void 0,void 0,void 0,{buffersCount:this._multiRenderTarget.textures.length-1,maxSimultaneousMorphTargets:f}));return this._effect.isReady()};d.prototype.getGBuffer=function(){return this._multiRenderTarget};Object.defineProperty(d.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(a){this._multiRenderTarget.samples=a},enumerable:!1,configurable:!0});d.prototype.dispose=function(){this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),
this._resizeObserver=null);this.getGBuffer().dispose()};d.prototype._assignRenderTargetIndices=function(){var a=2;this._enablePosition&&(this._positionIndex=a,a++);this._enableVelocity&&(this._velocityIndex=a,a++);this._enableReflectivity&&(this._reflectivityIndex=a,a++);return a};d.prototype._createRenderTargets=function(){var a=this,d=this._scene.getEngine(),b=this._assignRenderTargetIndices();this._multiRenderTarget=new g.a("gBuffer",{width:d.getRenderWidth()*this._ratio,height:d.getRenderHeight()*
this._ratio},b,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:1});if(this.isSupported){this._multiRenderTarget.wrapU=p.a.CLAMP_ADDRESSMODE;this._multiRenderTarget.wrapV=p.a.CLAMP_ADDRESSMODE;this._multiRenderTarget.refreshRate=1;this._multiRenderTarget.renderParticles=!1;this._multiRenderTarget.renderList=null;this._multiRenderTarget.onClearObservable.add(function(a){a.clear(new f.b(0,0,0,1),!0,!0,!0)});this._resizeObserver=d.onResizeObservable.add(function(){a._multiRenderTarget&&
a._multiRenderTarget.resize({width:d.getRenderWidth()*a._ratio,height:d.getRenderHeight()*a._ratio})});var h=function(d){var f=d.getRenderingMesh(),b=d.getEffectiveMesh(),g=a._scene,h=g.getEngine(),n=d.getMaterial();if(n){b._internalAbstractMeshDataInfo._isActiveIntermediate=!1;if(a._enableVelocity&&!a._previousTransformationMatrices[b.uniqueId]&&(a._previousTransformationMatrices[b.uniqueId]={world:l.a.Identity(),viewProjection:g.getTransformMatrix()},f.skeleton)){var w=f.skeleton.getTransformMatrices(f);
a._previousBonesTransformationMatrices[f.uniqueId]=a._copyBonesTransformationMatrices(w,new Float32Array(w.length))}w=f._getInstancesRenderList(d._id,!!d.getReplacementMesh());if(!w.mustReturn){var p=h.getCaps().instancedArrays&&(null!==w.visibleInstances[d._id]||f.hasThinInstances),t=b.getWorldMatrix();if(a.isReady(d,p)){h.enableEffect(a._effect);f._bind(d,a._effect,n.fillMode);a._effect.setMatrix("viewProjection",g.getTransformMatrix());a._effect.setMatrix("view",g.getViewMatrix());if(n){h=b._instanceDataStorage;
if(h.isFrozen||!n.backFaceCulling&&null===n.overrideMaterialSideOrientation)h=h.sideOrientation;else{var B=b._getWorldMatrixDeterminant();h=n.overrideMaterialSideOrientation;null==h&&(h=n.sideOrientation);0>B&&(h=h===r.a.ClockWiseSideOrientation?r.a.CounterClockWiseSideOrientation:r.a.ClockWiseSideOrientation)}n._preBind(a._effect,h);n.needAlphaTesting()&&(h=n.getAlphaTestTexture())&&(a._effect.setTexture("diffuseSampler",h),a._effect.setMatrix("diffuseMatrix",h.getTextureMatrix()));n.bumpTexture&&
g.getEngine().getCaps().standardDerivatives&&m.a.BumpTextureEnabled&&(a._effect.setFloat3("vBumpInfos",n.bumpTexture.coordinatesIndex,1/n.bumpTexture.level,n.parallaxScaleBias),a._effect.setMatrix("bumpMatrix",n.bumpTexture.getTextureMatrix()),a._effect.setTexture("bumpSampler",n.bumpTexture),a._effect.setFloat2("vTangentSpaceParams",n.invertNormalMapX?-1:1,n.invertNormalMapY?-1:1));a._enableReflectivity&&(n instanceof m.a&&n.specularTexture?(a._effect.setMatrix("reflectivityMatrix",n.specularTexture.getTextureMatrix()),
a._effect.setTexture("reflectivitySampler",n.specularTexture)):n instanceof x.a&&n.reflectivityTexture&&(a._effect.setMatrix("reflectivityMatrix",n.reflectivityTexture.getTextureMatrix()),a._effect.setTexture("reflectivitySampler",n.reflectivityTexture)))}f.useBones&&f.computeBonesUsingShaders&&f.skeleton&&(a._effect.setMatrices("mBones",f.skeleton.getTransformMatrices(f)),a._enableVelocity&&a._effect.setMatrices("mPreviousBones",a._previousBonesTransformationMatrices[f.uniqueId]));c.a.BindMorphTargetParameters(f,
a._effect);a._enableVelocity&&(a._effect.setMatrix("previousWorld",a._previousTransformationMatrices[b.uniqueId].world),a._effect.setMatrix("previousViewProjection",a._previousTransformationMatrices[b.uniqueId].viewProjection));f._processRendering(b,d,a._effect,n.fillMode,w,p,function(c,d){return a._effect.setMatrix("world",d)})}a._enableVelocity&&(a._previousTransformationMatrices[b.uniqueId].world=t.clone(),a._previousTransformationMatrices[b.uniqueId].viewProjection=a._scene.getTransformMatrix().clone(),
f.skeleton&&a._copyBonesTransformationMatrices(f.skeleton.getTransformMatrices(f),a._previousBonesTransformationMatrices[b.uniqueId]))}}};this._multiRenderTarget.customRenderFunction=function(c,f,b,g){var m;if(a._linkedWithPrePass){if(!a._prePassRenderer.enabled)return;a._scene.getEngine().bindAttachments(a._attachments)}if(g.length){d.setColorWrite(!1);for(m=0;m<g.length;m++)h(g.data[m]);d.setColorWrite(!0)}for(m=0;m<c.length;m++)h(c.data[m]);for(m=0;m<f.length;m++)h(f.data[m]);if(a.renderTransparentMeshes)for(m=
0;m<b.length;m++)h(b.data[m])}}};d.prototype._copyBonesTransformationMatrices=function(a,c){for(var d=0;d<a.length;d++)c[d]=a[d];return c};d.DEPTHNORMAL_TEXTURE_TYPE=0;d.POSITION_TEXTURE_TYPE=1;d.VELOCITY_TEXTURE_TYPE=2;d.REFLECTIVITY_TEXTURE_TYPE=3;d._SceneComponentInitialization=function(a){throw h.a.WarnImport("GeometryBufferRendererSceneComponent");};return d}()},F24J:function(u,v,b){b.d(v,"a",function(){return p});var l=b("I8OS"),t=function(){return function(){}}(),p=function(){function b(c){this._useSceneAutoClearSetup=
!1;this._renderingGroups=[];this._autoClearDepthStencil={};this._customOpaqueSortCompareFn={};this._customAlphaTestSortCompareFn={};this._customTransparentSortCompareFn={};this._renderingGroupInfo=new t;this._scene=c;for(c=b.MIN_RENDERINGGROUPS;c<b.MAX_RENDERINGGROUPS;c++)this._autoClearDepthStencil[c]={autoClear:!0,depth:!0,stencil:!0}}b.prototype._clearDepthStencilBuffer=function(c,b){void 0===c&&(c=!0);void 0===b&&(b=!0);this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,
!1,c,b),this._depthStencilBufferAlreadyCleaned=!0)};b.prototype.render=function(c,f,g,l){var h=this._renderingGroupInfo;h.scene=this._scene;h.camera=this._scene.activeCamera;if(this._scene.spriteManagers&&l)for(var m=0;m<this._scene.spriteManagers.length;m++)this.dispatchSprites(this._scene.spriteManagers[m]);for(m=b.MIN_RENDERINGGROUPS;m<b.MAX_RENDERINGGROUPS;m++){this._depthStencilBufferAlreadyCleaned=m===b.MIN_RENDERINGGROUPS;var w=this._renderingGroups[m];if(w){var d=Math.pow(2,m);h.renderingGroupId=
m;this._scene.onBeforeRenderingGroupObservable.notifyObservers(h,d);if(b.AUTOCLEAR){var a=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(m):this._autoClearDepthStencil[m];a&&a.autoClear&&this._clearDepthStencilBuffer(a.depth,a.stencil)}for(var n=0,x=this._scene._beforeRenderingGroupDrawStage;n<x.length;n++)a=x[n],a.action(m);w.render(c,l,g,f);w=0;for(n=this._scene._afterRenderingGroupDrawStage;w<n.length;w++)a=n[w],a.action(m);this._scene.onAfterRenderingGroupObservable.notifyObservers(h,
d)}}};b.prototype.reset=function(){for(var c=b.MIN_RENDERINGGROUPS;c<b.MAX_RENDERINGGROUPS;c++){var f=this._renderingGroups[c];f&&f.prepare()}};b.prototype.dispose=function(){this.freeRenderingGroups();this._renderingGroups.length=0;this._renderingGroupInfo=null};b.prototype.freeRenderingGroups=function(){for(var c=b.MIN_RENDERINGGROUPS;c<b.MAX_RENDERINGGROUPS;c++){var f=this._renderingGroups[c];f&&f.dispose()}};b.prototype._prepareRenderingGroup=function(c){void 0===this._renderingGroups[c]&&(this._renderingGroups[c]=
new l.a(c,this._scene,this._customOpaqueSortCompareFn[c],this._customAlphaTestSortCompareFn[c],this._customTransparentSortCompareFn[c]))};b.prototype.dispatchSprites=function(c){var b=c.renderingGroupId||0;this._prepareRenderingGroup(b);this._renderingGroups[b].dispatchSprites(c)};b.prototype.dispatchParticles=function(c){var b=c.renderingGroupId||0;this._prepareRenderingGroup(b);this._renderingGroups[b].dispatchParticles(c)};b.prototype.dispatch=function(c,b,g){void 0===b&&(b=c.getMesh());var f=
b.renderingGroupId||0;this._prepareRenderingGroup(f);this._renderingGroups[f].dispatch(c,b,g)};b.prototype.setRenderingOrder=function(c,b,g,l){void 0===b&&(b=null);void 0===g&&(g=null);void 0===l&&(l=null);this._customOpaqueSortCompareFn[c]=b;this._customAlphaTestSortCompareFn[c]=g;this._customTransparentSortCompareFn[c]=l;this._renderingGroups[c]&&(b=this._renderingGroups[c],b.opaqueSortCompareFn=this._customOpaqueSortCompareFn[c],b.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[c],b.transparentSortCompareFn=
this._customTransparentSortCompareFn[c])};b.prototype.setRenderingAutoClearDepthStencil=function(c,b,g,l){void 0===g&&(g=!0);void 0===l&&(l=!0);this._autoClearDepthStencil[c]={autoClear:b,depth:g,stencil:l}};b.prototype.getAutoClearDepthStencilSetup=function(c){return this._autoClearDepthStencil[c]};b.MAX_RENDERINGGROUPS=4;b.MIN_RENDERINGGROUPS=0;b.AUTOCLEAR=!0;return b}()},I8OS:function(u,v,b){b.d(v,"a",function(){return p});var l=b("Bfey"),t=b("/SR9"),p=function(){function b(c,b,m,g,h){void 0===
m&&(m=null);void 0===g&&(g=null);void 0===h&&(h=null);this.index=c;this._opaqueSubMeshes=new l.a(256);this._transparentSubMeshes=new l.a(256);this._alphaTestSubMeshes=new l.a(256);this._depthOnlySubMeshes=new l.a(256);this._particleSystems=new l.a(256);this._spriteManagers=new l.a(256);this._edgesRenderers=new l.b(16);this._scene=b;this.opaqueSortCompareFn=m;this.alphaTestSortCompareFn=g;this.transparentSortCompareFn=h}Object.defineProperty(b.prototype,"opaqueSortCompareFn",{set:function(c){this._renderOpaque=
(this._opaqueSortCompareFn=c)?this.renderOpaqueSorted:b.renderUnsorted},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"alphaTestSortCompareFn",{set:function(c){this._renderAlphaTest=(this._alphaTestSortCompareFn=c)?this.renderAlphaTestSorted:b.renderUnsorted},enumerable:!1,configurable:!0});Object.defineProperty(b.prototype,"transparentSortCompareFn",{set:function(c){this._transparentSortCompareFn=c?c:b.defaultTransparentSortCompare;this._renderTransparent=this.renderTransparentSorted},
enumerable:!1,configurable:!0});b.prototype.render=function(c,b,m,g){if(c)c(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{c=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(c.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),c.setColorWrite(!0));0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes);0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var f=
c.getStencilBuffer();c.setStencilBuffer(!1);b&&this._renderSprites();m&&this._renderParticles(g);if(this.onBeforeTransparentRendering)this.onBeforeTransparentRendering();0!==this._transparentSubMeshes.length&&(c.setStencilBuffer(f),this._renderTransparent(this._transparentSubMeshes),c.setAlphaMode(0));c.setStencilBuffer(!1);if(this._edgesRenderers.length){for(b=0;b<this._edgesRenderers.length;b++)this._edgesRenderers.data[b].render();c.setAlphaMode(0)}c.setStencilBuffer(f)}};b.prototype.renderOpaqueSorted=
function(c){return b.renderSorted(c,this._opaqueSortCompareFn,this._scene.activeCamera,!1)};b.prototype.renderAlphaTestSorted=function(c){return b.renderSorted(c,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)};b.prototype.renderTransparentSorted=function(c){return b.renderSorted(c,this._transparentSortCompareFn,this._scene.activeCamera,!0)};b.renderSorted=function(c,f,m,g){for(var h=0,l=m?m.globalPosition:b._zeroVector;h<c.length;h++)m=c.data[h],m._alphaIndex=m.getMesh().alphaIndex,m._distanceToCamera=
t.e.Distance(m.getBoundingInfo().boundingSphere.centerWorld,l);c=c.data.slice(0,c.length);f&&c.sort(f);for(h=0;h<c.length;h++)m=c[h],g&&(f=m.getMaterial())&&f.needDepthPrePass&&(f=f.getScene().getEngine(),f.setColorWrite(!1),f.setAlphaMode(0),m.render(!1),f.setColorWrite(!0)),m.render(g)};b.renderUnsorted=function(c){for(var b=0;b<c.length;b++)c.data[b].render(!1)};b.defaultTransparentSortCompare=function(c,f){return c._alphaIndex>f._alphaIndex?1:c._alphaIndex<f._alphaIndex?-1:b.backToFrontSortCompare(c,
f)};b.backToFrontSortCompare=function(c,b){return c._distanceToCamera<b._distanceToCamera?1:c._distanceToCamera>b._distanceToCamera?-1:0};b.frontToBackSortCompare=function(c,b){return c._distanceToCamera<b._distanceToCamera?-1:c._distanceToCamera>b._distanceToCamera?1:0};b.prototype.prepare=function(){this._opaqueSubMeshes.reset();this._transparentSubMeshes.reset();this._alphaTestSubMeshes.reset();this._depthOnlySubMeshes.reset();this._particleSystems.reset();this._spriteManagers.reset();this._edgesRenderers.reset()};
b.prototype.dispose=function(){this._opaqueSubMeshes.dispose();this._transparentSubMeshes.dispose();this._alphaTestSubMeshes.dispose();this._depthOnlySubMeshes.dispose();this._particleSystems.dispose();this._spriteManagers.dispose();this._edgesRenderers.dispose()};b.prototype.dispatch=function(c,b,g){void 0===b&&(b=c.getMesh());void 0===g&&(g=c.getMaterial());null!==g&&void 0!==g&&(g.needAlphaBlendingForMesh(b)?this._transparentSubMeshes.push(c):g.needAlphaTesting()?(g.needDepthPrePass&&this._depthOnlySubMeshes.push(c),
this._alphaTestSubMeshes.push(c)):(g.needDepthPrePass&&this._depthOnlySubMeshes.push(c),this._opaqueSubMeshes.push(c)),b._renderingGroup=this,b._edgesRenderer&&b._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(b._edgesRenderer))};b.prototype.dispatchSprites=function(c){this._spriteManagers.push(c)};b.prototype.dispatchParticles=function(c){this._particleSystems.push(c)};b.prototype._renderParticles=function(c){if(0!==this._particleSystems.length){var b=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);
for(var g=0;g<this._particleSystems.length;g++){var l=this._particleSystems.data[g];if(0!==(b&&b.layerMask&l.layerMask)){var h=l.emitter;h.position&&c&&-1===c.indexOf(h)||this._scene._activeParticles.addCount(l.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}};b.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var c=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);
for(var b=0;b<this._spriteManagers.length;b++){var g=this._spriteManagers.data[b];0!==(c&&c.layerMask&g.layerMask)&&g.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}};b._zeroVector=t.e.Zero();return b}()},KKje:function(u,v,b){b.d(v,"a",function(){return l});var l=function(){return function(){this.enabled=!1;this.name="motionBlur";this.texturesRequired=[2]}}()},PFez:function(u,v,b){b.d(v,"a",function(){return l});var l=function(){return function(){this.enabled=
!1;this.name="ssao2";this.texturesRequired=[5]}}()},aypA:function(u,v,b){u=b("tVVT");var l=b("Yap0"),t=b("6Fho");Object.defineProperty(u.a.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(b){b&&b.isSupported&&(this._geometryBufferRenderer=b)},enumerable:!0,configurable:!0});u.a.prototype.enableGeometryBufferRenderer=function(b){void 0===b&&(b=1);if(this._geometryBufferRenderer)return this._geometryBufferRenderer;this._geometryBufferRenderer=new t.a(this,
b);this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null);return this._geometryBufferRenderer};u.a.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var p=function(){function b(c){this.name=l.a.NAME_GEOMETRYBUFFERRENDERER;this.scene=c}b.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(l.a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,
this._gatherRenderTargets)};b.prototype.rebuild=function(){};b.prototype.dispose=function(){};b.prototype._gatherRenderTargets=function(c){this.scene._geometryBufferRenderer&&c.push(this.scene._geometryBufferRenderer.getGBuffer())};return b}();t.a._SceneComponentInitialization=function(b){var c=b._getComponent(l.a.NAME_GEOMETRYBUFFERRENDERER);c||(c=new p(b),b._addComponent(c))}},b7XG:function(u,v,b){b.d(v,"a",function(){return l});var l=function(){return function(){this.enabled=!1;this.name="screenSpaceReflections";
this.texturesRequired=[5,3,1]}}()},gyD2:function(u,v,b){b.d(v,"a",function(){return c});var l=b("oYeq"),t=b("ADVu"),p=b("srWW"),g=b("/SR9");u=b("KbzI");u.a.prototype.removeReflectionProbe=function(c){if(!this.reflectionProbes)return-1;c=this.reflectionProbes.indexOf(c);-1!==c&&this.reflectionProbes.splice(c,1);return c};u.a.prototype.addReflectionProbe=function(c){this.reflectionProbes||(this.reflectionProbes=[]);this.reflectionProbes.push(c)};var c=function(){function c(c,b,h,f,l){var d=this;void 0===
f&&(f=!0);void 0===l&&(l=!1);this.name=c;this._viewMatrix=g.a.Identity();this._target=g.e.Zero();this._add=g.e.Zero();this._invertYAxis=!1;this.position=g.e.Zero();this._scene=h;this._scene.reflectionProbes||(this._scene.reflectionProbes=[]);this._scene.reflectionProbes.push(this);var a=0;l&&(l=this._scene.getEngine().getCaps(),l.textureHalfFloatRender?a=2:l.textureFloatRender&&(a=1));this._renderTargetTexture=new p.a(c,b,h,f,!0,a,!0);this._renderTargetTexture.onBeforeRenderObservable.add(function(a){switch(a){case 0:d._add.copyFromFloats(1,
0,0);break;case 1:d._add.copyFromFloats(-1,0,0);break;case 2:d._add.copyFromFloats(0,d._invertYAxis?1:-1,0);break;case 3:d._add.copyFromFloats(0,d._invertYAxis?-1:1,0);break;case 4:d._add.copyFromFloats(0,0,1);break;case 5:d._add.copyFromFloats(0,0,-1)}d._attachedMesh&&d.position.copyFrom(d._attachedMesh.getAbsolutePosition());d.position.addToRef(d._add,d._target);g.a.LookAtLHToRef(d.position,d._target,g.e.Up(),d._viewMatrix);h.activeCamera&&(d._projectionMatrix=g.a.PerspectiveFovLH(Math.PI/2,1,h.activeCamera.minZ,
h.activeCamera.maxZ),h.setTransformMatrix(d._viewMatrix,d._projectionMatrix));h._forcedViewPosition=d.position});this._renderTargetTexture.onAfterUnbindObservable.add(function(){h._forcedViewPosition=null;h.updateTransformMatrix(!0)})}Object.defineProperty(c.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(c){this._renderTargetTexture.samples=c},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},
set:function(c){this._renderTargetTexture.refreshRate=c},enumerable:!1,configurable:!0});c.prototype.getScene=function(){return this._scene};Object.defineProperty(c.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!1,configurable:!0});c.prototype.attachToMesh=function(c){this._attachedMesh=c};c.prototype.setRenderingAutoClearDepthStencil=
function(c,b){this._renderTargetTexture.setRenderingAutoClearDepthStencil(c,b)};c.prototype.dispose=function(){var c=this._scene.reflectionProbes.indexOf(this);-1!==c&&this._scene.reflectionProbes.splice(c,1);this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)};c.prototype.toString=function(c){var b="Name: "+this.name;c&&(b+=", position: "+this.position.toString(),this._attachedMesh&&(b+=", attached mesh: "+this._attachedMesh.name));return b};c.prototype.getClassName=
function(){return"ReflectionProbe"};c.prototype.serialize=function(){var c=t.a.Serialize(this,this._renderTargetTexture.serialize());c.isReflectionProbe=!0;return c};c.Parse=function(b,f,h){var g=null;if(f.reflectionProbes)for(var l=0;l<f.reflectionProbes.length;l++){var d=f.reflectionProbes[l];if(d.name===b.name){g=d;break}}g=t.a.Parse(function(){return g||new c(b.name,b.renderTargetSize,f,b._generateMipMaps)},b,f,h);g.cubeTexture._waitingRenderList=b.renderList;b._attachedMesh&&g.attachToMesh(f.getMeshByID(b._attachedMesh));
return g};Object(l.c)([Object(t.k)()],c.prototype,"_attachedMesh",void 0);Object(l.c)([Object(t.o)()],c.prototype,"position",void 0);return c}()},kJhO:function(u,v,b){b.d(v,"a",function(){return m});var l=b("Xeau"),t=b("y4Ty"),p=b("aCSs"),g=b("srWW"),c=b("/eyM");b("uWGR");b("eSPP");var f=b("n5HA"),m=function(){function b(h,f,m,d){var a=this;void 0===f&&(f=1);void 0===m&&(m=null);void 0===d&&(d=!1);this.enabled=!0;this.useOnlyInActiveCamera=!1;this._scene=h;this._storeNonLinearDepth=d;this._clearColor=
(this.isPacked=0===f)?new l.b(1,1,1,1):new l.b(1,0,0,1);b._SceneComponentInitialization(this._scene);this._camera=m;var n=h.getEngine();h=this.isPacked||1===n.webGLVersion?5:6;this._depthMap=new g.a("depthMap",{width:n.getRenderWidth(),height:n.getRenderHeight()},this._scene,!1,!0,f,!1,void 0,void 0,void 0,void 0,h);this._depthMap.wrapU=p.a.CLAMP_ADDRESSMODE;this._depthMap.wrapV=p.a.CLAMP_ADDRESSMODE;this._depthMap.refreshRate=1;this._depthMap.renderParticles=!1;this._depthMap.renderList=null;this._depthMap.activeCamera=
this._camera;this._depthMap.ignoreCameraViewport=!0;this._depthMap.useCameraPostProcesses=!1;this._depthMap.onClearObservable.add(function(c){c.clear(a._clearColor,!0,!0,!0)});var r=function(b){var d=b.getRenderingMesh(),f=b.getEffectiveMesh(),h=a._scene,g=h.getEngine(),l=b.getMaterial();f._internalAbstractMeshDataInfo._isActiveIntermediate=!1;if(l&&0!==b.verticesCount&&b._renderId!==h.getRenderId()){g.setState(l.backFaceCulling,0,!1,h.useRightHandedSystem);var n=d._getInstancesRenderList(b._id,!!b.getReplacementMesh());
if(!n.mustReturn){var m=g.getCaps().instancedArrays&&(null!==n.visibleInstances[b._id]&&void 0!==n.visibleInstances[b._id]||d.hasThinInstances),r=a._camera||h.activeCamera;a.isReady(b,m)&&r&&(b._renderId=h.getRenderId(),g.enableEffect(a._effect),d._bind(b,a._effect,l.fillMode),a._effect.setMatrix("viewProjection",h.getTransformMatrix()),a._effect.setFloat2("depthValues",r.minZ,r.minZ+r.maxZ),l&&l.needAlphaTesting()&&(h=l.getAlphaTestTexture())&&(a._effect.setTexture("diffuseSampler",h),a._effect.setMatrix("diffuseMatrix",
h.getTextureMatrix())),d.useBones&&d.computeBonesUsingShaders&&d.skeleton&&a._effect.setMatrices("mBones",d.skeleton.getTransformMatrices(d)),c.a.BindMorphTargetParameters(d,a._effect),d._processRendering(f,b,a._effect,l.fillMode,n,m,function(c,b){return a._effect.setMatrix("world",b)}))}}};this._depthMap.customRenderFunction=function(a,c,b,d){if(d.length){n.setColorWrite(!1);for(b=0;b<d.length;b++)r(d.data[b]);n.setColorWrite(!0)}for(b=0;b<a.length;b++)r(a.data[b]);for(b=0;b<c.length;b++)r(c.data[b])}}
b.prototype.isReady=function(b,f){var h=b.getMaterial();if(h.disableDepthWrite)return!1;var d=[],a=[t.b.PositionKind],g=b.getMesh();h&&h.needAlphaTesting()&&h.getAlphaTestTexture()&&(d.push("#define ALPHATEST"),g.isVerticesDataPresent(t.b.UVKind)&&(a.push(t.b.UVKind),d.push("#define UV1")),g.isVerticesDataPresent(t.b.UV2Kind)&&(a.push(t.b.UV2Kind),d.push("#define UV2")));g.useBones&&g.computeBonesUsingShaders?(a.push(t.b.MatricesIndicesKind),a.push(t.b.MatricesWeightsKind),4<g.numBoneInfluencers&&
(a.push(t.b.MatricesIndicesExtraKind),a.push(t.b.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+g.numBoneInfluencers),d.push("#define BonesPerMesh "+(g.skeleton?g.skeleton.bones.length+1:0))):d.push("#define NUM_BONE_INFLUENCERS 0");var l=g.morphTargetManager;h=0;l&&0<l.numInfluencers&&(h=l.numInfluencers,d.push("#define MORPHTARGETS"),d.push("#define NUM_MORPH_INFLUENCERS "+h),c.a.PrepareAttributesForMorphTargetsInfluencers(a,g,h));f&&(d.push("#define INSTANCES"),c.a.PushAttributesForInstances(a),
b.getRenderingMesh().hasThinInstances&&d.push("#define THIN_INSTANCES"));this._storeNonLinearDepth&&d.push("#define NONLINEARDEPTH");this.isPacked&&d.push("#define PACKED");b=d.join("\n");this._cachedDefines!==b&&(this._cachedDefines=b,this._effect=this._scene.getEngine().createEffect("depth",a,"world mBones viewProjection diffuseMatrix depthValues morphTargetInfluences".split(" "),["diffuseSampler"],b,void 0,void 0,void 0,{maxSimultaneousMorphTargets:h}));return this._effect.isReady()};b.prototype.getDepthMap=
function(){return this._depthMap};b.prototype.dispose=function(){this._depthMap.dispose()};b._SceneComponentInitialization=function(b){throw f.a.WarnImport("DepthRendererSceneComponent");};return b}()},zRBM:function(u,v,b){b.d(v,"a",function(){return x});var l=b("tVVT"),t=b("ps+7"),p=b("98Qd"),g=b("e2Mr"),c=b("SqLj"),f=b("/SR9"),m=b("Xeau"),x=function(){function b(b,c){var d=this;void 0===c&&(c=!0);this.originalScene=b;this._pointerCaptures={};this._lastPointerEvents={};this._renderCamera=this._sharedGizmoLight=
null;this.onlyCheckPointerDownEvents=this.shouldRender=this.pickUtilitySceneFirst=!0;this.processAllEvents=!1;this.onPointerOutObservable=new t.a;this.utilityLayerScene=new l.a(b.getEngine(),{virtual:!0});this.utilityLayerScene.useRightHandedSystem=b.useRightHandedSystem;this.utilityLayerScene._allowPostProcessClearColor=!1;this.utilityLayerScene.detachControl();c&&(this._originalPointerObserver=b.onPrePointerObservable.add(function(a,c){if(d.utilityLayerScene.activeCamera&&(d.processAllEvents||a.type===
p.a.POINTERMOVE||a.type===p.a.POINTERUP||a.type===p.a.POINTERDOWN||a.type===p.a.POINTERDOUBLETAP)){d.utilityLayerScene.pointerX=b.pointerX;d.utilityLayerScene.pointerY=b.pointerY;var f=a.event;if(b.isPointerCaptured(f.pointerId))d._pointerCaptures[f.pointerId]=!1;else if(c=a.ray?d.utilityLayerScene.pickWithRay(a.ray):d.utilityLayerScene.pick(b.pointerX,b.pointerY),!a.ray&&c&&(a.ray=c.ray),d.utilityLayerScene.onPrePointerObservable.notifyObservers(a),d.onlyCheckPointerDownEvents&&a.type!=p.a.POINTERDOWN)a.skipOnPointerObservable||
d.utilityLayerScene.onPointerObservable.notifyObservers(new p.b(a.type,a.event,c),a.type),a.type===p.a.POINTERUP&&d._pointerCaptures[f.pointerId]&&(d._pointerCaptures[f.pointerId]=!1);else if(d.utilityLayerScene.autoClearDepthAndStencil||d.pickUtilitySceneFirst)c&&c.hit&&(a.skipOnPointerObservable||d.utilityLayerScene.onPointerObservable.notifyObservers(new p.b(a.type,a.event,c),a.type),a.skipOnPointerObservable=!0);else{f=a.ray?b.pickWithRay(a.ray):b.pick(b.pointerX,b.pointerY);var g=a.event;f&&
c&&(0===c.distance&&f.pickedMesh?d.mainSceneTrackerPredicate&&d.mainSceneTrackerPredicate(f.pickedMesh)?(d._notifyObservers(a,f,g),a.skipOnPointerObservable=!0):a.type===p.a.POINTERDOWN?d._pointerCaptures[g.pointerId]=!0:d._lastPointerEvents[g.pointerId]&&(d.onPointerOutObservable.notifyObservers(g.pointerId),delete d._lastPointerEvents[g.pointerId]):!d._pointerCaptures[g.pointerId]&&(c.distance<f.distance||0===f.distance)?(d._notifyObservers(a,c,g),a.skipOnPointerObservable||(a.skipOnPointerObservable=
0<c.distance)):!d._pointerCaptures[g.pointerId]&&c.distance>f.distance&&(d.mainSceneTrackerPredicate&&d.mainSceneTrackerPredicate(f.pickedMesh)?(d._notifyObservers(a,f,g),a.skipOnPointerObservable=!0):d._lastPointerEvents[g.pointerId]&&(d.onPointerOutObservable.notifyObservers(g.pointerId),delete d._lastPointerEvents[g.pointerId])),a.type===p.a.POINTERUP&&d._pointerCaptures[g.pointerId]&&(d._pointerCaptures[g.pointerId]=!1))}}}))&&b.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver);
this.utilityLayerScene.autoClear=!1;this._afterRenderObserver=this.originalScene.onAfterCameraRenderObservable.add(function(a){d.shouldRender&&a==d.getRenderCamera()&&d.render()});this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){d.dispose()});this._updateCamera()}b.prototype.getRenderCamera=function(b){if(this._renderCamera)return this._renderCamera;var c=this.originalScene.activeCameras&&1<this.originalScene.activeCameras.length?this.originalScene.activeCameras[this.originalScene.activeCameras.length-
1]:this.originalScene.activeCamera;return b&&c&&c.isRigCamera?c.rigParent:c};b.prototype.setRenderCamera=function(b){this._renderCamera=b};b.prototype._getSharedGizmoLight=function(){this._sharedGizmoLight||(this._sharedGizmoLight=new c.a("shared gizmo light",new f.e(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=m.a.Gray());return this._sharedGizmoLight};Object.defineProperty(b,"DefaultUtilityLayer",{get:function(){null==b._DefaultUtilityLayer&&
(b._DefaultUtilityLayer=new b(g.a.LastCreatedScene),b._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){b._DefaultUtilityLayer=null}));return b._DefaultUtilityLayer},enumerable:!1,configurable:!0});Object.defineProperty(b,"DefaultKeepDepthUtilityLayer",{get:function(){null==b._DefaultKeepDepthUtilityLayer&&(b._DefaultKeepDepthUtilityLayer=new b(g.a.LastCreatedScene),b._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,b._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){b._DefaultKeepDepthUtilityLayer=
null}));return b._DefaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0});b.prototype._notifyObservers=function(b,c,d){b.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new p.b(b.type,b.event,c),b.type),this._lastPointerEvents[d.pointerId]=!0)};b.prototype.render=function(){this._updateCamera();if(this.utilityLayerScene.activeCamera){var b=this.utilityLayerScene.activeCamera.getScene(),c=this.utilityLayerScene.activeCamera;c._scene=this.utilityLayerScene;
c.leftCamera&&(c.leftCamera._scene=this.utilityLayerScene);c.rightCamera&&(c.rightCamera._scene=this.utilityLayerScene);this.utilityLayerScene.render(!1);c._scene=b;c.leftCamera&&(c.leftCamera._scene=b);c.rightCamera&&(c.rightCamera._scene=b)}};b.prototype.dispose=function(){this.onPointerOutObservable.clear();this._afterRenderObserver&&this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver);this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver);
this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver);this.utilityLayerScene.dispose()};b.prototype._updateCamera=function(){this.utilityLayerScene.cameraToUseForPointers=this.getRenderCamera();this.utilityLayerScene.activeCamera=this.getRenderCamera()};b._DefaultUtilityLayer=null;b._DefaultKeepDepthUtilityLayer=null;return b}()}}]);
