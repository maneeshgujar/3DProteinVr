var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(l){var y=0;return function(){return y<l.length?{done:!1,value:l[y++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};$jscomp.makeIterator=function(l){var y="undefined"!=typeof Symbol&&Symbol.iterator&&l[Symbol.iterator];return y?y.call(l):$jscomp.arrayIterator(l)};
$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,y,h){l!=Array.prototype&&l!=Object.prototype&&(l[y]=h.value)};
$jscomp.polyfill=function(l,y,h,B){if(y){h=$jscomp.global;l=l.split(".");for(B=0;B<l.length-1;B++){var v=l[B];v in h||(h[v]={});h=h[v]}l=l[l.length-1];B=h[l];y=y(B);y!=B&&null!=y&&$jscomp.defineProperty(h,l,{configurable:!0,writable:!0,value:y})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(l){function y(){this.batch_=null}function h(p){return p instanceof v?p:new v(function(h,l){h(p)})}if(l&&!$jscomp.FORCE_POLYFILL_PROMISE)return l;y.prototype.asyncExecute=function(p){if(null==this.batch_){this.batch_=[];var h=this;this.asyncExecuteFunction(function(){h.executeBatch_()})}this.batch_.push(p)};var B=$jscomp.global.setTimeout;y.prototype.asyncExecuteFunction=function(p){B(p,0)};y.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var p=
this.batch_;this.batch_=[];for(var h=0;h<p.length;++h){var l=p[h];p[h]=null;try{l()}catch(H){this.asyncThrow_(H)}}}this.batch_=null};y.prototype.asyncThrow_=function(p){this.asyncExecuteFunction(function(){throw p;})};var v=function(p){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var h=this.createResolveAndReject_();try{p(h.resolve,h.reject)}catch(ba){h.reject(ba)}};v.prototype.createResolveAndReject_=function(){function p(p){return function(v){l||(l=!0,p.call(h,v))}}var h=this,l=
!1;return{resolve:p(this.resolveTo_),reject:p(this.reject_)}};v.prototype.resolveTo_=function(p){if(p===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(p instanceof v)this.settleSameAsPromise_(p);else{a:switch(typeof p){case "object":var h=null!=p;break a;case "function":h=!0;break a;default:h=!1}h?this.resolveToNonPromiseObj_(p):this.fulfill_(p)}};v.prototype.resolveToNonPromiseObj_=function(p){var h=void 0;try{h=p.then}catch(ba){this.reject_(ba);return}"function"==
typeof h?this.settleSameAsThenable_(h,p):this.fulfill_(p)};v.prototype.reject_=function(h){this.settle_(2,h)};v.prototype.fulfill_=function(h){this.settle_(1,h)};v.prototype.settle_=function(h,l){if(0!=this.state_)throw Error("Cannot settle("+h+", "+l+"): Promise already settled in state"+this.state_);this.state_=h;this.result_=l;this.executeOnSettledCallbacks_()};v.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var h=0;h<this.onSettledCallbacks_.length;++h)F.asyncExecute(this.onSettledCallbacks_[h]);
this.onSettledCallbacks_=null}};var F=new y;v.prototype.settleSameAsPromise_=function(h){var p=this.createResolveAndReject_();h.callWhenSettled_(p.resolve,p.reject)};v.prototype.settleSameAsThenable_=function(h,l){var p=this.createResolveAndReject_();try{h.call(l,p.resolve,p.reject)}catch(H){p.reject(H)}};v.prototype.then=function(h,l){function p(h,p){return"function"==typeof h?function(p){try{y(h(p))}catch(I){B(I)}}:p}var y,B,F=new v(function(h,p){y=h;B=p});this.callWhenSettled_(p(h,y),p(l,B));return F};
v.prototype.catch=function(h){return this.then(void 0,h)};v.prototype.callWhenSettled_=function(h,l){function p(){switch(v.state_){case 1:h(v.result_);break;case 2:l(v.result_);break;default:throw Error("Unexpected state: "+v.state_);}}var v=this;null==this.onSettledCallbacks_?F.asyncExecute(p):this.onSettledCallbacks_.push(p)};v.resolve=h;v.reject=function(h){return new v(function(p,l){l(h)})};v.race=function(p){return new v(function(l,v){for(var y=$jscomp.makeIterator(p),B=y.next();!B.done;B=y.next())h(B.value).callWhenSettled_(l,
v)})};v.all=function(p){var l=$jscomp.makeIterator(p),y=l.next();return y.done?h([]):new v(function(p,v){function B(h){return function(l){F[h]=l;H--;0==H&&p(F)}}var F=[],H=0;do F.push(void 0),H++,h(y.value).callWhenSettled_(B(F.length-1),v),y=l.next();while(!y.done)})};return v},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(l,y){this.$jscomp$symbol$id_=l;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:y})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function l(h){if(this instanceof l)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(h||"")+"_"+y++,h)}var y=0;return l}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.iterator;l||(l=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[l]&&$jscomp.defineProperty(Array.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.asyncIterator;l||(l=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(l){$jscomp.initSymbolIterator();l={next:l};l[$jscomp.global.Symbol.iterator]=function(){return this};return l};
$jscomp.iteratorFromArray=function(l,y){$jscomp.initSymbolIterator();l instanceof String&&(l+="");var h=0,B={next:function(){if(h<l.length){var v=h++;return{value:y(v,l[v]),done:!1}}B.next=function(){return{done:!0,value:void 0}};return B.next()}};B[Symbol.iterator]=function(){return B};return B};$jscomp.polyfill("Array.prototype.values",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(l,h){return h})}},"es8","es3");
$jscomp.polyfill("Array.prototype.keys",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(l){return l})}},"es6","es3");
(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{dSwm:function(l,y,h){function B(a,b,c,d){var e={externalResourceFunction:function(b){return d(b).then(function(b){return new Uint8Array(b)})}};c&&(e.uri="file:"===b?c:b+c);return a instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(a),e):GLTFValidator.validateString(a,e)}function v(){var a=[];onmessage=function(b){b=b.data;switch(b.id){case "init":importScripts(b.url);break;case "validate":B(b.data,b.rootUrl,b.fileName,function(b){return new Promise(function(c,
e){var d=a.length;a.push({resolve:c,reject:e});postMessage({id:"getExternalResource",index:d,uri:b})})}).then(function(b){postMessage({id:"validate.resolve",value:b})},function(b){postMessage({id:"validate.reject",reason:b})});break;case "getExternalResource.resolve":a[b.index].resolve(b.value);break;case "getExternalResource.reject":a[b.index].reject(b.reason)}}}var F=h("ps+7"),p=h("YKqZ"),wa=h("R0D4"),ba=h("FH9a"),H=h("uyO6"),ja=h("JXbM"),Na=function(){function a(){}a.ValidateAsync=function(b,c,
d,a){var e=this;if("function"===typeof Worker)return new Promise(function(f,m){var g=URL.createObjectURL(new Blob([B+"("+v+")()"],{type:"application/javascript"})),q=new Worker(g),u=function(b){q.removeEventListener("error",u);q.removeEventListener("message",A);m(b)},A=function(b){var c=b.data;switch(c.id){case "getExternalResource":a(c.uri).then(function(b){q.postMessage({id:"getExternalResource.resolve",index:c.index,value:b},[b])},function(b){q.postMessage({id:"getExternalResource.reject",index:c.index,
reason:b})});break;case "validate.resolve":q.removeEventListener("error",u);q.removeEventListener("message",A);f(c.value);break;case "validate.reject":q.removeEventListener("error",u),q.removeEventListener("message",A),m(c.reason)}};q.addEventListener("error",u);q.addEventListener("message",A);q.postMessage({id:"init",url:p.b.GetAbsoluteUrl(e.Configuration.url)});q.postMessage({id:"validate",data:b,rootUrl:c,fileName:d})});this._LoadScriptPromise||(this._LoadScriptPromise=p.b.LoadScriptAsync(this.Configuration.url));
return this._LoadScriptPromise.then(function(){return B(b,c,d,a)})};a.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"};return a}(),X=h("X2Ve"),ca;(function(a){a[a.AUTO=0]="AUTO";a[a.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"})(ca||(ca={}));var Y;(function(a){a[a.NONE=0]="NONE";a[a.FIRST=1]="FIRST";a[a.ALL=2]="ALL"})(Y||(Y={}));var I;(function(a){a[a.LOADING=0]="LOADING";a[a.READY=1]="READY";a[a.COMPLETE=2]="COMPLETE"})(I||(I={}));var T=function(){function a(){this.onParsedObservable=
new F.a;this.coordinateSystemMode=ca.AUTO;this.animationStartMode=Y.FIRST;this.useRangeRequests=this.transparencyAsCoverage=this.compileShadowGenerators=this.useClipPlane=this.compileMaterials=!1;this.createInstances=!0;this.loadAllMaterials=this.alwaysComputeBoundingBox=!1;this.preprocessUrlAsync=function(b){return Promise.resolve(b)};this.onMeshLoadedObservable=new F.a;this.onTextureLoadedObservable=new F.a;this.onMaterialLoadedObservable=new F.a;this.onCameraLoadedObservable=new F.a;this.onCompleteObservable=
new F.a;this.onErrorObservable=new F.a;this.onDisposeObservable=new F.a;this.onExtensionLoadedObservable=new F.a;this.validate=!1;this.onValidatedObservable=new F.a;this._loader=null;this._requests=[];this.name="gltf";this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}};this._logIndentLevel=0;this._loggingEnabled=!1;this._log=this._logDisabled;this._capturePerformanceCounters=!1;this._startPerformanceCounter=this._startPerformanceCounterDisabled;this._endPerformanceCounter=this._endPerformanceCounterDisabled}
Object.defineProperty(a.prototype,"onParsed",{set:function(b){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver);this._onParsedObserver=this.onParsedObservable.add(b)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"onMeshLoaded",{set:function(b){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver);this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(b)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"onTextureLoaded",{set:function(b){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver);this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(b)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"onMaterialLoaded",{set:function(b){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver);this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(b)},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"onCameraLoaded",{set:function(b){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver);this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(b)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"onComplete",{set:function(b){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver);this._onCompleteObserver=this.onCompleteObservable.add(b)},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"onError",{set:function(b){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver);this._onErrorObserver=this.onErrorObservable.add(b)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"onDispose",{set:function(b){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(b)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"onExtensionLoaded",
{set:function(b){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver);this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(b)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(b){this._loggingEnabled!==b&&(this._log=(this._loggingEnabled=b)?this._logEnabled:this._logDisabled)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(b){this._capturePerformanceCounters!==b&&((this._capturePerformanceCounters=b)?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"onValidated",{set:function(b){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver);this._onValidatedObserver=this.onValidatedObservable.add(b)},enumerable:!1,configurable:!0});a.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var b=0,c=this._requests;b<c.length;b++)c[b].abort();this._requests.length=0;delete this._progressCallback;this.preprocessUrlAsync=function(b){return Promise.resolve(b)};this.onMeshLoadedObservable.clear();
this.onTextureLoadedObservable.clear();this.onMaterialLoadedObservable.clear();this.onCameraLoadedObservable.clear();this.onCompleteObservable.clear();this.onExtensionLoadedObservable.clear();this.onDisposeObservable.notifyObservers(void 0);this.onDisposeObservable.clear()};a.prototype.requestFile=function(b,c,d,a,f,g){var e=this;this._progressCallback=a;if(f){if(this.useRangeRequests){this.validate&&H.a.Warn("glTF validation is not supported when range requests are enabled");var k={abort:function(){},
onCompleteObservable:new F.a};this._unpackBinaryAsync(new ja.a({readAsync:function(d,a){return new Promise(function(f,g){e._requestFile(c,b,function(b){f(new Uint8Array(b))},!0,function(b){g(b)},function(b){b.setRequestHeader("Range","bytes="+d+"-"+(d+a-1))})})},byteLength:0})).then(function(b){k.onCompleteObservable.notifyObservers(k);d(b)},g);return k}return this._requestFile(c,b,function(b,c){e._unpackBinaryAsync(new ja.a({readAsync:function(c,d){return Promise.resolve(new Uint8Array(b,c,d))},
byteLength:b.byteLength})).then(function(b){d(b,c)},g)},!0,g)}return this._requestFile(c,b,function(a,f){e._validate(b,a,p.b.GetFolderPath(c),p.b.GetFilename(c));d({json:e._parseJson(a)},f)},f,g)};a.prototype.readFile=function(b,c,d,a,f,g){var e=this;return b._readFile(c,function(a){e._validate(b,a,"file:",c.name);f?e._unpackBinaryAsync(new ja.a({readAsync:function(b,c){return Promise.resolve(new Uint8Array(a,b,c))},byteLength:a.byteLength})).then(d,g):d({json:e._parseJson(a)})},a,f,g)};a.prototype.importMeshAsync=
function(b,c,d,a,f,g){var e=this;return Promise.resolve().then(function(){e.onParsedObservable.notifyObservers(d);e.onParsedObservable.clear();e._log("Loading "+(g||""));e._loader=e._getLoader(d);return e._loader.importMeshAsync(b,c,!1,d,a,f,g)})};a.prototype.loadAsync=function(b,c,d,a,f){var e=this;return Promise.resolve().then(function(){e.onParsedObservable.notifyObservers(c);e.onParsedObservable.clear();e._log("Loading "+(f||""));e._loader=e._getLoader(c);return e._loader.loadAsync(b,c,d,a,f)})};
a.prototype.loadAssetContainerAsync=function(b,c,d,a,f){var e=this;return Promise.resolve().then(function(){e.onParsedObservable.notifyObservers(c);e.onParsedObservable.clear();e._log("Loading "+(f||""));e._loader=e._getLoader(c);var g=new ba.a(b),k=[];e.onMaterialLoadedObservable.add(function(b){k.push(b);b.onDisposeObservable.addOnce(function(){var c=g.materials.indexOf(b);-1<c&&g.materials.splice(c,1);c=k.indexOf(b);-1<c&&k.splice(c,1)})});var q=[];e.onTextureLoadedObservable.add(function(b){q.push(b);
b.onDisposeObservable.addOnce(function(){var c=g.textures.indexOf(b);-1<c&&g.textures.splice(c,1);c=q.indexOf(b);-1<c&&q.splice(c,1)})});var u=[];e.onCameraLoadedObservable.add(function(b){u.push(b)});return e._loader.importMeshAsync(null,b,!0,c,d,a,f).then(function(b){Array.prototype.push.apply(g.geometries,b.geometries);Array.prototype.push.apply(g.meshes,b.meshes);Array.prototype.push.apply(g.particleSystems,b.particleSystems);Array.prototype.push.apply(g.skeletons,b.skeletons);Array.prototype.push.apply(g.animationGroups,
b.animationGroups);Array.prototype.push.apply(g.materials,k);Array.prototype.push.apply(g.textures,q);Array.prototype.push.apply(g.lights,b.lights);Array.prototype.push.apply(g.transformNodes,b.transformNodes);Array.prototype.push.apply(g.cameras,u);return g})})};a.prototype.canDirectLoad=function(b){return-1!==b.indexOf("asset")&&-1!==b.indexOf("version")||X.a.StartsWith(b,"data:base64,"+a.magicBase64Encoded)||X.a.StartsWith(b,"data:application/octet-stream;base64,"+a.magicBase64Encoded)||X.a.StartsWith(b,
"data:model/gltf-binary;base64,"+a.magicBase64Encoded)};a.prototype.directLoad=function(b,c){if(X.a.StartsWith(c,"base64,"+a.magicBase64Encoded)||X.a.StartsWith(c,"application/octet-stream;base64,"+a.magicBase64Encoded)||X.a.StartsWith(c,"model/gltf-binary;base64,"+a.magicBase64Encoded)){var d=p.b.DecodeBase64(c);this._validate(b,d);return this._unpackBinaryAsync(new ja.a({readAsync:function(b,c){return Promise.resolve(new Uint8Array(d,b,c))},byteLength:d.byteLength}))}this._validate(b,c);return Promise.resolve({json:this._parseJson(c)})};
a.prototype.createPlugin=function(){return new a};Object.defineProperty(a.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!1,configurable:!0});a.prototype.whenCompleteAsync=function(){var b=this;return new Promise(function(c,d){b.onCompleteObservable.addOnce(function(){c()});b.onErrorObservable.addOnce(function(b){d(b)})})};a.prototype._loadFile=function(b,c,d,a,f){var e=this,m=c._loadFile(b,d,function(b){e._onProgress(b,m)},void 0,a,f);m.onCompleteObservable.add(function(b){e._requests.splice(e._requests.indexOf(b),
1)});this._requests.push(m);return m};a.prototype._requestFile=function(b,c,d,a,f,g){var e=this,k=c._requestFile(b,d,function(b){e._onProgress(b,k)},void 0,a,f,g);k.onCompleteObservable.add(function(b){e._requests.splice(e._requests.indexOf(b),1)});this._requests.push(k);return k};a.prototype._onProgress=function(b,c){if(this._progressCallback){c._lengthComputable=b.lengthComputable;c._loaded=b.loaded;c._total=b.total;b=!0;for(var d=c=0,a=0,f=this._requests;a<f.length;a++){var g=f[a];if(void 0===
g._lengthComputable||void 0===g._loaded||void 0===g._total)return;b=b&&g._lengthComputable;c+=g._loaded;d+=g._total}this._progressCallback({lengthComputable:b,loaded:c,total:b?d:0})}};a.prototype._validate=function(b,c,d,a){var e=this;void 0===d&&(d="");void 0===a&&(a="");this.validate&&(this._startPerformanceCounter("Validate JSON"),Na.ValidateAsync(c,d,a,function(c){return e.preprocessUrlAsync(d+c).then(function(c){return b._loadFileAsync(c,void 0,!0,!0)})}).then(function(b){e._endPerformanceCounter("Validate JSON");
e.onValidatedObservable.notifyObservers(b);e.onValidatedObservable.clear()},function(b){e._endPerformanceCounter("Validate JSON");p.b.Warn("Failed to validate: "+b.message);e.onValidatedObservable.clear()}))};a.prototype._getLoader=function(b){b=b.json.asset||{};this._log("Asset version: "+b.version);b.minVersion&&this._log("Asset minimum version: "+b.minVersion);b.generator&&this._log("Asset generator: "+b.generator);var c=a._parseVersion(b.version);if(!c)throw Error("Invalid version: "+b.version);
if(void 0!==b.minVersion){var d=a._parseVersion(b.minVersion);if(!d)throw Error("Invalid minimum version: "+b.minVersion);if(0<a._compareVersion(d,{major:2,minor:0}))throw Error("Incompatible minimum version: "+b.minVersion);}c={1:a._CreateGLTF1Loader,2:a._CreateGLTF2Loader}[c.major];if(!c)throw Error("Unsupported version: "+b.version);return c(this)};a.prototype._parseJson=function(b){this._startPerformanceCounter("Parse JSON");this._log("JSON length: "+b.length);b=JSON.parse(b);this._endPerformanceCounter("Parse JSON");
return b};a.prototype._unpackBinaryAsync=function(b){var c=this;this._startPerformanceCounter("Unpack Binary");return b.loadAsync(20).then(function(){var d=b.readUint32();if(1179937895!==d)throw Error("Unexpected magic: "+d);d=b.readUint32();c.loggingEnabled&&c._log("Binary version: "+d);var a=b.readUint32();if(0!==b.buffer.byteLength&&a!==b.buffer.byteLength)throw Error("Length in header does not match actual data length: "+a+" != "+b.buffer.byteLength);switch(d){case 1:d=c._unpackBinaryV1Async(b,
a);break;case 2:d=c._unpackBinaryV2Async(b,a);break;default:throw Error("Unsupported version: "+d);}c._endPerformanceCounter("Unpack Binary");return d})};a.prototype._unpackBinaryV1Async=function(b,c){var d=b.readUint32(),a=b.readUint32();if(0!==a)throw Error("Unexpected content format: "+a);c-=b.byteOffset;d={json:this._parseJson(b.readString(d)),bin:null};if(0!==c){var f=b.byteOffset;d.bin={readAsync:function(c,d){return b.buffer.readAsync(f+c,d)},byteLength:c}}return Promise.resolve(d)};a.prototype._unpackBinaryV2Async=
function(b,c){var d=this,a=b.readUint32();if(1313821514!==b.readUint32())throw Error("First chunk format is not JSON");return b.byteOffset+a===c?b.loadAsync(a).then(function(){return{json:d._parseJson(b.readString(a)),bin:null}}):b.loadAsync(a+8).then(function(){var e={json:d._parseJson(b.readString(a)),bin:null},g=function(){var d=b.readUint32();switch(b.readUint32()){case 1313821514:throw Error("Unexpected JSON chunk");case 5130562:var a=b.byteOffset;e.bin={readAsync:function(c,d){return b.buffer.readAsync(a+
c,d)},byteLength:d};b.skipBytes(d);break;default:b.skipBytes(d)}return b.byteOffset!==c?b.loadAsync(8).then(g):Promise.resolve(e)};return g()})};a._parseVersion=function(b){return"1.0"===b||"1.0.1"===b?{major:1,minor:0}:(b=(b+"").match(/^(\d+)\.(\d+)/))?{major:parseInt(b[1]),minor:parseInt(b[2])}:null};a._compareVersion=function(b,c){return b.major>c.major?1:b.major<c.major?-1:b.minor>c.minor?1:b.minor<c.minor?-1:0};a.prototype._logOpen=function(b){this._log(b);this._logIndentLevel++};a.prototype._logClose=
function(){--this._logIndentLevel};a.prototype._logEnabled=function(b){var c=a._logSpaces.substr(0,2*this._logIndentLevel);H.a.Log(""+c+b)};a.prototype._logDisabled=function(b){};a.prototype._startPerformanceCounterEnabled=function(b){p.b.StartPerformanceCounter(b)};a.prototype._startPerformanceCounterDisabled=function(b){};a.prototype._endPerformanceCounterEnabled=function(b){p.b.EndPerformanceCounter(b)};a.prototype._endPerformanceCounterDisabled=function(b){};a.IncrementalLoading=!0;a.HomogeneousCoordinates=
!1;a.magicBase64Encoded="Z2xURg";a._logSpaces="                                ";return a}();wa.a&&wa.a.RegisterPlugin(new T);var Z=h("mrSG"),U;(function(a){a[a.BYTE=5120]="BYTE";a[a.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";a[a.SHORT=5122]="SHORT";a[a.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";a[a.FLOAT=5126]="FLOAT"})(U||(U={}));var ka;(function(a){a[a.FRAGMENT=35632]="FRAGMENT";a[a.VERTEX=35633]="VERTEX"})(ka||(ka={}));var K;(function(a){a[a.BYTE=5120]="BYTE";a[a.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";a[a.SHORT=
5122]="SHORT";a[a.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";a[a.INT=5124]="INT";a[a.UNSIGNED_INT=5125]="UNSIGNED_INT";a[a.FLOAT=5126]="FLOAT";a[a.FLOAT_VEC2=35664]="FLOAT_VEC2";a[a.FLOAT_VEC3=35665]="FLOAT_VEC3";a[a.FLOAT_VEC4=35666]="FLOAT_VEC4";a[a.INT_VEC2=35667]="INT_VEC2";a[a.INT_VEC3=35668]="INT_VEC3";a[a.INT_VEC4=35669]="INT_VEC4";a[a.BOOL=35670]="BOOL";a[a.BOOL_VEC2=35671]="BOOL_VEC2";a[a.BOOL_VEC3=35672]="BOOL_VEC3";a[a.BOOL_VEC4=35673]="BOOL_VEC4";a[a.FLOAT_MAT2=35674]="FLOAT_MAT2";a[a.FLOAT_MAT3=
35675]="FLOAT_MAT3";a[a.FLOAT_MAT4=35676]="FLOAT_MAT4";a[a.SAMPLER_2D=35678]="SAMPLER_2D"})(K||(K={}));var da;(function(a){a[a.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";a[a.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT";a[a.REPEAT=10497]="REPEAT"})(da||(da={}));var O;(function(a){a[a.NEAREST=9728]="NEAREST";a[a.LINEAR=9728]="LINEAR";a[a.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";a[a.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";a[a.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";a[a.LINEAR_MIPMAP_LINEAR=
9987]="LINEAR_MIPMAP_LINEAR"})(O||(O={}));var xa;(function(a){a[a.ALPHA=6406]="ALPHA";a[a.RGB=6407]="RGB";a[a.RGBA=6408]="RGBA";a[a.LUMINANCE=6409]="LUMINANCE";a[a.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"})(xa||(xa={}));var la;(function(a){a[a.FRONT=1028]="FRONT";a[a.BACK=1029]="BACK";a[a.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(la||(la={}));var E;(function(a){a[a.ZERO=0]="ZERO";a[a.ONE=1]="ONE";a[a.SRC_COLOR=768]="SRC_COLOR";a[a.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";a[a.DST_COLOR=774]="DST_COLOR";
a[a.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";a[a.SRC_ALPHA=770]="SRC_ALPHA";a[a.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";a[a.DST_ALPHA=772]="DST_ALPHA";a[a.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";a[a.CONSTANT_COLOR=32769]="CONSTANT_COLOR";a[a.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";a[a.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";a[a.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA";a[a.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(E||(E={}));var r=h("/SR9"),
C=h("Xeau"),ya=h("CAkI"),ma=h("sdjL"),P=h("mBE3"),ea=h("5WzX"),na=h("btC8"),W=h("Z6Y1"),N=h("cdI9"),Oa=h("jI0L"),oa=h("kdvT"),za=h("NDL1"),D=h("aCSs"),Pa=h("UtUh"),z=h("y4Ty"),pa=h("yk6c"),Qa=h("C1Wc"),Ra=h("ikaq"),Q=h("wAMR"),Aa=h("SqLj"),qa=h("lFBE"),ra=h("zZL8"),sa=h("pVyc"),M=function(){function a(){}a.SetMatrix=function(b,c,d,a,f){var e=null;if("MODEL"===d.semantic)e=c.getWorldMatrix();else if("PROJECTION"===d.semantic)e=b.getProjectionMatrix();else if("VIEW"===d.semantic)e=b.getViewMatrix();
else if("MODELVIEWINVERSETRANSPOSE"===d.semantic)e=r.a.Transpose(c.getWorldMatrix().multiply(b.getViewMatrix()).invert());else if("MODELVIEW"===d.semantic)e=c.getWorldMatrix().multiply(b.getViewMatrix());else if("MODELVIEWPROJECTION"===d.semantic)e=c.getWorldMatrix().multiply(b.getTransformMatrix());else if("MODELINVERSE"===d.semantic)e=c.getWorldMatrix().invert();else if("VIEWINVERSE"===d.semantic)e=b.getViewMatrix().invert();else if("PROJECTIONINVERSE"===d.semantic)e=b.getProjectionMatrix().invert();
else if("MODELVIEWINVERSE"===d.semantic)e=c.getWorldMatrix().multiply(b.getViewMatrix()).invert();else if("MODELVIEWPROJECTIONINVERSE"===d.semantic)e=c.getWorldMatrix().multiply(b.getTransformMatrix()).invert();else if("MODELINVERSETRANSPOSE"===d.semantic)e=r.a.Transpose(c.getWorldMatrix().invert());else debugger;if(e)switch(d.type){case K.FLOAT_MAT2:f.setMatrix2x2(a,r.a.GetAsMatrix2x2(e));break;case K.FLOAT_MAT3:f.setMatrix3x3(a,r.a.GetAsMatrix3x3(e));break;case K.FLOAT_MAT4:f.setMatrix(a,e)}};a.SetUniform=
function(b,c,d,a){switch(a){case K.FLOAT:return b.setFloat(c,d),!0;case K.FLOAT_VEC2:return b.setVector2(c,r.d.FromArray(d)),!0;case K.FLOAT_VEC3:return b.setVector3(c,r.e.FromArray(d)),!0;case K.FLOAT_VEC4:return b.setVector4(c,r.f.FromArray(d)),!0;default:return!1}};a.GetWrapMode=function(b){switch(b){case da.CLAMP_TO_EDGE:return D.a.CLAMP_ADDRESSMODE;case da.MIRRORED_REPEAT:return D.a.MIRROR_ADDRESSMODE;case da.REPEAT:return D.a.WRAP_ADDRESSMODE;default:return D.a.WRAP_ADDRESSMODE}};a.GetByteStrideFromType=
function(b){switch(b.type){case "VEC2":return 2;case "VEC3":return 3;case "VEC4":return 4;case "MAT2":return 4;case "MAT3":return 9;case "MAT4":return 16;default:return 1}};a.GetTextureFilterMode=function(b){switch(b){case O.LINEAR:case O.LINEAR_MIPMAP_NEAREST:case O.LINEAR_MIPMAP_LINEAR:return D.a.TRILINEAR_SAMPLINGMODE;case O.NEAREST:case O.NEAREST_MIPMAP_NEAREST:return D.a.NEAREST_SAMPLINGMODE;default:return D.a.BILINEAR_SAMPLINGMODE}};a.GetBufferFromBufferView=function(b,c,d,a,f){d=c.byteOffset+
d;b=b.loadedBufferViews[c.buffer];if(d+a>b.byteLength)throw Error("Buffer access is out of range");c=b.buffer;d+=b.byteOffset;switch(f){case U.BYTE:return new Int8Array(c,d,a);case U.UNSIGNED_BYTE:return new Uint8Array(c,d,a);case U.SHORT:return new Int16Array(c,d,a);case U.UNSIGNED_SHORT:return new Uint16Array(c,d,a);default:return new Float32Array(c,d,a)}};a.GetBufferFromAccessor=function(b,c){var d=b.bufferViews[c.bufferView],e=c.count*a.GetByteStrideFromType(c);return a.GetBufferFromBufferView(b,
d,c.byteOffset,e,c.componentType)};a.DecodeBufferToText=function(b){for(var c="",d=b.byteLength,a=0;a<d;++a)c+=String.fromCharCode(b[a]);return c};a.GetDefaultMaterial=function(b){a._DefaultMaterial||(W.a.ShadersStore.GLTFDefaultMaterialVertexShader="precision highp float;\n\nuniform mat4 worldView;\nuniform mat4 projection;\n\nattribute vec3 position;\n\nvoid main(void)\n{\n    gl_Position = projection * worldView * vec4(position, 1.0);\n}",W.a.ShadersStore.GLTFDefaultMaterialPixelShader="precision highp float;\n\nuniform vec4 u_emission;\n\nvoid main(void)\n{\n    gl_FragColor = u_emission;\n}",
a._DefaultMaterial=new za.a("GLTFDefaultMaterial",b,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},{attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:[],needAlphaBlending:!1}),a._DefaultMaterial.setColor4("u_emission",new C.b(.5,.5,.5,1)));return a._DefaultMaterial};a._DefaultMaterial=null;return a}(),aa=h("BOQG"),V;(function(a){a[a.IDENTIFIER=1]="IDENTIFIER";a[a.UNKNOWN=2]="UNKNOWN";a[a.END_OF_INPUT=3]="END_OF_INPUT"})(V||(V={}));var Ba=function(){function a(b){this._pos=
0;this.currentToken=V.UNKNOWN;this.currentString=this.currentIdentifier="";this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/;this._toParse=b;this._maxPos=b.length}a.prototype.getNextToken=function(){if(this.isEnd())return V.END_OF_INPUT;this.currentString=this.read();this.currentToken=V.UNKNOWN;if("_"===this.currentString||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=V.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=
this.peek())||"_"===this.currentString);)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken};a.prototype.peek=function(){return this._toParse[this._pos]};a.prototype.read=function(){return this._toParse[this._pos++]};a.prototype.forward=function(){this._pos++};a.prototype.isEnd=function(){return this._pos>=this._maxPos};return a}(),Ca="MODEL VIEW PROJECTION MODELVIEW MODELVIEWPROJECTION JOINTMATRIX".split(" "),Da="world view projection worldView worldViewProjection mBones".split(" "),
Sa=["translation","rotation","scale"],Ta=["position","rotationQuaternion","scaling"],J=function(a,b,c){for(var d in a)c[b][d]=a[d]},Ea=function(a){return"NORMAL"===a.semantic?"normal":"POSITION"===a.semantic?"position":"JOINT"===a.semantic?"matricesIndices":"WEIGHT"===a.semantic?"matricesWeights":"COLOR"===a.semantic?"color":a.semantic&&-1!==a.semantic.indexOf("TEXCOORD_")?(a=Number(a.semantic.split("_")[1]),"uv"+(0===a?"":a+1)):null},ta=function(a){if(a.translation||a.rotation||a.scale){var b=r.e.FromArray(a.scale||
[1,1,1]);var c=r.b.FromArray(a.rotation||[0,0,0,1]);a=r.e.FromArray(a.translation||[0,0,0]);b=r.a.Compose(b,c,a)}else b=r.a.FromArray(a.matrix);return b},Fa=function(a,b,c,d){for(var e=0;e<d.bones.length;e++)if(d.bones[e].name===c)return d.bones[e];var f=a.nodes,g;for(g in f){var m=f[g];if(m.jointName){var k=m.children;for(e=0;e<k.length;e++){var q=a.nodes[k[e]];if(q.jointName&&q.jointName===c)return c=ta(m),a=new ea.a(m.name||"",d,Fa(a,b,m.jointName,d),c),a.id=g,a}}}return null},ua=function(a,b){a=
a.nodes;var c=a[b];if(c)return{node:c,id:b};for(var d in a)if(c=a[d],c.jointName===b)return{node:c,id:d};return null},Ga=function(a,b,c,d,e){e||(a.scene._blockEntityCollection=a.forAssetContainer,e=new Q.a(b.name||"",a.scene),a.scene._blockEntityCollection=!1,e.id=d);if(!b.babylonNode)return e;var f=[],g=null;b=[];for(var m=[],k=[],q=[],u=0;u<c.length;u++){var A=c[u];if(A=a.meshes[A])for(var h=0;h<A.primitives.length;h++){var w=new Pa.a,p=A.primitives[h],r=p.attributes,l;for(l in r){var x=a.accessors[r[l]];
x=M.GetBufferFromAccessor(a,x);if("NORMAL"===l)w.normals=new Float32Array(x.length),w.normals.set(x);else if("POSITION"===l){if(T.HomogeneousCoordinates){w.positions=new Float32Array(x.length-x.length/4);for(var n=0;n<x.length;n+=4)w.positions[n]=x[n],w.positions[n+1]=x[n+1],w.positions[n+2]=x[n+2]}else w.positions=new Float32Array(x.length),w.positions.set(x);m.push(w.positions.length)}else if(-1!==l.indexOf("TEXCOORD_")){n=Number(l.split("_")[1]);n=z.b.UVKind+(0===n?"":n+1);var t=new Float32Array(x.length);
t.set(x);if(x=t)for(var v=0;v<x.length/2;v++)x[2*v+1]=1-x[2*v+1];w.set(t,n)}else"JOINT"===l?(w.matricesIndices=new Float32Array(x.length),w.matricesIndices.set(x)):"WEIGHT"===l?(w.matricesWeights=new Float32Array(x.length),w.matricesWeights.set(x)):"COLOR"===l&&(w.colors=new Float32Array(x.length),w.colors.set(x))}if(x=a.accessors[p.indices])x=M.GetBufferFromAccessor(a,x),w.indices=new Int32Array(x.length),w.indices.set(x);else{r=[];for(n=0;n<w.positions.length/3;n++)r.push(n);w.indices=new Int32Array(r)}q.push(w.indices.length);
g?g.merge(w):g=w;w=a.scene.getMaterialByID(p.material);f.push(null===w?M.GetDefaultMaterial(a.scene):w);b.push(0===b.length?0:b[b.length-1]+m[m.length-2]);k.push(0===k.length?0:k[k.length-1]+q[q.length-2])}}a.scene._blockEntityCollection=a.forAssetContainer;1<f.length?(u=new Oa.a("multimat"+d,a.scene),u.subMaterials=f):u=new oa.a("multimat"+d,a.scene);1===f.length&&(u=f[0]);e.material||(e.material=u);new pa.a(d,a.scene,g,!1,e);e.computeWorldMatrix(!0);a.scene._blockEntityCollection=!1;e.subMeshes=
[];for(u=d=0;u<c.length;u++)if(A=c[u],A=a.meshes[A])for(h=0;h<A.primitives.length;h++)Qa.a.AddToMesh(d,b[d],m[d],k[d],q[d],e,e,!0),d++;return e},va=function(a,b,c,d){a.position&&(a.position=b);if(a.rotationQuaternion||a.rotation)a.rotationQuaternion=c;a.scaling&&(a.scaling=d)},fa=function(a,b,c,d){void 0===d&&(d=!1);var e=a.nodes[b],f=null;d=a.importOnlyMeshes&&!d&&a.importMeshesNames?-1!==a.importMeshesNames.indexOf(e.name||"")||0===a.importMeshesNames.length?!0:!1:!0;if(!e.jointName&&d){a:if(f=
null,a.importOnlyMeshes&&(e.skin||e.meshes)&&a.importMeshesNames&&0<a.importMeshesNames.length&&-1===a.importMeshesNames.indexOf(e.name||""))f=null;else{if(e.skin){if(e.meshes){f=a.skins[e.skin];var g=Ga(a,e,e.meshes,b,e.babylonNode);g.skeleton=a.scene.getLastSkeletonByID(e.skin);if(null===g.skeleton){var m=g;var k=f.babylonSkeleton;k||(k=new na.a(f.name||"","",a.scene));if(f.babylonSkeleton){var q=[],u=[],A=k,h;for(h in a.nodes){var w=a.nodes[h];var l=h,n;if(n=w.jointName){c:{for(n=0;n<f.jointNames.length;n++)if(f.jointNames[n]===
w.jointName){n=!0;break c}n=!1}n=!n}n&&(n=ta(w),n=new ea.a(w.name||"",A,null,n),n.id=l,q.push({bone:n,node:w,id:l}))}for(h=0;h<q.length;h++)for(A=q[h],w=A.node.children,l=0;l<w.length;l++){n=null;for(var L=0;L<q.length;L++)if(q[L].id===w[l]){n=q[L];break}n&&(n.bone._parent=A.bone,A.bone.children.push(n.bone))}k.bones=[];for(h=0;h<f.jointNames.length;h++)if(w=ua(a,f.jointNames[h]))if(A=w.node)if(w=w.id,l=a.scene.getBoneByID(w))k.bones.push(l);else{n=null;for(l=0;l<h;l++)if(L=ua(a,f.jointNames[l]))if(L=
L.node){var x=L.children;if(x){L=!1;for(var t=0;t<x.length;t++)if(x[t]===w){n=Fa(a,f,f.jointNames[l],k);L=!0;break}if(L)break}}else p.b.Warn("Joint named "+f.jointNames[l]+" does not exist when looking for parent");l=ta(A);if(!n&&0<q.length){c:{for(n=0;n<q.length;n++)for(L=q[n],x=0;x<L.node.children.length;x++)if(L.node.children[x]===w){n=L.bone;break c}n=null}n&&-1===u.indexOf(n)&&u.push(n)}(new ea.a(A.jointName||"",k,n,l)).id=w}else p.b.Warn("Joint named "+f.jointNames[h]+" does not exist");q=k.bones;
k.bones=[];for(h=0;h<f.jointNames.length;h++)if(w=ua(a,f.jointNames[h]))for(l=0;l<q.length;l++)if(q[l].id===w.id){k.bones.push(q[l]);break}k.prepare();for(h=0;h<u.length;h++)k.bones.push(u[h])}m.skeleton=k;f.babylonSkeleton||(f.babylonSkeleton=g.skeleton)}f=g}}else if(e.meshes)f=g=Ga(a,e,e.mesh?[e.mesh]:e.meshes,b,e.babylonNode);else if(!e.light||e.babylonNode||a.importOnlyMeshes)e.camera&&!e.babylonNode&&!a.importOnlyMeshes&&(g=a.cameras[e.camera])&&(a.scene._blockEntityCollection=a.forAssetContainer,
"orthographic"===g.type?(f=new ma.a(e.camera,r.e.Zero(),a.scene,!1),f.name=e.name||"",f.mode=ya.a.ORTHOGRAPHIC_CAMERA,f.attachControl()):"perspective"===g.type&&(f=g[g.type],g=new ma.a(e.camera,r.e.Zero(),a.scene,!1),g.name=e.name||"",g.attachControl(),f.aspectRatio||(f.aspectRatio=a.scene.getEngine().getRenderWidth()/a.scene.getEngine().getRenderHeight()),f.znear&&f.zfar&&(g.maxZ=f.zfar,g.minZ=f.znear),f=g),a.scene._blockEntityCollection=!1);else if(g=a.lights[e.light])"ambient"===g.type?(f=g[g.type],
g=new Aa.a(e.light,r.e.Zero(),a.scene),g.name=e.name||"",f.color&&(g.diffuse=C.a.FromArray(f.color)),f=g):"directional"===g.type?(f=g[g.type],g=new qa.a(e.light,r.e.Zero(),a.scene),g.name=e.name||"",f.color&&(g.diffuse=C.a.FromArray(f.color)),f=g):"point"===g.type?(f=g[g.type],g=new ra.a(e.light,r.e.Zero(),a.scene),g.name=e.name||"",f.color&&(g.diffuse=C.a.FromArray(f.color)),f=g):"spot"===g.type&&(f=g[g.type],g=new sa.a(e.light,r.e.Zero(),r.e.Zero(),0,0,a.scene),g.name=e.name||"",f.color&&(g.diffuse=
C.a.FromArray(f.color)),f.fallOfAngle&&(g.angle=f.fallOfAngle),f.fallOffExponent&&(g.exponent=f.fallOffExponent),f=g);if(!e.jointName)if(e.babylonNode){f=e.babylonNode;break a}else null===f&&(a.scene._blockEntityCollection=a.forAssetContainer,f=new Q.a(e.name||"",a.scene),a.scene._blockEntityCollection=!1,e.babylonNode=f);null!==f&&(e.matrix&&f instanceof Q.a?(g=f,e.matrix?(m=new r.e(0,0,0),k=new r.b,u=new r.e(0,0,0),r.a.FromArray(e.matrix).decompose(u,k,m),va(g,m,k,u)):e.translation&&e.rotation&&
e.scale&&va(g,r.e.FromArray(e.translation),r.b.FromArray(e.rotation),r.e.FromArray(e.scale)),g.computeWorldMatrix(!0)):(g=e.rotation||[0,0,0,1],m=e.scale||[1,1,1],va(f,r.e.FromArray(e.translation||[0,0,0]),r.b.FromArray(g),r.e.FromArray(m))),f.updateCache(!0),e.babylonNode=f)}null!==f&&(f.id=b,f.parent=c)}if(e.children)for(b=0;b<e.children.length;b++)fa(a,e.children[b],f,d)},Ha=function(a){var b=a.currentScene;if(b)for(var c=0;c<b.nodes.length;c++)fa(a,b.nodes[c],null);else for(var d in a.scenes)for(b=
a.scenes[d],c=0;c<b.nodes.length;c++)fa(a,b.nodes[c],null);for(var e in a.animations)if(b=a.animations[e],b.channels&&b.samplers)for(c=null,d=0;d<b.channels.length;d++){var f=b.channels[d],g=b.samplers[f.sampler];if(g){if(b.parameters){var m=b.parameters[g.input];g=b.parameters[g.output]}else m=g.input,g=g.output;m=M.GetBufferFromAccessor(a,a.accessors[m]);g=M.GetBufferFromAccessor(a,a.accessors[g]);var k=f.target.id,q=a.scene.getNodeByID(k);null===q&&(q=a.scene.getNodeByName(k));if(null===q)p.b.Warn("Creating animation named "+
e+". But cannot find node named "+k+" to attach to");else{k=q instanceof ea.a;f=f.target.path;var u=Sa.indexOf(f);-1!==u&&(f=Ta[u]);var A=P.a.ANIMATIONTYPE_MATRIX;k||("rotationQuaternion"===f?(A=P.a.ANIMATIONTYPE_QUATERNION,q.rotationQuaternion=new r.b):A=P.a.ANIMATIONTYPE_VECTOR3);u=null;var h=[],w=0,l=!1;k&&c&&c.getKeys().length===m.length&&(u=c,l=!0);l||(a.scene._blockEntityCollection=a.forAssetContainer,u=new P.a(e,k?"_matrix":f,1,A,P.a.ANIMATIONLOOPMODE_CYCLE),a.scene._blockEntityCollection=
!1);for(A=0;A<m.length;A++){if("rotationQuaternion"===f){var n=r.b.FromArray([g[w],g[w+1],g[w+2],g[w+3]]);w+=4}else n=r.e.FromArray([g[w],g[w+1],g[w+2]]),w+=3;if(k){var t=q,x=r.e.Zero(),v=new r.b,y=r.e.Zero();t=t.getBaseMatrix();l&&c&&(t=c.getKeys()[A].value);t.decompose(y,v,x);"position"===f?x=n:"rotationQuaternion"===f?v=n:y=n;n=r.a.Compose(y,v,x)}l?c&&(c.getKeys()[A].value=n):h.push({frame:m[A],value:n})}!l&&u&&(u.setKeys(h),q.animations.push(u));c=u;a.scene.stopAnimation(q);a.scene.beginAnimation(q,
0,m[m.length-1],!0,1)}}}for(c=0;c<a.scene.skeletons.length;c++)a.scene.beginAnimation(a.scene.skeletons[c],0,Number.MAX_VALUE,!0,1)},Ua=function(a,b,c,d,e){var f=d.values||c.parameters;c=c.uniforms;for(var g in e){var m=e[g],k=m.type,q=f[c[g]];void 0===q&&(q=m.value);if(q){var u=function(c){return function(d){m.value&&c&&(b.setTexture(c,d),delete e[c])}};k===K.SAMPLER_2D?R.LoadTextureAsync(a,d.values?q:m.value,u(g),function(){return u(null)}):m.value&&M.SetUniform(b,g,d.values?q:m.value,k)&&delete e[g]}}},
Va=function(a,b,c){return function(d,e){b.dispose(!0);c("Cannot compile program named "+a.name+". Error: "+e+". Default material will be applied")}},Wa=function(a,b,c,d,e,f){return function(g){Ua(a,b,c,d,e);b.onBind=function(g){var k=d.values||c.parameters,m;for(m in e){var u=e[m],h=u.type;if(h===K.FLOAT_MAT2||h===K.FLOAT_MAT3||h===K.FLOAT_MAT4)!u.semantic||u.source||u.node?u.semantic&&(u.source||u.node)&&(h=a.scene.getNodeByName(u.source||u.node||""),null===h&&(h=a.scene.getNodeByID(u.source||u.node||
"")),null!==h&&M.SetMatrix(a.scene,h,u,m,b.getEffect())):M.SetMatrix(a.scene,g,u,m,b.getEffect());else{var l=k[c.uniforms[m]];l&&(h===K.SAMPLER_2D?(u=a.textures[d.values?l:u.value].babylonTexture,null!==u&&void 0!==u&&b.getEffect().setTexture(m,u)):M.SetUniform(b.getEffect(),m,l,h))}}f(b)}}},Ia=function(a,b,c){for(var d in b.uniforms){var e=b.parameters[b.uniforms[d]];if(a.currentIdentifier===d&&e.semantic&&!e.source&&!e.node&&(e=Ca.indexOf(e.semantic),-1!==e))return delete c[d],Da[e]}return a.currentIdentifier},
Ja=function(a){for(var b in a.materials)R.LoadMaterialAsync(a,b,function(b){},function(){})},S=function(){function a(){}a.CreateRuntime=function(b,c,d){c={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:c,rootUrl:d,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,
dummyNodes:[],forAssetContainer:!1};b.extensions&&J(b.extensions,"extensions",c);b.extensionsUsed&&J(b.extensionsUsed,"extensionsUsed",c);if(b.buffers){d=b.buffers;for(var a in d)c.buffers[a]=d[a],c.buffersCount++}b.bufferViews&&J(b.bufferViews,"bufferViews",c);b.accessors&&J(b.accessors,"accessors",c);b.meshes&&J(b.meshes,"meshes",c);b.lights&&J(b.lights,"lights",c);b.cameras&&J(b.cameras,"cameras",c);b.nodes&&J(b.nodes,"nodes",c);b.images&&J(b.images,"images",c);b.textures&&J(b.textures,"textures",
c);if(b.shaders){a=b.shaders;for(var f in a)c.shaders[f]=a[f],c.shaderscount++}b.programs&&J(b.programs,"programs",c);b.samplers&&J(b.samplers,"samplers",c);b.techniques&&J(b.techniques,"techniques",c);b.materials&&J(b.materials,"materials",c);b.animations&&J(b.animations,"animations",c);b.skins&&J(b.skins,"skins",c);b.scenes&&(c.scenes=b.scenes);b.scene&&b.scenes&&(c.currentScene=b.scenes[b.scene]);return c};a.LoadBufferAsync=function(b,c,d,a,f){var e=b.buffers[c];p.b.IsBase64(e.uri)?setTimeout(function(){return d(new Uint8Array(p.b.DecodeBase64(e.uri)))}):
p.b.LoadFile(b.rootUrl+e.uri,function(b){return d(new Uint8Array(b))},f,void 0,!0,function(b){b&&a(b.status+" "+b.statusText)})};a.LoadTextureBufferAsync=function(b,c,d,a){if((c=b.textures[c])&&c.source)if(c.babylonTexture)d(null);else{var e=b.images[c.source];p.b.IsBase64(e.uri)?setTimeout(function(){return d(new Uint8Array(p.b.DecodeBase64(e.uri)))}):p.b.LoadFile(b.rootUrl+e.uri,function(b){return d(new Uint8Array(b))},void 0,void 0,!0,function(b){b&&a(b.status+" "+b.statusText)})}else a("")};a.CreateTextureAsync=
function(b,c,d,a,f){f=b.textures[c];if(f.babylonTexture)a(f.babylonTexture);else{var e=b.samplers[f.sampler],m=e.minFilter===O.NEAREST_MIPMAP_NEAREST||e.minFilter===O.NEAREST_MIPMAP_LINEAR||e.minFilter===O.LINEAR_MIPMAP_NEAREST||e.minFilter===O.LINEAR_MIPMAP_LINEAR,k=D.a.BILINEAR_SAMPLINGMODE;d=null==d?new Blob:new Blob([d]);var q=URL.createObjectURL(d);d=function(){return URL.revokeObjectURL(q)};b=new D.a(q,b.scene,!m,!0,k,d,d);void 0!==e.wrapS&&(b.wrapU=M.GetWrapMode(e.wrapS));void 0!==e.wrapT&&
(b.wrapV=M.GetWrapMode(e.wrapT));b.name=c;f.babylonTexture=b;a(b)}};a.LoadShaderStringAsync=function(b,c,d,a){c=b.shaders[c];p.b.IsBase64(c.uri)?(b=atob(c.uri.split(",")[1]),d&&d(b)):p.b.LoadFile(b.rootUrl+c.uri,d,void 0,void 0,!1,function(b){b&&a&&a(b.status+" "+b.statusText)})};a.LoadMaterialAsync=function(b,c,d,a){var e=b.materials[c];if(e.technique){var g=b.techniques[e.technique];if(g){var m=b.programs[g.program],k=g.states,q=W.a.ShadersStore[m.fragmentShader+"PixelShader"],u="",h="",l=new Ba(W.a.ShadersStore[m.vertexShader+
"VertexShader"]),w=new Ba(q);q={};var n=[],p=[],r=[],x;for(x in g.uniforms){var t=g.parameters[g.uniforms[x]];q[x]=t;!t.semantic||t.node||t.source?t.type===K.SAMPLER_2D?r.push(x):n.push(x):(t=Ca.indexOf(t.semantic),-1!==t?(n.push(Da[t]),delete q[x]):n.push(x))}for(var v in g.attributes)t=g.attributes[v],t=g.parameters[t],t.semantic&&(x=Ea(t))&&p.push(x);for(;!l.isEnd()&&l.getNextToken();)if(x=l.currentToken,x!==V.IDENTIFIER)u+=l.currentString;else{x=!1;for(v in g.attributes)if(t=g.attributes[v],t=
g.parameters[t],l.currentIdentifier===v&&t.semantic){u+=Ea(t);x=!0;break}x||(u+=Ia(l,g,q))}for(;!w.isEnd()&&w.getNextToken();)x=w.currentToken,h=x!==V.IDENTIFIER?h+w.currentString:h+Ia(w,g,q);l={vertex:m.vertexShader+c,fragment:m.fragmentShader+c};n={attributes:p,uniforms:n,samplers:r,needAlphaBlending:k&&k.enable&&-1!==k.enable.indexOf(3042)};W.a.ShadersStore[m.vertexShader+c+"VertexShader"]=u;W.a.ShadersStore[m.fragmentShader+c+"PixelShader"]=h;c=new za.a(c,b.scene,l,n);c.onError=Va(m,c,a);c.onCompiled=
Wa(b,c,g,e,q,d);c.sideOrientation=N.a.CounterClockWiseSideOrientation;k&&k.functions&&(b=k.functions,b.cullFace&&b.cullFace[0]!==la.BACK&&(c.backFaceCulling=!1),b=b.blendFuncSeparate)&&(b[0]===E.SRC_ALPHA&&b[1]===E.ONE_MINUS_SRC_ALPHA&&b[2]===E.ONE&&b[3]===E.ONE?c.alphaMode=aa.a.ALPHA_COMBINE:b[0]===E.ONE&&b[1]===E.ONE&&b[2]===E.ZERO&&b[3]===E.ONE?c.alphaMode=aa.a.ALPHA_ONEONE:b[0]===E.SRC_ALPHA&&b[1]===E.ONE&&b[2]===E.ZERO&&b[3]===E.ONE?c.alphaMode=aa.a.ALPHA_ADD:b[0]===E.ZERO&&b[1]===E.ONE_MINUS_SRC_COLOR&&
b[2]===E.ONE&&b[3]===E.ONE?c.alphaMode=aa.a.ALPHA_SUBTRACT:b[0]===E.DST_COLOR&&b[1]===E.ZERO&&b[2]===E.ONE&&b[3]===E.ONE?c.alphaMode=aa.a.ALPHA_MULTIPLY:b[0]===E.SRC_ALPHA&&b[1]===E.ONE_MINUS_SRC_COLOR&&b[2]===E.ONE&&b[3]===E.ONE&&(c.alphaMode=aa.a.ALPHA_MAXIMIZED))}else b.scene._blockEntityCollection=b.forAssetContainer,a=new oa.a(c,b.scene),b.scene._blockEntityCollection=!1,a.diffuseColor=new C.a(.5,.5,.5),a.sideOrientation=N.a.CounterClockWiseSideOrientation,d(a)}else a&&a("No technique found.")};
return a}(),ha=function(){function a(){this.state=null}a.RegisterExtension=function(b){a.Extensions[b.name]?p.b.Error('Tool with the same name "'+b.name+'" already exists'):a.Extensions[b.name]=b};a.prototype.dispose=function(){};a.prototype._importMeshAsync=function(b,c,d,a,f,g,m,k){var e=this;c.useRightHandedSystem=!0;R.LoadRuntimeAsync(c,d,a,function(c){c.forAssetContainer=f;c.importOnlyMeshes=!0;""===b?c.importMeshesNames=[]:"string"===typeof b?c.importMeshesNames=[b]:!b||b instanceof Array?(c.importMeshesNames=
[],p.b.Warn("Argument meshesNames must be of type string or string[]")):c.importMeshesNames=[b];e._createNodes(c);var d=[],a=[];for(u in c.nodes){var k=c.nodes[u];k.babylonNode instanceof Ra.a&&d.push(k.babylonNode)}for(var q in c.skins){var u=c.skins[q];u.babylonSkeleton instanceof na.a&&a.push(u.babylonSkeleton)}e._loadBuffersAsync(c,function(){e._loadShadersAsync(c,function(){Ja(c);Ha(c);!T.IncrementalLoading&&g&&g(d,a)})},m);T.IncrementalLoading&&g&&g(d,a)},k);return!0};a.prototype.importMeshAsync=
function(b,c,d,a,f,g){var e=this;return new Promise(function(k,m){e._importMeshAsync(b,c,a,f,d,function(b,c){k({meshes:b,particleSystems:[],skeletons:c,animationGroups:[],lights:[],transformNodes:[],geometries:[]})},g,function(b){m(Error(b))})})};a.prototype._loadAsync=function(b,c,d,a,f,g,m){var e=this;b.useRightHandedSystem=!0;R.LoadRuntimeAsync(b,c,d,function(b){R.LoadRuntimeExtensionsAsync(b,function(){e._createNodes(b);e._loadBuffersAsync(b,function(){e._loadShadersAsync(b,function(){Ja(b);Ha(b);
T.IncrementalLoading||f()})});T.IncrementalLoading&&f()},m)},m)};a.prototype.loadAsync=function(b,c,d,a){var e=this;return new Promise(function(f,m){e._loadAsync(b,c,d,!1,function(){f()},a,function(b){m(Error(b))})})};a.prototype._loadShadersAsync=function(b,c){var d=!1,a=function(d,a){R.LoadShaderStringAsync(b,d,function(e){e instanceof ArrayBuffer||(b.loadedShaderCount++,e&&(W.a.ShadersStore[d+(a.type===ka.VERTEX?"VertexShader":"PixelShader")]=e),b.loadedShaderCount===b.shaderscount&&c())},function(){p.b.Error("Error when loading shader program named "+
d+" located at "+a.uri)})},f;for(f in b.shaders){d=!0;var g=b.shaders[f];g?a.bind(this,f,g)():p.b.Error("No shader named: "+f)}d||c()};a.prototype._loadBuffersAsync=function(b,c,d){d=!1;var a=function(d,a){R.LoadBufferAsync(b,d,function(e){b.loadedBufferCount++;e&&(e.byteLength!=b.buffers[d].byteLength&&p.b.Error("Buffer named "+d+" is length "+e.byteLength+". Expected: "+a.byteLength),b.loadedBufferViews[d]=e);b.loadedBufferCount===b.buffersCount&&c()},function(){p.b.Error("Error when loading buffer named "+
d+" located at "+a.uri)})},f;for(f in b.buffers){d=!0;var g=b.buffers[f];g?a.bind(this,f,g)():p.b.Error("No buffer named: "+f)}d||c()};a.prototype._createNodes=function(b){var c=b.currentScene;if(c)for(var d=0;d<c.nodes.length;d++)fa(b,c.nodes[d],null);else for(var a in b.scenes)for(c=b.scenes[a],d=0;d<c.nodes.length;d++)fa(b,c.nodes[d],null)};a.Extensions={};return a}(),R=function(){function a(b){this._name=b}Object.defineProperty(a.prototype,"name",{get:function(){return this._name},enumerable:!1,
configurable:!0});a.prototype.loadRuntimeAsync=function(b,c,d,a,f){return!1};a.prototype.loadRuntimeExtensionsAsync=function(b,c,d){return!1};a.prototype.loadBufferAsync=function(b,c,d,a,f){return!1};a.prototype.loadTextureBufferAsync=function(b,c,d,a){return!1};a.prototype.createTextureAsync=function(b,c,d,a,f){return!1};a.prototype.loadShaderStringAsync=function(b,c,d,a){return!1};a.prototype.loadMaterialAsync=function(b,c,d,a){return!1};a.LoadRuntimeAsync=function(b,c,d,e,f){a.ApplyExtensions(function(a){return a.loadRuntimeAsync(b,
c,d,e,f)},function(){setTimeout(function(){e&&e(S.CreateRuntime(c.json,b,d))})})};a.LoadRuntimeExtensionsAsync=function(b,c,d){a.ApplyExtensions(function(a){return a.loadRuntimeExtensionsAsync(b,c,d)},function(){setTimeout(function(){c()})})};a.LoadBufferAsync=function(b,c,d,e,f){a.ApplyExtensions(function(a){return a.loadBufferAsync(b,c,d,e,f)},function(){S.LoadBufferAsync(b,c,d,e,f)})};a.LoadTextureAsync=function(b,c,d,e){a.LoadTextureBufferAsync(b,c,function(f){f&&a.CreateTextureAsync(b,c,f,d,
e)},e)};a.LoadShaderStringAsync=function(b,c,d,e){a.ApplyExtensions(function(a){return a.loadShaderStringAsync(b,c,d,e)},function(){S.LoadShaderStringAsync(b,c,d,e)})};a.LoadMaterialAsync=function(b,c,d,e){a.ApplyExtensions(function(a){return a.loadMaterialAsync(b,c,d,e)},function(){S.LoadMaterialAsync(b,c,d,e)})};a.LoadTextureBufferAsync=function(b,c,d,e){a.ApplyExtensions(function(a){return a.loadTextureBufferAsync(b,c,d,e)},function(){S.LoadTextureBufferAsync(b,c,d,e)})};a.CreateTextureAsync=function(b,
c,d,e,f){a.ApplyExtensions(function(a){return a.createTextureAsync(b,c,d,e,f)},function(){S.CreateTextureAsync(b,c,d,e,f)})};a.ApplyExtensions=function(b,c){for(var a in ha.Extensions)if(b(ha.Extensions[a]))return;c()};return a}();T._CreateGLTF1Loader=function(){return new ha};var Xa=function(a){function b(){return a.call(this,"KHR_binary_glTF")||this}Object(Z.c)(b,a);b.prototype.loadRuntimeAsync=function(b,a,e,f,g){g=a.json.extensionsUsed;if(!g||-1===g.indexOf(this.name)||!a.bin)return!1;this._bin=
a.bin;f(S.CreateRuntime(a.json,b,e));return!0};b.prototype.loadBufferAsync=function(b,a,e,f){if(-1===b.extensionsUsed.indexOf(this.name)||"binary_glTF"!==a)return!1;this._bin.readAsync(0,this._bin.byteLength).then(e,function(b){return f(b.message)});return!0};b.prototype.loadTextureBufferAsync=function(b,a,e,f){a=b.images[b.textures[a].source];if(!(a.extensions&&this.name in a.extensions))return!1;a=b.bufferViews[a.extensions[this.name].bufferView];b=M.GetBufferFromBufferView(b,a,0,a.byteLength,U.UNSIGNED_BYTE);
e(b);return!0};b.prototype.loadShaderStringAsync=function(b,a,e,f){a=b.shaders[a];if(!(a.extensions&&this.name in a.extensions))return!1;a=b.bufferViews[a.extensions[this.name].bufferView];var c=M.GetBufferFromBufferView(b,a,0,a.byteLength,U.UNSIGNED_BYTE);setTimeout(function(){var b=M.DecodeBufferToText(c);e(b)});return!0};return b}(R);ha.RegisterExtension(new Xa);var Ya=function(a){function b(){return a.call(this,"KHR_materials_common")||this}Object(Z.c)(b,a);b.prototype.loadRuntimeExtensionsAsync=
function(b,a,e){if(!b.extensions)return!1;a=b.extensions[this.name];if(!a)return!1;if(a=a.lights)for(var c in a)switch(e=a[c],e.type){case "ambient":var d=new Aa.a(e.name,new r.e(0,1,0),b.scene);if(e=e.ambient)d.diffuse=C.a.FromArray(e.color||[1,1,1]);break;case "point":d=new ra.a(e.name,new r.e(10,10,10),b.scene);if(e=e.point)d.diffuse=C.a.FromArray(e.color||[1,1,1]);break;case "directional":d=new qa.a(e.name,new r.e(0,-1,0),b.scene);if(e=e.directional)d.diffuse=C.a.FromArray(e.color||[1,1,1]);break;
case "spot":if(d=e.spot)(new sa.a(e.name,new r.e(0,10,0),new r.e(0,-1,0),d.fallOffAngle||Math.PI,d.fallOffExponent||0,b.scene)).diffuse=C.a.FromArray(d.color||[1,1,1]);break;default:p.b.Warn('GLTF Material Common extension: light type "'+e.type+"\u201d not supported")}return!1};b.prototype.loadMaterialAsync=function(b,a,e,f){e=b.materials[a];if(!e||!e.extensions)return!1;e=e.extensions[this.name];if(!e)return!1;a=new oa.a(a,b.scene);a.sideOrientation=N.a.CounterClockWiseSideOrientation;"CONSTANT"===
e.technique&&(a.disableLighting=!0);a.backFaceCulling=void 0===e.doubleSided?!1:!e.doubleSided;a.alpha=void 0===e.values.transparency?1:e.values.transparency;a.specularPower=void 0===e.values.shininess?0:e.values.shininess;"string"===typeof e.values.ambient?this._loadTexture(b,e.values.ambient,a,"ambientTexture",f):a.ambientColor=C.a.FromArray(e.values.ambient||[0,0,0]);"string"===typeof e.values.diffuse?this._loadTexture(b,e.values.diffuse,a,"diffuseTexture",f):a.diffuseColor=C.a.FromArray(e.values.diffuse||
[0,0,0]);"string"===typeof e.values.emission?this._loadTexture(b,e.values.emission,a,"emissiveTexture",f):a.emissiveColor=C.a.FromArray(e.values.emission||[0,0,0]);"string"===typeof e.values.specular?this._loadTexture(b,e.values.specular,a,"specularTexture",f):a.specularColor=C.a.FromArray(e.values.specular||[0,0,0]);return!0};b.prototype._loadTexture=function(b,a,e,f,g){S.LoadTextureBufferAsync(b,a,function(c){S.CreateTextureAsync(b,a,c,function(b){return e[f]=b},g)},g)};return b}(R);ha.RegisterExtension(new Ya);
var ia=h("U2MC"),Za=h("ks95"),G=h("oXT7"),Ka=h("qVgn"),$a=h("YSg2"),ab=h("1t4k"),bb=h("Ql7q"),cb=h("TFEU"),db=h("T5H4"),n=function(){function a(){}a.Get=function(b,c,a){if(!c||void 0==a||!c[a])throw Error(b+": Failed to find index ("+a+")");return c[a]};a.Assign=function(b){if(b)for(var c=0;c<b.length;c++)b[c].index=c};return a}(),t=function(){function a(b){this._completePromises=[];this._forAssetContainer=!1;this._babylonLights=[];this._disableInstancedMesh=0;this._disposed=!1;this._state=null;this._extensions=
[];this._defaultBabylonMaterialData={};this._parent=b}a.RegisterExtension=function(b,c){a.UnregisterExtension(b)&&H.a.Warn("Extension with the name '"+b+"' already exists");a._RegisteredExtensions[b]={factory:c}};a.UnregisterExtension=function(b){if(!a._RegisteredExtensions[b])return!1;delete a._RegisteredExtensions[b];return!0};Object.defineProperty(a.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"gltf",{get:function(){return this._gltf},
enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"babylonScene",{get:function(){return this._babylonScene},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0});
a.prototype.dispose=function(){if(!this._disposed){this._disposed=!0;this._completePromises.length=0;for(var b in this._extensions){var c=this._extensions[b];c.dispose&&c.dispose();delete this._extensions[b]}this._rootBabylonMesh=this._babylonScene=this._gltf=null;this._parent.dispose()}};a.prototype.importMeshAsync=function(b,c,a,e,f,g,m){var d=this;return Promise.resolve().then(function(){d._babylonScene=c;d._rootUrl=f;d._fileName=m||"scene";d._forAssetContainer=a;d._loadData(e);var g=null;if(b){var k=
{};if(d._gltf.nodes){g=0;for(var h=d._gltf.nodes;g<h.length;g++){var l=h[g];l.name&&(k[l.name]=l.index)}}g=(b instanceof Array?b:[b]).map(function(b){var c=k[b];if(void 0===c)throw Error("Failed to find node '"+b+"'");return c})}return d._loadAsync(g,function(){return{meshes:d._getMeshes(),particleSystems:[],skeletons:d._getSkeletons(),animationGroups:d._getAnimationGroups(),lights:d._babylonLights,transformNodes:d._getTransformNodes(),geometries:d._getGeometries()}})})};a.prototype.loadAsync=function(b,
c,a,e,f){var d=this;return Promise.resolve().then(function(){d._babylonScene=b;d._rootUrl=a;d._fileName=f||"scene";d._loadData(c);return d._loadAsync(null,function(){})})};a.prototype._loadAsync=function(b,c){var a=this;return Promise.resolve().then(function(){a._uniqueRootUrl=-1===a._rootUrl.indexOf("file:")&&a._fileName?a._rootUrl:""+a._rootUrl+Date.now()+"/";a._loadExtensions();a._checkExtensions();var d=I[I.LOADING]+" => "+I[I.READY],f=I[I.LOADING]+" => "+I[I.COMPLETE];a._parent._startPerformanceCounter(d);
a._parent._startPerformanceCounter(f);a._setState(I.LOADING);a._extensionsOnLoading();var g=[],m=a._babylonScene.blockMaterialDirtyMechanism;a._babylonScene.blockMaterialDirtyMechanism=!0;if(b)g.push(a.loadSceneAsync("/nodes",{nodes:b,index:-1}));else if(void 0!=a._gltf.scene||a._gltf.scenes&&a._gltf.scenes[0]){var k=n.Get("/scene",a._gltf.scenes,a._gltf.scene||0);g.push(a.loadSceneAsync("/scenes/"+k.index,k))}if(a.parent.loadAllMaterials&&a._gltf.materials)for(k=0;k<a._gltf.materials.length;++k)g.push(a._loadMaterialAsync("/materials/"+
k,a._gltf.materials[k],null,N.a.TriangleFillMode,function(b){}));a._babylonScene.blockMaterialDirtyMechanism=m;a._parent.compileMaterials&&g.push(a._compileMaterialsAsync());a._parent.compileShadowGenerators&&g.push(a._compileShadowGeneratorsAsync());g=Promise.all(g).then(function(){a._rootBabylonMesh&&a._rootBabylonMesh.setEnabled(!0);a._extensionsOnReady();a._setState(I.READY);a._startAnimations();return c()});g.then(function(){a._parent._endPerformanceCounter(d);p.b.SetImmediate(function(){a._disposed||
Promise.all(a._completePromises).then(function(){a._parent._endPerformanceCounter(f);a._setState(I.COMPLETE);a._parent.onCompleteObservable.notifyObservers(void 0);a._parent.onCompleteObservable.clear();a.dispose()},function(b){a._parent.onErrorObservable.notifyObservers(b);a._parent.onErrorObservable.clear();a.dispose()})})});return g}).catch(function(b){a._disposed||(a._parent.onErrorObservable.notifyObservers(b),a._parent.onErrorObservable.clear(),a.dispose());throw b;})};a.prototype._loadData=
function(b){this._gltf=b.json;this._setupData();if(b.bin){var c=this._gltf.buffers;c&&c[0]&&!c[0].uri?(c=c[0],(c.byteLength<b.bin.byteLength-3||c.byteLength>b.bin.byteLength)&&H.a.Warn("Binary buffer length ("+c.byteLength+") from JSON does not match chunk length ("+b.bin.byteLength+")"),this._bin=b.bin):H.a.Warn("Unexpected BIN chunk")}};a.prototype._setupData=function(){n.Assign(this._gltf.accessors);n.Assign(this._gltf.animations);n.Assign(this._gltf.buffers);n.Assign(this._gltf.bufferViews);n.Assign(this._gltf.cameras);
n.Assign(this._gltf.images);n.Assign(this._gltf.materials);n.Assign(this._gltf.meshes);n.Assign(this._gltf.nodes);n.Assign(this._gltf.samplers);n.Assign(this._gltf.scenes);n.Assign(this._gltf.skins);n.Assign(this._gltf.textures);if(this._gltf.nodes){for(var b={},c=0,a=this._gltf.nodes;c<a.length;c++){var e=a[c];if(e.children)for(var f=0,g=e.children;f<g.length;f++)b[g[f]]=e.index}c=this._createRootNode();a=0;for(f=this._gltf.nodes;a<f.length;a++)e=f[a],g=b[e.index],e.parent=void 0===g?c:this._gltf.nodes[g]}};
a.prototype._loadExtensions=function(){for(var b in a._RegisteredExtensions){var c=a._RegisteredExtensions[b].factory(this);c.name!==b&&H.a.Warn("The name of the glTF loader extension instance does not match the registered name: "+c.name+" !== "+b);this._extensions.push(c);this._parent.onExtensionLoadedObservable.notifyObservers(c)}this._extensions.sort(function(b,c){return(b.order||Number.MAX_VALUE)-(c.order||Number.MAX_VALUE)});this._parent.onExtensionLoadedObservable.clear()};a.prototype._checkExtensions=
function(){if(this._gltf.extensionsRequired)for(var b=function(b){if(!c._extensions.some(function(c){return c.name===b&&c.enabled}))throw Error("Require extension "+b+" is not available");},c=this,a=0,e=this._gltf.extensionsRequired;a<e.length;a++)b(e[a])};a.prototype._setState=function(b){this._state=b;this.log(I[this._state])};a.prototype._createRootNode=function(){this._babylonScene._blockEntityCollection=this._forAssetContainer;this._rootBabylonMesh=new Q.a("__root__",this._babylonScene);this._babylonScene._blockEntityCollection=
!1;this._rootBabylonMesh.setEnabled(!1);var b={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case ca.AUTO:this._babylonScene.useRightHandedSystem||(b.rotation=[0,1,0,0],b.scale=[1,1,-1],a._LoadTransform(b,this._rootBabylonMesh));break;case ca.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")");}this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh);
return b};a.prototype.loadSceneAsync=function(b,c){var a=this,e=this._extensionsLoadSceneAsync(b,c);if(e)return e;e=[];this.logOpen(b+" "+(c.name||""));if(c.nodes)for(var f=0,g=c.nodes;f<g.length;f++)c=g[f],c=n.Get(b+"/nodes/"+c,this._gltf.nodes,c),e.push(this.loadNodeAsync("/nodes/"+c.index,c,function(b){b.parent=a._rootBabylonMesh}));if(this._gltf.nodes)for(b=0,f=this._gltf.nodes;b<f.length;b++)if(c=f[b],c._babylonTransformNode&&c._babylonBones){g=0;for(var m=c._babylonBones;g<m.length;g++)m[g].linkTransformNode(c._babylonTransformNode)}e.push(this._loadAnimationsAsync());
this.logClose();return Promise.all(e).then(function(){})};a.prototype._forEachPrimitive=function(b,c){if(b._primitiveBabylonMeshes){var a=0;for(b=b._primitiveBabylonMeshes;a<b.length;a++)c(b[a])}};a.prototype._getGeometries=function(){var b=[],c=this._gltf.nodes;if(c)for(var a=0;a<c.length;a++)this._forEachPrimitive(c[a],function(c){(c=c.geometry)&&-1===b.indexOf(c)&&b.push(c)});return b};a.prototype._getMeshes=function(){var b=[];b.push(this._rootBabylonMesh);var c=this._gltf.nodes;if(c)for(var a=
0;a<c.length;a++)this._forEachPrimitive(c[a],function(c){b.push(c)});return b};a.prototype._getTransformNodes=function(){var b=[],c=this._gltf.nodes;if(c)for(var a=0;a<c.length;a++){var e=c[a];e._babylonTransformNode&&"TransformNode"===e._babylonTransformNode.getClassName()&&b.push(e._babylonTransformNode)}return b};a.prototype._getSkeletons=function(){var b=[],c=this._gltf.skins;if(c)for(var a=0;a<c.length;a++){var e=c[a];e._data&&b.push(e._data.babylonSkeleton)}return b};a.prototype._getAnimationGroups=
function(){var b=[],c=this._gltf.animations;if(c)for(var a=0;a<c.length;a++){var e=c[a];e._babylonAnimationGroup&&b.push(e._babylonAnimationGroup)}return b};a.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case Y.NONE:break;case Y.FIRST:var b=this._getAnimationGroups();0!==b.length&&b[0].start(!0);break;case Y.ALL:b=this._getAnimationGroups();for(var c=0;c<b.length;c++)b[c].start(!0);break;default:H.a.Error("Invalid animation start mode ("+this._parent.animationStartMode+
")")}};a.prototype.loadNodeAsync=function(b,c,d){var e=this;void 0===d&&(d=function(){});var f=this._extensionsLoadNodeAsync(b,c,d);if(f)return f;if(c._babylonTransformNode)throw Error(b+": Invalid recursive node hierarchy");var g=[];this.logOpen(b+" "+(c.name||""));f=function(f){a.AddPointerMetadata(f,b);a._LoadTransform(c,f);if(void 0!=c.camera){var m=n.Get(b+"/camera",e._gltf.cameras,c.camera);g.push(e.loadCameraAsync("/cameras/"+m.index,m,function(b){b.parent=f}))}if(c.children){m=0;for(var k=
c.children;m<k.length;m++){var h=k[m];h=n.Get(b+"/children/"+h,e._gltf.nodes,h);g.push(e.loadNodeAsync("/nodes/"+h.index,h,function(b){b.parent=f}))}}d(f)};if(void 0==c.mesh){var m=c.name||"node"+c.index;this._babylonScene._blockEntityCollection=this._forAssetContainer;c._babylonTransformNode=new Ka.a(m,this._babylonScene);this._babylonScene._blockEntityCollection=!1;f(c._babylonTransformNode)}else m=n.Get(b+"/mesh",this._gltf.meshes,c.mesh),g.push(this._loadMeshAsync("/meshes/"+m.index,c,m,f));this.logClose();
return Promise.all(g).then(function(){e._forEachPrimitive(c,function(b){b.geometry&&b.geometry.useBoundingInfoFromGeometry?b._updateBoundingInfo():b.refreshBoundingInfo(!0)});return c._babylonTransformNode})};a.prototype._loadMeshAsync=function(b,c,a,e){var d=a.primitives;if(!d||!d.length)throw Error(b+": Primitives are missing");void 0==d[0].index&&n.Assign(d);var g=[];this.logOpen(b+" "+(a.name||""));var m=c.name||"node"+c.index;if(1===d.length){var k=a.primitives[0];g.push(this._loadMeshPrimitiveAsync(b+
"/primitives/"+k.index,m,c,a,k,function(b){c._babylonTransformNode=b;c._primitiveBabylonMeshes=[b]}))}else{this._babylonScene._blockEntityCollection=this._forAssetContainer;c._babylonTransformNode=new Ka.a(m,this._babylonScene);this._babylonScene._blockEntityCollection=!1;c._primitiveBabylonMeshes=[];for(var q=0;q<d.length;q++)k=d[q],g.push(this._loadMeshPrimitiveAsync(b+"/primitives/"+k.index,m+"_primitive"+k.index,c,a,k,function(b){b.parent=c._babylonTransformNode;c._primitiveBabylonMeshes.push(b)}))}void 0!=
c.skin&&(b=n.Get(b+"/skin",this._gltf.skins,c.skin),g.push(this._loadSkinAsync("/skins/"+b.index,c,b)));e(c._babylonTransformNode);this.logClose();return Promise.all(g).then(function(){return c._babylonTransformNode})};a.prototype._loadMeshPrimitiveAsync=function(b,c,d,e,f,g){var m=this,k=this._extensionsLoadMeshPrimitiveAsync(b,c,d,e,f,g);if(k)return k;this.logOpen(""+b);k=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==d.skin&&!e.primitives[0].targets;if(k&&f._instanceData){var q=
f._instanceData.babylonSourceMesh.createInstance(c);var h=f._instanceData.promise}else{h=[];this._babylonScene._blockEntityCollection=this._forAssetContainer;var l=new Q.a(c,this._babylonScene);this._babylonScene._blockEntityCollection=!1;l.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?N.a.CounterClockWiseSideOrientation:N.a.ClockWiseSideOrientation;this._createMorphTargets(b,d,e,f,l);h.push(this._loadVertexDataAsync(b,f,l).then(function(c){return m._loadMorphTargetsAsync(b,
f,l,c).then(function(){m._babylonScene._blockEntityCollection=m._forAssetContainer;c.applyToMesh(l);m._babylonScene._blockEntityCollection=!1})}));c=a._GetDrawMode(b,f.mode);void 0==f.material?(d=this._defaultBabylonMaterialData[c],d||(d=this._createDefaultMaterial("__GLTFLoader._default",c),this._parent.onMaterialLoadedObservable.notifyObservers(d),this._defaultBabylonMaterialData[c]=d),l.material=d):(d=n.Get(b+"/material",this._gltf.materials,f.material),h.push(this._loadMaterialAsync("/materials/"+
d.index,d,l,c,function(b){l.material=b})));h=Promise.all(h);k&&(f._instanceData={babylonSourceMesh:l,promise:h});q=l}a.AddPointerMetadata(q,b);this._parent.onMeshLoadedObservable.notifyObservers(q);g(q);this.logClose();return h.then(function(){return q})};a.prototype._loadVertexDataAsync=function(b,c,a){var d=this,f=this._extensionsLoadVertexDataAsync(b,c,a);if(f)return f;var g=c.attributes;if(!g)throw Error(b+": Attributes are missing");var m=[],k=new pa.a(a.name,this._babylonScene);void 0==c.indices?
a.isUnIndexed=!0:(c=n.Get(b+"/indices",this._gltf.accessors,c.indices),m.push(this._loadIndicesAccessorAsync("/accessors/"+c.index,c).then(function(b){k.setIndices(b)})));c=function(c,e,f){if(void 0!=g[c]){a._delayInfo=a._delayInfo||[];-1===a._delayInfo.indexOf(e)&&a._delayInfo.push(e);var q=n.Get(b+"/attributes/"+c,d._gltf.accessors,g[c]);m.push(d._loadVertexAccessorAsync("/accessors/"+q.index,q,e).then(function(b){if(b.getKind()===z.b.PositionKind&&!d.parent.alwaysComputeBoundingBox&&!a.skeleton){var c=
q.min,e=q.max;if(void 0!==c&&void 0!==e){var f=r.c.Vector3[0],g=r.c.Vector3[1];f.copyFromFloats.apply(f,c);g.copyFromFloats.apply(g,e);k._boundingInfo=new db.a(f,g);k.useBoundingInfoFromGeometry=!0}}k.setVerticesBuffer(b,q.count)}));e==z.b.MatricesIndicesExtraKind&&(a.numBoneInfluencers=8);f&&f(q)}};c("POSITION",z.b.PositionKind);c("NORMAL",z.b.NormalKind);c("TANGENT",z.b.TangentKind);c("TEXCOORD_0",z.b.UVKind);c("TEXCOORD_1",z.b.UV2Kind);c("JOINTS_0",z.b.MatricesIndicesKind);c("WEIGHTS_0",z.b.MatricesWeightsKind);
c("JOINTS_1",z.b.MatricesIndicesExtraKind);c("WEIGHTS_1",z.b.MatricesWeightsExtraKind);c("COLOR_0",z.b.ColorKind,function(b){"VEC4"===b.type&&(a.hasVertexAlpha=!0)});return Promise.all(m).then(function(){return k})};a.prototype._createMorphTargets=function(b,c,a,e,f){if(e.targets){if(void 0==c._numMorphTargets)c._numMorphTargets=e.targets.length;else if(e.targets.length!==c._numMorphTargets)throw Error(b+": Primitives do not have the same number of targets");b=a.extras?a.extras.targetNames:null;f.morphTargetManager=
new ab.a(f.getScene());for(var d=0;d<e.targets.length;d++)f.morphTargetManager.addTarget(new $a.a(b?b[d]:"morphTarget"+d,c.weights?c.weights[d]:a.weights?a.weights[d]:0,f.getScene()))}};a.prototype._loadMorphTargetsAsync=function(b,c,a,e){if(!c.targets)return Promise.resolve();var d=[];a=a.morphTargetManager;for(var g=0;g<a.numTargets;g++){var m=a.getTarget(g);d.push(this._loadMorphTargetVertexDataAsync(b+"/targets/"+g,e,c.targets[g],m))}return Promise.all(d).then(function(){})};a.prototype._loadMorphTargetVertexDataAsync=
function(b,c,a,e){var d=this,g=[],m=function(e,f,m){if(void 0!=a[e]){var k=c.getVertexBuffer(f);k&&(e=n.Get(b+"/"+e,d._gltf.accessors,a[e]),g.push(d._loadFloatAccessorAsync("/accessors/"+e.index,e).then(function(b){m(k,b)})))}};m("POSITION",z.b.PositionKind,function(b,c){var a=new Float32Array(c.length);b.forEach(c.length,function(b,d){a[d]=c[d]+b});e.setPositions(a)});m("NORMAL",z.b.NormalKind,function(b,c){var a=new Float32Array(c.length);b.forEach(a.length,function(b,d){a[d]=c[d]+b});e.setNormals(a)});
m("TANGENT",z.b.TangentKind,function(b,c){var a=new Float32Array(c.length/3*4),d=0;b.forEach(c.length/3*4,function(b,e){0!==(e+1)%4&&(a[d]=c[d]+b,d++)});e.setTangents(a)});return Promise.all(g).then(function(){})};a._LoadTransform=function(b,c){if(void 0==b.skin){var a=r.e.Zero(),e=r.b.Identity(),f=r.e.One();b.matrix?r.a.FromArray(b.matrix).decompose(f,e,a):(b.translation&&(a=r.e.FromArray(b.translation)),b.rotation&&(e=r.b.FromArray(b.rotation)),b.scale&&(f=r.e.FromArray(b.scale)));c.position=a;
c.rotationQuaternion=e;c.scaling=f}};a.prototype._loadSkinAsync=function(b,c,a){var d=this,f=this._extensionsLoadSkinAsync(b,c,a);if(f)return f;f=function(b){d._forEachPrimitive(c,function(c){c.skeleton=b})};if(a._data)return f(a._data.babylonSkeleton),a._data.promise;var g="skeleton"+a.index;this._babylonScene._blockEntityCollection=this._forAssetContainer;var m=new na.a(a.name||g,g,this._babylonScene);this._babylonScene._blockEntityCollection=!1;m.overrideMesh=this._rootBabylonMesh;this._loadBones(b,
a,m);f(m);b=this._loadSkinInverseBindMatricesDataAsync(b,a).then(function(b){d._updateBoneMatrices(m,b)});a._data={babylonSkeleton:m,promise:b};return b};a.prototype._loadBones=function(b,c,a){for(var d={},f=0,g=c.joints;f<g.length;f++){var m=g[f];m=n.Get(b+"/joints/"+m,this._gltf.nodes,m);this._loadBone(m,c,a,d)}};a.prototype._loadBone=function(b,c,a,e){var d=e[b.index];if(d)return d;d=null;b.parent&&b.parent._babylonTransformNode!==this._rootBabylonMesh&&(d=this._loadBone(b.parent,c,a,e));c=c.joints.indexOf(b.index);
d=new ea.a(b.name||"joint"+b.index,a,d,this._getNodeMatrix(b),null,null,c);e[b.index]=d;b._babylonBones=b._babylonBones||[];b._babylonBones.push(d);return d};a.prototype._loadSkinInverseBindMatricesDataAsync=function(b,c){if(void 0==c.inverseBindMatrices)return Promise.resolve(null);b=n.Get(b+"/inverseBindMatrices",this._gltf.accessors,c.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+b.index,b)};a.prototype._updateBoneMatrices=function(b,c){var a=0;for(b=b.bones;a<b.length;a++){var e=
b[a],f=r.a.Identity(),g=e._index;c&&-1!==g&&(r.a.FromArrayToRef(c,16*g,f),f.invertToRef(f));(g=e.getParent())&&f.multiplyToRef(g.getInvertedAbsoluteTransform(),f);e.setBindPose(f);e.updateMatrix(f,!1,!1);e._updateDifferenceMatrix(void 0,!1)}};a.prototype._getNodeMatrix=function(b){return b.matrix?r.a.FromArray(b.matrix):r.a.Compose(b.scale?r.e.FromArray(b.scale):r.e.One(),b.rotation?r.b.FromArray(b.rotation):r.b.Identity(),b.translation?r.e.FromArray(b.translation):r.e.Zero())};a.prototype.loadCameraAsync=
function(b,c,d){void 0===d&&(d=function(){});var e=this._extensionsLoadCameraAsync(b,c,d);if(e)return e;this.logOpen(b+" "+(c.name||""));this._babylonScene._blockEntityCollection=this._forAssetContainer;var f=new ma.a(c.name||"camera"+c.index,r.e.Zero(),this._babylonScene,!1);this._babylonScene._blockEntityCollection=!1;f.ignoreParentScaling=!0;f.rotation=new r.e(0,Math.PI,0);switch(c.type){case "perspective":c=c.perspective;if(!c)throw Error(b+": Camera perspective properties are missing");f.fov=
c.yfov;f.minZ=c.znear;f.maxZ=c.zfar||Number.MAX_VALUE;break;case "orthographic":if(!c.orthographic)throw Error(b+": Camera orthographic properties are missing");f.mode=ya.a.ORTHOGRAPHIC_CAMERA;f.orthoLeft=-c.orthographic.xmag;f.orthoRight=c.orthographic.xmag;f.orthoBottom=-c.orthographic.ymag;f.orthoTop=c.orthographic.ymag;f.minZ=c.orthographic.znear;f.maxZ=c.orthographic.zfar;break;default:throw Error(b+": Invalid camera type ("+c.type+")");}a.AddPointerMetadata(f,b);this._parent.onCameraLoadedObservable.notifyObservers(f);
d(f);this.logClose();return Promise.all([]).then(function(){return f})};a.prototype._loadAnimationsAsync=function(){var b=this._gltf.animations;if(!b)return Promise.resolve();for(var c=[],a=0;a<b.length;a++){var e=b[a];c.push(this.loadAnimationAsync("/animations/"+e.index,e))}return Promise.all(c).then(function(){})};a.prototype.loadAnimationAsync=function(b,c){var a=this._extensionsLoadAnimationAsync(b,c);if(a)return a;this._babylonScene._blockEntityCollection=this._forAssetContainer;var e=new Za.a(c.name||
"animation"+c.index,this._babylonScene);this._babylonScene._blockEntityCollection=!1;c._babylonAnimationGroup=e;a=[];n.Assign(c.channels);n.Assign(c.samplers);for(var f=0,g=c.channels;f<g.length;f++){var m=g[f];a.push(this._loadAnimationChannelAsync(b+"/channels/"+m.index,b,c,m,e))}return Promise.all(a).then(function(){e.normalize(0);return e})};a.prototype._loadAnimationChannelAsync=function(b,c,a,e,f,g){var d=this;void 0===g&&(g=null);if(void 0==e.target.node)return Promise.resolve();var k=n.Get(b+
"/target/node",this._gltf.nodes,e.target.node);if("weights"===e.target.path&&!k._numMorphTargets||"weights"!==e.target.path&&!k._babylonTransformNode)return Promise.resolve();a=n.Get(b+"/sampler",a.samplers,e.sampler);return this._loadAnimationSamplerAsync(c+"/samplers/"+e.sampler,a).then(function(c){switch(e.target.path){case "translation":var a="position";var m=P.a.ANIMATIONTYPE_VECTOR3;break;case "rotation":a="rotationQuaternion";m=P.a.ANIMATIONTYPE_QUATERNION;break;case "scale":a="scaling";m=
P.a.ANIMATIONTYPE_VECTOR3;break;case "weights":a="influence";m=P.a.ANIMATIONTYPE_FLOAT;break;default:throw Error(b+"/target/path: Invalid value ("+e.target.path+")");}var h=0;switch(a){case "position":var q=function(){var b=r.e.FromArray(c.output,h);h+=3;return b};break;case "rotationQuaternion":q=function(){var b=r.b.FromArray(c.output,h);h+=4;return b};break;case "scaling":q=function(){var b=r.e.FromArray(c.output,h);h+=3;return b};break;case "influence":q=function(){for(var b=Array(k._numMorphTargets),
a=0;a<k._numMorphTargets;a++)b[a]=c.output[h++];return b}}switch(c.interpolation){case "STEP":var l=function(b){return{frame:c.input[b],value:q(),interpolation:bb.a.STEP}};break;case "LINEAR":l=function(b){return{frame:c.input[b],value:q()}};break;case "CUBICSPLINE":l=function(b){return{frame:c.input[b],inTangent:q(),value:q(),outTangent:q()}}}for(var n=Array(c.input.length),p=0;p<c.input.length;p++)n[p]=l(p);if("influence"===a)for(l=function(b){var c=new P.a(f.name+"_channel"+f.targetedAnimations.length,
a,1,m);c.setKeys(n.map(function(c){return{frame:c.frame,inTangent:c.inTangent?c.inTangent[b]:void 0,value:c.value[b],outTangent:c.outTangent?c.outTangent[b]:void 0}}));d._forEachPrimitive(k,function(a){a=a.morphTargetManager.getTarget(b);var d=c.clone();a.animations.push(d);f.addTargetedAnimation(d,a)})},p=0;p<k._numMorphTargets;p++)l(p);else l=new P.a(f.name+"_channel"+f.targetedAnimations.length,a,1,m),l.setKeys(n),null!=g&&null!=g.animations?(g.animations.push(l),f.addTargetedAnimation(l,g)):(k._babylonTransformNode.animations.push(l),
f.addTargetedAnimation(l,k._babylonTransformNode))})};a.prototype._loadAnimationSamplerAsync=function(b,c){if(c._data)return c._data;var a=c.interpolation||"LINEAR";switch(a){case "STEP":case "LINEAR":case "CUBICSPLINE":break;default:throw Error(b+"/interpolation: Invalid value ("+c.interpolation+")");}var e=n.Get(b+"/input",this._gltf.accessors,c.input);b=n.Get(b+"/output",this._gltf.accessors,c.output);c._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+e.index,e),this._loadFloatAccessorAsync("/accessors/"+
b.index,b)]).then(function(b){return{input:b[0],interpolation:a,output:b[1]}});return c._data};a.prototype._loadBufferAsync=function(b,c,a,e){var d=this._extensionsLoadBufferAsync(b,c,a,e);if(d)return d;if(!c._data)if(c.uri)c._data=this.loadUriAsync(b+"/uri",c,c.uri);else{if(!this._bin)throw Error(b+": Uri is missing or the binary glTF is missing its binary chunk");c._data=this._bin.readAsync(0,c.byteLength)}return c._data.then(function(c){try{return new Uint8Array(c.buffer,c.byteOffset+a,e)}catch(m){throw Error(b+
": "+m.message);}})};a.prototype.loadBufferViewAsync=function(b,c){var a=this._extensionsLoadBufferViewAsync(b,c);if(a)return a;if(c._data)return c._data;b=n.Get(b+"/buffer",this._gltf.buffers,c.buffer);c._data=this._loadBufferAsync("/buffers/"+b.index,b,c.byteOffset||0,c.byteLength);return c._data};a.prototype._loadAccessorAsync=function(b,c,d){var e=this;if(c._data)return c._data;var f=a._GetNumComponents(b,c.type),g=f*z.b.GetTypeByteLength(c.componentType),m=f*c.count;if(void 0==c.bufferView)c._data=
Promise.resolve(new d(m));else{var k=n.Get(b+"/bufferView",this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync("/bufferViews/"+k.index,k).then(function(e){if(5126!==c.componentType||c.normalized||k.byteStride&&k.byteStride!==g){var h=new d(m);z.b.ForEach(e,c.byteOffset||0,k.byteStride||g,f,c.componentType,h.length,c.normalized||!1,function(b,c){h[c]=b});return h}return a._GetTypedArray(b,c.componentType,e,c.byteOffset,m)})}if(c.sparse){var h=c.sparse;c._data=c._data.then(function(m){var k=
n.Get(b+"/sparse/indices/bufferView",e._gltf.bufferViews,h.indices.bufferView),q=n.Get(b+"/sparse/values/bufferView",e._gltf.bufferViews,h.values.bufferView);return Promise.all([e.loadBufferViewAsync("/bufferViews/"+k.index,k),e.loadBufferViewAsync("/bufferViews/"+q.index,q)]).then(function(e){var k=e[1];e=a._GetTypedArray(b+"/sparse/indices",h.indices.componentType,e[0],h.indices.byteOffset,h.count);var q=f*h.count;if(5126!==c.componentType||c.normalized){k=a._GetTypedArray(b+"/sparse/values",c.componentType,
k,h.values.byteOffset,q);var l=new d(q);z.b.ForEach(k,0,g,f,c.componentType,l.length,c.normalized||!1,function(b,c){l[c]=b})}else l=a._GetTypedArray(b+"/sparse/values",c.componentType,k,h.values.byteOffset,q);for(q=k=0;q<e.length;q++)for(var u=e[q]*f,n=0;n<f;n++)m[u++]=l[k++];return m})})}return c._data};a.prototype._loadFloatAccessorAsync=function(b,c){return this._loadAccessorAsync(b,c,Float32Array)};a.prototype._loadIndicesAccessorAsync=function(b,c){if("SCALAR"!==c.type)throw Error(b+"/type: Invalid value "+
c.type);if(5121!==c.componentType&&5123!==c.componentType&&5125!==c.componentType)throw Error(b+"/componentType: Invalid value "+c.componentType);if(c._data)return c._data;if(c.sparse){var d=a._GetTypedArrayConstructor(b+"/componentType",c.componentType);c._data=this._loadAccessorAsync(b,c,d)}else d=n.Get(b+"/bufferView",this._gltf.bufferViews,c.bufferView),c._data=this.loadBufferViewAsync("/bufferViews/"+d.index,d).then(function(d){return a._GetTypedArray(b,c.componentType,d,c.byteOffset,c.count)});
return c._data};a.prototype._loadVertexBufferViewAsync=function(b,c){var a=this;if(b._babylonBuffer)return b._babylonBuffer;b._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+b.index,b).then(function(b){return new z.a(a._babylonScene.getEngine(),b,!1)});return b._babylonBuffer};a.prototype._loadVertexAccessorAsync=function(b,c,d){var e=this;if(c._babylonVertexBuffer)return c._babylonVertexBuffer;if(c.sparse)c._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+c.index,c).then(function(b){return new z.b(e._babylonScene.getEngine(),
b,d,!1)});else if(c.byteOffset&&0!==c.byteOffset%z.b.GetTypeByteLength(c.componentType))H.a.Warn("Accessor byte offset is not a multiple of component type byte length"),c._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+c.index,c).then(function(b){return new z.b(e._babylonScene.getEngine(),b,d,!1)});else if(d===z.b.MatricesIndicesKind||d===z.b.MatricesIndicesExtraKind)c._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+c.index,c).then(function(b){return new z.b(e._babylonScene.getEngine(),
b,d,!1)});else{var f=n.Get(b+"/bufferView",this._gltf.bufferViews,c.bufferView);c._babylonVertexBuffer=this._loadVertexBufferViewAsync(f,d).then(function(g){var m=a._GetNumComponents(b,c.type);return new z.b(e._babylonScene.getEngine(),g,d,!1,!1,f.byteStride,!1,c.byteOffset,m,c.componentType,c.normalized,!0,1,!0)})}return c._babylonVertexBuffer};a.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(b,c,a){if(!(a instanceof G.a))throw Error(b+": Material type not supported");var d=[];
c&&(c.baseColorFactor?(a.albedoColor=C.a.FromArray(c.baseColorFactor),a.alpha=c.baseColorFactor[3]):a.albedoColor=C.a.White(),a.metallic=void 0==c.metallicFactor?1:c.metallicFactor,a.roughness=void 0==c.roughnessFactor?1:c.roughnessFactor,c.baseColorTexture&&d.push(this.loadTextureInfoAsync(b+"/baseColorTexture",c.baseColorTexture,function(b){b.name=a.name+" (Base Color)";a.albedoTexture=b})),c.metallicRoughnessTexture&&(c.metallicRoughnessTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(b+
"/metallicRoughnessTexture",c.metallicRoughnessTexture,function(b){b.name=a.name+" (Metallic Roughness)";a.metallicTexture=b})),a.useMetallnessFromMetallicTextureBlue=!0,a.useRoughnessFromMetallicTextureGreen=!0,a.useRoughnessFromMetallicTextureAlpha=!1));return Promise.all(d).then(function(){})};a.prototype._loadMaterialAsync=function(b,c,d,e,f){void 0===f&&(f=function(){});var g=this._extensionsLoadMaterialAsync(b,c,d,e,f);if(g)return g;c._data=c._data||{};var m=c._data[e];m||(this.logOpen(b+" "+
(c.name||"")),g=this.createMaterial(b,c,e),m={babylonMaterial:g,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(b,c,g)},c._data[e]=m,a.AddPointerMetadata(g,b),this._parent.onMaterialLoadedObservable.notifyObservers(g),this.logClose());d&&(m.babylonMeshes.push(d),d.onDisposeObservable.addOnce(function(){var b=m.babylonMeshes.indexOf(d);-1!==b&&m.babylonMeshes.splice(b,1)}));f(m.babylonMaterial);return m.promise.then(function(){return m.babylonMaterial})};a.prototype._createDefaultMaterial=
function(b,c){this._babylonScene._blockEntityCollection=this._forAssetContainer;b=new G.a(b,this._babylonScene);this._babylonScene._blockEntityCollection=!1;b.fillMode=c;b.enableSpecularAntiAliasing=!0;b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage;b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage;b.transparencyMode=G.a.PBRMATERIAL_OPAQUE;b.metallic=1;b.roughness=1;return b};a.prototype.createMaterial=function(b,c,a){return(b=this._extensionsCreateMaterial(b,c,a))?b:this._createDefaultMaterial(c.name||
"material"+c.index,a)};a.prototype.loadMaterialPropertiesAsync=function(b,c,a){var d=this._extensionsLoadMaterialPropertiesAsync(b,c,a);if(d)return d;d=[];d.push(this.loadMaterialBasePropertiesAsync(b,c,a));c.pbrMetallicRoughness&&d.push(this._loadMaterialMetallicRoughnessPropertiesAsync(b+"/pbrMetallicRoughness",c.pbrMetallicRoughness,a));this.loadMaterialAlphaProperties(b,c,a);return Promise.all(d).then(function(){})};a.prototype.loadMaterialBasePropertiesAsync=function(b,c,a){if(!(a instanceof
G.a))throw Error(b+": Material type not supported");var d=[];a.emissiveColor=c.emissiveFactor?C.a.FromArray(c.emissiveFactor):new C.a(0,0,0);c.doubleSided&&(a.backFaceCulling=!1,a.twoSidedLighting=!0);c.normalTexture&&(c.normalTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(b+"/normalTexture",c.normalTexture,function(b){b.name=a.name+" (Normal)";a.bumpTexture=b})),a.invertNormalMapX=!this._babylonScene.useRightHandedSystem,a.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=
c.normalTexture.scale&&(a.bumpTexture.level=c.normalTexture.scale),a.forceIrradianceInFragment=!0);c.occlusionTexture&&(c.occlusionTexture.nonColorData=!0,d.push(this.loadTextureInfoAsync(b+"/occlusionTexture",c.occlusionTexture,function(b){b.name=a.name+" (Occlusion)";a.ambientTexture=b})),a.useAmbientInGrayScale=!0,void 0!=c.occlusionTexture.strength&&(a.ambientTextureStrength=c.occlusionTexture.strength));c.emissiveTexture&&d.push(this.loadTextureInfoAsync(b+"/emissiveTexture",c.emissiveTexture,
function(b){b.name=a.name+" (Emissive)";a.emissiveTexture=b}));return Promise.all(d).then(function(){})};a.prototype.loadMaterialAlphaProperties=function(b,a,d){if(!(d instanceof G.a))throw Error(b+": Material type not supported");switch(a.alphaMode||"OPAQUE"){case "OPAQUE":d.transparencyMode=G.a.PBRMATERIAL_OPAQUE;break;case "MASK":d.transparencyMode=G.a.PBRMATERIAL_ALPHATEST;d.alphaCutOff=void 0==a.alphaCutoff?.5:a.alphaCutoff;d.albedoTexture&&(d.albedoTexture.hasAlpha=!0);break;case "BLEND":d.transparencyMode=
G.a.PBRMATERIAL_ALPHABLEND;d.albedoTexture&&(d.albedoTexture.hasAlpha=!0,d.useAlphaFromAlbedoTexture=!0);break;default:throw Error(b+"/alphaMode: Invalid value ("+a.alphaMode+")");}};a.prototype.loadTextureInfoAsync=function(b,c,d){var e=this;void 0===d&&(d=function(){});var f=this._extensionsLoadTextureInfoAsync(b,c,d);if(f)return f;this.logOpen(""+b);if(2<=c.texCoord)throw Error(b+"/texCoord: Invalid value ("+c.texCoord+")");f=n.Get(b+"/index",this._gltf.textures,c.index);f._textureInfo=c;f=this._loadTextureAsync("/textures/"+
c.index,f,function(f){f.coordinatesIndex=c.texCoord||0;a.AddPointerMetadata(f,b);e._parent.onTextureLoadedObservable.notifyObservers(f);d(f)});this.logClose();return f};a.prototype._loadTextureAsync=function(b,c,d){void 0===d&&(d=function(){});var e=this._extensionsLoadTextureAsync(b,c,d);if(e)return e;this.logOpen(b+" "+(c.name||""));e=void 0==c.sampler?a.DefaultSampler:n.Get(b+"/sampler",this._gltf.samplers,c.sampler);c=n.Get(b+"/source",this._gltf.images,c.source);b=this._createTextureAsync(b,
e,c,d);this.logClose();return b};a.prototype._createTextureAsync=function(b,a,d,e,f){var c=this;void 0===e&&(e=function(){});a=this._loadSampler("/samplers/"+a.index,a);var m=[],k=new ia.a;this._babylonScene._blockEntityCollection=this._forAssetContainer;var h=new D.a(null,this._babylonScene,a.noMipMaps,!1,a.samplingMode,function(){c._disposed||k.resolve()},function(a,d){c._disposed||k.reject(Error(b+": "+(d&&d.message?d.message:a||"Failed to load texture")))},void 0,void 0,void 0,d.mimeType,f);this._babylonScene._blockEntityCollection=
!1;m.push(k.promise);m.push(this.loadImageAsync("/images/"+d.index,d).then(function(b){h.updateURL("data:"+c._uniqueRootUrl+(d.uri||c._fileName+"#image"+d.index),b)}));h.wrapU=a.wrapU;h.wrapV=a.wrapV;e(h);return Promise.all(m).then(function(){return h})};a.prototype._loadSampler=function(b,c){c._data||(c._data={noMipMaps:9728===c.minFilter||9729===c.minFilter,samplingMode:a._GetTextureSamplingMode(b,c),wrapU:a._GetTextureWrapMode(b+"/wrapS",c.wrapS),wrapV:a._GetTextureWrapMode(b+"/wrapT",c.wrapT)});
return c._data};a.prototype.loadImageAsync=function(b,a){a._data||(this.logOpen(b+" "+(a.name||"")),a.uri?a._data=this.loadUriAsync(b+"/uri",a,a.uri):(b=n.Get(b+"/bufferView",this._gltf.bufferViews,a.bufferView),a._data=this.loadBufferViewAsync("/bufferViews/"+b.index,b)),this.logClose());return a._data};a.prototype.loadUriAsync=function(b,c,d){var e=this;if(c=this._extensionsLoadUriAsync(b,c,d))return c;if(!a._ValidateUri(d))throw Error(b+": '"+d+"' is invalid");if(p.b.IsBase64(d))return c=new Uint8Array(p.b.DecodeBase64(d)),
this.log("Decoded "+d.substr(0,64)+"... ("+c.length+" bytes)"),Promise.resolve(c);this.log("Loading "+d);return this._parent.preprocessUrlAsync(this._rootUrl+d).then(function(a){return new Promise(function(c,f){e._parent._loadFile(a,e._babylonScene,function(b){e._disposed||(e.log("Loaded "+d+" ("+b.byteLength+" bytes)"),c(new Uint8Array(b)))},!0,function(a){f(new cb.b(b+": Failed to load '"+d+"'"+(a?": "+a.status+" "+a.statusText:""),a))})})})};a.AddPointerMetadata=function(b,a){b=b.metadata=b.metadata||
{};b=b.gltf=b.gltf||{};(b.pointers=b.pointers||[]).push(a)};a._GetTextureWrapMode=function(b,a){a=void 0==a?10497:a;switch(a){case 33071:return D.a.CLAMP_ADDRESSMODE;case 33648:return D.a.MIRROR_ADDRESSMODE;case 10497:return D.a.WRAP_ADDRESSMODE;default:return H.a.Warn(b+": Invalid value ("+a+")"),D.a.WRAP_ADDRESSMODE}};a._GetTextureSamplingMode=function(b,a){var c=void 0==a.magFilter?9729:a.magFilter;a=void 0==a.minFilter?9987:a.minFilter;if(9729===c)switch(a){case 9728:return D.a.LINEAR_NEAREST;
case 9729:return D.a.LINEAR_LINEAR;case 9984:return D.a.LINEAR_NEAREST_MIPNEAREST;case 9985:return D.a.LINEAR_LINEAR_MIPNEAREST;case 9986:return D.a.LINEAR_NEAREST_MIPLINEAR;case 9987:return D.a.LINEAR_LINEAR_MIPLINEAR;default:return H.a.Warn(b+"/minFilter: Invalid value ("+a+")"),D.a.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==c&&H.a.Warn(b+"/magFilter: Invalid value ("+c+")"),a){case 9728:return D.a.NEAREST_NEAREST;case 9729:return D.a.NEAREST_LINEAR;case 9984:return D.a.NEAREST_NEAREST_MIPNEAREST;
case 9985:return D.a.NEAREST_LINEAR_MIPNEAREST;case 9986:return D.a.NEAREST_NEAREST_MIPLINEAR;case 9987:return D.a.NEAREST_LINEAR_MIPLINEAR;default:return H.a.Warn(b+"/minFilter: Invalid value ("+a+")"),D.a.NEAREST_NEAREST_MIPNEAREST}};a._GetTypedArrayConstructor=function(b,a){switch(a){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw Error(b+": Invalid component type "+
a);}};a._GetTypedArray=function(b,c,d,e,f){var g=d.buffer;e=d.byteOffset+(e||0);c=a._GetTypedArrayConstructor(b+"/componentType",c);try{return new c(g,e,f)}catch(m){throw Error(b+": "+m);}};a._GetNumComponents=function(b,a){switch(a){case "SCALAR":return 1;case "VEC2":return 2;case "VEC3":return 3;case "VEC4":return 4;case "MAT2":return 4;case "MAT3":return 9;case "MAT4":return 16}throw Error(b+": Invalid type ("+a+")");};a._ValidateUri=function(b){return p.b.IsBase64(b)||-1===b.indexOf("..")};a._GetDrawMode=
function(b,a){void 0==a&&(a=4);switch(a){case 0:return N.a.PointListDrawMode;case 1:return N.a.LineListDrawMode;case 2:return N.a.LineLoopDrawMode;case 3:return N.a.LineStripDrawMode;case 4:return N.a.TriangleFillMode;case 5:return N.a.TriangleStripDrawMode;case 6:return N.a.TriangleFanDrawMode}throw Error(b+": Invalid mesh primitive mode ("+a+")");};a.prototype._compileMaterialsAsync=function(){var b=this;this._parent._startPerformanceCounter("Compile materials");var a=[];if(this._gltf.materials)for(var d=
0,e=this._gltf.materials;d<e.length;d++){var f=e[d];if(f._data)for(var g in f._data)for(var m=f._data[g],k=0,h=m.babylonMeshes;k<h.length;k++){var l=h[k];l.computeWorldMatrix(!0);var n=m.babylonMaterial;a.push(n.forceCompilationAsync(l));a.push(n.forceCompilationAsync(l,{useInstances:!0}));this._parent.useClipPlane&&(a.push(n.forceCompilationAsync(l,{clipPlane:!0})),a.push(n.forceCompilationAsync(l,{clipPlane:!0,useInstances:!0})))}}return Promise.all(a).then(function(){b._parent._endPerformanceCounter("Compile materials")})};
a.prototype._compileShadowGeneratorsAsync=function(){var b=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var a=[],d=0,e=this._babylonScene.lights;d<e.length;d++){var f=e[d].getShadowGenerator();f&&a.push(f.forceCompilationAsync())}return Promise.all(a).then(function(){b._parent._endPerformanceCounter("Compile shadow generators")})};a.prototype._forEachExtensions=function(b){for(var a=0,d=this._extensions;a<d.length;a++){var e=d[a];e.enabled&&b(e)}};a.prototype._applyExtensions=
function(b,a,d){for(var c=0,f=this._extensions;c<f.length;c++){var g=f[c];if(g.enabled){var m=g.name+"."+a,k=b;k._activeLoaderExtensionFunctions=k._activeLoaderExtensionFunctions||{};k=k._activeLoaderExtensionFunctions;if(!k[m]){k[m]=!0;try{var h=d(g);if(h)return h}finally{delete k[m]}}}}return null};a.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(b){return b.onLoading&&b.onLoading()})};a.prototype._extensionsOnReady=function(){this._forEachExtensions(function(b){return b.onReady&&
b.onReady()})};a.prototype._extensionsLoadSceneAsync=function(b,a){return this._applyExtensions(a,"loadScene",function(c){return c.loadSceneAsync&&c.loadSceneAsync(b,a)})};a.prototype._extensionsLoadNodeAsync=function(b,a,d){return this._applyExtensions(a,"loadNode",function(c){return c.loadNodeAsync&&c.loadNodeAsync(b,a,d)})};a.prototype._extensionsLoadCameraAsync=function(b,a,d){return this._applyExtensions(a,"loadCamera",function(c){return c.loadCameraAsync&&c.loadCameraAsync(b,a,d)})};a.prototype._extensionsLoadVertexDataAsync=
function(b,a,d){return this._applyExtensions(a,"loadVertexData",function(c){return c._loadVertexDataAsync&&c._loadVertexDataAsync(b,a,d)})};a.prototype._extensionsLoadMeshPrimitiveAsync=function(b,a,d,e,f,g){return this._applyExtensions(f,"loadMeshPrimitive",function(c){return c._loadMeshPrimitiveAsync&&c._loadMeshPrimitiveAsync(b,a,d,e,f,g)})};a.prototype._extensionsLoadMaterialAsync=function(b,a,d,e,f){return this._applyExtensions(a,"loadMaterial",function(c){return c._loadMaterialAsync&&c._loadMaterialAsync(b,
a,d,e,f)})};a.prototype._extensionsCreateMaterial=function(b,a,d){return this._applyExtensions(a,"createMaterial",function(c){return c.createMaterial&&c.createMaterial(b,a,d)})};a.prototype._extensionsLoadMaterialPropertiesAsync=function(b,a,d){return this._applyExtensions(a,"loadMaterialProperties",function(c){return c.loadMaterialPropertiesAsync&&c.loadMaterialPropertiesAsync(b,a,d)})};a.prototype._extensionsLoadTextureInfoAsync=function(b,a,d){return this._applyExtensions(a,"loadTextureInfo",function(c){return c.loadTextureInfoAsync&&
c.loadTextureInfoAsync(b,a,d)})};a.prototype._extensionsLoadTextureAsync=function(b,a,d){return this._applyExtensions(a,"loadTexture",function(c){return c._loadTextureAsync&&c._loadTextureAsync(b,a,d)})};a.prototype._extensionsLoadAnimationAsync=function(b,a){return this._applyExtensions(a,"loadAnimation",function(c){return c.loadAnimationAsync&&c.loadAnimationAsync(b,a)})};a.prototype._extensionsLoadSkinAsync=function(b,a,d){return this._applyExtensions(d,"loadSkin",function(c){return c._loadSkinAsync&&
c._loadSkinAsync(b,a,d)})};a.prototype._extensionsLoadUriAsync=function(b,a,d){return this._applyExtensions(a,"loadUri",function(c){return c._loadUriAsync&&c._loadUriAsync(b,a,d)})};a.prototype._extensionsLoadBufferViewAsync=function(b,a){return this._applyExtensions(a,"loadBufferView",function(c){return c.loadBufferViewAsync&&c.loadBufferViewAsync(b,a)})};a.prototype._extensionsLoadBufferAsync=function(b,a,d,e){return this._applyExtensions(a,"loadBuffer",function(c){return c.loadBufferAsync&&c.loadBufferAsync(b,
a,d,e)})};a.LoadExtensionAsync=function(b,a,d,e){return a.extensions?(a=a.extensions[d])?e(b+"/extensions/"+d,a):null:null};a.LoadExtraAsync=function(b,a,d,e){return a.extras?(a=a.extras[d])?e(b+"/extras/"+d,a):null:null};a.prototype.isExtensionUsed=function(b){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(b)};a.prototype.logOpen=function(b){this._parent._logOpen(b)};a.prototype.logClose=function(){this._parent._logClose()};a.prototype.log=function(b){this._parent._log(b)};
a.prototype.startPerformanceCounter=function(b){this._parent._startPerformanceCounter(b)};a.prototype.endPerformanceCounter=function(b){this._parent._endPerformanceCounter(b)};a._RegisteredExtensions={};a.DefaultSampler={index:-1};return a}();T._CreateGLTF2Loader=function(a){return new t(a)};var eb=h("sH6m"),La=h("TUvE"),fb=h("o7xM"),gb=function(){function a(b){this.name="EXT_lights_image_based";this._loader=b;this.enabled=this._loader.isExtensionUsed("EXT_lights_image_based")}a.prototype.dispose=
function(){this._loader=null;delete this._lights};a.prototype.onLoading=function(){var b=this._loader.gltf.extensions;b&&b[this.name]&&(this._lights=b[this.name].lights)};a.prototype.loadSceneAsync=function(b,a){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(d,f){var e=[];e.push(c._loader.loadSceneAsync(b,a));c._loader.logOpen(""+d);d=n.Get(d+"/light",c._lights,f.light);e.push(c._loadLightAsync("/extensions/"+c.name+"/lights/"+f.light,d).then(function(b){c._loader.babylonScene.environmentTexture=
b}));c._loader.logClose();return Promise.all(e).then(function(){})})};a.prototype._loadLightAsync=function(b,a){var c=this;if(!a._loaded){var e=[];this._loader.logOpen(""+b);for(var f=Array(a.specularImages.length),g=function(c){var d=a.specularImages[c];f[c]=Array(d.length);for(var g=function(a){var g=b+"/specularImages/"+c+"/"+a;m._loader.logOpen(""+g);var k=d[a];g=n.Get(g,m._loader.gltf.images,k);e.push(m._loader.loadImageAsync("/images/"+k,g).then(function(b){f[c][a]=b}));m._loader.logClose()},
k=0;k<d.length;k++)g(k)},m=this,k=0;k<a.specularImages.length;k++)g(k);this._loader.logClose();a._loaded=Promise.all(e).then(function(){var b=new fb.a(c._loader.babylonScene,null,a.specularImageSize);b.name=a.name||"environment";a._babylonTexture=b;void 0!=a.intensity&&(b.level=a.intensity);if(a.rotation){var d=r.b.FromArray(a.rotation);c._loader.babylonScene.useRightHandedSystem||(d=r.b.Inverse(d));r.a.FromQuaternionToRef(d,b.getReflectionTextureMatrix())}d=La.a.FromArray(a.irradianceCoefficients);
d.scaleInPlace(a.intensity);d.convertIrradianceToLambertianRadiance();d=La.b.FromHarmonics(d);var e=(f.length-1)/eb.a.Log2(a.specularImageSize);return b.updateRGBDAsync(f,d,e)})}return a._loaded.then(function(){return a._babylonTexture})};return a}();t.RegisterExtension("EXT_lights_image_based",function(a){return new gb(a)});var hb=function(){function a(b){this.name="EXT_mesh_gpu_instancing";this._loader=b;this.enabled=this._loader.isExtensionUsed("EXT_mesh_gpu_instancing")}a.prototype.dispose=function(){this._loader=
null};a.prototype.loadNodeAsync=function(b,a,d){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(b,e){c._loader._disableInstancedMesh++;var f=c._loader.loadNodeAsync("/nodes/"+a.index,a,d);c._loader._disableInstancedMesh--;if(!a._primitiveBabylonMeshes)return f;var g=[],h=0,l=function(a){if(void 0==e.attributes[a])g.push(Promise.resolve(null));else if(a=n.Get(b+"/attributes/"+a,c._loader.gltf.accessors,e.attributes[a]),g.push(c._loader._loadFloatAccessorAsync("/accessors/"+a.bufferView,
a)),0===h)h=a.count;else if(h!==a.count)throw Error(b+"/attributes: Instance buffer accessors do not have the same count.");};l("TRANSLATION");l("ROTATION");l("SCALE");return f.then(function(b){return Promise.all(g).then(function(c){var d=c[0],e=c[1],f=c[2];c=new Float32Array(16*h);r.c.Vector3[0].copyFromFloats(0,0,0);r.c.Quaternion[0].copyFromFloats(0,0,0,1);r.c.Vector3[1].copyFromFloats(1,1,1);for(var g=0;g<h;++g)d&&r.e.FromArrayToRef(d,3*g,r.c.Vector3[0]),e&&r.b.FromArrayToRef(e,4*g,r.c.Quaternion[0]),
f&&r.e.FromArrayToRef(f,3*g,r.c.Vector3[1]),r.a.ComposeToRef(r.c.Vector3[1],r.c.Quaternion[0],r.c.Vector3[0],r.c.Matrix[0]),r.c.Matrix[0].copyToArray(c,16*g);d=0;for(e=a._primitiveBabylonMeshes;d<e.length;d++)e[d].thinInstanceSetBuffer("matrix",c,16,!0);return b})})})};return a}();t.RegisterExtension("EXT_mesh_gpu_instancing",function(a){return new hb(a)});var ib=function(){function a(b){this.name="EXT_texture_webp";this._loader=b;this.enabled=b.isExtensionUsed("EXT_texture_webp")}a.prototype.dispose=
function(){this._loader=null};a.prototype._loadTextureAsync=function(b,a,d){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(e,g){var f=void 0==a.sampler?t.DefaultSampler:n.Get(b+"/sampler",c._loader.gltf.samplers,a.sampler);e=n.Get(e+"/source",c._loader.gltf.images,g.source);return c._loader._createTextureAsync(b,f,e,function(b){d(b)})})};return a}();t.RegisterExtension("EXT_texture_webp",function(a){return new ib(a)});var Ma=h("QpEL"),jb=function(){function a(b){this.name="KHR_draco_mesh_compression";
this._loader=b;this.enabled=Ma.a.DecoderAvailable&&this._loader.isExtensionUsed("KHR_draco_mesh_compression")}a.prototype.dispose=function(){delete this.dracoCompression;this._loader=null};a.prototype._loadVertexDataAsync=function(b,a,d){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(e,g){if(void 0!=a.mode){if(5!==a.mode&&4!==a.mode)throw Error(b+": Unsupported mode "+a.mode);if(5===a.mode)throw Error(b+": Mode "+a.mode+" is not currently supported");}var f={},k=function(b,a){b=g.attributes[b];
void 0!=b&&(d._delayInfo=d._delayInfo||[],-1===d._delayInfo.indexOf(a)&&d._delayInfo.push(a),f[a]=b)};k("POSITION",z.b.PositionKind);k("NORMAL",z.b.NormalKind);k("TANGENT",z.b.TangentKind);k("TEXCOORD_0",z.b.UVKind);k("TEXCOORD_1",z.b.UV2Kind);k("JOINTS_0",z.b.MatricesIndicesKind);k("WEIGHTS_0",z.b.MatricesWeightsKind);k("COLOR_0",z.b.ColorKind);e=n.Get(e,c._loader.gltf.bufferViews,g.bufferView);e._dracoBabylonGeometry||(e._dracoBabylonGeometry=c._loader.loadBufferViewAsync("/bufferViews/"+e.index,
e).then(function(a){return(c.dracoCompression||Ma.a.Default).decodeMeshAsync(a,f).then(function(b){var a=new pa.a(d.name,c._loader.babylonScene);b.applyToGeometry(a);return a}).catch(function(a){throw Error(b+": "+a.message);})}));return e._dracoBabylonGeometry})};return a}();t.RegisterExtension("KHR_draco_mesh_compression",function(a){return new jb(a)});var kb=h("llUH"),lb=function(){function a(b){this.name="KHR_lights_punctual";this._loader=b;this.enabled=this._loader.isExtensionUsed("KHR_lights_punctual")}
a.prototype.dispose=function(){this._loader=null;delete this._lights};a.prototype.onLoading=function(){var b=this._loader.gltf.extensions;b&&b[this.name]&&(this._lights=b[this.name].lights)};a.prototype.loadNodeAsync=function(b,a,d){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(e,g){return c._loader.loadNodeAsync(b,a,function(b){var a=n.Get(e,c._lights,g.light);var f=a.name||b.name;c._loader.babylonScene._blockEntityCollection=c._loader._forAssetContainer;switch(a.type){case "directional":f=
new qa.a(f,r.e.Backward(),c._loader.babylonScene);break;case "point":f=new ra.a(f,r.e.Zero(),c._loader.babylonScene);break;case "spot":f=new sa.a(f,r.e.Zero(),r.e.Backward(),0,1,c._loader.babylonScene);f.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4);f.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0);break;default:throw c._loader.babylonScene._blockEntityCollection=!1,Error(e+": Invalid light type ("+a.type+")");}c._loader.babylonScene._blockEntityCollection=!1;f.falloffType=kb.a.FALLOFF_GLTF;
f.diffuse=a.color?C.a.FromArray(a.color):C.a.White();f.intensity=void 0==a.intensity?1:a.intensity;f.range=void 0==a.range?Number.MAX_VALUE:a.range;f.parent=b;c._loader._babylonLights.push(f);t.AddPointerMetadata(f,e);d(b)})})};return a}();t.RegisterExtension("KHR_lights_punctual",function(a){return new lb(a)});var mb=function(){function a(b){this.name="KHR_materials_pbrSpecularGlossiness";this.order=200;this._loader=b;this.enabled=this._loader.isExtensionUsed("KHR_materials_pbrSpecularGlossiness")}
a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=function(b,a,d){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(e,g){var f=[];f.push(c._loader.loadMaterialBasePropertiesAsync(b,a,d));f.push(c._loadSpecularGlossinessPropertiesAsync(e,a,g,d));c._loader.loadMaterialAlphaProperties(b,a,d);return Promise.all(f).then(function(){})})};a.prototype._loadSpecularGlossinessPropertiesAsync=function(b,a,d,e){if(!(e instanceof G.a))throw Error(b+": Material type not supported");
a=[];e.metallic=null;e.roughness=null;d.diffuseFactor?(e.albedoColor=C.a.FromArray(d.diffuseFactor),e.alpha=d.diffuseFactor[3]):e.albedoColor=C.a.White();e.reflectivityColor=d.specularFactor?C.a.FromArray(d.specularFactor):C.a.White();e.microSurface=void 0==d.glossinessFactor?1:d.glossinessFactor;d.diffuseTexture&&a.push(this._loader.loadTextureInfoAsync(b+"/diffuseTexture",d.diffuseTexture,function(b){b.name=e.name+" (Diffuse)";e.albedoTexture=b}));d.specularGlossinessTexture&&(d.specularGlossinessTexture.nonColorData=
!0,a.push(this._loader.loadTextureInfoAsync(b+"/specularGlossinessTexture",d.specularGlossinessTexture,function(b){b.name=e.name+" (Specular Glossiness)";e.reflectivityTexture=b})),e.reflectivityTexture.hasAlpha=!0,e.useMicroSurfaceFromReflectivityMapAlpha=!0);return Promise.all(a).then(function(){})};return a}();t.RegisterExtension("KHR_materials_pbrSpecularGlossiness",function(a){return new mb(a)});var nb=function(){function a(b){this.name="KHR_materials_unlit";this.order=210;this._loader=b;this.enabled=
this._loader.isExtensionUsed("KHR_materials_unlit")}a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=function(b,a,d){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(){return c._loadUnlitPropertiesAsync(b,a,d)})};a.prototype._loadUnlitPropertiesAsync=function(b,a,d){if(!(d instanceof G.a))throw Error(b+": Material type not supported");var c=[];d.unlit=!0;var f=a.pbrMetallicRoughness;f&&(f.baseColorFactor?(d.albedoColor=C.a.FromArray(f.baseColorFactor),
d.alpha=f.baseColorFactor[3]):d.albedoColor=C.a.White(),f.baseColorTexture&&c.push(this._loader.loadTextureInfoAsync(b+"/baseColorTexture",f.baseColorTexture,function(b){b.name=d.name+" (Base Color)";d.albedoTexture=b})));a.doubleSided&&(d.backFaceCulling=!1,d.twoSidedLighting=!0);this._loader.loadMaterialAlphaProperties(b,a,d);return Promise.all(c).then(function(){})};return a}();t.RegisterExtension("KHR_materials_unlit",function(a){return new nb(a)});var ob=function(){function a(b){this.name="KHR_materials_clearcoat";
this.order=190;this._loader=b;this.enabled=this._loader.isExtensionUsed("KHR_materials_clearcoat")}a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=function(b,a,d){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(e,g){var f=[];f.push(c._loader.loadMaterialPropertiesAsync(b,a,d));f.push(c._loadClearCoatPropertiesAsync(e,g,d));return Promise.all(f).then(function(){})})};a.prototype._loadClearCoatPropertiesAsync=function(b,a,d){if(!(d instanceof G.a))throw Error(b+
": Material type not supported");var c=[];d.clearCoat.isEnabled=!0;d.clearCoat.useRoughnessFromMainTexture=!1;d.clearCoat.remapF0OnInterfaceChange=!1;d.clearCoat.intensity=void 0!=a.clearcoatFactor?a.clearcoatFactor:0;a.clearcoatTexture&&c.push(this._loader.loadTextureInfoAsync(b+"/clearcoatTexture",a.clearcoatTexture,function(b){b.name=d.name+" (ClearCoat Intensity)";d.clearCoat.texture=b}));d.clearCoat.roughness=void 0!=a.clearcoatRoughnessFactor?a.clearcoatRoughnessFactor:0;a.clearcoatRoughnessTexture&&
(a.clearcoatRoughnessTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(b+"/clearcoatRoughnessTexture",a.clearcoatRoughnessTexture,function(b){b.name=d.name+" (ClearCoat Roughness)";d.clearCoat.textureRoughness=b})));a.clearcoatNormalTexture&&(a.clearcoatNormalTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(b+"/clearcoatNormalTexture",a.clearcoatNormalTexture,function(b){b.name=d.name+" (ClearCoat Normal)";d.clearCoat.bumpTexture=b})),d.invertNormalMapX=!d.getScene().useRightHandedSystem,
d.invertNormalMapY=d.getScene().useRightHandedSystem,void 0!=a.clearcoatNormalTexture.scale&&(d.clearCoat.bumpTexture.level=a.clearcoatNormalTexture.scale));return Promise.all(c).then(function(){})};return a}();t.RegisterExtension("KHR_materials_clearcoat",function(a){return new ob(a)});var pb=function(){function a(b){this.name="KHR_materials_sheen";this.order=190;this._loader=b;this.enabled=this._loader.isExtensionUsed("KHR_materials_sheen")}a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=
function(b,a,d){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(e,g){var f=[];f.push(c._loader.loadMaterialPropertiesAsync(b,a,d));f.push(c._loadSheenPropertiesAsync(e,g,d));return Promise.all(f).then(function(){})})};a.prototype._loadSheenPropertiesAsync=function(b,a,d){if(!(d instanceof G.a))throw Error(b+": Material type not supported");var c=[];d.sheen.isEnabled=!0;d.sheen.intensity=1;d.sheen.color=void 0!=a.sheenColorFactor?C.a.FromArray(a.sheenColorFactor):C.a.Black();a.sheenColorTexture&&
c.push(this._loader.loadTextureInfoAsync(b+"/sheenColorTexture",a.sheenColorTexture,function(b){b.name=d.name+" (Sheen Color)";d.sheen.texture=b}));d.sheen.roughness=void 0!==a.sheenRoughnessFactor?a.sheenRoughnessFactor:0;a.sheenRoughnessTexture&&(a.sheenRoughnessTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(b+"/sheenRoughnessTexture",a.sheenRoughnessTexture,function(b){b.name=d.name+" (Sheen Roughness)";d.sheen.textureRoughness=b})));d.sheen.albedoScaling=!0;d.sheen.useRoughnessFromMainTexture=
!1;return Promise.all(c).then(function(){})};return a}();t.RegisterExtension("KHR_materials_sheen",function(a){return new pb(a)});var qb=function(){function a(b){this.name="KHR_materials_specular";this.order=190;this._loader=b;this.enabled=this._loader.isExtensionUsed("KHR_materials_specular")}a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=function(b,a,d){var c=this;return t.LoadExtensionAsync(b,a,this.name,function(e,g){var f=[];f.push(c._loader.loadMaterialPropertiesAsync(b,
a,d));f.push(c._loadSpecularPropertiesAsync(e,g,d));return Promise.all(f).then(function(){})})};a.prototype._loadSpecularPropertiesAsync=function(b,a,d){if(!(d instanceof G.a))throw Error(b+": Material type not supported");var c=[];void 0!==a.specularFactor&&(d.metallicF0Factor=a.specularFactor);void 0!==a.specularColorFactor&&(d.metallicReflectanceColor=C.a.FromArray(a.specularColorFactor));a.specularTexture&&(a.specularTexture.nonColorData=!0,c.push(this._loader.loadTextureInfoAsync(b+"/specularTexture",
a.specularTexture,function(b){b.name=d.name+" (Specular F0 Color)";d.metallicReflectanceTexture=b})));return Promise.all(c).then(function(){})};return a}();t.RegisterExtension("KHR_materials_specular",function(a){return new qb(a)});var rb=function(){function a(b){this.name="KHR_materials_ior";this.order=180;this._loader=b;this.enabled=this._loader.isExtensionUsed("KHR_materials_ior")}a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=function(b,a,d){var c=this;
return t.LoadExtensionAsync(b,a,this.name,function(e,g){var f=[];f.push(c._loader.loadMaterialPropertiesAsync(b,a,d));f.push(c._loadIorPropertiesAsync(e,g,d));return Promise.all(f).then(function(){})})};a.prototype._loadIorPropertiesAsync=function(b,c,d){if(!(d instanceof G.a))throw Error(b+": Material type not supported");d.indexOfRefraction=void 0!==c.ior?c.ior:a._DEFAULT_IOR;return Promise.resolve()};a._DEFAULT_IOR=1.5;return a}();t.RegisterExtension("KHR_materials_ior",function(a){return new rb(a)});
var sb=function(){function a(b){this.name="KHR_materials_variants";this._loader=b;this.enabled=this._loader.isExtensionUsed("KHR_materials_variants")}a.prototype.dispose=function(){this._loader=null};a.GetAvailableVariants=function(b){return(b=this._GetExtensionMetadata(b))?Object.keys(b.variants):[]};a.prototype.getAvailableVariants=function(b){return a.GetAvailableVariants(b)};a.SelectVariant=function(b,a){var c=this._GetExtensionMetadata(b);if(!c)throw Error("Cannot select variant on a glTF mesh that does not have the KHR_materials_variants extension");
b=function(b){if(b=c.variants[b])for(var a=0;a<b.length;a++){var d=b[a];d.mesh.material=d.material}};if(a instanceof Array)for(var e=0;e<a.length;e++)b(a[e]);else b(a);c.lastSelected=a};a.prototype.selectVariant=function(b,c){return a.SelectVariant(b,c)};a.Reset=function(b){b=this._GetExtensionMetadata(b);if(!b)throw Error("Cannot reset on a glTF mesh that does not have the KHR_materials_variants extension");for(var a=0,d=b.original;a<d.length;a++){var e=d[a];e.mesh.material=e.material}b.lastSelected=
null};a.prototype.reset=function(b){return a.Reset(b)};a.GetLastSelectedVariant=function(b){b=this._GetExtensionMetadata(b);if(!b)throw Error("Cannot get the last selected variant on a glTF mesh that does not have the KHR_materials_variants extension");return b.lastSelected};a.prototype.getLastSelectedVariant=function(b){return a.GetLastSelectedVariant(b)};a._GetExtensionMetadata=function(b){var a,d;return(null===(d=null===(a=null===b||void 0===b?void 0:b.metadata)||void 0===a?void 0:a.gltf)||void 0===
d?void 0:d.KHR_materials_variants)||null};a.prototype.onLoading=function(){var a=this._loader.gltf.extensions;a&&a[this.name]&&(this._variants=a[this.name].variants)};a.prototype._loadMeshPrimitiveAsync=function(a,c,d,e,f,g){var b=this;return t.LoadExtensionAsync(a,f,this.name,function(h,m){var k=[];k.push(b._loader._loadMeshPrimitiveAsync(a,c,d,e,f,function(c){g(c);if(c instanceof Q.a){var d=t._GetDrawMode(a,f.mode),e=b._loader.rootBabylonMesh;e=e.metadata=e.metadata||{};e=e.gltf=e.gltf||{};e=e.KHR_materials_variants=
e.KHR_materials_variants||{lastSelected:null,original:[],variants:{}};e.original.push({mesh:c,material:c.material});var l=e.variants;e=0;for(var q=m.mappings;e<q.length;e++)for(var p=q[e],r=function(a){var e=n.Get(h+"/mapping/"+a,b._variants,a);a=n.Get("#/materials/",b._loader.gltf.materials,p.material);k.push(b._loader._loadMaterialAsync("#/materials/"+p.material,a,c,d,function(a){l[e.name]=l[e.name]||[];l[e.name].push({mesh:c,material:a})}))},u=0,v=p.variants;u<v.length;u++)r(v[u])}}));return Promise.all(k).then(function(a){return a[0]})})};
return a}();t.RegisterExtension("KHR_materials_variants",function(a){return new sb(a)});var tb=h("srWW"),ub=function(){function a(b,c){var d=this;this._opaqueRenderTarget=null;this._opaqueMeshesCache=[];this._transparentMeshesCache=[];this._options=Object(Z.a)(Object(Z.a)({},a._getDefaultOptions()),b);this._scene=c;this._scene._transmissionHelper=this;this.onErrorObservable=new F.a;this._scene.onDisposeObservable.addOnce(function(a){d.dispose()});this._parseScene();this._setupRenderTargets()}a._getDefaultOptions=
function(){return{renderSize:512}};a.prototype.updateOptions=function(a){var b=this;if(Object.keys(a).filter(function(c){return b._options[c]!==a[c]}).length){var d=Object(Z.a)(Object(Z.a)({},this._options),a),e=this._options;this._options=d;d.renderSize!==e.renderSize&&this._setupRenderTargets()}};a.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget};a.prototype.shouldRenderAsTransmission=function(a){return a?a instanceof G.a&&a.subSurface.isRefractionEnabled?!0:!1:!1};a.prototype._addMesh=
function(a){a instanceof Q.a&&(a.onMaterialChangedObservable.add(this.onMeshMaterialChanged.bind(this)),this.shouldRenderAsTransmission(a.material)?this._transparentMeshesCache.push(a):this._opaqueMeshesCache.push(a))};a.prototype._removeMesh=function(a){if(a instanceof Q.a){a.onMaterialChangedObservable.remove(this.onMeshMaterialChanged.bind(this));var b=this._transparentMeshesCache.indexOf(a);-1!==b&&this._transparentMeshesCache.splice(b,1);b=this._opaqueMeshesCache.indexOf(a);-1!==b&&this._opaqueMeshesCache.splice(b,
1)}};a.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this));this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this));this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))};a.prototype.onMeshMaterialChanged=function(a){if(a instanceof Q.a){var b=this._transparentMeshesCache.indexOf(a),d=this._opaqueMeshesCache.indexOf(a);this.shouldRenderAsTransmission(a.material)?(a.material instanceof G.a&&(a.material.subSurface.refractionTexture=this._opaqueRenderTarget),
-1!==d?(this._opaqueMeshesCache.splice(d,1),this._transparentMeshesCache.push(a)):-1===b&&this._transparentMeshesCache.push(a)):-1!==b?(this._transparentMeshesCache.splice(b,1),this._opaqueMeshesCache.push(a)):-1===d&&this._opaqueMeshesCache.push(a)}};a.prototype._setupRenderTargets=function(){var a=this,c=-1;if(this._scene.layers&&this._opaqueRenderTarget)for(var d=0,e=this._scene.layers;d<e.length;d++){var f=e[d],g=f.renderTargetTextures.indexOf(this._opaqueRenderTarget);0<=g&&f.renderTargetTextures.splice(g,
1)}this._opaqueRenderTarget&&(c=this._scene.customRenderTargets.indexOf(this._opaqueRenderTarget),this._opaqueRenderTarget.dispose());this._opaqueRenderTarget=new tb.a("opaqueSceneTexture",this._options.renderSize,this._scene,!0);this._opaqueRenderTarget.renderList=this._opaqueMeshesCache;this._opaqueRenderTarget.gammaSpace=!0;this._opaqueRenderTarget.lodGenerationScale=1;this._opaqueRenderTarget.lodGenerationOffset=-4;0<=c?this._scene.customRenderTargets.splice(c,0,this._opaqueRenderTarget):(c=this._scene.customRenderTargets.length,
this._scene.customRenderTargets.push(this._opaqueRenderTarget));if(this._scene.layers&&this._opaqueRenderTarget)for(c=0,d=this._scene.layers;c<d.length;c++)f=d[c],f.renderTargetTextures.push(this._opaqueRenderTarget);this._transparentMeshesCache.forEach(function(b){a.shouldRenderAsTransmission(b.material)&&b.material instanceof G.a&&(b.material.refractionTexture=a._opaqueRenderTarget)})};a.prototype.dispose=function(){this._scene._transmissionHelper=void 0;this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),
this._opaqueRenderTarget=null);this._transparentMeshesCache=[];this._opaqueMeshesCache=[]};return a}(),vb=function(){function a(a){this.name="KHR_materials_transmission";this.order=175;this._loader=a;if(this.enabled=this._loader.isExtensionUsed("KHR_materials_transmission"))a.parent.transparencyAsCoverage=!0}a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=function(a,c,d){var b=this;return t.LoadExtensionAsync(a,c,this.name,function(e,g){var f=[];f.push(b._loader.loadMaterialBasePropertiesAsync(a,
c,d));f.push(b._loader.loadMaterialPropertiesAsync(a,c,d));f.push(b._loadTransparentPropertiesAsync(e,c,d,g));return Promise.all(f).then(function(){})})};a.prototype._loadTransparentPropertiesAsync=function(a,c,d,e){if(!(d instanceof G.a))throw Error(a+": Material type not supported");d.subSurface.isRefractionEnabled=!0;d.subSurface.volumeIndexOfRefraction=1;d.subSurface.useAlbedoToTintRefraction=!0;if(void 0!==e.transmissionFactor)d.subSurface.refractionIntensity=e.transmissionFactor,c=d.getScene(),
d.subSurface.refractionIntensity&&!c._transmissionHelper&&new ub({},d.getScene());else return d.subSurface.refractionIntensity=0,d.subSurface.isRefractionEnabled=!1,Promise.resolve();return e.transmissionTexture?(e.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(a+"/transmissionTexture",e.transmissionTexture,void 0).then(function(a){d.subSurface.thicknessTexture=a;d.subSurface.useMaskFromThicknessTextureGltf=!0})):Promise.resolve()};return a}();t.RegisterExtension("KHR_materials_transmission",
function(a){return new vb(a)});var wb=function(){function a(a){this.name="KHR_materials_translucency";this.order=175;this._loader=a;if(this.enabled=this._loader.isExtensionUsed("KHR_materials_translucency"))a.parent.transparencyAsCoverage=!0}a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=function(a,c,d){var b=this;return t.LoadExtensionAsync(a,c,this.name,function(e,g){var f=[];f.push(b._loader.loadMaterialBasePropertiesAsync(a,c,d));f.push(b._loader.loadMaterialPropertiesAsync(a,
c,d));f.push(b._loadTranslucentPropertiesAsync(e,c,d,g));return Promise.all(f).then(function(){})})};a.prototype._loadTranslucentPropertiesAsync=function(a,c,d,e){if(!(d instanceof G.a))throw Error(a+": Material type not supported");d.subSurface.isTranslucencyEnabled=!0;d.subSurface.volumeIndexOfRefraction=1;d.subSurface.minimumThickness=0;d.subSurface.maximumThickness=0;d.subSurface.useAlbedoToTintRefraction=!0;if(void 0!==e.translucencyFactor)d.subSurface.translucencyIntensity=e.translucencyFactor;
else return d.subSurface.translucencyIntensity=0,d.subSurface.isTranslucencyEnabled=!1,Promise.resolve();return e.translucencyTexture?this._loader.loadTextureInfoAsync(a+"/translucencyTexture",e.translucencyTexture).then(function(a){d.subSurface.thicknessTexture=a;d.subSurface.useMaskFromThicknessTextureGltf=!0}):Promise.resolve()};return a}();t.RegisterExtension("KHR_materials_translucency",function(a){return new wb(a)});var xb=function(){function a(a){this.name="KHR_mesh_quantization";this.enabled=
a.isExtensionUsed("KHR_mesh_quantization")}a.prototype.dispose=function(){};return a}();t.RegisterExtension("KHR_mesh_quantization",function(a){return new xb(a)});var yb=function(){function a(a){this.name="KHR_texture_basisu";this._loader=a;this.enabled=a.isExtensionUsed("KHR_texture_basisu")}a.prototype.dispose=function(){this._loader=null};a.prototype._loadTextureAsync=function(a,c,d){var b=this;return t.LoadExtensionAsync(a,c,this.name,function(e,g){var f=void 0==c.sampler?t.DefaultSampler:n.Get(a+
"/sampler",b._loader.gltf.samplers,c.sampler);e=n.Get(e+"/source",b._loader.gltf.images,g.source);return b._loader._createTextureAsync(a,f,e,function(a){d(a)},c._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0)})};return a}();t.RegisterExtension("KHR_texture_basisu",function(a){return new yb(a)});var zb=function(){function a(a){this.name="KHR_texture_transform";this._loader=a;this.enabled=this._loader.isExtensionUsed("KHR_texture_transform")}a.prototype.dispose=function(){this._loader=
null};a.prototype.loadTextureInfoAsync=function(a,c,d){var b=this;return t.LoadExtensionAsync(a,c,this.name,function(e,g){return b._loader.loadTextureInfoAsync(a,c,function(a){if(!(a instanceof D.a))throw Error(e+": Texture type not supported");g.offset&&(a.uOffset=g.offset[0],a.vOffset=g.offset[1]);a.uRotationCenter=0;a.vRotationCenter=0;g.rotation&&(a.wAng=-g.rotation);g.scale&&(a.uScale=g.scale[0],a.vScale=g.scale[1]);void 0!=g.texCoord&&(a.coordinatesIndex=g.texCoord);d(a)})})};return a}();t.RegisterExtension("KHR_texture_transform",
function(a){return new zb(a)});var Ab=h("CkZi"),Bb=h("K0AZ"),Cb=h("DP2o"),Db=function(){function a(a){this.name="MSFT_audio_emitter";this._loader=a;this.enabled=this._loader.isExtensionUsed("MSFT_audio_emitter")}a.prototype.dispose=function(){this._emitters=this._clips=this._loader=null};a.prototype.onLoading=function(){var a=this._loader.gltf.extensions;a&&a[this.name]&&(a=a[this.name],this._clips=a.clips,this._emitters=a.emitters,n.Assign(this._clips),n.Assign(this._emitters))};a.prototype.loadSceneAsync=
function(a,c){var b=this;return t.LoadExtensionAsync(a,c,this.name,function(d,f){var e=[];e.push(b._loader.loadSceneAsync(a,c));var h=0;for(f=f.emitters;h<f.length;h++){var k=n.Get(d+"/emitters",b._emitters,f[h]);if(void 0!=k.refDistance||void 0!=k.maxDistance||void 0!=k.rolloffFactor||void 0!=k.distanceModel||void 0!=k.innerAngle||void 0!=k.outerAngle)throw Error(d+": Direction or Distance properties are not allowed on emitters attached to a scene");e.push(b._loadEmitterAsync(d+"/emitters/"+k.index,
k))}return Promise.all(e).then(function(){})})};a.prototype.loadNodeAsync=function(a,c,d){var b=this;return t.LoadExtensionAsync(a,c,this.name,function(a,e){var f=[];return b._loader.loadNodeAsync(a,c,function(c){for(var g=function(d){var e=n.Get(a+"/emitters",b._emitters,d);f.push(b._loadEmitterAsync(a+"/emitters/"+e.index,e).then(function(){for(var a=0,b=e._babylonSounds;a<b.length;a++){var d=b[a];d.attachToMesh(c);if(void 0!=e.innerAngle||void 0!=e.outerAngle)d.setLocalDirectionToMesh(r.e.Forward()),
d.setDirectionalCone(2*p.b.ToDegrees(void 0==e.innerAngle?Math.PI:e.innerAngle),2*p.b.ToDegrees(void 0==e.outerAngle?Math.PI:e.outerAngle),0)}}))},h=0,k=e.emitters;h<k.length;h++)g(k[h]);d(c)}).then(function(a){return Promise.all(f).then(function(){return a})})})};a.prototype.loadAnimationAsync=function(a,c){var b=this;return t.LoadExtensionAsync(a,c,this.name,function(d,f){return b._loader.loadAnimationAsync(a,c).then(function(e){var g=[];n.Assign(f.events);for(var h=0,l=f.events;h<l.length;h++){var p=
l[h];g.push(b._loadAnimationEventAsync(d+"/events/"+p.index,a,c,p,e))}return Promise.all(g).then(function(){return e})})})};a.prototype._loadClipAsync=function(a,c){if(c._objectURL)return c._objectURL;c.uri?a=this._loader.loadUriAsync(a,c,c.uri):(a=n.Get(a+"/bufferView",this._loader.gltf.bufferViews,c.bufferView),a=this._loader.loadBufferViewAsync("/bufferViews/"+a.index,a));c._objectURL=a.then(function(a){return URL.createObjectURL(new Blob([a],{type:c.mimeType}))});return c._objectURL};a.prototype._loadEmitterAsync=
function(a,c){var b=this;c._babylonSounds=c._babylonSounds||[];if(!c._babylonData){var e=[],f=c.name||"emitter"+c.index,g={loop:!1,autoplay:!1,volume:void 0==c.volume?1:c.volume};a=function(a){var d="/extensions/"+h.name+"/clips",k=n.Get(d,h._clips,c.clips[a].clip);e.push(h._loadClipAsync(d+"/"+c.clips[a].clip,k).then(function(d){d=c._babylonSounds[a]=new Bb.a(f,d,b._loader.babylonScene,null,g);d.refDistance=c.refDistance||1;d.maxDistance=c.maxDistance||256;d.rolloffFactor=c.rolloffFactor||1;d.distanceModel=
c.distanceModel||"exponential";d._positionInEmitterSpace=!0}))};for(var h=this,k=0;k<c.clips.length;k++)a(k);a=Promise.all(e).then(function(){var a=c.clips.map(function(a){return a.weight||1});a=new Cb.a(c.loop||!1,c._babylonSounds,a);c.innerAngle&&(a.directionalConeInnerAngle=2*p.b.ToDegrees(c.innerAngle));c.outerAngle&&(a.directionalConeOuterAngle=2*p.b.ToDegrees(c.outerAngle));c.volume&&(a.volume=c.volume);c._babylonData.sound=a});c._babylonData={loaded:a}}return c._babylonData.loaded};a.prototype._getEventAction=
function(a,c,d,e,f){switch(d){case "play":return function(a){c.play((f||0)+(a-e))};case "stop":return function(a){c.stop()};case "pause":return function(a){c.pause()};default:throw Error(a+": Unsupported action "+d);}};a.prototype._loadAnimationEventAsync=function(a,c,d,e,f){var b=this;if(0==f.targetedAnimations.length)return Promise.resolve();var h=f.targetedAnimations[0],k=n.Get("/extensions/"+this.name+"/emitters",this._emitters,e.emitter);return this._loadEmitterAsync(a,k).then(function(){var c=
k._babylonData.sound;if(c){var d=new Ab.a(e.time,b._getEventAction(a,c,e.action,e.time,e.startOffset));h.animation.addEvent(d);f.onAnimationGroupEndObservable.add(function(){c.stop()});f.onAnimationGroupPauseObservable.add(function(){c.pause()})}})};return a}();t.RegisterExtension("MSFT_audio_emitter",function(a){return new Db(a)});var Eb=function(){function a(a){this.name="MSFT_lod";this.order=100;this.maxLODsToLoad=10;this.onNodeLODsLoadedObservable=new F.a;this.onMaterialLODsLoadedObservable=new F.a;
this._bufferLODs=[];this._nodeIndexLOD=null;this._nodeSignalLODs=[];this._nodePromiseLODs=[];this._nodeBufferLODs=[];this._materialIndexLOD=null;this._materialSignalLODs=[];this._materialPromiseLODs=[];this._materialBufferLODs=[];this._loader=a;this.enabled=this._loader.isExtensionUsed("MSFT_lod")}a.prototype.dispose=function(){this._nodeIndexLOD=this._loader=null;this._nodeSignalLODs.length=0;this._nodePromiseLODs.length=0;this._nodeBufferLODs.length=0;this._materialIndexLOD=null;this._materialSignalLODs.length=
0;this._materialPromiseLODs.length=0;this._materialBufferLODs.length=0;this.onMaterialLODsLoadedObservable.clear();this.onNodeLODsLoadedObservable.clear()};a.prototype.onReady=function(){for(var a=this,c=function(b){var c=Promise.all(d._nodePromiseLODs[b]).then(function(){0!==b&&(a._loader.endPerformanceCounter("Node LOD "+b),a._loader.log("Loaded node LOD "+b));a.onNodeLODsLoadedObservable.notifyObservers(b);b!==a._nodePromiseLODs.length-1&&(a._loader.startPerformanceCounter("Node LOD "+(b+1)),a._loadBufferLOD(a._nodeBufferLODs,
b+1),a._nodeSignalLODs[b]&&a._nodeSignalLODs[b].resolve())});d._loader._completePromises.push(c)},d=this,e=0;e<this._nodePromiseLODs.length;e++)c(e);c=function(b){var c=Promise.all(f._materialPromiseLODs[b]).then(function(){0!==b&&(a._loader.endPerformanceCounter("Material LOD "+b),a._loader.log("Loaded material LOD "+b));a.onMaterialLODsLoadedObservable.notifyObservers(b);b!==a._materialPromiseLODs.length-1&&(a._loader.startPerformanceCounter("Material LOD "+(b+1)),a._loadBufferLOD(a._materialBufferLODs,
b+1),a._materialSignalLODs[b]&&a._materialSignalLODs[b].resolve())});f._loader._completePromises.push(c)};var f=this;for(e=0;e<this._materialPromiseLODs.length;e++)c(e)};a.prototype.loadSceneAsync=function(a,c){a=this._loader.loadSceneAsync(a,c);this._loadBufferLOD(this._bufferLODs,0);return a};a.prototype.loadNodeAsync=function(a,c,d){var b=this;return t.LoadExtensionAsync(a,c,this.name,function(a,d){var e,f=b._getLODs(a,c,b._loader.gltf.nodes,d.ids);b._loader.logOpen(""+a);a=function(a){var c=f[a];
0!==a&&(b._nodeIndexLOD=a,b._nodeSignalLODs[a]=b._nodeSignalLODs[a]||new ia.a);c=b._loader.loadNodeAsync("/nodes/"+c.index,c,function(a){a.setEnabled(!1)}).then(function(c){if(0!==a){var d=f[a-1];d._babylonTransformNode&&(b._disposeTransformNode(d._babylonTransformNode),delete d._babylonTransformNode)}c.setEnabled(!0);return c});b._nodePromiseLODs[a]=b._nodePromiseLODs[a]||[];0===a?e=c:(b._nodeIndexLOD=null,b._nodePromiseLODs[a].push(c))};for(d=0;d<f.length;d++)a(d);b._loader.logClose();return e})};
a.prototype._loadMaterialAsync=function(a,c,d,e,f){var b=this;return this._nodeIndexLOD?null:t.LoadExtensionAsync(a,c,this.name,function(a,g){var h,k=b._getLODs(a,c,b._loader.gltf.materials,g.ids);b._loader.logOpen(""+a);a=function(a){var c=k[a];0!==a&&(b._materialIndexLOD=a);c=b._loader._loadMaterialAsync("/materials/"+c.index,c,d,e,function(b){0===a&&f(b)}).then(function(c){if(0!==a){f(c);var d=k[a-1]._data;d[e]&&(b._disposeMaterials([d[e].babylonMaterial]),delete d[e])}return c});b._materialPromiseLODs[a]=
b._materialPromiseLODs[a]||[];0===a?h=c:(b._materialIndexLOD=null,b._materialPromiseLODs[a].push(c))};for(g=0;g<k.length;g++)a(g);b._loader.logClose();return h})};a.prototype._loadUriAsync=function(a,c,d){var b=this;if(null!==this._nodeIndexLOD){this._loader.log("deferred");var f=this._nodeIndexLOD-1;this._nodeSignalLODs[f]=this._nodeSignalLODs[f]||new ia.a;return this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return b._loader.loadUriAsync(a,c,d)})}return null!==this._materialIndexLOD?
(this._loader.log("deferred"),f=this._materialIndexLOD-1,this._materialSignalLODs[f]=this._materialSignalLODs[f]||new ia.a,this._materialSignalLODs[f].promise.then(function(){return b._loader.loadUriAsync(a,c,d)})):null};a.prototype.loadBufferAsync=function(a,c,d,e){if(this._loader.parent.useRangeRequests&&!c.uri){if(!this._loader.bin)throw Error(a+": Uri is missing or the binary glTF is missing its binary chunk");a=function(a,b){var c=d+e-1,f=a[b];f?(f.start=Math.min(f.start,d),f.end=Math.max(f.end,
c)):(f={start:d,end:c,loaded:new ia.a},a[b]=f);return f.loaded.promise.then(function(a){return new Uint8Array(a.buffer,a.byteOffset+d-f.start,e)})};this._loader.log("deferred");return null!==this._nodeIndexLOD?a(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?a(this._materialBufferLODs,this._materialIndexLOD):a(this._bufferLODs,0)}return null};a.prototype._loadBufferLOD=function(a,c){var b=a[c];b&&(this._loader.log("Loading buffer range ["+b.start+"-"+b.end+"]"),this._loader.bin.readAsync(b.start,
b.end-b.start+1).then(function(a){b.loaded.resolve(a)},function(a){b.loaded.reject(a)}))};a.prototype._getLODs=function(a,c,d,e){if(0>=this.maxLODsToLoad)throw Error("maxLODsToLoad must be greater than zero");for(var b=[],g=e.length-1;0<=g;g--)if(b.push(n.Get(a+"/ids/"+e[g],d,e[g])),b.length===this.maxLODsToLoad)return b;b.push(c);return b};a.prototype._disposeTransformNode=function(a){var b=this,d=[],e=a.material;e&&d.push(e);e=0;for(var f=a.getChildMeshes();e<f.length;e++){var g=f[e];g.material&&
d.push(g.material)}a.dispose();a=d.filter(function(a){return b._loader.babylonScene.meshes.every(function(b){return b.material!=a})});this._disposeMaterials(a)};a.prototype._disposeMaterials=function(a){for(var b={},d=0;d<a.length;d++){for(var e=a[d],f=0,g=e.getActiveTextures();f<g.length;f++){var h=g[f];b[h.uniqueId]=h}e.dispose()}for(var k in b)for(a=0,d=this._loader.babylonScene.materials;a<d.length;a++)e=d[a],e.hasTexture(b[k])&&delete b[k];for(k in b)b[k].dispose()};return a}();t.RegisterExtension("MSFT_lod",
function(a){return new Eb(a)});var Fb=function(){function a(a){this.name="MSFT_minecraftMesh";this._loader=a;this.enabled=this._loader.isExtensionUsed("MSFT_minecraftMesh")}a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=function(a,c,d){var b=this;return t.LoadExtraAsync(a,c,this.name,function(e,g){if(g){if(!(d instanceof G.a))throw Error(e+": Material type not supported");e=b._loader.loadMaterialPropertiesAsync(a,c,d);d.needAlphaBlending()&&(d.forceDepthWrite=
!0,d.separateCullingPass=!0);d.backFaceCulling=d.forceDepthWrite;d.twoSidedLighting=!0;return e}return null})};return a}();t.RegisterExtension("MSFT_minecraftMesh",function(a){return new Fb(a)});var Gb=function(){function a(a){this.name="MSFT_sRGBFactors";this._loader=a;this.enabled=this._loader.isExtensionUsed("MSFT_sRGBFactors")}a.prototype.dispose=function(){this._loader=null};a.prototype.loadMaterialPropertiesAsync=function(a,c,d){var b=this;return t.LoadExtraAsync(a,c,this.name,function(e,g){if(g){if(!(d instanceof
G.a))throw Error(e+": Material type not supported");e=b._loader.loadMaterialPropertiesAsync(a,c,d);d.albedoTexture||d.albedoColor.toLinearSpaceToRef(d.albedoColor);d.reflectivityTexture||d.reflectivityColor.toLinearSpaceToRef(d.reflectivityColor);return e}return null})};return a}();t.RegisterExtension("MSFT_sRGBFactors",function(a){return new Gb(a)});var Hb=function(){function a(a){this.name="ExtrasAsMetadata";this.enabled=!0;this._loader=a}a.prototype._assignExtras=function(a,c){c.extras&&0<Object.keys(c.extras).length&&
(a=a.metadata=a.metadata||{},(a.gltf=a.gltf||{}).extras=c.extras)};a.prototype.dispose=function(){this._loader=null};a.prototype.loadNodeAsync=function(a,c,d){var b=this;return this._loader.loadNodeAsync(a,c,function(a){b._assignExtras(a,c);d(a)})};a.prototype.loadCameraAsync=function(a,c,d){var b=this;return this._loader.loadCameraAsync(a,c,function(a){b._assignExtras(a,c);d(a)})};a.prototype.createMaterial=function(a,c,d){a=this._loader.createMaterial(a,c,d);this._assignExtras(a,c);return a};return a}();
t.RegisterExtension("ExtrasAsMetadata",function(a){return new Hb(a)})}}]);
