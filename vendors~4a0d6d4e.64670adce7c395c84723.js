(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{C1Wc:function(B,F,d){d.d(F,"a",function(){return w});var y=d("y4Ty"),g=d("1m8g"),m=d("T5H4"),f=d("lJNW"),w=function(){function p(f,a,b,e,c,l,v,k,r){void 0===k&&(k=!0);void 0===r&&(r=!0);this.materialIndex=f;this.verticesStart=a;this.verticesCount=b;this.indexStart=e;this.indexCount=c;this._effectOverride=this._materialEffect=this._materialDefines=null;this._linesIndexCount=0;this._lastColliderTransformMatrix=this._lastColliderWorldVertices=
this._linesIndexBuffer=null;this._distanceToCamera=this._alphaIndex=this._renderId=0;this._currentMaterial=null;this._mesh=l;this._renderingMesh=v||l;r&&l.subMeshes.push(this);this._trianglePlanes=[];this._id=l.subMeshes.length-1;k&&(this.refreshBoundingInfo(),l.computeWorldMatrix(!0))}Object.defineProperty(p.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(f){this._materialDefines=f},enumerable:!1,configurable:!0});Object.defineProperty(p.prototype,"effect",
{get:function(){var f;return null!==(f=this._effectOverride)&&void 0!==f?f:this._materialEffect},enumerable:!1,configurable:!0});p.prototype.setEffect=function(f,a){void 0===a&&(a=null);this._materialEffect===f?f||(this._materialDefines=null):(this._materialDefines=a,this._materialEffect=f)};p.AddToMesh=function(f,a,b,e,c,l,v,k){void 0===k&&(k=!0);return new p(f,a,b,e,c,l,v,k)};Object.defineProperty(p.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},
enumerable:!1,configurable:!0});p.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo};p.prototype.setBoundingInfo=function(f){this._boundingInfo=f;return this};p.prototype.getMesh=function(){return this._mesh};p.prototype.getRenderingMesh=function(){return this._renderingMesh};p.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null};p.prototype.getEffectiveMesh=function(){var f=
this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return f?f:this._renderingMesh};p.prototype.getMaterial=function(){var f=this._renderingMesh.material;if(null===f||void 0===f)return this._mesh.getScene().defaultMaterial;this._IsMultiMaterial(f)&&(f=f.getSubMaterial(this.materialIndex),this._currentMaterial!==f&&(this._currentMaterial=f,this._materialDefines=null));return f};p.prototype._IsMultiMaterial=function(f){return void 0!==f.getSubMaterial};p.prototype.refreshBoundingInfo=
function(g){void 0===g&&(g=null);this._lastColliderWorldVertices=null;if(this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;g||(g=this._renderingMesh.getVerticesData(y.b.PositionKind));if(!g)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var a=this._renderingMesh.getIndices();0===this.indexStart&&this.indexCount===a.length?(g=this._renderingMesh.getBoundingInfo(),g={minimum:g.minimum.clone(),maximum:g.maximum.clone()}):g=Object(f.b)(g,a,this.indexStart,this.indexCount,
this._renderingMesh.geometry.boundingBias);this._boundingInfo?this._boundingInfo.reConstruct(g.minimum,g.maximum):this._boundingInfo=new m.a(g.minimum,g.maximum);return this};p.prototype._checkCollision=function(f){return this.getBoundingInfo()._checkCollision(f)};p.prototype.updateBoundingInfo=function(f){var a=this.getBoundingInfo();a||(this.refreshBoundingInfo(),a=this.getBoundingInfo());a&&a.update(f);return this};p.prototype.isInFrustum=function(f){var a=this.getBoundingInfo();return a?a.isInFrustum(f,
this._mesh.cullingStrategy):!1};p.prototype.isCompletelyInFrustum=function(f){var a=this.getBoundingInfo();return a?a.isCompletelyInFrustum(f):!1};p.prototype.render=function(f){this._renderingMesh.render(this,f,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0);return this};p.prototype._getLinesIndexBuffer=function(f,a){if(!this._linesIndexBuffer){for(var b=[],e=this.indexStart;e<this.indexStart+this.indexCount;e+=3)b.push(f[e],f[e+1],f[e+1],f[e+2],f[e+2],f[e]);this._linesIndexBuffer=
a.createIndexBuffer(b);this._linesIndexCount=b.length}return this._linesIndexBuffer};p.prototype.canIntersects=function(f){var a=this.getBoundingInfo();return a?f.intersectsBox(a.boundingBox):!1};p.prototype.intersects=function(f,a,b,e,c){var l=this.getMaterial();if(!l)return null;var v=3,k=!1;switch(l.fillMode){case 3:case 4:case 5:case 6:case 8:return null;case 7:v=1,k=!0}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?b.length?this._intersectLines(f,
a,b,this._mesh.intersectionThreshold,e):this._intersectUnIndexedLines(f,a,b,this._mesh.intersectionThreshold,e):!b.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(f,a,b,e,c):this._intersectTriangles(f,a,b,v,k,e,c)};p.prototype._intersectLines=function(f,a,b,e,c){for(var l=null,v=this.indexStart;v<this.indexStart+this.indexCount;v+=2){var k=f.intersectionSegment(a[b[v]],a[b[v+1]],e);if(!(0>k)&&(c||!l||k<l.distance)&&(l=new g.a(null,null,k),l.faceId=v/2,c))break}return l};p.prototype._intersectUnIndexedLines=
function(f,a,b,e,c){b=null;for(var l=this.verticesStart;l<this.verticesStart+this.verticesCount;l+=2){var v=f.intersectionSegment(a[l],a[l+1],e);if(!(0>v)&&(c||!b||v<b.distance)&&(b=new g.a(null,null,v),b.faceId=l/2,c))break}return b};p.prototype._intersectTriangles=function(f,a,b,e,c,l,v){for(var k=null,r=-1,q=this.indexStart;q<this.indexStart+this.indexCount;q+=e){r++;var g=b[q],x=b[q+1],m=b[q+2];if(c&&4294967295===m)q+=2;else if(g=a[g],x=a[x],m=a[m],!(v&&!v(g,x,m,f)||!(m=f.intersectsTriangle(g,
x,m))||0>m.distance)&&(l||!k||m.distance<k.distance)&&(k=m,k.faceId=r,l))break}return k};p.prototype._intersectUnIndexedTriangles=function(f,a,b,e,c){b=null;for(var l=this.verticesStart;l<this.verticesStart+this.verticesCount;l+=3){var v=a[l],k=a[l+1],r=a[l+2];if(!(c&&!c(v,k,r,f)||!(v=f.intersectsTriangle(v,k,r))||0>v.distance)&&(e||!b||v.distance<b.distance)&&(b=v,b.faceId=l/3,e))break}return b};p.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)};p.prototype.clone=
function(f,a){f=new p(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,f,a,!1);if(!this.IsGlobal){a=this.getBoundingInfo();if(!a)return f;f._boundingInfo=new m.a(a.minimum,a.maximum)}return f};p.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var f=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(f,1)};p.prototype.getClassName=function(){return"SubMesh"};
p.CreateFromIndices=function(f,a,b,e,c){for(var l=Number.MAX_VALUE,v=-Number.MAX_VALUE,k=(c||e).getIndices(),r=a;r<a+b;r++){var q=k[r];q<l&&(l=q);q>v&&(v=q)}return new p(f,l,v-l+1,a,b,e,c)};return p}()},CFrw:function(B,F,d){d.d(F,"b",function(){return J});d.d(F,"a",function(){return a});var y=d("oYeq"),g=d("Xeau"),m=d("y4Ty");B=d("wAMR");F=d("acOv");var f=d("cdI9"),w=d("NDL1"),p=d("/eyM");d("go3B");d("c403");var J=function(b){function e(a,e,f,k,r,q,C){void 0===e&&(e=null);void 0===f&&(f=null);void 0===
k&&(k=null);a=b.call(this,a,e,f,k,r)||this;a.useVertexColor=q;a.useVertexAlpha=C;a.color=new g.a(1,1,1);a.alpha=1;k&&(a.color=k.color.clone(),a.alpha=k.alpha,a.useVertexColor=k.useVertexColor,a.useVertexAlpha=k.useVertexAlpha);a.intersectionThreshold=.1;k={attributes:[m.b.PositionKind,"world0","world1","world2","world3"],uniforms:"vClipPlane vClipPlane2 vClipPlane3 vClipPlane4 vClipPlane5 vClipPlane6 world viewProjection".split(" "),needAlphaBlending:!0,defines:[]};!1===C&&(k.needAlphaBlending=!1);
q?(k.defines.push("#define VERTEXCOLOR"),k.attributes.push(m.b.ColorKind)):(k.uniforms.push("color"),a.color4=new g.b);a._colorShader=new w.a("colorShader",a.getScene(),"color",k);return a}Object(y.d)(e,b);e.prototype._addClipPlaneDefine=function(b){b="#define "+b;-1===this._colorShader.options.defines.indexOf(b)&&this._colorShader.options.defines.push(b)};e.prototype._removeClipPlaneDefine=function(b){b=this._colorShader.options.defines.indexOf("#define "+b);-1!==b&&this._colorShader.options.defines.splice(b,
1)};e.prototype.isReady=function(){var a=this.getScene();a.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE");a.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2");a.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3");a.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4");a.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5");
a.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6");return this._colorShader.isReady(this)?b.prototype.isReady.call(this):!1};e.prototype.getClassName=function(){return"LinesMesh"};Object.defineProperty(e.prototype,"material",{get:function(){return this._colorShader},set:function(b){},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"checkCollisions",{get:function(){return!1},enumerable:!1,configurable:!0});e.prototype._bind=function(b,a,
e){if(!this._geometry)return this;b=this._colorShader.getEffect();a=this.isUnIndexed?null:this._geometry.getIndexBuffer();this._geometry._bind(b,a);this.useVertexColor||(a=this.color,this.color4.set(a.r,a.g,a.b,this.alpha),this._colorShader.setColor4("color",this.color4));p.a.BindClipPlane(b,this.getScene());return this};e.prototype._draw=function(b,a,e){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;a=this.getScene().getEngine();
this._unIndexed?a.drawArraysType(f.a.LineListDrawMode,b.verticesStart,b.verticesCount,e):a.drawElementsType(f.a.LineListDrawMode,b.indexStart,b.indexCount,e);return this};e.prototype.dispose=function(a){this._colorShader.dispose(!1,!1,!0);b.prototype.dispose.call(this,a)};e.prototype.clone=function(b,a,f){void 0===a&&(a=null);return new e(b,this.getScene(),a,this,f)};e.prototype.createInstance=function(b){return new a(b,this)};return e}(B.a),a=function(b){function a(a,e){a=b.call(this,a,e)||this;
a.intersectionThreshold=e.intersectionThreshold;return a}Object(y.d)(a,b);a.prototype.getClassName=function(){return"InstancedLinesMesh"};return a}(F.a)},I2E9:function(B,F,d){d.d(F,"a",function(){return y});var y=function(){return function(g,m){this.distance=g;this.mesh=m}}()},Ihqv:function(B,F,d){B=d("tVVT");F=d("wAMR");var y=d("wcHl"),g=d("Yap0");Object.defineProperty(B.a.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new y.a;var f=this._getComponent(g.a.NAME_SIMPLIFICATIONQUEUE);
f||(f=new m(this),this._addComponent(f))}return this._simplificationQueue},set:function(f){this._simplificationQueue=f},enumerable:!0,configurable:!0});F.a.prototype.simplify=function(f,g,m,d){void 0===g&&(g=!0);void 0===m&&(m=y.b.QUADRATIC);this.getScene().simplificationQueue.addTask({settings:f,parallelProcessing:g,mesh:this,simplificationType:m,successCallback:d});return this};var m=function(){function f(f){this.name=g.a.NAME_SIMPLIFICATIONQUEUE;this.scene=f}f.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(g.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,
this,this._beforeCameraUpdate)};f.prototype.rebuild=function(){};f.prototype.dispose=function(){};f.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()};return f}()},It3q:function(B,F,d){d.d(F,"a",function(){return c});var y=d("oYeq"),g=d("uyO6"),m=d("/SR9"),f=d("y4Ty"),w=d("wAMR"),p=d("UtUh"),J=d("qUIE"),a=d("Gldd"),b=function(b){function a(a,c){a=b.call(this,a.x,a.y)||this;a.index=c;return a}
Object(y.d)(a,b);return a}(m.d),e=function(){function a(){this.elements=[]}a.prototype.add=function(a){var c=this,e=[];a.forEach(function(a){a=new b(a,c.elements.length);e.push(a);c.elements.push(a)});return e};a.prototype.computeBounds=function(){var b=new m.d(this.elements[0].x,this.elements[0].y),a=new m.d(this.elements[0].x,this.elements[0].y);this.elements.forEach(function(c){c.x<b.x?b.x=c.x:c.x>a.x&&(a.x=c.x);c.y<b.y?b.y=c.y:c.y>a.y&&(a.y=c.y)});return{min:b,max:a,width:a.x-b.x,height:a.y-b.y}};
return a}();(function(){function b(){}b.Rectangle=function(b,a,c,e){return[new m.d(b,a),new m.d(c,a),new m.d(c,e),new m.d(b,e)]};b.Circle=function(b,a,c,e){void 0===a&&(a=0);void 0===c&&(c=0);void 0===e&&(e=32);for(var l=[],f=0,k=2*Math.PI/e,v=0;v<e;v++)l.push(new m.d(a+Math.cos(f)*b,c+Math.sin(f)*b)),f-=k;return l};b.Parse=function(b){b=b.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(b){return!isNaN(b)});var a,c=[];for(a=0;a<(b.length&2147483646);a+=2)c.push(new m.d(b[a],b[a+1]));return c};
b.StartingAt=function(b,c){return a.c.StartingAt(b,c)};return b})();var c=function(){function b(b,c,f,l){void 0===l&&(l=earcut);this._points=new e;this._outlinepoints=new e;this._holes=[];this._epoints=[];this._eholes=[];this.bjsEarcut=l;this._name=b;this._scene=f||J.a.LastCreatedScene;b=c instanceof a.c?c.getPoints():c;this._addToepoint(b);this._points.add(b);this._outlinepoints.add(b);"undefined"===typeof this.bjsEarcut&&g.a.Warn("Earcut was not found, the polygon will not be built.")}b.prototype._addToepoint=
function(b){for(var a=0;a<b.length;a++){var c=b[a];this._epoints.push(c.x,c.y)}};b.prototype.addHole=function(b){this._points.add(b);var a=new e;a.add(b);this._holes.push(a);this._eholes.push(this._epoints.length/2);this._addToepoint(b);return this};b.prototype.build=function(b,a){void 0===b&&(b=!1);void 0===a&&(a=0);var c=new w.a(this._name,this._scene);a=this.buildVertexData(a);c.setVerticesData(f.b.PositionKind,a.positions,b);c.setVerticesData(f.b.NormalKind,a.normals,b);c.setVerticesData(f.b.UVKind,
a.uvs,b);c.setIndices(a.indices);return c};b.prototype.buildVertexData=function(b){var a=this;void 0===b&&(b=0);var c=new p.a,e=[],l=[],f=[],g=this._points.computeBounds();this._points.elements.forEach(function(b){e.push(0,1,0);l.push(b.x,0,b.y);f.push((b.x-g.min.x)/g.width,(b.y-g.min.y)/g.height)});for(var v=[],m=this.bjsEarcut(this._epoints,this._eholes,2),d=0;d<m.length;d++)v.push(m[d]);if(0<b){m=l.length/3;this._points.elements.forEach(function(a){e.push(0,-1,0);l.push(a.x,-b,a.y);f.push(1-(a.x-
g.min.x)/g.width,1-(a.y-g.min.y)/g.height)});var J=v.length;for(d=0;d<J;d+=3){var X=v[d+0],Y=v[d+1];v.push(v[d+2]+m);v.push(Y+m);v.push(X+m)}this.addSide(l,e,f,v,g,this._outlinepoints,b,!1);this._holes.forEach(function(c){a.addSide(l,e,f,v,g,c,b,!0)})}c.indices=v;c.positions=l;c.normals=e;c.uvs=f;return c};b.prototype.addSide=function(b,a,c,e,l,f,g,d){for(var v=b.length/3,q=0,k=0;k<f.elements.length;k++){var r=f.elements[k];var x=k+1>f.elements.length-1?f.elements[0]:f.elements[k+1];b.push(r.x,0,
r.y);b.push(r.x,-g,r.y);b.push(x.x,0,x.y);b.push(x.x,-g,x.y);r=new m.e(r.x,0,r.y);x=(new m.e(x.x,0,x.y)).subtract(r);r=new m.e(0,1,0);r=m.e.Cross(x,r);r=r.normalize();c.push(q/l.width,0);c.push(q/l.width,1);q+=x.length();c.push(q/l.width,0);c.push(q/l.width,1);d?(a.push(r.x,r.y,r.z),a.push(r.x,r.y,r.z),a.push(r.x,r.y,r.z),a.push(r.x,r.y,r.z),e.push(v),e.push(v+2),e.push(v+1),e.push(v+1),e.push(v+2),e.push(v+3)):(a.push(-r.x,-r.y,-r.z),a.push(-r.x,-r.y,-r.z),a.push(-r.x,-r.y,-r.z),a.push(-r.x,-r.y,
-r.z),e.push(v),e.push(v+1),e.push(v+2),e.push(v+1),e.push(v+3),e.push(v+2));v+=4}};return b}()},PjzG:function(B,F,d){d.d(F,"a",function(){return W});var y=d("O2A8"),g=d("e993"),m=d("HZbn"),f=d("aXRn"),w=d("H22S"),p=d("5xLc"),J=d("s3JK"),a=d("qq9P"),b=d("IIC5"),e=d("RhQe"),c=d("SgR9"),l=d("eC2D"),v=d("NNSw"),k=d("cykt"),r=d("bnDv"),q=d("2Qj2"),C=d("RV+K"),x=d("dhMq"),A=d("66Nj"),u=d("lUEe"),D=d("/SR9"),W=function(){function d(){}d.CreateBox=function(b,a,c){void 0===c&&(c=null);return m.a.CreateBox(b,
a,c)};d.CreateTiledBox=function(b,a,c){void 0===c&&(c=null);return f.a.CreateTiledBox(b,a,c)};d.CreateSphere=function(b,a,c){void 0===c&&(c=null);return w.a.CreateSphere(b,a,c)};d.CreateDisc=function(b,a,c){void 0===c&&(c=null);return g.a.CreateDisc(b,a,c)};d.CreateIcoSphere=function(b,a,c){void 0===c&&(c=null);return x.a.CreateIcoSphere(b,a,c)};d.CreateRibbon=function(b,a,c){void 0===c&&(c=null);return y.a.CreateRibbon(b,a,c)};d.CreateCylinder=function(b,a,c){void 0===c&&(c=null);return p.a.CreateCylinder(b,
a,c)};d.CreateTorus=function(b,a,c){void 0===c&&(c=null);return J.a.CreateTorus(b,a,c)};d.CreateTorusKnot=function(b,c,e){void 0===e&&(e=null);return a.a.CreateTorusKnot(b,c,e)};d.CreateLineSystem=function(a,c,e){return b.a.CreateLineSystem(a,c,e)};d.CreateLines=function(a,c,e){void 0===e&&(e=null);return b.a.CreateLines(a,c,e)};d.CreateDashedLines=function(a,c,e){void 0===e&&(e=null);return b.a.CreateDashedLines(a,c,e)};d.ExtrudeShape=function(b,a,e){void 0===e&&(e=null);return c.a.ExtrudeShape(b,
a,e)};d.ExtrudeShapeCustom=function(b,a,e){void 0===e&&(e=null);return c.a.ExtrudeShapeCustom(b,a,e)};d.CreateLathe=function(b,a,c){void 0===c&&(c=null);return l.a.CreateLathe(b,a,c)};d.CreateTiledPlane=function(b,a,c){void 0===c&&(c=null);return k.a.CreateTiledPlane(b,a,c)};d.CreatePlane=function(b,a,c){void 0===c&&(c=null);return v.a.CreatePlane(b,a,c)};d.CreateGround=function(b,a,c){void 0===c&&(c=null);return r.a.CreateGround(b,a,c)};d.CreateTiledGround=function(b,a,c){void 0===c&&(c=null);return r.a.CreateTiledGround(b,
a,c)};d.CreateGroundFromHeightMap=function(b,a,c,e){void 0===e&&(e=null);return r.a.CreateGroundFromHeightMap(b,a,c,e)};d.CreatePolygon=function(b,a,c,l){void 0===c&&(c=null);void 0===l&&(l=earcut);return e.a.CreatePolygon(b,a,c,l)};d.ExtrudePolygon=function(b,a,c,l){void 0===c&&(c=null);void 0===l&&(l=earcut);return e.a.ExtrudePolygon(b,a,c,l)};d.CreateTube=function(b,a,c){void 0===c&&(c=null);return q.a.CreateTube(b,a,c)};d.CreatePolyhedron=function(b,a,c){void 0===c&&(c=null);return C.a.CreatePolyhedron(b,
a,c)};d.CreateDecal=function(b,a,c){return A.a.CreateDecal(b,a,c)};d.CreateCapsule=function(b,a,c){void 0===a&&(a={orientation:D.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});void 0===c&&(c=null);return u.a.CreateCapsule(b,a,c)};return d}()},UtUh:function(B,F,d){d.d(F,"a",function(){return p});var y=d("/SR9"),g=d("y4Ty"),m=d("n5HA"),f=d("Xeau"),w=d("uyO6"),p=function(){function d(){}d.prototype.set=function(a,b){a.length||w.a.Warn("Setting vertex data kind '"+b+"' with an empty array");
switch(b){case g.b.PositionKind:this.positions=a;break;case g.b.NormalKind:this.normals=a;break;case g.b.TangentKind:this.tangents=a;break;case g.b.UVKind:this.uvs=a;break;case g.b.UV2Kind:this.uvs2=a;break;case g.b.UV3Kind:this.uvs3=a;break;case g.b.UV4Kind:this.uvs4=a;break;case g.b.UV5Kind:this.uvs5=a;break;case g.b.UV6Kind:this.uvs6=a;break;case g.b.ColorKind:this.colors=a;break;case g.b.MatricesIndicesKind:this.matricesIndices=a;break;case g.b.MatricesWeightsKind:this.matricesWeights=a;break;
case g.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=a;break;case g.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=a}};d.prototype.applyToMesh=function(a,b){this._applyTo(a,b);return this};d.prototype.applyToGeometry=function(a,b){this._applyTo(a,b);return this};d.prototype.updateMesh=function(a){this._update(a);return this};d.prototype.updateGeometry=function(a){this._update(a);return this};d.prototype._applyTo=function(a,b){void 0===b&&(b=!1);this.positions&&a.setVerticesData(g.b.PositionKind,
this.positions,b);this.normals&&a.setVerticesData(g.b.NormalKind,this.normals,b);this.tangents&&a.setVerticesData(g.b.TangentKind,this.tangents,b);this.uvs&&a.setVerticesData(g.b.UVKind,this.uvs,b);this.uvs2&&a.setVerticesData(g.b.UV2Kind,this.uvs2,b);this.uvs3&&a.setVerticesData(g.b.UV3Kind,this.uvs3,b);this.uvs4&&a.setVerticesData(g.b.UV4Kind,this.uvs4,b);this.uvs5&&a.setVerticesData(g.b.UV5Kind,this.uvs5,b);this.uvs6&&a.setVerticesData(g.b.UV6Kind,this.uvs6,b);this.colors&&a.setVerticesData(g.b.ColorKind,
this.colors,b);this.matricesIndices&&a.setVerticesData(g.b.MatricesIndicesKind,this.matricesIndices,b);this.matricesWeights&&a.setVerticesData(g.b.MatricesWeightsKind,this.matricesWeights,b);this.matricesIndicesExtra&&a.setVerticesData(g.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,b);this.matricesWeightsExtra&&a.setVerticesData(g.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,b);this.indices?a.setIndices(this.indices,null,b):a.setIndices([],null);return this};d.prototype._update=function(a,
b,e){this.positions&&a.updateVerticesData(g.b.PositionKind,this.positions,b,e);this.normals&&a.updateVerticesData(g.b.NormalKind,this.normals,b,e);this.tangents&&a.updateVerticesData(g.b.TangentKind,this.tangents,b,e);this.uvs&&a.updateVerticesData(g.b.UVKind,this.uvs,b,e);this.uvs2&&a.updateVerticesData(g.b.UV2Kind,this.uvs2,b,e);this.uvs3&&a.updateVerticesData(g.b.UV3Kind,this.uvs3,b,e);this.uvs4&&a.updateVerticesData(g.b.UV4Kind,this.uvs4,b,e);this.uvs5&&a.updateVerticesData(g.b.UV5Kind,this.uvs5,
b,e);this.uvs6&&a.updateVerticesData(g.b.UV6Kind,this.uvs6,b,e);this.colors&&a.updateVerticesData(g.b.ColorKind,this.colors,b,e);this.matricesIndices&&a.updateVerticesData(g.b.MatricesIndicesKind,this.matricesIndices,b,e);this.matricesWeights&&a.updateVerticesData(g.b.MatricesWeightsKind,this.matricesWeights,b,e);this.matricesIndicesExtra&&a.updateVerticesData(g.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,b,e);this.matricesWeightsExtra&&a.updateVerticesData(g.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,
b,e);this.indices&&a.setIndices(this.indices,null);return this};d.prototype.transform=function(a){var b=0>a.determinant(),e=y.e.Zero(),c;if(this.positions){var l=y.e.Zero();for(c=0;c<this.positions.length;c+=3)y.e.FromArrayToRef(this.positions,c,l),y.e.TransformCoordinatesToRef(l,a,e),this.positions[c]=e.x,this.positions[c+1]=e.y,this.positions[c+2]=e.z}if(this.normals)for(l=y.e.Zero(),c=0;c<this.normals.length;c+=3)y.e.FromArrayToRef(this.normals,c,l),y.e.TransformNormalToRef(l,a,e),this.normals[c]=
e.x,this.normals[c+1]=e.y,this.normals[c+2]=e.z;if(this.tangents)for(e=y.f.Zero(),l=y.f.Zero(),c=0;c<this.tangents.length;c+=4)y.f.FromArrayToRef(this.tangents,c,e),y.f.TransformNormalToRef(e,a,l),this.tangents[c]=l.x,this.tangents[c+1]=l.y,this.tangents[c+2]=l.z,this.tangents[c+3]=l.w;if(b&&this.indices)for(c=0;c<this.indices.length;c+=3)a=this.indices[c+1],this.indices[c+1]=this.indices[c+2],this.indices[c+2]=a;return this};d.prototype.merge=function(a,b){void 0===b&&(b=!1);this._validate();a._validate();
if(!this.normals!==!a.normals||!this.tangents!==!a.tangents||!this.uvs!==!a.uvs||!this.uvs2!==!a.uvs2||!this.uvs3!==!a.uvs3||!this.uvs4!==!a.uvs4||!this.uvs5!==!a.uvs5||!this.uvs6!==!a.uvs6||!this.colors!==!a.colors||!this.matricesIndices!==!a.matricesIndices||!this.matricesWeights!==!a.matricesWeights||!this.matricesIndicesExtra!==!a.matricesIndicesExtra||!this.matricesWeightsExtra!==!a.matricesWeightsExtra)throw Error("Cannot merge vertex data that do not have the same set of attributes");if(a.indices){this.indices||
(this.indices=[]);var e=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var c=this.indices.length+a.indices.length;b=b||this.indices instanceof Uint32Array?new Uint32Array(c):new Uint16Array(c);b.set(this.indices);c=this.indices.length;for(var l=0;l<a.indices.length;l++)b[c+l]=a.indices[l]+e;this.indices=b}else for(l=0;l<a.indices.length;l++)this.indices.push(a.indices[l]+e)}this.positions=this._mergeElement(this.positions,a.positions);this.normals=this._mergeElement(this.normals,
a.normals);this.tangents=this._mergeElement(this.tangents,a.tangents);this.uvs=this._mergeElement(this.uvs,a.uvs);this.uvs2=this._mergeElement(this.uvs2,a.uvs2);this.uvs3=this._mergeElement(this.uvs3,a.uvs3);this.uvs4=this._mergeElement(this.uvs4,a.uvs4);this.uvs5=this._mergeElement(this.uvs5,a.uvs5);this.uvs6=this._mergeElement(this.uvs6,a.uvs6);this.colors=this._mergeElement(this.colors,a.colors);this.matricesIndices=this._mergeElement(this.matricesIndices,a.matricesIndices);this.matricesWeights=
this._mergeElement(this.matricesWeights,a.matricesWeights);this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,a.matricesIndicesExtra);this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,a.matricesWeightsExtra);return this};d.prototype._mergeElement=function(a,b){if(!a)return b;if(!b)return a;var e=b.length+a.length,c=b instanceof Float32Array;if(a instanceof Float32Array)return e=new Float32Array(e),e.set(a),e.set(b,a.length),e;if(c){a=a.slice(0);c=0;for(e=b.length;c<
e;c++)a.push(b[c]);return a}return a.concat(b)};d.prototype._validate=function(){if(!this.positions)throw Error("Positions are required");var a=function(b,a){var c=g.b.DeduceStride(b);if(0!==a.length%c)throw Error("The "+b+"s array count must be a multiple of "+c);return a.length/c},b=a(g.b.PositionKind,this.positions),e=function(c,e){e=a(c,e);if(e!==b)throw Error("The "+c+"s element count ("+e+") does not match the positions count ("+b+")");};this.normals&&e(g.b.NormalKind,this.normals);this.tangents&&
e(g.b.TangentKind,this.tangents);this.uvs&&e(g.b.UVKind,this.uvs);this.uvs2&&e(g.b.UV2Kind,this.uvs2);this.uvs3&&e(g.b.UV3Kind,this.uvs3);this.uvs4&&e(g.b.UV4Kind,this.uvs4);this.uvs5&&e(g.b.UV5Kind,this.uvs5);this.uvs6&&e(g.b.UV6Kind,this.uvs6);this.colors&&e(g.b.ColorKind,this.colors);this.matricesIndices&&e(g.b.MatricesIndicesKind,this.matricesIndices);this.matricesWeights&&e(g.b.MatricesWeightsKind,this.matricesWeights);this.matricesIndicesExtra&&e(g.b.MatricesIndicesExtraKind,this.matricesIndicesExtra);
this.matricesWeightsExtra&&e(g.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)};d.prototype.serialize=function(){var a=this.serialize();this.positions&&(a.positions=this.positions);this.normals&&(a.normals=this.normals);this.tangents&&(a.tangents=this.tangents);this.uvs&&(a.uvs=this.uvs);this.uvs2&&(a.uvs2=this.uvs2);this.uvs3&&(a.uvs3=this.uvs3);this.uvs4&&(a.uvs4=this.uvs4);this.uvs5&&(a.uvs5=this.uvs5);this.uvs6&&(a.uvs6=this.uvs6);this.colors&&(a.colors=this.colors);this.matricesIndices&&
(a.matricesIndices=this.matricesIndices,a.matricesIndices._isExpanded=!0);this.matricesWeights&&(a.matricesWeights=this.matricesWeights);this.matricesIndicesExtra&&(a.matricesIndicesExtra=this.matricesIndicesExtra,a.matricesIndicesExtra._isExpanded=!0);this.matricesWeightsExtra&&(a.matricesWeightsExtra=this.matricesWeightsExtra);a.indices=this.indices;return a};d.ExtractFromMesh=function(a,b,e){return d._ExtractFrom(a,b,e)};d.ExtractFromGeometry=function(a,b,e){return d._ExtractFrom(a,b,e)};d._ExtractFrom=
function(a,b,e){var c=new d;a.isVerticesDataPresent(g.b.PositionKind)&&(c.positions=a.getVerticesData(g.b.PositionKind,b,e));a.isVerticesDataPresent(g.b.NormalKind)&&(c.normals=a.getVerticesData(g.b.NormalKind,b,e));a.isVerticesDataPresent(g.b.TangentKind)&&(c.tangents=a.getVerticesData(g.b.TangentKind,b,e));a.isVerticesDataPresent(g.b.UVKind)&&(c.uvs=a.getVerticesData(g.b.UVKind,b,e));a.isVerticesDataPresent(g.b.UV2Kind)&&(c.uvs2=a.getVerticesData(g.b.UV2Kind,b,e));a.isVerticesDataPresent(g.b.UV3Kind)&&
(c.uvs3=a.getVerticesData(g.b.UV3Kind,b,e));a.isVerticesDataPresent(g.b.UV4Kind)&&(c.uvs4=a.getVerticesData(g.b.UV4Kind,b,e));a.isVerticesDataPresent(g.b.UV5Kind)&&(c.uvs5=a.getVerticesData(g.b.UV5Kind,b,e));a.isVerticesDataPresent(g.b.UV6Kind)&&(c.uvs6=a.getVerticesData(g.b.UV6Kind,b,e));a.isVerticesDataPresent(g.b.ColorKind)&&(c.colors=a.getVerticesData(g.b.ColorKind,b,e));a.isVerticesDataPresent(g.b.MatricesIndicesKind)&&(c.matricesIndices=a.getVerticesData(g.b.MatricesIndicesKind,b,e));a.isVerticesDataPresent(g.b.MatricesWeightsKind)&&
(c.matricesWeights=a.getVerticesData(g.b.MatricesWeightsKind,b,e));a.isVerticesDataPresent(g.b.MatricesIndicesExtraKind)&&(c.matricesIndicesExtra=a.getVerticesData(g.b.MatricesIndicesExtraKind,b,e));a.isVerticesDataPresent(g.b.MatricesWeightsExtraKind)&&(c.matricesWeightsExtra=a.getVerticesData(g.b.MatricesWeightsExtraKind,b,e));c.indices=a.getIndices(b,e);return c};d.CreateRibbon=function(a){throw m.a.WarnImport("ribbonBuilder");};d.CreateBox=function(a){throw m.a.WarnImport("boxBuilder");};d.CreateTiledBox=
function(a){throw m.a.WarnImport("tiledBoxBuilder");};d.CreateTiledPlane=function(a){throw m.a.WarnImport("tiledPlaneBuilder");};d.CreateSphere=function(a){throw m.a.WarnImport("sphereBuilder");};d.CreateCylinder=function(a){throw m.a.WarnImport("cylinderBuilder");};d.CreateTorus=function(a){throw m.a.WarnImport("torusBuilder");};d.CreateLineSystem=function(a){throw m.a.WarnImport("linesBuilder");};d.CreateDashedLines=function(a){throw m.a.WarnImport("linesBuilder");};d.CreateGround=function(a){throw m.a.WarnImport("groundBuilder");
};d.CreateTiledGround=function(a){throw m.a.WarnImport("groundBuilder");};d.CreateGroundFromHeightMap=function(a){throw m.a.WarnImport("groundBuilder");};d.CreatePlane=function(a){throw m.a.WarnImport("planeBuilder");};d.CreateDisc=function(a){throw m.a.WarnImport("discBuilder");};d.CreatePolygon=function(a,b,e,c,l,f,d){throw m.a.WarnImport("polygonBuilder");};d.CreateIcoSphere=function(a){throw m.a.WarnImport("icoSphereBuilder");};d.CreatePolyhedron=function(a){throw m.a.WarnImport("polyhedronBuilder");
};d.CreateCapsule=function(a){void 0===a&&y.e.Up();throw m.a.WarnImport("capsuleBuilder");};d.CreateTorusKnot=function(a){throw m.a.WarnImport("torusKnotBuilder");};d.ComputeNormals=function(a,b,e,c){var l,f=!1,d=!1,r=!1,g=!1,m=1,x=0,p=null;if(c&&(f=c.facetNormals?!0:!1,d=c.facetPositions?!0:!1,r=c.facetPartitioning?!0:!1,m=!0===c.useRightHandedSystem?-1:1,x=c.ratio||0,g=c.depthSort?!0:!1,p=c.distanceTo,g)){void 0===p&&(p=y.e.Zero());var u=c.depthSortedFacets}var w=0,J=0,K=0,B=0;r&&c&&c.bbSize&&(w=
c.subDiv.X*x/c.bbSize.x,J=c.subDiv.Y*x/c.bbSize.y,K=c.subDiv.Z*x/c.bbSize.z,B=c.subDiv.max*c.subDiv.max,c.facetPartitioning.length=0);for(l=0;l<a.length;l++)e[l]=0;var F=b.length/3|0;for(l=0;l<F;l++){var O=3*b[3*l];var R=O+1;var S=O+2;var N=3*b[3*l+1];var T=N+1;var h=N+2;var n=3*b[3*l+2];var z=n+1;var I=n+2;var G=a[O]-a[N];var E=a[R]-a[T];var H=a[S]-a[h];var U=a[n]-a[N];var V=a[z]-a[T];var L=a[I]-a[h];var M=m*(E*L-H*V);H=m*(H*U-G*L);G=m*(G*V-E*U);E=Math.sqrt(M*M+H*H+G*G);E=0===E?1:E;M/=E;H/=E;G/=
E;f&&c&&(c.facetNormals[l].x=M,c.facetNormals[l].y=H,c.facetNormals[l].z=G);d&&c&&(c.facetPositions[l].x=(a[O]+a[N]+a[n])/3,c.facetPositions[l].y=(a[R]+a[T]+a[z])/3,c.facetPositions[l].z=(a[S]+a[h]+a[I])/3);if(r&&c){E=Math.floor((c.facetPositions[l].x-c.bInfo.minimum.x*x)*w);U=Math.floor((c.facetPositions[l].y-c.bInfo.minimum.y*x)*J);V=Math.floor((c.facetPositions[l].z-c.bInfo.minimum.z*x)*K);var P=Math.floor((a[O]-c.bInfo.minimum.x*x)*w);var Z=Math.floor((a[R]-c.bInfo.minimum.y*x)*J);var aa=Math.floor((a[S]-
c.bInfo.minimum.z*x)*K);var Q=Math.floor((a[N]-c.bInfo.minimum.x*x)*w);var t=Math.floor((a[T]-c.bInfo.minimum.y*x)*J);var ba=Math.floor((a[h]-c.bInfo.minimum.z*x)*K);L=Math.floor((a[n]-c.bInfo.minimum.x*x)*w);var ca=Math.floor((a[z]-c.bInfo.minimum.y*x)*J);var da=Math.floor((a[I]-c.bInfo.minimum.z*x)*K);P=P+c.subDiv.max*Z+B*aa;Q=Q+c.subDiv.max*t+B*ba;L=L+c.subDiv.max*ca+B*da;E=E+c.subDiv.max*U+B*V;c.facetPartitioning[E]=c.facetPartitioning[E]?c.facetPartitioning[E]:[];c.facetPartitioning[P]=c.facetPartitioning[P]?
c.facetPartitioning[P]:[];c.facetPartitioning[Q]=c.facetPartitioning[Q]?c.facetPartitioning[Q]:[];c.facetPartitioning[L]=c.facetPartitioning[L]?c.facetPartitioning[L]:[];c.facetPartitioning[P].push(l);Q!=P&&c.facetPartitioning[Q].push(l);L!=Q&&L!=P&&c.facetPartitioning[L].push(l);E!=P&&E!=Q&&E!=L&&c.facetPartitioning[E].push(l)}g&&c&&c.facetPositions&&(E=u[l],E.ind=3*l,E.sqDistance=y.e.DistanceSquared(c.facetPositions[l],p));e[O]+=M;e[R]+=H;e[S]+=G;e[N]+=M;e[T]+=H;e[h]+=G;e[n]+=M;e[z]+=H;e[I]+=G}for(l=
0;l<e.length/3;l++)M=e[3*l],H=e[3*l+1],G=e[3*l+2],E=Math.sqrt(M*M+H*H+G*G),E=0===E?1:E,M/=E,H/=E,G/=E,e[3*l]=M,e[3*l+1]=H,e[3*l+2]=G};d._ComputeSides=function(a,b,e,c,f,g,m){var l=e.length,q=c.length;a=a||d.DEFAULTSIDE;switch(a){case d.BACKSIDE:for(b=0;b<l;b+=3)f=e[b],e[b]=e[b+2],e[b+2]=f;for(e=0;e<q;e++)c[e]=-c[e];break;case d.DOUBLESIDE:var v=b.length;a=v/3;for(var k=0;k<v;k++)b[v+k]=b[k];for(b=0;b<l;b+=3)e[b+l]=e[b+2]+a,e[b+1+l]=e[b+1]+a,e[b+2+l]=e[b]+a;for(e=0;e<q;e++)c[q+e]=-c[e];c=f.length;
for(q=0;q<c;q++)f[q+c]=f[q];g=g?g:new y.f(0,0,1,1);m=m?m:new y.f(0,0,1,1);for(b=q=0;b<c/2;b++)f[q]=g.x+(g.z-g.x)*f[q],f[q+1]=g.y+(g.w-g.y)*f[q+1],f[q+c]=m.x+(m.z-m.x)*f[q+c],f[q+c+1]=m.y+(m.w-m.y)*f[q+c+1],q+=2}};d.ImportVertexData=function(a,b){var e=new d,c=a.positions;c&&e.set(c,g.b.PositionKind);var l=a.normals;l&&e.set(l,g.b.NormalKind);(l=a.tangents)&&e.set(l,g.b.TangentKind);(l=a.uvs)&&e.set(l,g.b.UVKind);(l=a.uv2s)&&e.set(l,g.b.UV2Kind);(l=a.uv3s)&&e.set(l,g.b.UV3Kind);(l=a.uv4s)&&e.set(l,
g.b.UV4Kind);(l=a.uv5s)&&e.set(l,g.b.UV5Kind);(l=a.uv6s)&&e.set(l,g.b.UV6Kind);(l=a.colors)&&e.set(f.b.CheckColors4(l,c.length/3),g.b.ColorKind);(c=a.matricesIndices)&&e.set(c,g.b.MatricesIndicesKind);(c=a.matricesWeights)&&e.set(c,g.b.MatricesWeightsKind);if(c=a.indices)e.indices=c;b.setAllVerticesData(e,a.updatable)};d.FRONTSIDE=0;d.BACKSIDE=1;d.DOUBLESIDE=2;d.DEFAULTSIDE=0;return d}()},Z5Kw:function(B,F,d){B=d("wAMR");var y=d("y4Ty"),g=d("/SR9");B.a.prototype.thinInstanceAdd=function(d,f){void 0===
f&&(f=!0);this._thinInstanceUpdateBufferSize("matrix",Array.isArray(d)?d.length:1);var g=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(d))for(var m=0;m<d.length;++m)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,d[m],m===d.length-1&&f);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,d,f);return g};B.a.prototype.thinInstanceAddSelf=function(d){void 0===d&&(d=!0);return this.thinInstanceAdd(g.a.IdentityReadOnly,d)};B.a.prototype.thinInstanceRegisterAttribute=
function(d,f){this.removeVerticesData(d);this._thinInstanceInitializeUserStorage();this._userThinInstanceBuffersStorage.strides[d]=f;this._userThinInstanceBuffersStorage.sizes[d]=f*Math.max(32,this._thinInstanceDataStorage.instancesCount);this._userThinInstanceBuffersStorage.data[d]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[d]);this._userThinInstanceBuffersStorage.vertexBuffers[d]=new y.b(this.getEngine(),this._userThinInstanceBuffersStorage.data[d],d,!0,!1,f,!0);this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[d])};
B.a.prototype.thinInstanceSetMatrixAt=function(d,f,g){void 0===g&&(g=!0);if(!this._thinInstanceDataStorage.matrixData||d>=this._thinInstanceDataStorage.instancesCount)return!1;f.copyToArray(this._thinInstanceDataStorage.matrixData,16*d);this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[d]=f);g&&(this.thinInstanceBufferUpdated("matrix"),this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1));return!0};B.a.prototype.thinInstanceSetAttributeAt=function(d,
f,g,p){void 0===p&&(p=!0);if(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[d]||f>=this._thinInstanceDataStorage.instancesCount)return!1;this._thinInstanceUpdateBufferSize(d,0);this._userThinInstanceBuffersStorage.data[d].set(g,f*this._userThinInstanceBuffersStorage.strides[d]);p&&this.thinInstanceBufferUpdated(d);return!0};Object.defineProperty(B.a.prototype,"thinInstanceCount",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(d){var f,
g,m=(null!==(g=null===(f=this._thinInstanceDataStorage.matrixData)||void 0===f?void 0:f.length)&&void 0!==g?g:0)/16;d<=m&&(this._thinInstanceDataStorage.instancesCount=d)},enumerable:!0,configurable:!0});B.a.prototype.thinInstanceSetBuffer=function(d,f,g,p){var m,a;void 0===g&&(g=0);void 0===p&&(p=!1);g=g||16;if("matrix"===d)null===(m=this._thinInstanceDataStorage.matrixBuffer)||void 0===m?void 0:m.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=
f?f.length:32*g,this._thinInstanceDataStorage.matrixData=f,this._thinInstanceDataStorage.worldMatrices=null,null!==f?(this._thinInstanceDataStorage.instancesCount=f.length/g,d=new y.a(this.getEngine(),f,!p,g,!1,!0),this._thinInstanceDataStorage.matrixBuffer=d,this.setVerticesBuffer(d.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(d.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(d.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(d.createVertexBuffer("world3",12,4)),this.doNotSyncBoundingInfo||
this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.doNotSyncBoundingInfo||this.refreshBoundingInfo(!0));else if(null===f){if(null===(a=this._userThinInstanceBuffersStorage)||void 0===a?0:a.data[d])this.removeVerticesData(d),delete this._userThinInstanceBuffersStorage.data[d],delete this._userThinInstanceBuffersStorage.strides[d],delete this._userThinInstanceBuffersStorage.sizes[d],delete this._userThinInstanceBuffersStorage.vertexBuffers[d]}else this._thinInstanceInitializeUserStorage(),
this._userThinInstanceBuffersStorage.data[d]=f,this._userThinInstanceBuffersStorage.strides[d]=g,this._userThinInstanceBuffersStorage.sizes[d]=f.length,this._userThinInstanceBuffersStorage.vertexBuffers[d]=new y.b(this.getEngine(),f,d,!p,!1,g,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[d])};B.a.prototype.thinInstanceBufferUpdated=function(d){var f;"matrix"===d?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,
0,this._thinInstanceDataStorage.instancesCount):(null===(f=this._userThinInstanceBuffersStorage)||void 0===f?0:f.vertexBuffers[d])&&this._userThinInstanceBuffersStorage.vertexBuffers[d].updateDirectly(this._userThinInstanceBuffersStorage.data[d],0)};B.a.prototype.thinInstancePartialBufferUpdate=function(d,f,g){var m;"matrix"===d?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(f,g):(null===(m=this._userThinInstanceBuffersStorage)||void 0===m?0:
m.vertexBuffers[d])&&this._userThinInstanceBuffersStorage.vertexBuffers[d].updateDirectly(f,g)};B.a.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];var d=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(var f=0;f<this._thinInstanceDataStorage.instancesCount;++f)this._thinInstanceDataStorage.worldMatrices[f]=
g.a.FromArray(d,16*f)}return this._thinInstanceDataStorage.worldMatrices};B.a.prototype.thinInstanceRefreshBoundingInfo=function(d){void 0===d&&(d=!1);if(this._thinInstanceDataStorage.matrixData&&this._thinInstanceDataStorage.matrixBuffer){var f=this._thinInstanceDataStorage.boundingVectors;d&&(f.length=0,this.refreshBoundingInfo(!0));d=this.getBoundingInfo();var m=this._thinInstanceDataStorage.matrixData;if(0===f.length)for(var p=0;p<d.boundingBox.vectors.length;++p)f.push(d.boundingBox.vectors[p].clone());
g.c.Vector3[0].setAll(Number.POSITIVE_INFINITY);g.c.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(var y=0;y<this._thinInstanceDataStorage.instancesCount;++y)for(g.a.FromArrayToRef(m,16*y,g.c.Matrix[0]),p=0;p<f.length;++p)g.e.TransformCoordinatesToRef(f[p],g.c.Matrix[0],g.c.Vector3[2]),g.c.Vector3[0].minimizeInPlace(g.c.Vector3[2]),g.c.Vector3[1].maximizeInPlace(g.c.Vector3[2]);d.reConstruct(g.c.Vector3[0],g.c.Vector3[1]);this._updateBoundingInfo()}};B.a.prototype._thinInstanceUpdateBufferSize=function(d,
f){var g,p;void 0===f&&(f=1);var m="matrix"===d;if(m||this._userThinInstanceBuffersStorage&&this._userThinInstanceBuffersStorage.strides[d]){var a=m?16:this._userThinInstanceBuffersStorage.strides[d],b=m?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[d],e=m?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[d],c=(this._thinInstanceDataStorage.instancesCount+f)*a;for(f=b;f<c;)f*=2;e&&b==f||(e?(b=new Float32Array(f),b.set(e,
0),e=b):e=new Float32Array(f),m?(null===(g=this._thinInstanceDataStorage.matrixBuffer)||void 0===g?void 0:g.dispose(),d=new y.a(this.getEngine(),e,!0,a,!1,!0),this._thinInstanceDataStorage.matrixBuffer=d,this._thinInstanceDataStorage.matrixData=e,this._thinInstanceDataStorage.matrixBufferSize=f,this.setVerticesBuffer(d.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(d.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(d.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(d.createVertexBuffer("world3",
12,4))):(null===(p=this._userThinInstanceBuffersStorage.vertexBuffers[d])||void 0===p?void 0:p.dispose(),this._userThinInstanceBuffersStorage.data[d]=e,this._userThinInstanceBuffersStorage.sizes[d]=f,this._userThinInstanceBuffersStorage.vertexBuffers[d]=new y.b(this.getEngine(),e,d,!0,!1,a,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[d])))}};B.a.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage=
{data:{},sizes:{},vertexBuffers:{},strides:{}})};B.a.prototype._disposeThinInstanceSpecificData=function(){var d;if(null===(d=this._thinInstanceDataStorage)||void 0===d?0:d.matrixBuffer)this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null}},acOv:function(B,F,d){d.d(F,"a",function(){return b});var y=d("oYeq"),g=d("/SR9"),m=d("uyO6");B=d("ikaq");F=d("wAMR");var f=d("Dc3z"),w=d("qVgn"),p=d("y4Ty"),J=d("T5H4"),a=d("YKqZ");F.a._instancedMeshFactory=function(a,
c){a=new b(a,c);if(c.instancedBuffers){a.instancedBuffers={};for(var e in c.instancedBuffers)a.instancedBuffers[e]=c.instancedBuffers[e]}return a};var b=function(b){function c(c,e){c=b.call(this,c,e.getScene())||this;c._indexInSourceMeshInstanceArray=-1;e.addInstance(c);c._sourceMesh=e;c._unIndexed=e._unIndexed;c.position.copyFrom(e.position);c.rotation.copyFrom(e.rotation);c.scaling.copyFrom(e.scaling);e.rotationQuaternion&&(c.rotationQuaternion=e.rotationQuaternion.clone());c.animations=a.b.Slice(e.animations);
for(var f=0,d=e.getAnimationRanges();f<d.length;f++){var l=d[f];null!=l&&c.createAnimationRange(l.name,l.from,l.to)}c.infiniteDistance=e.infiniteDistance;c.setPivotMatrix(e.getPivotMatrix());c.refreshBoundingInfo();c._syncSubMeshes();return c}Object(y.d)(c,b);c.prototype.getClassName=function(){return"InstancedMesh"};Object.defineProperty(c.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0});c.prototype._resyncLightSources=function(){};c.prototype._resyncLightSource=
function(b){};c.prototype._removeLightSource=function(b,a){};Object.defineProperty(c.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"skeleton",
{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(b){this._sourceMesh&&b!==this._sourceMesh.renderingGroupId&&m.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0});c.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0};c.prototype.getTotalIndices=
function(){return this._sourceMesh.getTotalIndices()};Object.defineProperty(c.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0});c.prototype.createInstance=function(b){return this._sourceMesh.createInstance(b)};c.prototype.isReady=function(b){void 0===b&&(b=!1);return this._sourceMesh.isReady(b,!0)};c.prototype.getVerticesData=function(b,a){return this._sourceMesh.getVerticesData(b,a)};c.prototype.setVerticesData=function(b,a,c,e){this.sourceMesh&&this.sourceMesh.setVerticesData(b,
a,c,e);return this.sourceMesh};c.prototype.updateVerticesData=function(b,a,c,e){this.sourceMesh&&this.sourceMesh.updateVerticesData(b,a,c,e);return this.sourceMesh};c.prototype.setIndices=function(b,a){void 0===a&&(a=null);this.sourceMesh&&this.sourceMesh.setIndices(b,a);return this.sourceMesh};c.prototype.isVerticesDataPresent=function(b){return this._sourceMesh.isVerticesDataPresent(b)};c.prototype.getIndices=function(){return this._sourceMesh.getIndices()};Object.defineProperty(c.prototype,"_positions",
{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0});c.prototype.refreshBoundingInfo=function(b){void 0===b&&(b=!1);if(this._boundingInfo&&this._boundingInfo.isLocked)return this;var a=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;this._refreshBoundingInfo(this._sourceMesh._getPositionData(b),a);return this};c.prototype._preActivate=function(){this._currentLOD&&this._currentLOD._preActivate();return this};c.prototype._activate=function(b,a){this._sourceMesh.subMeshes||
m.a.Warn("Instances should only be created for meshes with geometry.");if(this._currentLOD){if(0<this._currentLOD._getWorldMatrixDeterminant()!==0<this._getWorldMatrixDeterminant())return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0;this._internalAbstractMeshDataInfo._actAsRegularMesh=!1;this._currentLOD._registerInstanceForRenderId(this,b);if(a){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=
!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0}return!1};c.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):
this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)};c.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==w.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var a=this._currentLOD._masterMesh;this._currentLOD._masterMesh=this;g.c.Vector3[7].copyFrom(this._currentLOD.position);this._currentLOD.position.set(0,0,0);g.c.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0));
this._currentLOD.position.copyFrom(g.c.Vector3[7]);this._currentLOD._masterMesh=a;return g.c.Matrix[0]}return b.prototype.getWorldMatrix.call(this)};Object.defineProperty(c.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0});c.prototype.getLOD=function(b){if(!b)return this;var a=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(b,a.boundingSphere);return this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD};c.prototype._preActivateForIntermediateRendering=
function(b){return this.sourceMesh._preActivateForIntermediateRendering(b)};c.prototype._syncSubMeshes=function(){this.releaseSubMeshes();if(this._sourceMesh.subMeshes)for(var b=0;b<this._sourceMesh.subMeshes.length;b++)this._sourceMesh.subMeshes[b].clone(this,this._sourceMesh);return this};c.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()};c.prototype._updateBoundingInfo=function(){this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=
new J.a(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache);this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache);return this};c.prototype.clone=function(b,a,c){void 0===a&&(a=null);b=this._sourceMesh.createInstance(b);f.a.DeepCopy(this,b,"name subMeshes uniqueId parent lightSources receiveShadows material visibility skeleton sourceMesh isAnInstance facetNb isFacetDataEnabled isBlocked useBones hasInstances collider edgesRenderer forward up right absolutePosition absoluteScaling absoluteRotationQuaternion isWorldMatrixFrozen nonUniformScaling behaviors worldMatrixFromCache hasThinInstances".split(" "),
[]);this.refreshBoundingInfo();a&&(b.parent=a);if(!c)for(a=0;a<this.getScene().meshes.length;a++)c=this.getScene().meshes[a],c.parent===this&&c.clone(c.name,b);b.computeWorldMatrix(!0);return b};c.prototype.dispose=function(a,c){void 0===c&&(c=!1);this._sourceMesh.removeInstance(this);b.prototype.dispose.call(this,a,c)};return c}(B.a);F.a.prototype.edgesShareWithInstances=!1;F.a.prototype.registerInstancedBuffer=function(b,a){this.removeVerticesData(b);if(!this.instancedBuffers){this.instancedBuffers=
{};for(var c=0,e=this.instances;c<e.length;c++){var f=e[c];f.instancedBuffers={}}this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[b]=null;this._userInstancedBuffersStorage.strides[b]=a;this._userInstancedBuffersStorage.sizes[b]=32*a;this._userInstancedBuffersStorage.data[b]=new Float32Array(this._userInstancedBuffersStorage.sizes[b]);this._userInstancedBuffersStorage.vertexBuffers[b]=new p.b(this.getEngine(),this._userInstancedBuffersStorage.data[b],
b,!0,!1,a,!0);this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[b]);a=0;for(c=this.instances;a<c.length;a++)f=c[a],f.instancedBuffers[b]=null};F.a.prototype._processInstancedBuffers=function(b,a){var c=b.length,e;for(e in this.instancedBuffers){for(var f=this._userInstancedBuffersStorage.sizes[e],d=this._userInstancedBuffersStorage.strides[e],g=(c+1)*d;f<g;)f*=2;this._userInstancedBuffersStorage.data[e].length!=f&&(this._userInstancedBuffersStorage.data[e]=new Float32Array(f),
this._userInstancedBuffersStorage.sizes[e]=f,this._userInstancedBuffersStorage.vertexBuffers[e]&&(this._userInstancedBuffersStorage.vertexBuffers[e].dispose(),this._userInstancedBuffersStorage.vertexBuffers[e]=null));f=this._userInstancedBuffersStorage.data[e];g=0;if(a){var C=this.instancedBuffers[e];C.toArray?C.toArray(f,g):C.copyToArray(f,g);g+=d}for(var x=0;x<c;x++)C=b[x].instancedBuffers[e],C.toArray?C.toArray(f,g):C.copyToArray(f,g),g+=d;this._userInstancedBuffersStorage.vertexBuffers[e]?this._userInstancedBuffersStorage.vertexBuffers[e].updateDirectly(f,
0):(this._userInstancedBuffersStorage.vertexBuffers[e]=new p.b(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,d,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[e]))}};F.a.prototype._disposeInstanceSpecificData=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);for(;this.instances.length;)this.instances[0].dispose();for(var b in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[b]&&
this._userInstancedBuffersStorage.vertexBuffers[b].dispose();this.instancedBuffers={}}},mUUE:function(B,F,d){var y=d("oYeq"),g=d("ikaq");B=d("wAMR");var m=d("/SR9"),f=d("y4Ty"),w=d("UtUh");(function(d){function p(a,b,e,c,f,g){void 0===c&&(c=1);void 0===f&&(f=60);void 0===g&&(g=!0);a=d.call(this,a,e)||this;a._sectionPolygonPointsCount=4;a._running=!1;a._autoStart=g;a._generator=b;a._diameter=c;a._length=f;a._sectionVectors=[];a._sectionNormalVectors=[];for(b=0;b<a._sectionPolygonPointsCount;b++)a._sectionVectors[b]=
m.e.Zero(),a._sectionNormalVectors[b]=m.e.Zero();a._createMesh();return a}Object(y.d)(p,d);p.prototype.getClassName=function(){return"TrailMesh"};p.prototype._createMesh=function(){var a=new w.a,b=[],e=[],c=[];m.e.Zero();var f=this._generator instanceof g.a&&this._generator._boundingInfo?this._generator._boundingInfo.boundingBox.centerWorld:this._generator.position;for(var d=2*Math.PI/this._sectionPolygonPointsCount,k=0;k<this._sectionPolygonPointsCount;k++)b.push(f.x+Math.cos(k*d)*this._diameter,
f.y+Math.sin(k*d)*this._diameter,f.z);for(k=1;k<=this._length;k++){for(var r=0;r<this._sectionPolygonPointsCount;r++)b.push(f.x+Math.cos(r*d)*this._diameter,f.y+Math.sin(r*d)*this._diameter,f.z);var q=b.length/3-2*this._sectionPolygonPointsCount;for(r=0;r<this._sectionPolygonPointsCount-1;r++)c.push(q+r,q+r+this._sectionPolygonPointsCount,q+r+this._sectionPolygonPointsCount+1),c.push(q+r,q+r+this._sectionPolygonPointsCount+1,q+r+1);c.push(q+this._sectionPolygonPointsCount-1,q+this._sectionPolygonPointsCount-
1+this._sectionPolygonPointsCount,q+this._sectionPolygonPointsCount);c.push(q+this._sectionPolygonPointsCount-1,q+this._sectionPolygonPointsCount,q)}w.a.ComputeNormals(b,c,e);a.positions=b;a.normals=e;a.indices=c;a.applyToMesh(this,!0);this._autoStart&&this.start()};p.prototype.start=function(){var a=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(function(){a.update()}))};p.prototype.stop=function(){this._beforeRenderObserver&&this._running&&
(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))};p.prototype.update=function(){var a=this.getVerticesData(f.b.PositionKind),b=this.getVerticesData(f.b.NormalKind),e=this._generator.getWorldMatrix();if(a&&b){for(var c=3*this._sectionPolygonPointsCount;c<a.length;c++)a[c-3*this._sectionPolygonPointsCount]=a[c]-b[c]/this._length*this._diameter;for(c=3*this._sectionPolygonPointsCount;c<b.length;c++)b[c-3*this._sectionPolygonPointsCount]=b[c];var d=a.length-
3*this._sectionPolygonPointsCount,g=2*Math.PI/this._sectionPolygonPointsCount;for(c=0;c<this._sectionPolygonPointsCount;c++)this._sectionVectors[c].copyFromFloats(Math.cos(c*g)*this._diameter,Math.sin(c*g)*this._diameter,0),this._sectionNormalVectors[c].copyFromFloats(Math.cos(c*g),Math.sin(c*g),0),m.e.TransformCoordinatesToRef(this._sectionVectors[c],e,this._sectionVectors[c]),m.e.TransformNormalToRef(this._sectionNormalVectors[c],e,this._sectionNormalVectors[c]);for(c=0;c<this._sectionPolygonPointsCount;c++)a[d+
3*c]=this._sectionVectors[c].x,a[d+3*c+1]=this._sectionVectors[c].y,a[d+3*c+2]=this._sectionVectors[c].z,b[d+3*c]=this._sectionNormalVectors[c].x,b[d+3*c+1]=this._sectionNormalVectors[c].y,b[d+3*c+2]=this._sectionNormalVectors[c].z;this.updateVerticesData(f.b.PositionKind,a,!0,!1);this.updateVerticesData(f.b.NormalKind,b,!0,!1)}};p.prototype.clone=function(a,b){void 0===a&&(a="");return new p(a,void 0===b?this._generator:b,this.getScene(),this._diameter,this._length,this._autoStart)};p.prototype.serialize=
function(a){d.prototype.serialize.call(this,a)};p.Parse=function(a,b){return new p(a.name,a._generator,b,a._diameter,a._length,a._autoStart)};return p})(B.a)},qVgn:function(B,F,d){d.d(F,"a",function(){return p});var y=d("oYeq"),g=d("ADVu"),m=d("ps+7"),f=d("/SR9");B=d("Ufda");var w=d("SYzJ"),p=function(d){function a(b,e,c){void 0===e&&(e=null);void 0===c&&(c=!0);b=d.call(this,b,e)||this;b._forward=new f.e(0,0,1);b._forwardInverted=new f.e(0,0,-1);b._up=new f.e(0,1,0);b._right=new f.e(1,0,0);b._rightInverted=
new f.e(-1,0,0);b._position=f.e.Zero();b._rotation=f.e.Zero();b._rotationQuaternion=null;b._scaling=f.e.One();b._isDirty=!1;b._transformToBoneReferal=null;b._isAbsoluteSynced=!1;b._billboardMode=a.BILLBOARDMODE_NONE;b._preserveParentRotationForBillboard=!1;b.scalingDeterminant=1;b._infiniteDistance=!1;b.ignoreNonUniformScaling=!1;b.reIntegrateRotationIntoRotationQuaternion=!1;b._poseMatrix=null;b._localMatrix=f.a.Zero();b._usePivotMatrix=!1;b._absolutePosition=f.e.Zero();b._absoluteScaling=f.e.Zero();
b._absoluteRotationQuaternion=f.b.Identity();b._pivotMatrix=f.a.Identity();b._postMultiplyPivotMatrix=!1;b._isWorldMatrixFrozen=!1;b._indexInSceneTransformNodesArray=-1;b.onAfterWorldMatrixUpdateObservable=new m.a;b._nonUniformScaling=!1;c&&b.getScene().addTransformNode(b);return b}Object(y.d)(a,d);Object.defineProperty(a.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(b){this._billboardMode!==b&&(this._billboardMode=b)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(b){b!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=b)},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(b){this._infiniteDistance!==b&&(this._infiniteDistance=b)},enumerable:!1,configurable:!0});a.prototype.getClassName=function(){return"TransformNode"};
Object.defineProperty(a.prototype,"position",{get:function(){return this._position},set:function(b){this._position=b;this._isDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"rotation",{get:function(){return this._rotation},set:function(b){this._rotation=b;this._rotationQuaternion=null;this._isDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"scaling",{get:function(){return this._scaling},set:function(b){this._scaling=b;this._isDirty=!0},enumerable:!1,
configurable:!0});Object.defineProperty(a.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(b){(this._rotationQuaternion=b)&&this._rotation.setAll(0);this._isDirty=!0},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"forward",{get:function(){return f.e.Normalize(f.e.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"up",{get:function(){return f.e.Normalize(f.e.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"right",{get:function(){return f.e.Normalize(f.e.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!1,configurable:!0});a.prototype.updatePoseMatrix=function(b){if(!this._poseMatrix)return this._poseMatrix=b.clone(),this;this._poseMatrix.copyFrom(b);return this};a.prototype.getPoseMatrix=
function(){this._poseMatrix||(this._poseMatrix=f.a.Identity());return this._poseMatrix};a.prototype._isSynchronized=function(){var b=this._cache;return this.billboardMode!==b.billboardMode||this.billboardMode!==a.BILLBOARDMODE_NONE||b.pivotMatrixUpdated||this.infiniteDistance||this.position._isDirty||this.scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this.rotation._isDirty?!1:!0};a.prototype._initCache=function(){d.prototype._initCache.call(this);var b=this._cache;
b.localMatrixUpdated=!1;b.billboardMode=-1;b.infiniteDistance=!1};a.prototype.markAsDirty=function(b){this._currentRenderId=Number.MAX_VALUE;this._isDirty=!0;return this};Object.defineProperty(a.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"absoluteScaling",{get:function(){this._syncAbsoluteScalingAndRotation();return this._absoluteScaling},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"absoluteRotationQuaternion",{get:function(){this._syncAbsoluteScalingAndRotation();return this._absoluteRotationQuaternion},enumerable:!1,configurable:!0});a.prototype.setPreTransformMatrix=function(b){return this.setPivotMatrix(b,!1)};a.prototype.setPivotMatrix=function(b,a){void 0===a&&(a=!0);this._pivotMatrix.copyFrom(b);this._usePivotMatrix=!this._pivotMatrix.isIdentity();this._cache.pivotMatrixUpdated=!0;if(this._postMultiplyPivotMatrix=a)this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):
this._pivotMatrixInverse=f.a.Invert(this._pivotMatrix);return this};a.prototype.getPivotMatrix=function(){return this._pivotMatrix};a.prototype.instantiateHierarchy=function(b,a,c){void 0===b&&(b=null);(b=this.clone("Clone of "+(this.name||this.id),b||this.parent,!0))&&c&&c(this,b);for(var e=0,f=this.getChildTransformNodes(!0);e<f.length;e++)f[e].instantiateHierarchy(b,a,c);return b};a.prototype.freezeWorldMatrix=function(b){void 0===b&&(b=null);b?this._worldMatrix=b:(this._isWorldMatrixFrozen=!1,
this.computeWorldMatrix(!0));this._isDirty=!1;this._isWorldMatrixFrozen=!0;return this};a.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1;this.computeWorldMatrix(!0);return this};Object.defineProperty(a.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0});a.prototype.getAbsolutePosition=function(){this.computeWorldMatrix();return this._absolutePosition};a.prototype.setAbsolutePosition=function(b){if(!b)return this;
if(void 0===b.x){if(3>arguments.length)return this;var a=arguments[0];var c=arguments[1];var d=arguments[2]}else a=b.x,c=b.y,d=b.z;if(this.parent){var g=f.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(g);f.e.TransformCoordinatesFromFloatsToRef(a,c,d,g,this.position)}else this.position.x=a,this.position.y=c,this.position.z=d;this._absolutePosition.copyFrom(b);return this};a.prototype.setPositionWithLocalVector=function(b){this.computeWorldMatrix();this.position=f.e.TransformNormal(b,this._localMatrix);
return this};a.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var b=f.c.Matrix[0];this._localMatrix.invertToRef(b);return f.e.TransformNormal(this.position,b)};a.prototype.locallyTranslate=function(b){this.computeWorldMatrix(!0);this.position=f.e.TransformCoordinates(b,this._localMatrix);return this};a.prototype.lookAt=function(b,e,c,d,g){void 0===e&&(e=0);void 0===c&&(c=0);void 0===d&&(d=0);void 0===g&&(g=w.c.LOCAL);var l=a._lookAtVectorCache,r=g===w.c.LOCAL?this.position:
this.getAbsolutePosition();b.subtractToRef(r,l);this.setDirection(l,e,c,d);g===w.c.WORLD&&this.parent&&(this.rotationQuaternion?(b=f.c.Matrix[0],this.rotationQuaternion.toRotationMatrix(b),e=f.c.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.invert(),b.multiplyToRef(e,b),this.rotationQuaternion.fromRotationMatrix(b)):(c=f.c.Quaternion[0],f.b.FromEulerVectorToRef(this.rotation,c),b=f.c.Matrix[0],c.toRotationMatrix(b),e=f.c.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(e),
e.invert(),b.multiplyToRef(e,b),c.fromRotationMatrix(b),c.toEulerAnglesToRef(this.rotation)));return this};a.prototype.getDirection=function(b){var a=f.e.Zero();this.getDirectionToRef(b,a);return a};a.prototype.getDirectionToRef=function(b,a){f.e.TransformNormalToRef(b,this.getWorldMatrix(),a);return this};a.prototype.setDirection=function(b,a,c,d){void 0===a&&(a=0);void 0===c&&(c=0);void 0===d&&(d=0);var e=-Math.atan2(b.z,b.x)+Math.PI/2;b=-Math.atan2(b.y,Math.sqrt(b.x*b.x+b.z*b.z));this.rotationQuaternion?
f.b.RotationYawPitchRollToRef(e+a,b+c,d,this.rotationQuaternion):(this.rotation.x=b+c,this.rotation.y=e+a,this.rotation.z=d);return this};a.prototype.setPivotPoint=function(b,a){void 0===a&&(a=w.c.LOCAL);0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var c=this.getWorldMatrix();a==w.c.WORLD&&(a=f.c.Matrix[0],c.invertToRef(a),b=f.e.TransformCoordinates(b,a));return this.setPivotMatrix(f.a.Translation(-b.x,-b.y,-b.z),!0)};a.prototype.getPivotPoint=function(){var b=f.e.Zero();this.getPivotPointToRef(b);
return b};a.prototype.getPivotPointToRef=function(b){b.x=-this._pivotMatrix.m[12];b.y=-this._pivotMatrix.m[13];b.z=-this._pivotMatrix.m[14];return this};a.prototype.getAbsolutePivotPoint=function(){var b=f.e.Zero();this.getAbsolutePivotPointToRef(b);return b};a.prototype.getAbsolutePivotPointToRef=function(b){this.getPivotPointToRef(b);f.e.TransformCoordinatesToRef(b,this.getWorldMatrix(),b);return this};a.prototype.setParent=function(b){if(!b&&!this.parent)return this;var a=f.c.Quaternion[0],c=f.c.Vector3[0],
d=f.c.Vector3[1];if(b){var g=f.c.Matrix[0],k=f.c.Matrix[1];this.computeWorldMatrix(!0);b.computeWorldMatrix(!0);b.getWorldMatrix().invertToRef(k);this.getWorldMatrix().multiplyToRef(k,g);g.decompose(d,a,c)}else this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(d,a,c);this.rotationQuaternion?this.rotationQuaternion.copyFrom(a):a.toEulerAnglesToRef(this.rotation);this.scaling.copyFrom(d);this.position.copyFrom(c);this.parent=b;return this};Object.defineProperty(a.prototype,"nonUniformScaling",
{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0});a.prototype._updateNonUniformScalingState=function(b){if(this._nonUniformScaling===b)return!1;this._nonUniformScaling=b;return!0};a.prototype.attachToBone=function(b,a){this._transformToBoneReferal=a;this.parent=b;b.getSkeleton().prepare();0>b.getWorldMatrix().determinant()&&(this.scalingDeterminant*=-1);return this};a.prototype.detachFromBone=function(){if(!this.parent)return this;0>this.parent.getWorldMatrix().determinant()&&
(this.scalingDeterminant*=-1);this.parent=this._transformToBoneReferal=null;return this};a.prototype.rotate=function(b,e,c){b.normalize();this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0));c&&c!==w.c.LOCAL?(this.parent&&(c=f.c.Matrix[0],this.parent.getWorldMatrix().invertToRef(c),b=f.e.TransformNormal(b,c)),b=f.b.RotationAxisToRef(b,e,a._rotationAxisCache),b.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)):(b=f.b.RotationAxisToRef(b,
e,a._rotationAxisCache),this.rotationQuaternion.multiplyToRef(b,this.rotationQuaternion));return this};a.prototype.rotateAround=function(b,a,c){a.normalize();this.rotationQuaternion||(this.rotationQuaternion=f.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var e=f.c.Vector3[0],d=f.c.Vector3[1],g=f.c.Vector3[2],r=f.c.Quaternion[0],q=f.c.Matrix[0],p=f.c.Matrix[1],x=f.c.Matrix[2],m=f.c.Matrix[3];b.subtractToRef(this.position,e);f.a.TranslationToRef(e.x,
e.y,e.z,q);f.a.TranslationToRef(-e.x,-e.y,-e.z,p);f.a.RotationAxisToRef(a,c,x);p.multiplyToRef(x,m);m.multiplyToRef(q,m);m.decompose(d,r,g);this.position.addInPlace(g);r.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion);return this};a.prototype.translate=function(b,a,c){b=b.scale(a);c&&c!==w.c.LOCAL?this.setAbsolutePosition(this.getAbsolutePosition().add(b)):(c=this.getPositionExpressedInLocalSpace().add(b),this.setPositionWithLocalVector(c));return this};a.prototype.addRotation=function(b,
a,c){if(this.rotationQuaternion)var e=this.rotationQuaternion;else e=f.c.Quaternion[1],f.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,e);var d=f.c.Quaternion[0];f.b.RotationYawPitchRollToRef(a,b,c,d);e.multiplyInPlace(d);this.rotationQuaternion||e.toEulerAnglesToRef(this.rotation);return this};a.prototype._getEffectiveParent=function(){return this.parent};a.prototype.computeWorldMatrix=function(b){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;
var e=this.getScene().getRenderId();if(!this._isDirty&&!b&&this.isSynchronized())return this._currentRenderId=e,this._worldMatrix;var c=this.getScene().activeCamera,d=0!==(this._billboardMode&a.BILLBOARDMODE_USE_POSITION),g=this._billboardMode!==a.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;g&&c&&d&&(this.lookAt(c.position),(this.billboardMode&a.BILLBOARDMODE_X)!==a.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&a.BILLBOARDMODE_Y)!==a.BILLBOARDMODE_Y&&(this.rotation.y=0),
(this.billboardMode&a.BILLBOARDMODE_Z)!==a.BILLBOARDMODE_Z&&(this.rotation.z=0));this._updateCache();var k=this._cache;k.pivotMatrixUpdated=!1;k.billboardMode=this.billboardMode;k.infiniteDistance=this.infiniteDistance;this._currentRenderId=e;this._childUpdateId++;this._isDirty=!1;this._position._isDirty=!1;this._rotation._isDirty=!1;this._scaling._isDirty=!1;e=this._getEffectiveParent();k=a._TmpScaling;var r=this._position;if(this._infiniteDistance&&!this.parent&&c){r=c.getWorldMatrix();var q=new f.e(r.m[12],
r.m[13],r.m[14]);r=a._TmpTranslation;r.copyFromFloats(this._position.x+q.x,this._position.y+q.y,this._position.z+q.z)}k.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,q=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(f.b.RotationYawPitchRoll(this._rotation.y,
this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(q=a._TmpRotation,f.b.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,q));if(this._usePivotMatrix){var p=f.c.Matrix[1];f.a.ScalingToRef(k.x,k.y,k.z,p);k=f.c.Matrix[0];q.toRotationMatrix(k);this._pivotMatrix.multiplyToRef(p,f.c.Matrix[4]);f.c.Matrix[4].multiplyToRef(k,this._localMatrix);this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix);this._localMatrix.addTranslationFromFloats(r.x,
r.y,r.z)}else f.a.ComposeToRef(k,q,r,this._localMatrix);e&&e.getWorldMatrix?(b&&e.computeWorldMatrix(),g?(this._transformToBoneReferal?e.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),f.c.Matrix[7]):f.c.Matrix[7].copyFrom(e.getWorldMatrix()),b=f.c.Vector3[5],k=f.c.Vector3[6],f.c.Matrix[7].decompose(k,void 0,b),f.a.ScalingToRef(k.x,k.y,k.z,f.c.Matrix[7]),f.c.Matrix[7].setTranslation(b),this._localMatrix.multiplyToRef(f.c.Matrix[7],this._worldMatrix)):this._transformToBoneReferal?
(this._localMatrix.multiplyToRef(e.getWorldMatrix(),f.c.Matrix[6]),f.c.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(e.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()):this._worldMatrix.copyFrom(this._localMatrix);g&&c&&this.billboardMode&&!d&&(this._worldMatrix.getTranslationToRef(f.c.Vector3[0]),f.c.Matrix[1].copyFrom(c.getViewMatrix()),f.c.Matrix[1].setTranslationFromFloats(0,0,0),f.c.Matrix[1].invertToRef(f.c.Matrix[0]),
(this.billboardMode&a.BILLBOARDMODE_ALL)!==a.BILLBOARDMODE_ALL&&(f.c.Matrix[0].decompose(void 0,f.c.Quaternion[0],void 0),c=f.c.Vector3[1],f.c.Quaternion[0].toEulerAnglesToRef(c),(this.billboardMode&a.BILLBOARDMODE_X)!==a.BILLBOARDMODE_X&&(c.x=0),(this.billboardMode&a.BILLBOARDMODE_Y)!==a.BILLBOARDMODE_Y&&(c.y=0),(this.billboardMode&a.BILLBOARDMODE_Z)!==a.BILLBOARDMODE_Z&&(c.z=0),f.a.RotationYawPitchRollToRef(c.y,c.x,c.z,f.c.Matrix[0])),this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(f.c.Matrix[0],
this._worldMatrix),this._worldMatrix.setTranslation(f.c.Vector3[0]));this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1E-6)?this._updateNonUniformScalingState(!0):e&&e._nonUniformScaling?this._updateNonUniformScalingState(e._nonUniformScaling):this._updateNonUniformScalingState(!1);this._afterComputeWorldMatrix();this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);this._isAbsoluteSynced=
!1;this.onAfterWorldMatrixUpdateObservable.notifyObservers(this);this._poseMatrix||(this._poseMatrix=f.a.Invert(this._worldMatrix));this._worldMatrixDeterminantIsDirty=!0;return this._worldMatrix};a.prototype.resetLocalMatrix=function(b){void 0===b&&(b=!0);this.computeWorldMatrix();if(b){b=this.getChildren();for(var a=0;a<b.length;++a){var c=b[a];if(c){c.computeWorldMatrix();var d=f.c.Matrix[0];c._localMatrix.multiplyToRef(this._localMatrix,d);var g=f.c.Quaternion[0];d.decompose(c.scaling,g,c.position);
c.rotationQuaternion?c.rotationQuaternion=g:g.toEulerAnglesToRef(c.rotation)}}}this.scaling.copyFromFloats(1,1,1);this.position.copyFromFloats(0,0,0);this.rotation.copyFromFloats(0,0,0);this.rotationQuaternion&&(this.rotationQuaternion=f.b.Identity());this._worldMatrix=f.a.Identity()};a.prototype._afterComputeWorldMatrix=function(){};a.prototype.registerAfterWorldMatrixUpdate=function(b){this.onAfterWorldMatrixUpdateObservable.add(b);return this};a.prototype.unregisterAfterWorldMatrixUpdate=function(b){this.onAfterWorldMatrixUpdateObservable.removeCallback(b);
return this};a.prototype.getPositionInCameraSpace=function(b){void 0===b&&(b=null);b||(b=this.getScene().activeCamera);return f.e.TransformCoordinates(this.getAbsolutePosition(),b.getViewMatrix())};a.prototype.getDistanceToCamera=function(b){void 0===b&&(b=null);b||(b=this.getScene().activeCamera);return this.getAbsolutePosition().subtract(b.globalPosition).length()};a.prototype.clone=function(b,e,c){var d=this,f=g.a.Clone(function(){return new a(b,d.getScene())},this);f.name=b;f.id=b;e&&(f.parent=
e);if(!c)for(e=this.getDescendants(!0),c=0;c<e.length;c++){var k=e[c];k.clone&&k.clone(b+"."+k.name,f)}return f};a.prototype.serialize=function(b){b=g.a.Serialize(this,b);b.type=this.getClassName();this.parent&&(b.parentId=this.parent.id);b.localMatrix=this.getPivotMatrix().asArray();b.isEnabled=this.isEnabled();this.parent&&(b.parentId=this.parent.id);return b};a.Parse=function(b,e,c){c=g.a.Parse(function(){return new a(b.name,e)},b,e,c);b.localMatrix?c.setPreTransformMatrix(f.a.FromArray(b.localMatrix)):
b.pivotMatrix&&c.setPivotMatrix(f.a.FromArray(b.pivotMatrix));c.setEnabled(b.isEnabled);b.parentId&&(c._waitingParentId=b.parentId);return c};a.prototype.getChildTransformNodes=function(b,e){var c=[];this._getDescendants(c,b,function(b){return(!e||e(b))&&b instanceof a});return c};a.prototype.dispose=function(b,a){void 0===a&&(a=!1);this.getScene().stopAnimation(this);this.getScene().removeTransformNode(this);this.onAfterWorldMatrixUpdateObservable.clear();if(b)for(var c=0,e=this.getChildTransformNodes(!0);c<
e.length;c++){var f=e[c];f.parent=null;f.computeWorldMatrix(!0)}d.prototype.dispose.call(this,b,a)};a.prototype.normalizeToUnitCube=function(b,a,c){void 0===b&&(b=!0);void 0===a&&(a=!1);var e=null,d=null;a&&(this.rotationQuaternion?(d=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(e=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));b=this.getHierarchyBoundingVectors(b,c);b=b.max.subtract(b.min);b=Math.max(b.x,b.y,b.z);if(0===b)return this;
this.scaling.scaleInPlace(1/b);a&&(this.rotationQuaternion&&d?this.rotationQuaternion.copyFrom(d):this.rotation&&e&&this.rotation.copyFrom(e));return this};a.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)};a.BILLBOARDMODE_NONE=0;a.BILLBOARDMODE_X=1;a.BILLBOARDMODE_Y=2;a.BILLBOARDMODE_Z=4;a.BILLBOARDMODE_ALL=7;a.BILLBOARDMODE_USE_POSITION=128;a._TmpRotation=
f.b.Zero();a._TmpScaling=f.e.Zero();a._TmpTranslation=f.e.Zero();a._lookAtVectorCache=new f.e(0,0,0);a._rotationAxisCache=new f.b;Object(y.c)([Object(g.o)("position")],a.prototype,"_position",void 0);Object(y.c)([Object(g.o)("rotation")],a.prototype,"_rotation",void 0);Object(y.c)([Object(g.l)("rotationQuaternion")],a.prototype,"_rotationQuaternion",void 0);Object(y.c)([Object(g.o)("scaling")],a.prototype,"_scaling",void 0);Object(y.c)([Object(g.c)("billboardMode")],a.prototype,"_billboardMode",void 0);
Object(y.c)([Object(g.c)()],a.prototype,"scalingDeterminant",void 0);Object(y.c)([Object(g.c)("infiniteDistance")],a.prototype,"_infiniteDistance",void 0);Object(y.c)([Object(g.c)()],a.prototype,"ignoreNonUniformScaling",void 0);Object(y.c)([Object(g.c)()],a.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0);return a}(B.a)},wAMR:function(B,F,d){d.d(F,"b",function(){return X});d.d(F,"a",function(){return N});var y=d("oYeq"),g=d("ps+7"),m=d("YKqZ"),f=d("Dc3z"),w=d("cSa5"),p=d("/SR9"),J=d("Xeau"),
a=d("Ufda"),b=d("y4Ty"),e=d("UtUh"),c=d("yk6c");B=d("ikaq");var l=d("C1Wc"),v=d("T5H4"),k=d("cdI9"),r=d("jI0L"),q=d("mzcJ"),C=d("ADVu"),x=d("uyO6"),A=d("WHS4"),u=d("n5HA"),D=d("Yap0"),W=d("I2E9"),K=d("O3Sr"),X=function(){return function(){}}(),Y=function(){return function(){this.visibleInstances={};this.batchCache=new O;this.instancesBufferSize=2048}}(),O=function(){return function(){this.mustReturn=!1;this.visibleInstances=[];this.renderSelf=[];this.hardwareInstancedRendering=[]}}(),R=function(){return function(){this.instancesCount=
0;this.matrixBuffer=null;this.matrixBufferSize=512;this.boundingVectors=[];this.worldMatrices=null}}(),S=function(){return function(){this._areNormalsFrozen=!1;this.meshMap=this._source=null;this._preActivateId=-1;this._LODLevels=[];this._morphTargetManager=null}}(),N=function(d){function h(a,b,c,e,g,H){void 0===b&&(b=null);void 0===c&&(c=null);void 0===e&&(e=null);void 0===H&&(H=!0);var n=d.call(this,a,b)||this;n._internalMeshDataInfo=new S;n.delayLoadState=0;n.instances=[];n._creationDataStorage=
null;n._geometry=null;n._instanceDataStorage=new Y;n._thinInstanceDataStorage=new R;n._effectiveMaterial=null;n._shouldGenerateFlatShading=!1;n._originalBuilderSideOrientation=h.DEFAULTSIDE;n.overrideMaterialSideOrientation=null;b=n.getScene();if(e){e._geometry&&e._geometry.applyToMesh(n);f.a.DeepCopy(e,n,"name material skeleton instances parent uniqueId source metadata morphTargetManager hasInstances source worldMatrixInstancedBuffer hasLODLevels geometry isBlocked areNormalsFrozen facetNb isFacetDataEnabled lightSources useBones isAnInstance collider edgesRenderer forward up right absolutePosition absoluteScaling absoluteRotationQuaternion isWorldMatrixFrozen nonUniformScaling behaviors worldMatrixFromCache hasThinInstances cloneMeshMap".split(" "),
["_poseMatrix"]);n._internalMeshDataInfo._source=e;b.useClonedMeshMap&&(e._internalMeshDataInfo.meshMap||(e._internalMeshDataInfo.meshMap={}),e._internalMeshDataInfo.meshMap[n.uniqueId]=n);n._originalBuilderSideOrientation=e._originalBuilderSideOrientation;n._creationDataStorage=e._creationDataStorage;if(e._ranges){var z=e._ranges;for(a in z)z.hasOwnProperty(a)&&z[a]&&n.createAnimationRange(a,z[a].from,z[a].to)}n.metadata=e.metadata&&e.metadata.clone?e.metadata.clone():e.metadata;w.a&&w.a.HasTags(e)&&
w.a.AddTagsTo(n,w.a.GetTags(e,!0));n.setEnabled(e.isEnabled());n.parent=e.parent;n.setPivotMatrix(e.getPivotMatrix());n.id=a+"."+e.id;n.material=e.material;if(!g)for(g=e.getDescendants(!0),z=0;z<g.length;z++){var G=g[z];G.clone&&G.clone(a+"."+G.name,n)}e.morphTargetManager&&(n.morphTargetManager=e.morphTargetManager);b.getPhysicsEngine&&(a=b.getPhysicsEngine(),H&&a&&(H=a.getImpostorForPhysicsObject(e)))&&(n.physicsImpostor=H.clone(n));for(H=0;H<b.particleSystems.length;H++)a=b.particleSystems[H],
a.emitter===e&&a.clone(a.name,n);n.refreshBoundingInfo();n.computeWorldMatrix(!0)}null!==c&&(n.parent=c);n._instanceDataStorage.hardwareInstancedRendering=n.getEngine().getCaps().instancedArrays;return n}Object(y.d)(h,d);h._GetDefaultSideOrientation=function(a){return a||h.FRONTSIDE};Object.defineProperty(h.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(a){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==
a&&(a&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(b.b.PositionKind,this._internalMeshDataInfo._sourcePositions.slice(),!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(b.b.NormalKind,this._internalMeshDataInfo._sourceNormals.slice(),!0)),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=a,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"onBeforeRenderObservable",{get:function(){this._internalMeshDataInfo._onBeforeRenderObservable||
(this._internalMeshDataInfo._onBeforeRenderObservable=new g.a);return this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"onBeforeBindObservable",{get:function(){this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new g.a);return this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"onAfterRenderObservable",{get:function(){this._internalMeshDataInfo._onAfterRenderObservable||
(this._internalMeshDataInfo._onAfterRenderObservable=new g.a);return this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"onBeforeDrawObservable",{get:function(){this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new g.a);return this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"onBeforeDraw",{set:function(a){this._onBeforeDrawObserver&&
this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver);this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(a)},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"hasInstances",{get:function(){return 0<this.instances.length},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"hasThinInstances",{get:function(){var a;return 0<(null!==(a=this._thinInstanceDataStorage.instancesCount)&&void 0!==a?a:0)},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,
"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(a){this._internalMeshDataInfo._morphTargetManager!==a&&(this._internalMeshDataInfo._morphTargetManager=a,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},
enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(a){this._unIndexed!==a&&(this._unIndexed=a,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},
set:function(a){this._instanceDataStorage.manualUpdate=a},enumerable:!1,configurable:!0});h.prototype.instantiateHierarchy=function(a,b,c){void 0===a&&(a=null);var n=!(0<this.getTotalVertices())||b&&b.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),a||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));n&&(n.parent=a||this.parent,n.position=this.position.clone(),n.scaling=this.scaling.clone(),this.rotationQuaternion?n.rotationQuaternion=this.rotationQuaternion.clone():
n.rotation=this.rotation.clone(),c&&c(this,n));a=0;for(var e=this.getChildTransformNodes(!0);a<e.length;a++)e[a].instantiateHierarchy(n,b,c);return n};h.prototype.getClassName=function(){return"Mesh"};Object.defineProperty(h.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0});h.prototype.toString=function(a){var n=d.prototype.toString.call(this,a);n+=", n vertices: "+this.getTotalVertices();n+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:
"NONE");if(this.animations)for(var c=0;c<this.animations.length;c++)n+=", animation[0]: "+this.animations[c].toString(a);a&&(this._geometry?(a=this.getIndices(),(c=this.getVerticesData(b.b.PositionKind))&&a&&(n+=", flat shading: "+(c.length/3===a.length?"YES":"NO"))):n+=", flat shading: UNKNOWN");return n};h.prototype._unBindEffect=function(){d.prototype._unBindEffect.call(this);for(var a=0,b=this.instances;a<b.length;a++)b[a]._unBindEffect()};Object.defineProperty(h.prototype,"hasLODLevels",{get:function(){return 0<
this._internalMeshDataInfo._LODLevels.length},enumerable:!1,configurable:!0});h.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels};h.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(a,b){return a.distance<b.distance?1:a.distance>b.distance?-1:0})};h.prototype.addLODLevel=function(a,b){if(b&&b._masterMesh)return x.a.Warn("You cannot use a mesh as LOD level twice"),this;a=new W.a(a,b);this._internalMeshDataInfo._LODLevels.push(a);b&&
(b._masterMesh=this);this._sortLODLevels();return this};h.prototype.getLODLevelAtDistance=function(a){for(var b=this._internalMeshDataInfo,n=0;n<b._LODLevels.length;n++){var c=b._LODLevels[n];if(c.distance===a)return c.mesh}return null};h.prototype.removeLODLevel=function(a){for(var b=this._internalMeshDataInfo,n=0;n<b._LODLevels.length;n++)b._LODLevels[n].mesh===a&&(b._LODLevels.splice(n,1),a&&(a._masterMesh=null));this._sortLODLevels();return this};h.prototype.getLOD=function(a,b){var n=this._internalMeshDataInfo;
if(!n._LODLevels||0===n._LODLevels.length)return this;a=(b?b:this.getBoundingInfo().boundingSphere).centerWorld.subtract(a.globalPosition).length();if(n._LODLevels[n._LODLevels.length-1].distance>a){if(this.onLODLevelSelection)this.onLODLevelSelection(a,this,this);return this}for(b=0;b<n._LODLevels.length;b++){var c=n._LODLevels[b];if(c.distance<a){if(c.mesh){if(4===c.mesh.delayLoadState)return c.mesh._checkDelayState(),this;if(2===c.mesh.delayLoadState)return this;c.mesh._preActivate();c.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}if(this.onLODLevelSelection)this.onLODLevelSelection(a,
this,c.mesh);return c.mesh}}if(this.onLODLevelSelection)this.onLODLevelSelection(a,this,this);return this};Object.defineProperty(h.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0});h.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()};h.prototype.getVerticesData=function(a,b,c){return this._geometry?this._geometry.getVerticesData(a,b,c):null};h.prototype.getVertexBuffer=function(a){return this._geometry?
this._geometry.getVertexBuffer(a):null};h.prototype.isVerticesDataPresent=function(a){return this._geometry?this._geometry.isVerticesDataPresent(a):this._delayInfo?-1!==this._delayInfo.indexOf(a):!1};h.prototype.isVertexBufferUpdatable=function(a){return this._geometry?this._geometry.isVertexBufferUpdatable(a):this._delayInfo?-1!==this._delayInfo.indexOf(a):!1};h.prototype.getVerticesDataKinds=function(){if(!this._geometry){var a=[];this._delayInfo&&this._delayInfo.forEach(function(b){a.push(b)});
return a}return this._geometry.getVerticesDataKinds()};h.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0};h.prototype.getIndices=function(a,b){return this._geometry?this._geometry.getIndices(a,b):[]};Object.defineProperty(h.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!1,configurable:!0});h.prototype.isReady=function(a,b){var n,c,e,f,z,g;void 0===a&&(a=!1);void 0===b&&(b=!1);if(2===this.delayLoadState||
!d.prototype.isReady.call(this,a))return!1;if(!this.subMeshes||0===this.subMeshes.length||!a)return!0;var h=this.getEngine();a=this.getScene();b=b||h.getCaps().instancedArrays&&(0<this.instances.length||this.hasThinInstances);this.computeWorldMatrix();if(a=this.material||a.defaultMaterial)if(a._storeEffectOnSubMeshes){h=0;for(var r=this.subMeshes;h<r.length;h++){a=r[h];var q=a.getMaterial();if(q)if(q._storeEffectOnSubMeshes){if(!q.isReadyForSubMesh(this,a,b))return!1}else if(!q.isReady(this,b))return!1}}else if(!a.isReady(this,
b))return!1;h=0;for(r=this.lightSources;h<r.length;h++)if((q=r[h].getShadowGenerator())&&(null===(n=q.getShadowMap())||void 0===n||!n.renderList||(null===(c=q.getShadowMap())||void 0===c?0:c.renderList)&&-1!==(null===(f=null===(e=q.getShadowMap())||void 0===e?void 0:e.renderList)||void 0===f?void 0:f.indexOf(this))))for(var l=0,x=this.subMeshes;l<x.length;l++)if(a=x[l],!q.isReady(a,b,null!==(g=null===(z=a.getMaterial())||void 0===z?void 0:z.needAlphaBlendingForMesh(this))&&void 0!==g?g:!1))return!1;
n=0;for(c=this._internalMeshDataInfo._LODLevels;n<c.length;n++)if(e=c[n],e.mesh&&!e.mesh.isReady(b))return!1;return!0};Object.defineProperty(h.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0});h.prototype.freezeNormals=function(){this._internalMeshDataInfo._areNormalsFrozen=!0;return this};h.prototype.unfreezeNormals=function(){this._internalMeshDataInfo._areNormalsFrozen=!1;return this};Object.defineProperty(h.prototype,
"overridenInstanceCount",{set:function(a){this._instanceDataStorage.overridenInstanceCount=a},enumerable:!1,configurable:!0});h.prototype._preActivate=function(){var a=this._internalMeshDataInfo,b=this.getScene().getRenderId();if(a._preActivateId===b)return this;a._preActivateId=b;this._instanceDataStorage.visibleInstances=null;return this};h.prototype._preActivateForIntermediateRendering=function(a){this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=
a);return this};h.prototype._registerInstanceForRenderId=function(a,b){this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:b,selfDefaultRenderId:this._renderId});this._instanceDataStorage.visibleInstances[b]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=b,this._instanceDataStorage.visibleInstances[b]=
[]);this._instanceDataStorage.visibleInstances[b].push(a);return this};h.prototype._afterComputeWorldMatrix=function(){d.prototype._afterComputeWorldMatrix.call(this);this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))};h.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))};
h.prototype.refreshBoundingInfo=function(a){void 0===a&&(a=!1);if(this._boundingInfo&&this._boundingInfo.isLocked)return this;var b=this.geometry?this.geometry.boundingBias:null;this._refreshBoundingInfo(this._getPositionData(a),b);return this};h.prototype._createGlobalSubMesh=function(a){var b=this.getTotalVertices();if(!b||!this.getIndices())return null;if(this.subMeshes&&0<this.subMeshes.length){var c=this.getIndices();if(!c)return null;c=c.length;var n=!1;if(a)n=!0;else{a=0;for(var e=this.subMeshes;a<
e.length;a++){var d=e[a];if(d.indexStart+d.indexCount>c){n=!0;break}if(d.verticesStart+d.verticesCount>b){n=!0;break}}}if(!n)return this.subMeshes[0]}this.releaseSubMeshes();return new l.a(0,0,b,0,this.getTotalIndices(),this)};h.prototype.subdivide=function(a){if(!(1>a)){for(var b=this.getTotalIndices(),c=b/a|0,n=0;0!==c%3;)c++;this.releaseSubMeshes();for(var e=0;e<a&&!(n>=b);e++)l.a.CreateFromIndices(0,n,e===a-1?b-n:c,this),n+=c;this.synchronizeInstances()}};h.prototype.setVerticesData=function(a,
b,d,f){void 0===d&&(d=!1);this._geometry?this._geometry.setVerticesData(a,b,d,f):(f=new e.a,f.set(b,a),a=this.getScene(),new c.a(c.a.RandomId(),a,f,d,this));return this};h.prototype.removeVerticesData=function(a){this._geometry&&this._geometry.removeVerticesData(a)};h.prototype.markVerticesDataAsUpdatable=function(a,b){void 0===b&&(b=!0);var c=this.getVertexBuffer(a);c&&c.isUpdatable()!==b&&this.setVerticesData(a,this.getVerticesData(a),b)};h.prototype.setVerticesBuffer=function(a){this._geometry||
(this._geometry=c.a.CreateGeometryForMesh(this));this._geometry.setVerticesBuffer(a);return this};h.prototype.updateVerticesData=function(a,b,c,e){if(!this._geometry)return this;e?(this.makeGeometryUnique(),this.updateVerticesData(a,b,c,!1)):this._geometry.updateVerticesData(a,b,c);return this};h.prototype.updateMeshPositions=function(a,c){void 0===c&&(c=!0);var n=this.getVerticesData(b.b.PositionKind);if(!n)return this;a(n);this.updateVerticesData(b.b.PositionKind,n,!1,!1);if(c){a=this.getIndices();
c=this.getVerticesData(b.b.NormalKind);if(!c)return this;e.a.ComputeNormals(n,a,c);this.updateVerticesData(b.b.NormalKind,c,!1,!1)}return this};h.prototype.makeGeometryUnique=function(){if(!this._geometry||1===this._geometry.meshes.length)return this;var a=this._geometry,b=this._geometry.copy(c.a.RandomId());a.releaseForMesh(this,!0);b.applyToMesh(this);return this};h.prototype.setIndices=function(a,b,d){void 0===b&&(b=null);void 0===d&&(d=!1);this._geometry?this._geometry.setIndices(a,b,d):(b=new e.a,
b.indices=a,a=this.getScene(),new c.a(c.a.RandomId(),a,b,d,this));return this};h.prototype.updateIndices=function(a,b,c){void 0===c&&(c=!1);if(!this._geometry)return this;this._geometry.updateIndices(a,b,c);return this};h.prototype.toLeftHanded=function(){if(!this._geometry)return this;this._geometry.toLeftHanded();return this};h.prototype._bind=function(a,b,c){if(!this._geometry)return this;var n=this.getScene().getEngine();if(this._unIndexed)a=null;else switch(c){case k.a.PointFillMode:a=null;break;
case k.a.WireFrameFillMode:a=a._getLinesIndexBuffer(this.getIndices(),n);break;default:case k.a.TriangleFillMode:a=this._geometry.getIndexBuffer()}this._geometry._bind(b,a);return this};h.prototype._draw=function(a,b,c){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var n=this.getScene().getEngine();this._unIndexed||
b==k.a.PointFillMode?n.drawArraysType(b,a.verticesStart,a.verticesCount,c):b==k.a.WireFrameFillMode?n.drawElementsType(b,0,a._linesIndexCount,c):n.drawElementsType(b,a.indexStart,a.indexCount,c);return this};h.prototype.registerBeforeRender=function(a){this.onBeforeRenderObservable.add(a);return this};h.prototype.unregisterBeforeRender=function(a){this.onBeforeRenderObservable.removeCallback(a);return this};h.prototype.registerAfterRender=function(a){this.onAfterRenderObservable.add(a);return this};
h.prototype.unregisterAfterRender=function(a){this.onAfterRenderObservable.removeCallback(a);return this};h.prototype._getInstancesRenderList=function(a,b){void 0===b&&(b=!1);if(this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var c=this.getScene(),n=c._isInIntermediateRendering(),e=n?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,d=this._instanceDataStorage.batchCache;
d.mustReturn=!1;d.renderSelf[a]=b||!e&&this.isEnabled()&&this.isVisible;d.visibleInstances[a]=null;this._instanceDataStorage.visibleInstances&&!b&&(e=this._instanceDataStorage.visibleInstances,c=c.getRenderId(),n=n?e.intermediateDefaultRenderId:e.defaultRenderId,d.visibleInstances[a]=e[c],!d.visibleInstances[a]&&n&&(d.visibleInstances[a]=e[n]));d.hardwareInstancedRendering[a]=!b&&this._instanceDataStorage.hardwareInstancedRendering&&null!==d.visibleInstances[a]&&void 0!==d.visibleInstances[a];return this._instanceDataStorage.previousBatch=
d};h.prototype._renderWithInstances=function(a,c,e,d,f){var n=e.visibleInstances[a._id];if(!n)return this;for(var z=this._instanceDataStorage,g=z.instancesBufferSize,G=z.instancesBuffer,I=64*(n.length+1);z.instancesBufferSize<I;)z.instancesBufferSize*=2;z.instancesData&&g==z.instancesBufferSize||(z.instancesData=new Float32Array(z.instancesBufferSize/4));var h=I=0;e=e.renderSelf[a._id];g=!G||g!==z.instancesBufferSize;if(this._instanceDataStorage.manualUpdate||z.isFrozen&&!g)h=(e?1:0)+n.length;else{var E=
this._effectiveMesh.getWorldMatrix();e&&(E.copyToArray(z.instancesData,I),I+=16,h++);if(n)for(E=0;E<n.length;E++)n[E].getWorldMatrix().copyToArray(z.instancesData,I),I+=16,h++}g?(G&&G.dispose(),G=new b.a(f,z.instancesData,!0,16,!1,!0),z.instancesBuffer=G,this.setVerticesBuffer(G.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(G.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(G.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(G.createVertexBuffer("world3",12,4))):this._instanceDataStorage.isFrozen||
G.updateDirectly(z.instancesData,0,h);this._processInstancedBuffers(n,e);this.getScene()._activeIndices.addCount(a.indexCount*h,!1);this._bind(a,d,c);this._draw(a,c,h);f.unbindInstanceAttributes();return this};h.prototype._renderWithThinInstances=function(a,b,c,e){var n,d,f=null!==(d=null===(n=this._thinInstanceDataStorage)||void 0===n?void 0:n.instancesCount)&&void 0!==d?d:0;this.getScene()._activeIndices.addCount(a.indexCount*f,!1);this._bind(a,c,b);this._draw(a,b,f);e.unbindInstanceAttributes()};
h.prototype._processInstancedBuffers=function(a,b){};h.prototype._processRendering=function(a,b,c,e,d,f,g,h){var n=this.getScene(),z=n.getEngine();if(f&&b.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(b,e,c,z),this;if(f)this._renderWithInstances(b,e,d,c,z);else{c=0;d.renderSelf[b._id]&&(g&&g(!1,a._effectiveMesh.getWorldMatrix(),h),c++,this._draw(b,e,this._instanceDataStorage.overridenInstanceCount));if(a=d.visibleInstances[b._id])for(d=a.length,c+=d,f=0;f<d;f++)z=a[f].getWorldMatrix(),
g&&g(!0,z,h),this._draw(b,e);n._activeIndices.addCount(b.indexCount*c,!1)}return this};h.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);d.prototype._rebuild.call(this)};h.prototype._freeze=function(){if(this.subMeshes){for(var a=0;a<this.subMeshes.length;a++)this._getInstancesRenderList(a);this._effectiveMaterial=null;this._instanceDataStorage.isFrozen=!0}};h.prototype._unFreeze=
function(){this._instanceDataStorage.isFrozen=!1;this._instanceDataStorage.previousBatch=null};h.prototype.render=function(a,b,c){var n=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;if(this._checkOcclusionQuery())return this;var e=this._getInstancesRenderList(a._id,!!c);if(e.mustReturn||!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;
this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var d=n.getEngine(),f=e.hardwareInstancedRendering[a._id]||a.getRenderingMesh().hasThinInstances,g=this._instanceDataStorage,z=a.getMaterial();if(!z)return this;if(!g.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==z){if(z._storeEffectOnSubMeshes){if(!z.isReadyForSubMesh(this,a,f))return this}else if(!z.isReady(this,f))return this;this._effectiveMaterial=z}b&&
d.setAlphaMode(this._effectiveMaterial.alphaMode);b=this._effectiveMaterial._storeEffectOnSubMeshes?a.effect:this._effectiveMaterial.getEffect();for(var I=0,h=n._beforeRenderingMeshStage;I<h.length;I++)z=h[I],z.action(this,a,e,b);if(!b)return this;c=c||this._effectiveMesh;g.isFrozen||!this._effectiveMaterial.backFaceCulling&&null===this.overrideMaterialSideOrientation?z=g.sideOrientation:(I=c._getWorldMatrixDeterminant(),z=this.overrideMaterialSideOrientation,null==z&&(z=this._effectiveMaterial.sideOrientation),
0>I&&(z=z===k.a.ClockWiseSideOrientation?k.a.CounterClockWiseSideOrientation:k.a.ClockWiseSideOrientation),g.sideOrientation=z);g=this._effectiveMaterial._preBind(b,z);this._effectiveMaterial.forceDepthWrite&&d.setDepthWrite(!0);z=n.forcePointsCloud?k.a.PointFillMode:n.forceWireframe?k.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this);f||this._bind(a,b,z);c=c.getWorldMatrix();
this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(c,this,a):this._effectiveMaterial.bind(c,this);!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(d.setState(!0,this._effectiveMaterial.zOffset,!1,!g),this._processRendering(this,a,b,z,e,f,this._onBeforeDraw,this._effectiveMaterial),d.setState(!0,this._effectiveMaterial.zOffset,!1,g));this._processRendering(this,a,b,z,e,f,this._onBeforeDraw,this._effectiveMaterial);this._effectiveMaterial.unbind();
d=0;for(n=n._afterRenderingMeshStage;d<n.length;d++)z=n[d],z.action(this,a,e,b);this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this);return this};h.prototype._onBeforeDraw=function(a,b,c){a&&c&&c.bindOnlyWorldMatrix(b)};h.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(b.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(b.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())};
h.prototype.normalizeSkinFourWeights=function(){for(var a=this.getVerticesData(b.b.MatricesWeightsKind),c=a.length,e=0;e<c;e+=4){var d=a[e]+a[e+1]+a[e+2]+a[e+3];0===d?a[e]=1:(d=1/d,a[e]*=d,a[e+1]*=d,a[e+2]*=d,a[e+3]*=d)}this.setVerticesData(b.b.MatricesWeightsKind,a)};h.prototype.normalizeSkinWeightsAndExtra=function(){for(var a=this.getVerticesData(b.b.MatricesWeightsExtraKind),c=this.getVerticesData(b.b.MatricesWeightsKind),e=c.length,d=0;d<e;d+=4){var f=c[d]+c[d+1]+c[d+2]+c[d+3];f+=a[d]+a[d+1]+
a[d+2]+a[d+3];0===f?c[d]=1:(f=1/f,c[d]*=f,c[d+1]*=f,c[d+2]*=f,c[d+3]*=f,a[d]*=f,a[d+1]*=f,a[d+2]*=f,a[d+3]*=f)}this.setVerticesData(b.b.MatricesWeightsKind,c);this.setVerticesData(b.b.MatricesWeightsKind,a)};h.prototype.validateSkinning=function(){var a=this.getVerticesData(b.b.MatricesWeightsExtraKind),c=this.getVerticesData(b.b.MatricesWeightsKind);if(null===c||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var e=c.length,d=0,f=0,g=0,h=0,r=null===a?4:8,q=[],l=0;l<=r;l++)q[l]=
0;for(l=0;l<e;l+=4){for(var x=c[l],k=x,p=0===k?0:1,m=1;m<r;m++){var t=4>m?c[l+m]:a[l+m-4];t>x&&d++;0!==t&&p++;k+=t;x=t}q[p]++;p>g&&(g=p);if(0===k)f++;else{x=1/k;for(m=k=0;m<r;m++)k=4>m?k+Math.abs(c[l+m]-c[l+m]*x):k+Math.abs(a[l+m-4]-a[l+m-4]*x);.001<k&&h++}}a=this.skeleton.bones.length;c=this.getVerticesData(b.b.MatricesIndicesKind);x=this.getVerticesData(b.b.MatricesIndicesExtraKind);for(l=k=0;l<e;l+=4)for(m=0;m<r;m++)p=4>m?c[l+m]:x[l+m-4],(p>=a||0>p)&&k++;return{skinned:!0,valid:0===f&&0===h&&0===
k,report:"Number of Weights = "+e/4+"\nMaximum influences = "+g+"\nMissing Weights = "+f+"\nNot Sorted = "+d+"\nNot Normalized = "+h+"\nWeightCounts = ["+q+"]\nNumber of bones = "+a+"\nBad Bone Indices = "+k}};h.prototype._checkDelayState=function(){var a=this.getScene();this._geometry?this._geometry.load(a):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(a));return this};h.prototype._queueLoad=function(a){var b=this;a._addPendingData(this);var c=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");
m.b.LoadFile(this.delayLoadingFile,function(c){c instanceof ArrayBuffer?b._delayLoadingFunction(c,b):b._delayLoadingFunction(JSON.parse(c),b);b.instances.forEach(function(a){a.refreshBoundingInfo();a._syncSubMeshes()});b.delayLoadState=1;a._removePendingData(b)},function(){},a.offlineProvider,c);return this};h.prototype.isInFrustum=function(a){if(2===this.delayLoadState||!d.prototype.isInFrustum.call(this,a))return!1;this._checkDelayState();return!0};h.prototype.setMaterialByID=function(a){var b=
this.getScene().materials,c;for(c=b.length-1;-1<c;c--)if(b[c].id===a)return this.material=b[c],this;b=this.getScene().multiMaterials;for(c=b.length-1;-1<c;c--)if(b[c].id===a){this.material=b[c];break}return this};h.prototype.getAnimatables=function(){var a=[];this.material&&a.push(this.material);this.skeleton&&a.push(this.skeleton);return a};h.prototype.bakeTransformIntoVertices=function(a){if(!this.isVerticesDataPresent(b.b.PositionKind))return this;var c=this.subMeshes.splice(0);this._resetPointsArrayCache();
var e=this.getVerticesData(b.b.PositionKind),d=[],n;for(n=0;n<e.length;n+=3)p.e.TransformCoordinates(p.e.FromArray(e,n),a).toArray(d,n);this.setVerticesData(b.b.PositionKind,d,this.getVertexBuffer(b.b.PositionKind).isUpdatable());if(this.isVerticesDataPresent(b.b.NormalKind)){e=this.getVerticesData(b.b.NormalKind);d=[];for(n=0;n<e.length;n+=3)p.e.TransformNormal(p.e.FromArray(e,n),a).normalize().toArray(d,n);this.setVerticesData(b.b.NormalKind,d,this.getVertexBuffer(b.b.NormalKind).isUpdatable())}0>
a.m[0]*a.m[5]*a.m[10]&&this.flipFaces();this.releaseSubMeshes();this.subMeshes=c;return this};h.prototype.bakeCurrentTransformIntoVertices=function(a){void 0===a&&(a=!0);this.bakeTransformIntoVertices(this.computeWorldMatrix(!0));this.resetLocalMatrix(a);return this};Object.defineProperty(h.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0});h.prototype._resetPointsArrayCache=function(){this._geometry&&this._geometry._resetPointsArrayCache();
return this};h.prototype._generatePointsArray=function(){return this._geometry?this._geometry._generatePointsArray():!1};h.prototype.clone=function(a,b,c,e){void 0===a&&(a="");void 0===b&&(b=null);void 0===e&&(e=!0);return new h(a,this.getScene(),b,this,c,e)};h.prototype.dispose=function(a,b){void 0===b&&(b=!1);this.morphTargetManager=null;this._geometry&&this._geometry.releaseForMesh(this,!0);var c=this._internalMeshDataInfo;c._onBeforeDrawObservable&&c._onBeforeDrawObservable.clear();c._onBeforeBindObservable&&
c._onBeforeBindObservable.clear();c._onBeforeRenderObservable&&c._onBeforeRenderObservable.clear();c._onAfterRenderObservable&&c._onAfterRenderObservable.clear();if(this._scene.useClonedMeshMap){if(c.meshMap)for(var e in c.meshMap){var n=c.meshMap[e];n&&(n._internalMeshDataInfo._source=null,c.meshMap[e]=void 0)}c._source&&c._source._internalMeshDataInfo.meshMap&&(c._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{e=0;for(var f=this.getScene().meshes;e<f.length;e++)n=f[e],n._internalMeshDataInfo&&
n._internalMeshDataInfo._source&&n._internalMeshDataInfo._source===this&&(n._internalMeshDataInfo._source=null)}c._source=null;this._disposeInstanceSpecificData();this._disposeThinInstanceSpecificData();d.prototype.dispose.call(this,a,b)};h.prototype._disposeInstanceSpecificData=function(){};h.prototype._disposeThinInstanceSpecificData=function(){};h.prototype.applyDisplacementMap=function(a,b,c,e,d,f,g){var n=this;void 0===g&&(g=!1);var z=this.getScene();m.b.LoadImage(a,function(a){var z=a.width,
G=a.height,h=K.a.CreateCanvas(z,G).getContext("2d");h.drawImage(a,0,0);a=h.getImageData(0,0,z,G).data;n.applyDisplacementMapFromBuffer(a,z,G,b,c,d,f,g);e&&e(n)},function(){},z.offlineProvider);return this};h.prototype.applyDisplacementMapFromBuffer=function(a,c,d,f,g,h,r,q){void 0===q&&(q=!1);if(!this.isVerticesDataPresent(b.b.PositionKind)||!this.isVerticesDataPresent(b.b.NormalKind)||!this.isVerticesDataPresent(b.b.UVKind))return x.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),
this;var n=this.getVerticesData(b.b.PositionKind,!0,!0),z=this.getVerticesData(b.b.NormalKind),G=this.getVerticesData(b.b.UVKind),l=p.e.Zero(),k=p.e.Zero(),I=p.d.Zero();h=h||p.d.Zero();r=r||new p.d(1,1);for(var m=0;m<n.length;m+=3){p.e.FromArrayToRef(n,m,l);p.e.FromArrayToRef(z,m,k);p.d.FromArrayToRef(G,m/3*2,I);var E=4*((Math.abs(I.x*r.x+h.x%1)*(c-1)%c|0)+(Math.abs(I.y*r.y+h.y%1)*(d-1)%d|0)*c);E=a[E]/255*.3+a[E+1]/255*.59+a[E+2]/255*.11;k.normalize();k.scaleInPlace(f+(g-f)*E);l=l.add(k);l.toArray(n,
m)}e.a.ComputeNormals(n,this.getIndices(),z);q?(this.setVerticesData(b.b.PositionKind,n),this.setVerticesData(b.b.NormalKind,z)):(this.updateVerticesData(b.b.PositionKind,n),this.updateVerticesData(b.b.NormalKind,z));return this};h.prototype.convertToFlatShadedMesh=function(){var a=this.getVerticesDataKinds(),c={},e={},d={},f=!1,g;for(g=0;g<a.length;g++){var h=a[g];var r=this.getVertexBuffer(h);h===b.b.NormalKind?(f=r.isUpdatable(),a.splice(g,1),g--):(c[h]=r,e[h]=c[h].getData(),d[h]=[])}r=this.subMeshes.slice(0);
var q=this.getIndices(),x=this.getTotalIndices(),k;for(k=0;k<x;k++){var m=q[k];for(g=0;g<a.length;g++){h=a[g];for(var C=c[h].getStrideSize(),u=0;u<C;u++)d[h].push(e[h][m*C+u])}}e=[];g=d[b.b.PositionKind];for(k=0;k<x;k+=3)for(q[k]=k,q[k+1]=k+1,q[k+2]=k+2,C=p.e.FromArray(g,3*k),h=p.e.FromArray(g,3*(k+1)),m=p.e.FromArray(g,3*(k+2)),C=C.subtract(h),h=m.subtract(h),h=p.e.Normalize(p.e.Cross(C,h)),m=0;3>m;m++)e.push(h.x),e.push(h.y),e.push(h.z);this.setIndices(q);this.setVerticesData(b.b.NormalKind,e,f);
for(g=0;g<a.length;g++)h=a[g],this.setVerticesData(h,d[h],c[h].isUpdatable());this.releaseSubMeshes();for(a=0;a<r.length;a++)c=r[a],l.a.AddToMesh(c.materialIndex,c.indexStart,c.indexCount,c.indexStart,c.indexCount,this);this.synchronizeInstances();return this};h.prototype.convertToUnIndexedMesh=function(){var a=this.getVerticesDataKinds(),b={},c={},e={},d;for(d=0;d<a.length;d++){var f=a[d];var g=this.getVertexBuffer(f);b[f]=g;c[f]=b[f].getData();e[f]=[]}g=this.subMeshes.slice(0);var h=this.getIndices(),
r=this.getTotalIndices(),q;for(q=0;q<r;q++){var k=h[q];for(d=0;d<a.length;d++){f=a[d];for(var x=b[f].getStrideSize(),m=0;m<x;m++)e[f].push(c[f][k*x+m])}}for(q=0;q<r;q+=3)h[q]=q,h[q+1]=q+1,h[q+2]=q+2;this.setIndices(h);for(d=0;d<a.length;d++)f=a[d],this.setVerticesData(f,e[f],b[f].isUpdatable());this.releaseSubMeshes();for(a=0;a<g.length;a++)b=g[a],l.a.AddToMesh(b.materialIndex,b.indexStart,b.indexCount,b.indexStart,b.indexCount,this);this._unIndexed=!0;this.synchronizeInstances();return this};h.prototype.flipFaces=
function(a){void 0===a&&(a=!1);var c=e.a.ExtractFromMesh(this);if(a&&this.isVerticesDataPresent(b.b.NormalKind)&&c.normals)for(a=0;a<c.normals.length;a++)c.normals[a]*=-1;if(c.indices)for(a=0;a<c.indices.length;a+=3){var d=c.indices[a+1];c.indices[a+1]=c.indices[a+2];c.indices[a+2]=d}c.applyToMesh(this,this.isVertexBufferUpdatable(b.b.PositionKind));return this};h.prototype.increaseVertices=function(a){var c=e.a.ExtractFromMesh(this),d=c.uvs,f=c.indices,n=c.positions,g=c.normals;if(f&&n&&g&&d){a+=
1;for(var h=[],q=0;q<a+1;q++)h[q]=[];var r=new p.e(0,0,0),l=new p.e(0,0,0),k=new p.d(0,0),m=[],C=[],u=[],t,v=n.length,y=d.length;for(q=0;q<f.length;q+=3){C[0]=f[q];C[1]=f[q+1];C[2]=f[q+2];for(var D=0;3>D;D++){var A=C[D];var w=C[(D+1)%3];void 0===u[A]&&void 0===u[w]?(u[A]=[],u[w]=[]):(void 0===u[A]&&(u[A]=[]),void 0===u[w]&&(u[w]=[]));if(void 0===u[A][w]&&void 0===u[w][A]){u[A][w]=[];r.x=(n[3*w]-n[3*A])/a;r.y=(n[3*w+1]-n[3*A+1])/a;r.z=(n[3*w+2]-n[3*A+2])/a;l.x=(g[3*w]-g[3*A])/a;l.y=(g[3*w+1]-g[3*A+
1])/a;l.z=(g[3*w+2]-g[3*A+2])/a;k.x=(d[2*w]-d[2*A])/a;k.y=(d[2*w+1]-d[2*A+1])/a;u[A][w].push(A);for(t=1;t<a;t++)u[A][w].push(n.length/3),n[v]=n[3*A]+t*r.x,g[v++]=g[3*A]+t*l.x,n[v]=n[3*A+1]+t*r.y,g[v++]=g[3*A+1]+t*l.y,n[v]=n[3*A+2]+t*r.z,g[v++]=g[3*A+2]+t*l.z,d[y++]=d[2*A]+t*k.x,d[y++]=d[2*A+1]+t*k.y;u[A][w].push(w);u[w][A]=[];t=u[A][w].length;for(var K=0;K<t;K++)u[w][A][K]=u[A][w][t-1-K]}}h[0][0]=f[q];h[1][0]=u[f[q]][f[q+1]][1];h[1][1]=u[f[q]][f[q+2]][1];for(t=2;t<a;t++)for(h[t][0]=u[f[q]][f[q+1]][t],
h[t][t]=u[f[q]][f[q+2]][t],r.x=(n[3*h[t][t]]-n[3*h[t][0]])/t,r.y=(n[3*h[t][t]+1]-n[3*h[t][0]+1])/t,r.z=(n[3*h[t][t]+2]-n[3*h[t][0]+2])/t,l.x=(g[3*h[t][t]]-g[3*h[t][0]])/t,l.y=(g[3*h[t][t]+1]-g[3*h[t][0]+1])/t,l.z=(g[3*h[t][t]+2]-g[3*h[t][0]+2])/t,k.x=(d[2*h[t][t]]-d[2*h[t][0]])/t,k.y=(d[2*h[t][t]+1]-d[2*h[t][0]+1])/t,D=1;D<t;D++)h[t][D]=n.length/3,n[v]=n[3*h[t][0]]+D*r.x,g[v++]=g[3*h[t][0]]+D*l.x,n[v]=n[3*h[t][0]+1]+D*r.y,g[v++]=g[3*h[t][0]+1]+D*l.y,n[v]=n[3*h[t][0]+2]+D*r.z,g[v++]=g[3*h[t][0]+2]+
D*l.z,d[y++]=d[2*h[t][0]]+D*k.x,d[y++]=d[2*h[t][0]+1]+D*k.y;h[a]=u[f[q+1]][f[q+2]];m.push(h[0][0],h[1][0],h[1][1]);for(t=1;t<a;t++){for(D=0;D<t;D++)m.push(h[t][D],h[t+1][D],h[t+1][D+1]),m.push(h[t][D],h[t+1][D+1],h[t][D+1]);m.push(h[t][D],h[t+1][D],h[t+1][D+1])}}c.indices=m;c.applyToMesh(this,this.isVertexBufferUpdatable(b.b.PositionKind))}else x.a.Warn("VertexData contains null entries")};h.prototype.forceSharedVertices=function(){var a=e.a.ExtractFromMesh(this),c=a.uvs,d=a.indices,f=a.positions,
g=a.colors;if(void 0===d||void 0===f||null===d||null===f)x.a.Warn("VertexData contains empty entries");else{for(var h=[],q=[],r=[],l=[],k,m=0,p={},C,u,t=0;t<d.length;t+=3){u=[d[t],d[t+1],d[t+2]];k=[];for(var A=0;3>A;A++){k[A]="";for(var D=0;3>D;D++)1E-8>Math.abs(f[3*u[A]+D])&&(f[3*u[A]+D]=0),k[A]+=f[3*u[A]+D]+"|"}if(k[0]!=k[1]&&k[0]!=k[2]&&k[1]!=k[2])for(A=0;3>A;A++){C=p[k[A]];if(void 0===C){p[k[A]]=m;C=m++;for(D=0;3>D;D++)h.push(f[3*u[A]+D]);if(null!==g&&void 0!==g)for(D=0;4>D;D++)l.push(g[4*u[A]+
D]);if(null!==c&&void 0!==c)for(D=0;2>D;D++)r.push(c[2*u[A]+D])}q.push(C)}}d=[];e.a.ComputeNormals(h,q,d);a.positions=h;a.indices=q;a.normals=d;null!==c&&void 0!==c&&(a.uvs=r);null!==g&&void 0!==g&&(a.colors=l);a.applyToMesh(this,this.isVertexBufferUpdatable(b.b.PositionKind))}};h._instancedMeshFactory=function(a,b){throw u.a.WarnImport("InstancedMesh");};h._PhysicsImpostorParser=function(a,b,c){throw u.a.WarnImport("PhysicsImpostor");};h.prototype.createInstance=function(a){var b=this.geometry;if(b&&
1<b.meshes.length){var c=0;for(b=b.meshes.slice(0);c<b.length;c++){var d=b[c];d!==this&&d.makeGeometryUnique()}}return h._instancedMeshFactory(a,this)};h.prototype.synchronizeInstances=function(){this._geometry&&1!==this._geometry.meshes.length&&this.instances.length&&this.makeGeometryUnique();for(var a=0;a<this.instances.length;a++)this.instances[a]._syncSubMeshes();return this};h.prototype.optimizeIndices=function(a){var c=this,d=this.getIndices(),e=this.getVerticesData(b.b.PositionKind);if(!e||
!d)return this;for(var f=[],n=0;n<e.length;n+=3)f.push(p.e.FromArray(e,n));var g=[];m.a.SyncAsyncForLoop(f.length,40,function(a){a=f.length-1-a;for(var b=f[a],c=0;c<a;++c)if(b.equals(f[c])){g[a]=c;break}},function(){for(var b=0;b<d.length;++b)d[b]=g[d[b]]||d[b];b=c.subMeshes.slice(0);c.setIndices(d);c.subMeshes=b;a&&a(c)});return this};h.prototype.serialize=function(a){a.name=this.name;a.id=this.id;a.uniqueId=this.uniqueId;a.type=this.getClassName();w.a&&w.a.HasTags(this)&&(a.tags=w.a.GetTags(this));
a.position=this.position.asArray();this.rotationQuaternion?a.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(a.rotation=this.rotation.asArray());a.scaling=this.scaling.asArray();this._postMultiplyPivotMatrix?a.pivotMatrix=this.getPivotMatrix().asArray():a.localMatrix=this.getPivotMatrix().asArray();a.isEnabled=this.isEnabled(!1);a.isVisible=this.isVisible;a.infiniteDistance=this.infiniteDistance;a.pickable=this.isPickable;a.receiveShadows=this.receiveShadows;a.billboardMode=this.billboardMode;
a.visibility=this.visibility;a.checkCollisions=this.checkCollisions;a.isBlocker=this.isBlocker;a.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation;this.parent&&(a.parentId=this.parent.id);a.isUnIndexed=this.isUnIndexed;var b=this._geometry;if(b)for(a.geometryId=b.id,a.subMeshes=[],b=0;b<this.subMeshes.length;b++){var c=this.subMeshes[b];a.subMeshes.push({materialIndex:c.materialIndex,verticesStart:c.verticesStart,verticesCount:c.verticesCount,indexStart:c.indexStart,indexCount:c.indexCount})}this.material?
this.material.doNotSerialize||(a.materialId=this.material.id):this.material=null;this.morphTargetManager&&(a.morphTargetManagerId=this.morphTargetManager.uniqueId);this.skeleton&&(a.skeletonId=this.skeleton.id,a.numBoneInfluencers=this.numBoneInfluencers);this.getScene()._getComponent(D.a.NAME_PHYSICSENGINE)&&(b=this.getPhysicsImpostor())&&(a.physicsMass=b.getParam("mass"),a.physicsFriction=b.getParam("friction"),a.physicsRestitution=b.getParam("mass"),a.physicsImpostor=b.type);this.metadata&&(a.metadata=
this.metadata);a.instances=[];for(c=0;c<this.instances.length;c++){var d=this.instances[c];if(!d.doNotSerialize){var e={name:d.name,id:d.id,isEnabled:d.isEnabled(!1),isVisible:d.isVisible,isPickable:d.isPickable,checkCollisions:d.checkCollisions,position:d.position.asArray(),scaling:d.scaling.asArray()};d.parent&&(e.parentId=d.parent.id);d.rotationQuaternion?e.rotationQuaternion=d.rotationQuaternion.asArray():d.rotation&&(e.rotation=d.rotation.asArray());this.getScene()._getComponent(D.a.NAME_PHYSICSENGINE)&&
(b=d.getPhysicsImpostor())&&(e.physicsMass=b.getParam("mass"),e.physicsFriction=b.getParam("friction"),e.physicsRestitution=b.getParam("mass"),e.physicsImpostor=b.type);d.metadata&&(e.metadata=d.metadata);a.instances.push(e);C.a.AppendSerializedAnimations(d,e);e.ranges=d.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(a.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:m.b.SliceToArray(this._thinInstanceDataStorage.matrixData),
matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize},this._userThinInstanceBuffersStorage)){b={data:{},sizes:{},strides:{}};for(var f in this._userThinInstanceBuffersStorage.data)b.data[f]=m.b.SliceToArray(this._userThinInstanceBuffersStorage.data[f]),b.sizes[f]=this._userThinInstanceBuffersStorage.sizes[f],b.strides[f]=this._userThinInstanceBuffersStorage.strides[f];a.thinInstances.userThinInstance=b}C.a.AppendSerializedAnimations(this,a);a.ranges=this.serializeAnimationRanges();a.layerMask=
this.layerMask;a.alphaIndex=this.alphaIndex;a.hasVertexAlpha=this.hasVertexAlpha;a.overlayAlpha=this.overlayAlpha;a.overlayColor=this.overlayColor.asArray();a.renderOverlay=this.renderOverlay;a.applyFog=this.applyFog;this.actionManager&&(a.actions=this.actionManager.serialize(this.name))};h.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var a=this._internalMeshDataInfo._morphTargetManager;if(a&&a.vertexCount)if(a.vertexCount!==this.getTotalVertices())x.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),
this.morphTargetManager=null;else for(var c=0;c<a.numInfluencers;c++){var d=a.getActiveTarget(c),e=d.getPositions();if(!e){x.a.Error("Invalid morph target. Target must have positions.");break}this.geometry.setVerticesData(b.b.PositionKind+c,e,!1,3);(e=d.getNormals())&&this.geometry.setVerticesData(b.b.NormalKind+c,e,!1,3);(e=d.getTangents())&&this.geometry.setVerticesData(b.b.TangentKind+c,e,!1,3);(d=d.getUVs())&&this.geometry.setVerticesData(b.b.UVKind+"_"+c,d,!1,2)}else for(c=0;this.geometry.isVerticesDataPresent(b.b.PositionKind+
c);)this.geometry.removeVerticesData(b.b.PositionKind+c),this.geometry.isVerticesDataPresent(b.b.NormalKind+c)&&this.geometry.removeVerticesData(b.b.NormalKind+c),this.geometry.isVerticesDataPresent(b.b.TangentKind+c)&&this.geometry.removeVerticesData(b.b.TangentKind+c),this.geometry.isVerticesDataPresent(b.b.UVKind+c)&&this.geometry.removeVerticesData(b.b.UVKind+"_"+c),c++}};h.Parse=function(d,e,f){var g=d.type&&"GroundMesh"===d.type?h._GroundMeshParser(d,e):new h(d.name,e);g.id=d.id;w.a&&w.a.AddTagsTo(g,
d.tags);g.position=p.e.FromArray(d.position);void 0!==d.metadata&&(g.metadata=d.metadata);d.rotationQuaternion?g.rotationQuaternion=p.b.FromArray(d.rotationQuaternion):d.rotation&&(g.rotation=p.e.FromArray(d.rotation));g.scaling=p.e.FromArray(d.scaling);d.localMatrix?g.setPreTransformMatrix(p.a.FromArray(d.localMatrix)):d.pivotMatrix&&g.setPivotMatrix(p.a.FromArray(d.pivotMatrix));g.setEnabled(d.isEnabled);g.isVisible=d.isVisible;g.infiniteDistance=d.infiniteDistance;g.showBoundingBox=d.showBoundingBox;
g.showSubMeshesBoundingBox=d.showSubMeshesBoundingBox;void 0!==d.applyFog&&(g.applyFog=d.applyFog);void 0!==d.pickable&&(g.isPickable=d.pickable);void 0!==d.alphaIndex&&(g.alphaIndex=d.alphaIndex);g.receiveShadows=d.receiveShadows;g.billboardMode=d.billboardMode;void 0!==d.visibility&&(g.visibility=d.visibility);g.checkCollisions=d.checkCollisions;g.overrideMaterialSideOrientation=d.overrideMaterialSideOrientation;void 0!==d.isBlocker&&(g.isBlocker=d.isBlocker);g._shouldGenerateFlatShading=d.useFlatShading;
d.freezeWorldMatrix&&(g._waitingData.freezeWorldMatrix=d.freezeWorldMatrix);d.parentId&&(g._waitingParentId=d.parentId);void 0!==d.actions&&(g._waitingData.actions=d.actions);void 0!==d.overlayAlpha&&(g.overlayAlpha=d.overlayAlpha);void 0!==d.overlayColor&&(g.overlayColor=J.a.FromArray(d.overlayColor));void 0!==d.renderOverlay&&(g.renderOverlay=d.renderOverlay);g.isUnIndexed=!!d.isUnIndexed;g.hasVertexAlpha=d.hasVertexAlpha;d.delayLoadingFile?(g.delayLoadState=4,g.delayLoadingFile=f+d.delayLoadingFile,
g._boundingInfo=new v.a(p.e.FromArray(d.boundingBoxMinimum),p.e.FromArray(d.boundingBoxMaximum)),d._binaryInfo&&(g._binaryInfo=d._binaryInfo),g._delayInfo=[],d.hasUVs&&g._delayInfo.push(b.b.UVKind),d.hasUVs2&&g._delayInfo.push(b.b.UV2Kind),d.hasUVs3&&g._delayInfo.push(b.b.UV3Kind),d.hasUVs4&&g._delayInfo.push(b.b.UV4Kind),d.hasUVs5&&g._delayInfo.push(b.b.UV5Kind),d.hasUVs6&&g._delayInfo.push(b.b.UV6Kind),d.hasColors&&g._delayInfo.push(b.b.ColorKind),d.hasMatricesIndices&&g._delayInfo.push(b.b.MatricesIndicesKind),
d.hasMatricesWeights&&g._delayInfo.push(b.b.MatricesWeightsKind),g._delayLoadingFunction=c.a._ImportGeometry,q.a.ForceFullSceneLoadingForIncremental&&g._checkDelayState()):c.a._ImportGeometry(d,g);d.materialId?g.setMaterialByID(d.materialId):g.material=null;-1<d.morphTargetManagerId&&(g.morphTargetManager=e.getMorphTargetManagerById(d.morphTargetManagerId));void 0!==d.skeletonId&&null!==d.skeletonId&&(g.skeleton=e.getLastSkeletonByID(d.skeletonId),d.numBoneInfluencers&&(g.numBoneInfluencers=d.numBoneInfluencers));
if(d.animations){for(f=0;f<d.animations.length;f++){var n=d.animations[f],r=A.a.GetClass("BABYLON.Animation");r&&g.animations.push(r.Parse(n))}a.a.ParseAnimationRanges(g,d,e)}d.autoAnimate&&e.beginAnimation(g,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1);d.layerMask&&!isNaN(d.layerMask)?g.layerMask=Math.abs(parseInt(d.layerMask)):g.layerMask=268435455;d.physicsImpostor&&h._PhysicsImpostorParser(e,g,d);d.lodMeshIds&&(g._waitingData.lods={ids:d.lodMeshIds,distances:d.lodDistances?
d.lodDistances:null,coverages:d.lodCoverages?d.lodCoverages:null});if(d.instances)for(var l=0;l<d.instances.length;l++){var k=d.instances[l],m=g.createInstance(k.name);k.id&&(m.id=k.id);w.a&&(k.tags?w.a.AddTagsTo(m,k.tags):w.a.AddTagsTo(m,d.tags));m.position=p.e.FromArray(k.position);void 0!==k.metadata&&(m.metadata=k.metadata);k.parentId&&(m._waitingParentId=k.parentId);void 0!==k.isEnabled&&null!==k.isEnabled&&m.setEnabled(k.isEnabled);void 0!==k.isVisible&&null!==k.isVisible&&(m.isVisible=k.isVisible);
void 0!==k.isPickable&&null!==k.isPickable&&(m.isPickable=k.isPickable);k.rotationQuaternion?m.rotationQuaternion=p.b.FromArray(k.rotationQuaternion):k.rotation&&(m.rotation=p.e.FromArray(k.rotation));m.scaling=p.e.FromArray(k.scaling);void 0!=k.checkCollisions&&null!=k.checkCollisions&&(m.checkCollisions=k.checkCollisions);void 0!=k.pickable&&null!=k.pickable&&(m.isPickable=k.pickable);void 0!=k.showBoundingBox&&null!=k.showBoundingBox&&(m.showBoundingBox=k.showBoundingBox);void 0!=k.showSubMeshesBoundingBox&&
null!=k.showSubMeshesBoundingBox&&(m.showSubMeshesBoundingBox=k.showSubMeshesBoundingBox);void 0!=k.alphaIndex&&null!=k.showSubMeshesBoundingBox&&(m.alphaIndex=k.alphaIndex);k.physicsImpostor&&h._PhysicsImpostorParser(e,m,k);if(k.animations){for(f=0;f<k.animations.length;f++)n=k.animations[f],(r=A.a.GetClass("BABYLON.Animation"))&&m.animations.push(r.Parse(n));a.a.ParseAnimationRanges(m,k,e);k.autoAnimate&&e.beginAnimation(m,k.autoAnimateFrom,k.autoAnimateTo,k.autoAnimateLoop,k.autoAnimateSpeed||
1)}}if(d.thinInstances&&(e=d.thinInstances,e.matrixData?(g.thinInstanceSetBuffer("matrix",new Float32Array(e.matrixData),16,!1),g._thinInstanceDataStorage.matrixBufferSize=e.matrixBufferSize,g._thinInstanceDataStorage.instancesCount=e.instancesCount):g._thinInstanceDataStorage.matrixBufferSize=e.matrixBufferSize,d.thinInstances.userThinInstance)){d=d.thinInstances.userThinInstance;for(var x in d.data)g.thinInstanceSetBuffer(x,new Float32Array(d.data[x]),d.strides[x],!1),g._userThinInstanceBuffersStorage.sizes[x]=
d.sizes[x]}return g};h.CreateRibbon=function(a,b,c,d,e,f,g,h,k){throw u.a.WarnImport("MeshBuilder");};h.CreateDisc=function(a,b,c,d,e,f){throw u.a.WarnImport("MeshBuilder");};h.CreateBox=function(a,b,c,d,e){throw u.a.WarnImport("MeshBuilder");};h.CreateSphere=function(a,b,c,d,e,f){throw u.a.WarnImport("MeshBuilder");};h.CreateHemisphere=function(a,b,c,d){throw u.a.WarnImport("MeshBuilder");};h.CreateCylinder=function(a,b,c,d,e,f,g,h,k){throw u.a.WarnImport("MeshBuilder");};h.CreateTorus=function(a,
b,c,d,e,f,g){throw u.a.WarnImport("MeshBuilder");};h.CreateTorusKnot=function(a,b,c,d,e,f,g,h,k,q){throw u.a.WarnImport("MeshBuilder");};h.CreateLines=function(a,b,c,d,e){throw u.a.WarnImport("MeshBuilder");};h.CreateDashedLines=function(a,b,c,d,e,f,g,h){throw u.a.WarnImport("MeshBuilder");};h.CreatePolygon=function(a,b,c,d,e,f,g){throw u.a.WarnImport("MeshBuilder");};h.ExtrudePolygon=function(a,b,c,d,e,f,g,h){throw u.a.WarnImport("MeshBuilder");};h.ExtrudeShape=function(a,b,c,d,e,f,g,h,k,q){throw u.a.WarnImport("MeshBuilder");
};h.ExtrudeShapeCustom=function(a,b,c,d,e,f,g,h,k,q,r,l){throw u.a.WarnImport("MeshBuilder");};h.CreateLathe=function(a,b,c,d,e,f,g){throw u.a.WarnImport("MeshBuilder");};h.CreatePlane=function(a,b,c,d,e){throw u.a.WarnImport("MeshBuilder");};h.CreateGround=function(a,b,c,d,e,f){throw u.a.WarnImport("MeshBuilder");};h.CreateTiledGround=function(a,b,c,d,e,f,g,h,k){throw u.a.WarnImport("MeshBuilder");};h.CreateGroundFromHeightMap=function(a,b,c,d,e,f,g,h,k,q,r){throw u.a.WarnImport("MeshBuilder");};
h.CreateTube=function(a,b,c,d,e,f,g,h,k,q){throw u.a.WarnImport("MeshBuilder");};h.CreatePolyhedron=function(a,b,c){throw u.a.WarnImport("MeshBuilder");};h.CreateIcoSphere=function(a,b,c){throw u.a.WarnImport("MeshBuilder");};h.CreateDecal=function(a,b,c,d,e,f){throw u.a.WarnImport("MeshBuilder");};h.CreateCapsule=function(a,b,c){throw u.a.WarnImport("MeshBuilder");};h.prototype.setPositionsForCPUSkinning=function(){var a=this._internalMeshDataInfo;if(!a._sourcePositions){var c=this.getVerticesData(b.b.PositionKind);
if(!c)return a._sourcePositions;a._sourcePositions=new Float32Array(c);this.isVertexBufferUpdatable(b.b.PositionKind)||this.setVerticesData(b.b.PositionKind,c,!0)}return a._sourcePositions};h.prototype.setNormalsForCPUSkinning=function(){var a=this._internalMeshDataInfo;if(!a._sourceNormals){var c=this.getVerticesData(b.b.NormalKind);if(!c)return a._sourceNormals;a._sourceNormals=new Float32Array(c);this.isVertexBufferUpdatable(b.b.NormalKind)||this.setVerticesData(b.b.NormalKind,c,!0)}return a._sourceNormals};
h.prototype.applySkeleton=function(a){if(!this.geometry||this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;this.geometry._softwareSkinningFrameId=this.getScene().getFrameId();if(!this.isVerticesDataPresent(b.b.PositionKind)||!this.isVerticesDataPresent(b.b.MatricesIndicesKind)||!this.isVerticesDataPresent(b.b.MatricesWeightsKind))return this;var c=this.isVerticesDataPresent(b.b.NormalKind),d=this._internalMeshDataInfo;if(!d._sourcePositions){var e=this.subMeshes.slice();
this.setPositionsForCPUSkinning();this.subMeshes=e}c&&!d._sourceNormals&&this.setNormalsForCPUSkinning();e=this.getVerticesData(b.b.PositionKind);if(!e)return this;e instanceof Float32Array||(e=new Float32Array(e));var f=this.getVerticesData(b.b.NormalKind);if(c){if(!f)return this;f instanceof Float32Array||(f=new Float32Array(f))}var g=this.getVerticesData(b.b.MatricesIndicesKind),h=this.getVerticesData(b.b.MatricesWeightsKind);if(!h||!g)return this;var k=4<this.numBoneInfluencers,q=k?this.getVerticesData(b.b.MatricesIndicesExtraKind):
null,n=k?this.getVerticesData(b.b.MatricesWeightsExtraKind):null;a=a.getTransformMatrices(this);for(var r=p.e.Zero(),l=new p.a,m=new p.a,x=0,C,u=0;u<e.length;u+=3,x+=4){for(C=0;4>C;C++){var A=h[x+C];0<A&&(p.a.FromFloat32ArrayToRefScaled(a,Math.floor(16*g[x+C]),A,m),l.addToSelf(m))}if(k)for(C=0;4>C;C++)A=n[x+C],0<A&&(p.a.FromFloat32ArrayToRefScaled(a,Math.floor(16*q[x+C]),A,m),l.addToSelf(m));p.e.TransformCoordinatesFromFloatsToRef(d._sourcePositions[u],d._sourcePositions[u+1],d._sourcePositions[u+
2],l,r);r.toArray(e,u);c&&(p.e.TransformNormalFromFloatsToRef(d._sourceNormals[u],d._sourceNormals[u+1],d._sourceNormals[u+2],l,r),r.toArray(f,u));l.reset()}this.updateVerticesData(b.b.PositionKind,e);c&&this.updateVerticesData(b.b.NormalKind,f);return this};h.MinMax=function(a){var b=null,c=null;a.forEach(function(a){a=a.getBoundingInfo().boundingBox;b&&c?(b.minimizeInPlace(a.minimumWorld),c.maximizeInPlace(a.maximumWorld)):(b=a.minimumWorld,c=a.maximumWorld)});return b&&c?{min:b,max:c}:{min:p.e.Zero(),
max:p.e.Zero()}};h.Center=function(a){a=a instanceof Array?h.MinMax(a):a;return p.e.Center(a.min,a.max)};h.MergeMeshes=function(a,b,c,d,f,g){void 0===b&&(b=!0);var k;if(!c){var q=0;for(k=0;k<a.length;k++)if(a[k]&&(q+=a[k].getTotalVertices(),65536<=q))return x.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}g&&(f=!1);q=[];var n=[],m=null,C=[],p=null;for(k=0;k<a.length;k++)if(a[k]){var u=a[k];if(u.isAnInstance)return x.a.Warn("Cannot merge instance meshes."),
null;var A=u.computeWorldMatrix(!0);var t=e.a.ExtractFromMesh(u,!0,!0);t.transform(A);m?m.merge(t,c):(m=t,p=u);f&&C.push(u.getTotalIndices());if(g)if(u.material)if(A=u.material,A instanceof r.a){for(t=0;t<A.subMaterials.length;t++)0>q.indexOf(A.subMaterials[t])&&q.push(A.subMaterials[t]);for(t=0;t<u.subMeshes.length;t++)n.push(q.indexOf(A.subMaterials[u.subMeshes[t].materialIndex])),C.push(u.subMeshes[t].indexCount)}else for(0>q.indexOf(A)&&q.push(A),t=0;t<u.subMeshes.length;t++)n.push(q.indexOf(A)),
C.push(u.subMeshes[t].indexCount);else for(t=0;t<u.subMeshes.length;t++)n.push(0),C.push(u.subMeshes[t].indexCount)}d||(d=new h(p.name+"_merged",p.getScene()));m.applyToMesh(d);d.checkCollisions=p.checkCollisions;d.overrideMaterialSideOrientation=p.overrideMaterialSideOrientation;if(b)for(k=0;k<a.length;k++)a[k]&&a[k].dispose();if(f||g)for(d.releaseSubMeshes(),a=k=0;k<C.length;)l.a.CreateFromIndices(0,a,C[k],d),a+=C[k],k++;if(g){g=new r.a(p.name+"_merged",p.getScene());g.subMaterials=q;for(t=0;t<
d.subMeshes.length;t++)d.subMeshes[t].materialIndex=n[t];d.material=g}else d.material=p.material;return d};h.prototype.addInstance=function(a){a._indexInSourceMeshInstanceArray=this.instances.length;this.instances.push(a)};h.prototype.removeInstance=function(a){var b=a._indexInSourceMeshInstanceArray;if(-1!=b){if(b!==this.instances.length-1){var c=this.instances[this.instances.length-1];this.instances[b]=c;c._indexInSourceMeshInstanceArray=b}a._indexInSourceMeshInstanceArray=-1;this.instances.pop()}};
h.FRONTSIDE=e.a.FRONTSIDE;h.BACKSIDE=e.a.BACKSIDE;h.DOUBLESIDE=e.a.DOUBLESIDE;h.DEFAULTSIDE=e.a.DEFAULTSIDE;h.NO_CAP=0;h.CAP_START=1;h.CAP_END=2;h.CAP_ALL=3;h.NO_FLIP=0;h.FLIP_TILE=1;h.ROTATE_TILE=2;h.FLIP_ROW=3;h.ROTATE_ROW=4;h.FLIP_N_ROTATE_TILE=5;h.FLIP_N_ROTATE_ROW=6;h.CENTER=0;h.LEFT=1;h.RIGHT=2;h.TOP=3;h.BOTTOM=4;h._GroundMeshParser=function(a,b){throw u.a.WarnImport("GroundMesh");};return h}(B.a);A.a.RegisteredTypes["BABYLON.Mesh"]=N},wcHl:function(B,F,d){d.d(F,"a",function(){return J});d.d(F,
"b",function(){return a});var y=d("/SR9"),g=d("y4Ty"),m=d("C1Wc"),f=d("wAMR"),w=d("YKqZ"),p=d("MhaC");(function(){return function(a,b,c){this.quality=a;this.distance=b;this.optimizeMesh=c}})();var J=function(){function a(){this.running=!1;this._simplificationArray=[]}a.prototype.addTask=function(a){this._simplificationArray.push(a)};a.prototype.executeNext=function(){var a=this._simplificationArray.pop();a?(this.running=!0,this.runSimplification(a)):this.running=!1};a.prototype.runSimplification=
function(a){var b=this;if(a.parallelProcessing)a.settings.forEach(function(c){b.getSimplifier(a).simplify(c,function(d){void 0!==c.distance&&a.mesh.addLODLevel(c.distance,d);d.isVisible=!0;c.quality===a.settings[a.settings.length-1].quality&&a.successCallback&&a.successCallback();b.executeNext()})});else{var c=this.getSimplifier(a),d=function(b,d){c.simplify(b,function(c){void 0!==b.distance&&a.mesh.addLODLevel(b.distance,c);c.isVisible=!0;d()})};w.a.Run(a.settings.length,function(b){d(a.settings[b.index],
function(){b.executeNext()})},function(){a.successCallback&&a.successCallback();b.executeNext()})}};a.prototype.getSimplifier=function(a){return new v(a.mesh)};return a}(),a;(function(a){a[a.QUADRATIC=0]="QUADRATIC"})(a||(a={}));var b=function(){return function(a){this.vertices=a;this.error=Array(4);this.deletePending=this.isDirty=this.deleted=!1;this.borderFactor=0}}(),e=function(){function a(a,b){this.position=a;this.id=b;this.isBorder=!0;this.q=new c;this.triangleStart=this.triangleCount=0;this.originalOffsets=
[]}a.prototype.updatePosition=function(a){this.position.copyFrom(a)};return a}(),c=function(){function a(a){this.data=Array(10);for(var b=0;10>b;++b)this.data[b]=a&&a[b]?a[b]:0}a.prototype.det=function(a,b,c,d,e,f,g,k,l){return this.data[a]*this.data[e]*this.data[l]+this.data[c]*this.data[d]*this.data[k]+this.data[b]*this.data[f]*this.data[g]-this.data[c]*this.data[e]*this.data[g]-this.data[a]*this.data[f]*this.data[k]-this.data[b]*this.data[d]*this.data[l]};a.prototype.addInPlace=function(a){for(var b=
0;10>b;++b)this.data[b]+=a.data[b]};a.prototype.addArrayInPlace=function(a){for(var b=0;10>b;++b)this.data[b]+=a[b]};a.prototype.add=function(b){for(var c=new a,d=0;10>d;++d)c.data[d]=this.data[d]+b.data[d];return c};a.FromData=function(b,c,d,e){return new a(a.DataFromNumbers(b,c,d,e))};a.DataFromNumbers=function(a,b,c,d){return[a*a,a*b,a*c,a*d,b*b,b*c,b*d,c*c,c*d,d*d]};return a}(),l=function(){return function(a,b){this.vertexId=a;this.triangleId=b}}(),v=function(){function a(a){this._mesh=a;this.syncIterations=
5E3;this.aggressiveness=7;this.decimationIterations=100;this.boundingBoxEpsilon=p.a}a.prototype.simplify=function(a,b){var c=this;this.initDecimatedMesh();w.a.Run(this._mesh.subMeshes.length,function(b){c.initWithMesh(b.index,function(){c.runDecimation(a,b.index,function(){b.executeNext()})},a.optimizeMesh)},function(){setTimeout(function(){b(c._reconstructedMesh)},0)})};a.prototype.runDecimation=function(a,b,c){var d=this,e=~~(this.triangles.length*a.quality),f=0,g=this.triangles.length,k=function(a,
b){setTimeout(function(){0===a%5&&d.updateMesh(0===a);for(var c=0;c<d.triangles.length;++c)d.triangles[c].isDirty=!1;var k=1E-9*Math.pow(a+3,d.aggressiveness);w.a.SyncAsyncForLoop(d.triangles.length,d.syncIterations,function(a){var b=d.triangles[~~((d.triangles.length/2+a)%d.triangles.length)];if(b&&!(b.error[3]>k||b.deleted||b.isDirty))for(var c=0;3>c;++c)if(b.error[c]<k){var e=[],g=[];a=b.vertices[c];var l=b.vertices[(c+1)%3];if(!a.isBorder&&!l.isBorder){var q=y.e.Zero();d.calculateError(a,l,q);
var m=[];if(!(d.isFlipped(a,l,q,e,m)||d.isFlipped(l,a,q,g,m)||0>e.indexOf(!0)||0>g.indexOf(!0))){var r=[];m.forEach(function(a){-1===r.indexOf(a)&&(a.deletePending=!0,r.push(a))});if(0===r.length%2){a.q=l.q.add(a.q);a.updatePosition(q);b=d.references.length;f=d.updateTriangles(a,a,e,f);f=d.updateTriangles(a,l,g,f);e=d.references.length-b;if(e<=a.triangleCount){if(e)for(g=0;g<e;g++)d.references[a.triangleStart+g]=d.references[b+g]}else a.triangleStart=b;a.triangleCount=e;break}}}}},b,function(){return g-
f<=e})},0)};w.a.Run(this.decimationIterations,function(a){g-f<=e?a.breakLoop():k(a.index,function(){a.executeNext()})},function(){setTimeout(function(){d.reconstructMesh(b);c()},0)})};a.prototype.initWithMesh=function(a,c,d){var f=this;this.vertices=[];this.triangles=[];var k=this._mesh.getVerticesData(g.b.PositionKind),l=this._mesh.getIndices(),q=this._mesh.subMeshes[a],m=[];w.a.SyncAsyncForLoop(q.verticesCount,this.syncIterations/4>>0,function(a){if(k){a+=q.verticesStart;var b=y.e.FromArray(k,3*
a),c;a:{if(d)for(c=0;c<f.vertices.length;++c)if(f.vertices[c].position.equalsWithEpsilon(b,1E-4)){c=f.vertices[c];break a}c=null}b=c||new e(b,f.vertices.length);b.originalOffsets.push(a);b.id===f.vertices.length&&f.vertices.push(b);m.push(b.id)}},function(){w.a.SyncAsyncForLoop(q.indexCount/3,f.syncIterations,function(a){if(l){a=3*(q.indexStart/3+a);var c=new b([f.vertices[m[l[a+0]-q.verticesStart]],f.vertices[m[l[a+1]-q.verticesStart]],f.vertices[m[l[a+2]-q.verticesStart]]]);c.originalOffset=a;f.triangles.push(c)}},
function(){f.init(c)})})};a.prototype.init=function(a){var b=this;w.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(a){a=b.triangles[a];a.normal=y.e.Cross(a.vertices[1].position.subtract(a.vertices[0].position),a.vertices[2].position.subtract(a.vertices[0].position)).normalize();for(var d=0;3>d;d++)a.vertices[d].q.addArrayInPlace(c.DataFromNumbers(a.normal.x,a.normal.y,a.normal.z,-y.e.Dot(a.normal,a.vertices[0].position)))},function(){w.a.SyncAsyncForLoop(b.triangles.length,
b.syncIterations,function(a){a=b.triangles[a];for(var c=0;3>c;++c)a.error[c]=b.calculateError(a.vertices[c],a.vertices[(c+1)%3]);a.error[3]=Math.min(a.error[0],a.error[1],a.error[2])},function(){a()})})};a.prototype.reconstructMesh=function(a){var b=[],c;for(c=0;c<this.vertices.length;++c)this.vertices[c].triangleCount=0;var d;for(c=0;c<this.triangles.length;++c)if(!this.triangles[c].deleted){var e=this.triangles[c];for(d=0;3>d;++d)e.vertices[d].triangleCount=1;b.push(e)}var f=this._reconstructedMesh.getVerticesData(g.b.PositionKind)||
[],k=this._reconstructedMesh.getVerticesData(g.b.NormalKind)||[],l=this._reconstructedMesh.getVerticesData(g.b.UVKind)||[],r=this._reconstructedMesh.getVerticesData(g.b.ColorKind)||[],p=this._mesh.getVerticesData(g.b.NormalKind),v=this._mesh.getVerticesData(g.b.UVKind),w=this._mesh.getVerticesData(g.b.ColorKind),y=0;for(c=0;c<this.vertices.length;++c){var B=this.vertices[c];B.id=y;B.triangleCount&&B.originalOffsets.forEach(function(a){f.push(B.position.x);f.push(B.position.y);f.push(B.position.z);
p&&p.length&&(k.push(p[3*a]),k.push(p[3*a+1]),k.push(p[3*a+2]));v&&v.length&&(l.push(v[2*a]),l.push(v[2*a+1]));w&&w.length&&(r.push(w[4*a]),r.push(w[4*a+1]),r.push(w[4*a+2]),r.push(w[4*a+3]));++y})}d=this._reconstructedMesh.getTotalIndices();var F=this._reconstructedMesh.getTotalVertices(),J=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var h=this._reconstructedMesh.getIndices(),n=this._mesh.getIndices();for(c=0;c<b.length;++c)e=b[c],[0,1,2].forEach(function(a){var b=e.vertices[a].originalOffsets.indexOf(n[e.originalOffset+
a]);0>b&&(b=0);h.push(e.vertices[a].id+b+F)});this._reconstructedMesh.setIndices(h);this._reconstructedMesh.setVerticesData(g.b.PositionKind,f);0<k.length&&this._reconstructedMesh.setVerticesData(g.b.NormalKind,k);0<l.length&&this._reconstructedMesh.setVerticesData(g.b.UVKind,l);0<r.length&&this._reconstructedMesh.setVerticesData(g.b.ColorKind,r);c=this._mesh.subMeshes[a];0<a&&(this._reconstructedMesh.subMeshes=[],J.forEach(function(a){m.a.AddToMesh(a.materialIndex,a.verticesStart,a.verticesCount,
a.indexStart,a.indexCount,a.getMesh())}),m.a.AddToMesh(c.materialIndex,F,y,d,3*b.length,this._reconstructedMesh))};a.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new f.a(this._mesh.name+"Decimated",this._mesh.getScene());this._reconstructedMesh.material=this._mesh.material;this._reconstructedMesh.parent=this._mesh.parent;this._reconstructedMesh.isVisible=!1;this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId};a.prototype.isFlipped=function(a,b,c,d,e){for(var f=0;f<
a.triangleCount;++f){var g=this.triangles[this.references[a.triangleStart+f].triangleId];if(!g.deleted){var k=this.references[a.triangleStart+f].vertexId,l=g.vertices[(k+1)%3];k=g.vertices[(k+2)%3];if(l===b||k===b)d[f]=!0,e.push(g);else{l=l.position.subtract(c);l=l.normalize();k=k.position.subtract(c);k=k.normalize();if(.999<Math.abs(y.e.Dot(l,k)))return!0;l=y.e.Cross(l,k).normalize();d[f]=!1;if(.2>y.e.Dot(l,g.normal))return!0}}}return!1};a.prototype.updateTriangles=function(a,b,c,d){for(var e=0;e<
b.triangleCount;++e){var f=this.references[b.triangleStart+e],g=this.triangles[f.triangleId];g.deleted||(c[e]&&g.deletePending?(g.deleted=!0,d++):(g.vertices[f.vertexId]=a,g.isDirty=!0,g.error[0]=this.calculateError(g.vertices[0],g.vertices[1])+g.borderFactor/2,g.error[1]=this.calculateError(g.vertices[1],g.vertices[2])+g.borderFactor/2,g.error[2]=this.calculateError(g.vertices[2],g.vertices[0])+g.borderFactor/2,g.error[3]=Math.min(g.error[0],g.error[1],g.error[2]),this.references.push(f)))}return d};
a.prototype.identifyBorder=function(){for(var a=0;a<this.vertices.length;++a){var b=[],c=[],d=this.vertices[a],e;for(e=0;e<d.triangleCount;++e)for(var f=this.triangles[this.references[d.triangleStart+e].triangleId],g=0;3>g;g++){for(var k=0,l=f.vertices[g];k<b.length&&c[k]!==l.id;)++k;k===b.length?(b.push(1),c.push(l.id)):b[k]++}for(e=0;e<b.length;++e)this.vertices[c[e]].isBorder=1===b[e]?!0:!1}};a.prototype.updateMesh=function(a){void 0===a&&(a=!1);var b;if(!a){var c=[];for(b=0;b<this.triangles.length;++b)this.triangles[b].deleted||
c.push(this.triangles[b]);this.triangles=c}for(b=0;b<this.vertices.length;++b)this.vertices[b].triangleCount=0,this.vertices[b].triangleStart=0;var d;for(b=0;b<this.triangles.length;++b)for(c=this.triangles[b],d=0;3>d;++d){var e=c.vertices[d];e.triangleCount++}for(b=c=0;b<this.vertices.length;++b)this.vertices[b].triangleStart=c,c+=this.vertices[b].triangleCount,this.vertices[b].triangleCount=0;var f=Array(3*this.triangles.length);for(b=0;b<this.triangles.length;++b)for(c=this.triangles[b],d=0;3>
d;++d)e=c.vertices[d],f[e.triangleStart+e.triangleCount]=new l(d,b),e.triangleCount++;this.references=f;a&&this.identifyBorder()};a.prototype.vertexError=function(a,b){var c=b.x,d=b.y;b=b.z;return a.data[0]*c*c+2*a.data[1]*c*d+2*a.data[2]*c*b+2*a.data[3]*c+a.data[4]*d*d+2*a.data[5]*d*b+2*a.data[6]*d+a.data[7]*b*b+2*a.data[8]*b+a.data[9]};a.prototype.calculateError=function(a,b,c){var d=a.q.add(b.q),e=a.isBorder&&b.isBorder,f=d.det(0,1,2,1,4,5,2,5,7);if(0===f||e){e=a.position.add(b.position).divide(new y.e(2,
2,2));f=this.vertexError(d,a.position);var g=this.vertexError(d,b.position);d=this.vertexError(d,e);d=Math.min(f,g,d);d===f?c&&c.copyFrom(a.position):d===g?c&&c.copyFrom(b.position):c&&c.copyFrom(e)}else c||(c=y.e.Zero()),c.x=-1/f*d.det(1,2,3,4,5,6,5,7,8),c.y=1/f*d.det(0,2,3,1,5,6,2,7,8),c.z=-1/f*d.det(0,1,3,1,4,6,2,5,8),d=this.vertexError(d,c);return d};return a}()}}]);
