/*
 doNotRecurse*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(h){var q=0;return function(){return q<h.length?{done:!1,value:h[q++]}:{done:!0}}};$jscomp.arrayIterator=function(h){return{next:$jscomp.arrayIteratorImpl(h)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(h,q,e){h!=Array.prototype&&h!=Object.prototype&&(h[q]=e.value)};$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(h,q){this.$jscomp$symbol$id_=h;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:q})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function h(e){if(this instanceof h)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(e||"")+"_"+q++,e)}var q=0;return h}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.iterator;h||(h=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[h]&&$jscomp.defineProperty(Array.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.asyncIterator;h||(h=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(h){$jscomp.initSymbolIterator();h={next:h};h[$jscomp.global.Symbol.iterator]=function(){return this};return h};
$jscomp.iteratorFromArray=function(h,q){$jscomp.initSymbolIterator();h instanceof String&&(h+="");var e=0,d={next:function(){if(e<h.length){var n=e++;return{value:q(n,h[n]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(h,q,e,d){if(q){e=$jscomp.global;h=h.split(".");for(d=0;d<h.length-1;d++){var n=h[d];n in e||(e[n]={});e=e[n]}h=h[h.length-1];d=e[h];q=q(d);q!=d&&null!=q&&$jscomp.defineProperty(e,h,{configurable:!0,writable:!0,value:q})}};$jscomp.polyfill("Array.prototype.keys",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6","es3");
(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"0FRC":function(h,q,e){e.d(q,"a",function(){return a});var d=e("oYeq"),n=e("aCSs");h=e("OJ6t");e("Es1+");e("k5Kv");var a=function(a){function e(d,e,l){d=a.call(this,d,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],l,e,n.a.BILINEAR_SAMPLINGMODE)||this;d.onSizeChangedObservable.add(function(){});d.onApplyObservable.add(function(g){e._scene.activeCamera&&e._scene.activeCamera.isLeftCamera?g.setInt("imageIndex",0):g.setInt("imageIndex",
1);g.setTexture("multiviewSampler",e._multiviewTexture)});return d}Object(d.d)(e,a);e.prototype.getClassName=function(){return"VRMultiviewToSingleviewPostProcess"};return e}(h.a)},"3kgD":function(h,q,e){e.d(q,"a",function(){return a});var d=e("/SR9"),n=e("n5HA"),a=function(){function a(e,v){void 0===v&&(v=a.DefaultPluginFactory());this._physicsPlugin=v;this._impostors=[];this._joints=[];this._subTimeStep=0;if(!this._physicsPlugin.isSupported())throw Error("Physics Engine "+this._physicsPlugin.name+
" cannot be found. Please make sure it is included.");e=e||new d.e(0,-9.807,0);this.setGravity(e);this.setTimeStep()}a.DefaultPluginFactory=function(){throw n.a.WarnImport("CannonJSPlugin");};a.prototype.setGravity=function(a){this.gravity=a;this._physicsPlugin.setGravity(this.gravity)};a.prototype.setTimeStep=function(a){void 0===a&&(a=1/60);this._physicsPlugin.setTimeStep(a)};a.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()};a.prototype.setSubTimeStep=function(a){void 0===
a&&(a=0);this._subTimeStep=a};a.prototype.getSubTimeStep=function(){return this._subTimeStep};a.prototype.dispose=function(){this._impostors.forEach(function(a){a.dispose()});this._physicsPlugin.dispose()};a.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name};a.prototype.addImpostor=function(a){a.uniqueId=this._impostors.push(a);a.parent||this._physicsPlugin.generatePhysicsBody(a)};a.prototype.removeImpostor=function(a){var d=this._impostors.indexOf(a);-1<d&&this._impostors.splice(d,
1).length&&this.getPhysicsPlugin().removePhysicsBody(a)};a.prototype.addJoint=function(a,d,e){a={mainImpostor:a,connectedImpostor:d,joint:e};e.physicsPlugin=this._physicsPlugin;this._joints.push(a);this._physicsPlugin.generateJoint(a)};a.prototype.removeJoint=function(a,d,e){var l=this._joints.filter(function(g){return g.connectedImpostor===d&&g.joint===e&&g.mainImpostor===a});l.length&&this._physicsPlugin.removeJoint(l[0])};a.prototype._step=function(a){var d=this;this._impostors.forEach(function(a){a.isBodyInitRequired()&&
d._physicsPlugin.generatePhysicsBody(a)});.1<a?a=.1:0>=a&&(a=1/60);this._physicsPlugin.executeStep(a,this._impostors)};a.prototype.getPhysicsPlugin=function(){return this._physicsPlugin};a.prototype.getImpostors=function(){return this._impostors};a.prototype.getImpostorForPhysicsObject=function(a){for(var d=0;d<this._impostors.length;++d)if(this._impostors[d].object===a)return this._impostors[d];return null};a.prototype.getImpostorWithPhysicsBody=function(a){for(var d=0;d<this._impostors.length;++d)if(this._impostors[d].physicsBody===
a)return this._impostors[d];return null};a.prototype.raycast=function(a,d){return this._physicsPlugin.raycast(a,d)};a.Epsilon=.001;return a}()},"4gN4":function(h,q,e){e.d(q,"a",function(){return n});var d=e("oYeq"),n=function(){function a(a,d){this.type=a;this.jointData=d;d.nativeParams=d.nativeParams||{}}Object.defineProperty(a.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(a){this._physicsJoint=a},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"physicsPlugin",{set:function(a){this._physicsPlugin=a},enumerable:!1,configurable:!0});a.prototype.executeNativeFunction=function(a){a(this._physicsPlugin.world,this._physicsJoint)};a.DistanceJoint=0;a.HingeJoint=1;a.BallAndSocketJoint=2;a.WheelJoint=3;a.SliderJoint=4;a.PrismaticJoint=5;a.UniversalJoint=6;a.Hinge2Joint=a.WheelJoint;a.PointToPointJoint=8;a.SpringJoint=9;a.LockJoint=10;return a}();(function(a){function e(d){return a.call(this,n.DistanceJoint,d)||this}Object(d.d)(e,a);e.prototype.updateDistance=
function(a,d){this._physicsPlugin.updateDistanceJoint(this,a,d)};return e})(n);h=function(a){function e(d,e){return a.call(this,d,e)||this}Object(d.d)(e,a);e.prototype.setMotor=function(a,d){this._physicsPlugin.setMotor(this,a||0,d)};e.prototype.setLimit=function(a,d){this._physicsPlugin.setLimit(this,a,d)};return e}(n);(function(a){function e(d){return a.call(this,n.HingeJoint,d)||this}Object(d.d)(e,a);e.prototype.setMotor=function(a,d){this._physicsPlugin.setMotor(this,a||0,d)};e.prototype.setLimit=
function(a,d){this._physicsPlugin.setLimit(this,a,d)};return e})(h);(function(a){function e(d){return a.call(this,n.Hinge2Joint,d)||this}Object(d.d)(e,a);e.prototype.setMotor=function(a,d,e){void 0===e&&(e=0);this._physicsPlugin.setMotor(this,a||0,d,e)};e.prototype.setLimit=function(a,d,e){void 0===e&&(e=0);this._physicsPlugin.setLimit(this,a,d,e)};return e})(h)},"7PGY":function(h,q,e){e("H9Lp");var d=e("oYeq"),n=e("OJ6t");e("dNTL");h=e("WHS4");var a=e("ADVu");q=function(g){function c(b,c,m,a,d,w){var f=
g.call(this,b,"blackAndWhite",["degree"],null,c,m,a,d,w)||this;f.degree=1;f.onApplyObservable.add(function(b){b.setFloat("degree",f.degree)});return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"BlackAndWhitePostProcess"};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,b.options,f,b.renderTargetSamplingMode,m.getEngine(),b.reusable)},b,m,d)};Object(d.c)([Object(a.c)()],c.prototype,"degree",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.BlackAndWhitePostProcess"]=
q;var x=e("YKqZ"),u=function(){function a(c,b,f,m){this._name=b;this._singleInstance=m||!0;this._getPostProcesses=f;this._cameras={};this._indicesForCamera={};this._postProcesses={}}Object.defineProperty(a.prototype,"isSupported",{get:function(){for(var c in this._postProcesses)if(this._postProcesses.hasOwnProperty(c))for(var b=this._postProcesses[c],f=0;f<b.length;f++)if(!b[f].isSupported)return!1;return!0},enumerable:!1,configurable:!0});a.prototype._update=function(){};a.prototype._attachCameras=
function(c){var b=this,f=x.b.MakeArray(c||this._cameras);if(f)for(var m=0;m<f.length;m++){var a=f[m];if(a){var d=a.name;c=this._singleInstance?0:d;if(!this._postProcesses[c]){var w=this._getPostProcesses();w&&(this._postProcesses[c]=Array.isArray(w)?w:[w])}this._indicesForCamera[d]||(this._indicesForCamera[d]=[]);this._postProcesses[c].forEach(function(c){c=a.attachPostProcess(c);b._indicesForCamera[d].push(c)});this._cameras[d]||(this._cameras[d]=a)}}};a.prototype._detachCameras=function(c){if(c=
x.b.MakeArray(c||this._cameras))for(var b=0;b<c.length;b++){var f=c[b],m=f.name,a=this._postProcesses[this._singleInstance?0:m];a&&a.forEach(function(b){f.detachPostProcess(b)});this._cameras[m]&&(this._cameras[m]=null)}};a.prototype._enable=function(c){var b=this,f=x.b.MakeArray(c||this._cameras);if(f)for(var m=0;m<f.length;m++){c=f[m];for(var a=c.name,d=0;d<this._indicesForCamera[a].length;d++)void 0!==c._postProcesses[this._indicesForCamera[a][d]]&&null!==c._postProcesses[this._indicesForCamera[a][d]]||
this._postProcesses[this._singleInstance?0:a].forEach(function(c){f[m].attachPostProcess(c,b._indicesForCamera[a][d])})}};a.prototype._disable=function(c){if(c=x.b.MakeArray(c||this._cameras))for(var b=0;b<c.length;b++){var f=c[b],m=f.name;this._postProcesses[this._singleInstance?0:m].forEach(function(b){f.detachPostProcess(b)})}};a.prototype.getPostProcesses=function(c){return this._singleInstance?this._postProcesses[0]:c?this._postProcesses[c.name]:null};return a}(),v=e("MhaC");e("7OwZ");var r=
function(g){function c(b,c,m,a,d,w,e,l){void 0===e&&(e=0);void 0===l&&(l=!1);var f=g.call(this,b,"extractHighlights",["threshold","exposure"],null,c,m,a,d,w,null,e,void 0,null,l)||this;f.threshold=.9;f._exposure=1;f._inputPostProcess=null;f.onApplyObservable.add(function(b){f._inputPostProcess&&b.setTextureFromPostProcess("textureSampler",f._inputPostProcess);b.setFloat("threshold",Math.pow(f.threshold,v.b));b.setFloat("exposure",f._exposure)});return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"ExtractHighlightsPostProcess"};
Object(d.c)([Object(a.c)()],c.prototype,"threshold",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.ExtractHighlightsPostProcess"]=r;var l=e("AGTA");e("DOQd");var g=function(g){function c(b,c,m,a,d,w,e,l,k,p,r){void 0===p&&(p=0);void 0===r&&(r=!1);var f=g.call(this,b,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],d,w,e,l,k,null,p,void 0,null,!0)||this;f.weight=1;f.weight=a;f.onApplyObservable.add(function(b){b.setTextureFromPostProcess("textureSampler",
c);b.setTextureFromPostProcessOutput("bloomBlur",m);b.setFloat("bloomWeight",f.weight)});r||f.updateEffect();return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"BloomMergePostProcess"};Object(d.c)([Object(a.c)()],c.prototype,"weight",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.BloomMergePostProcess"]=g;var p=e("/SR9"),k=e("aCSs"),G=function(a){function c(b,c,m,d,e,w){void 0===e&&(e=0);void 0===w&&(w=!1);var f=a.call(this,b.getEngine(),"bloom",function(){return f._effects},
!0)||this;f.bloomScale=c;f._effects=[];f._downscale=new r("highlights",1,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,e,w);f._blurX=new l.a("horizontal blur",new p.d(1,0),10,c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,e,void 0,w);f._blurX.alwaysForcePOT=!0;f._blurX.autoClear=!1;f._blurY=new l.a("vertical blur",new p.d(0,1),10,c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,e,void 0,w);f._blurY.alwaysForcePOT=!0;f._blurY.autoClear=!1;f.kernel=d;f._effects=[f._downscale,f._blurX,f._blurY];
f._merge=new g("bloomMerge",f._downscale,f._blurY,m,c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,e,w);f._merge.autoClear=!1;f._effects.push(f._merge);return f}Object(d.d)(c,a);Object.defineProperty(c.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(b){this._downscale.threshold=b},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"weight",{get:function(){return this._merge.weight},set:function(b){this._merge.weight=b},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(b){this._blurX.kernel=b*this.bloomScale;this._blurY.kernel=b*this.bloomScale},enumerable:!1,configurable:!0});c.prototype.disposeEffects=function(b){for(var c=0;c<this._effects.length;c++)this._effects[c].dispose(b)};c.prototype._updateEffects=function(){for(var b=0;b<this._effects.length;b++)this._effects[b].updateEffect()};c.prototype._isReady=function(){for(var b=0;b<this._effects.length;b++)if(!this._effects[b].isReady())return!1;
return!0};return c}(u);e("IbxF");var y=function(g){function c(b,c,m,a,d,w,e,l,k,r){void 0===k&&(k=0);void 0===r&&(r=!1);var f=g.call(this,b,"chromaticAberration","chromatic_aberration screen_width screen_height direction radialIntensity centerPosition".split(" "),[],a,d,w,e,l,null,k,void 0,null,r)||this;f.aberrationAmount=30;f.radialIntensity=0;f.direction=new p.d(.707,.707);f.centerPosition=new p.d(.5,.5);f.screenWidth=c;f.screenHeight=m;f.onApplyObservable.add(function(b){b.setFloat("chromatic_aberration",
f.aberrationAmount);b.setFloat("screen_width",c);b.setFloat("screen_height",m);b.setFloat("radialIntensity",f.radialIntensity);b.setFloat2("direction",f.direction.x,f.direction.y);b.setFloat2("centerPosition",f.centerPosition.x,f.centerPosition.y)});return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"ChromaticAberrationPostProcess"};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,b.screenWidth,b.screenHeight,b.options,f,b.renderTargetSamplingMode,m.getEngine(),
b.reusable,b.textureType,!1)},b,m,d)};Object(d.c)([Object(a.c)()],c.prototype,"aberrationAmount",void 0);Object(d.c)([Object(a.c)()],c.prototype,"radialIntensity",void 0);Object(d.c)([Object(a.c)()],c.prototype,"direction",void 0);Object(d.c)([Object(a.c)()],c.prototype,"centerPosition",void 0);Object(d.c)([Object(a.c)()],c.prototype,"screenWidth",void 0);Object(d.c)([Object(a.c)()],c.prototype,"screenHeight",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.ChromaticAberrationPostProcess"]=y;var t=
e("uyO6");e("fnt0");var C=function(g){function c(b,c,m,a,d,w,e,l,k){void 0===l&&(l=0);void 0===k&&(k=!1);var f=g.call(this,b,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],m,a,d,w,e,null,l,void 0,null,k)||this;f.lensSize=50;f.fStop=1.4;f.focusDistance=2E3;f.focalLength=50;f._depthTexture=null;f._depthTexture=c;f.onApplyObservable.add(function(b){if(f._depthTexture){b.setTexture("depthSampler",f._depthTexture);var c=f.lensSize/f.fStop*f.focalLength/(f.focusDistance-
f.focalLength);b.setFloat("focusDistance",f.focusDistance);b.setFloat("cocPrecalculation",c);b.setFloat2("cameraMinMaxZ",f._depthTexture.activeCamera.minZ,f._depthTexture.activeCamera.maxZ)}else t.a.Warn("No depth texture set on CircleOfConfusionPostProcess")});return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"CircleOfConfusionPostProcess"};Object.defineProperty(c.prototype,"depthTexture",{set:function(b){this._depthTexture=b},enumerable:!1,configurable:!0});Object(d.c)([Object(a.c)()],
c.prototype,"lensSize",void 0);Object(d.c)([Object(a.c)()],c.prototype,"fStop",void 0);Object(d.c)([Object(a.c)()],c.prototype,"focusDistance",void 0);Object(d.c)([Object(a.c)()],c.prototype,"focalLength",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.CircleOfConfusionPostProcess"]=C;e("Iv91");q=function(g){function c(b,c,m,a,d,w,e){var f=g.call(this,b,"colorCorrection",null,["colorTable"],m,a,d,w,e)||this;f._colorTableTexture=new k.a(c,a.getScene(),!0,!1,k.a.TRILINEAR_SAMPLINGMODE);f._colorTableTexture.anisotropicFilteringLevel=
1;f._colorTableTexture.wrapU=k.a.CLAMP_ADDRESSMODE;f._colorTableTexture.wrapV=k.a.CLAMP_ADDRESSMODE;f.colorTableUrl=c;f.onApply=function(b){b.setTexture("colorTable",f._colorTableTexture)};return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"ColorCorrectionPostProcess"};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,b.colorTableUrl,b.options,f,b.renderTargetSamplingMode,m.getEngine(),b.reusable)},b,m,d)};Object(d.c)([Object(a.c)()],c.prototype,"colorTableUrl",
void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.ColorCorrectionPostProcess"]=q;e("q6hq");q=function(g){function c(b,c,m,a,d,w,e,l){void 0===l&&(l=0);var f=g.call(this,b,"convolution",["kernel","screenSize"],null,m,a,d,w,e,null,l)||this;f.kernel=c;f.onApply=function(b){b.setFloat2("screenSize",f.width,f.height);b.setArray("kernel",f.kernel)};return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"ConvolutionPostProcess"};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,
b.kernel,b.options,f,b.renderTargetSamplingMode,m.getEngine(),b.reusable,b.textureType)},b,m,d)};c.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1];c.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0];c.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1];c.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0];c.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2];c.GaussianKernel=[0,1,0,1,1,1,0,1,0];Object(d.c)([Object(a.c)()],c.prototype,"kernel",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.ConvolutionPostProcess"]=q;var z=function(g){function c(b,
c,m,a,d,w,e,l,p,r,t,y,B){void 0===l&&(l=null);void 0===p&&(p=k.a.BILINEAR_SAMPLINGMODE);void 0===y&&(y=0);void 0===B&&(B=!1);b=g.call(this,b,m,a,d,w,p=2,r,t,y=0,"#define DOF 1\r\n",B)||this;b.direction=m;b.onApplyObservable.add(function(b){null!=l&&b.setTextureFromPostProcess("textureSampler",l);b.setTextureFromPostProcessOutput("circleOfConfusionSampler",e);c.activeCamera&&b.setFloat2("cameraMinMaxZ",c.activeCamera.minZ,c.activeCamera.maxZ)});return b}Object(d.d)(c,g);c.prototype.getClassName=function(){return"DepthOfFieldBlurPostProcess"};
Object(d.c)([Object(a.c)()],c.prototype,"direction",void 0);return c}(l.a);h.a.RegisteredTypes["BABYLON.DepthOfFieldBlurPostProcess"]=z;e("bQB8");(function(){return function(){}})();var A=function(a){function c(b,c,m,d,g,w,e,l,k,p,r){void 0===p&&(p=0);void 0===r&&(r=!1);b=a.call(this,b,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],g,w,e,l,k,null,p,void 0,null,!0)||this;b.blurSteps=d;b.onApplyObservable.add(function(b){b.setTextureFromPostProcess("textureSampler",
c);b.setTextureFromPostProcessOutput("circleOfConfusionSampler",m);d.forEach(function(c,f){b.setTextureFromPostProcessOutput("blurStep"+(d.length-f-1),c)})});r||b.updateEffect();return b}Object(d.d)(c,a);c.prototype.getClassName=function(){return"DepthOfFieldMergePostProcess"};c.prototype.updateEffect=function(b,c,m,d,g,w){void 0===b&&(b=null);void 0===c&&(c=null);void 0===m&&(m=null);b||(b="#define BLUR_LEVEL "+(this.blurSteps.length-1)+"\n");a.prototype.updateEffect.call(this,b,c,m,d,g,w)};return c}(n.a),
B;(function(a){a[a.Low=0]="Low";a[a.Medium=1]="Medium";a[a.High=2]="High"})(B||(B={}));var O=function(a){function c(b,c,m,d,g){void 0===m&&(m=B.Low);void 0===d&&(d=0);void 0===g&&(g=!1);var f=a.call(this,b.getEngine(),"depth of field",function(){return f._effects},!0)||this;f._effects=[];f._circleOfConfusion=new C("circleOfConfusion",c,1,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,d,g);f._depthOfFieldBlurY=[];f._depthOfFieldBlurX=[];c=1;var e=15;switch(m){case B.High:c=3;e=51;break;case B.Medium:c=
2;e=31;break;default:e=15,c=1}m=e/Math.pow(2,c-1);e=1;for(var l=0;l<c;l++){var N=new z("verticle blur",b,new p.d(0,1),m,e,null,f._circleOfConfusion,0==l?f._circleOfConfusion:null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,d,g);N.autoClear=!1;e=.75/Math.pow(2,l);var r=new z("horizontal blur",b,new p.d(1,0),m,e,null,f._circleOfConfusion,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,d,g);r.autoClear=!1;f._depthOfFieldBlurY.push(N);f._depthOfFieldBlurX.push(r)}f._effects=[f._circleOfConfusion];for(l=
0;l<f._depthOfFieldBlurX.length;l++)f._effects.push(f._depthOfFieldBlurY[l]),f._effects.push(f._depthOfFieldBlurX[l]);f._dofMerge=new A("dofMerge",f._circleOfConfusion,f._circleOfConfusion,f._depthOfFieldBlurX,e,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,d,g);f._dofMerge.autoClear=!1;f._effects.push(f._dofMerge);return f}Object(d.d)(c,a);Object.defineProperty(c.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(b){this._circleOfConfusion.focalLength=
b},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(b){this._circleOfConfusion.fStop=b},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(b){this._circleOfConfusion.focusDistance=b},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},
set:function(b){this._circleOfConfusion.lensSize=b},enumerable:!1,configurable:!0});c.prototype.getClassName=function(){return"DepthOfFieldEffect"};Object.defineProperty(c.prototype,"depthTexture",{set:function(b){this._circleOfConfusion.depthTexture=b},enumerable:!1,configurable:!0});c.prototype.disposeEffects=function(b){for(var c=0;c<this._effects.length;c++)this._effects[c].dispose(b)};c.prototype._updateEffects=function(){for(var b=0;b<this._effects.length;b++)this._effects[b].updateEffect()};
c.prototype._isReady=function(){for(var b=0;b<this._effects.length;b++)if(!this._effects[b].isReady())return!1;return!0};return c}(u);e("hXNV");q=function(g){function c(b,c,m,a,d,w){return g.call(this,b,"displayPass",["passSampler"],["passSampler"],c,m,a,d,w)||this}Object(d.d)(c,g);c.prototype.getClassName=function(){return"DisplayPassPostProcess"};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,b.options,f,b.renderTargetSamplingMode,m.getEngine(),b.reusable)},b,m,d)};return c}(n.a);
h.a.RegisteredTypes["BABYLON.DisplayPassPostProcess"]=q;e("gsof");q=function(g){function c(b,c,m,a,d,w,e){var f=g.call(this,b,"filter",["kernelMatrix"],null,m,a,d,w,e)||this;f.kernelMatrix=c;f.onApply=function(b){b.setMatrix("kernelMatrix",f.kernelMatrix)};return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"FilterPostProcess"};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,b.kernelMatrix,b.options,f,b.renderTargetSamplingMode,m.getEngine(),b.reusable)},
b,m,d)};Object(d.c)([Object(a.j)()],c.prototype,"kernelMatrix",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.FilterPostProcess"]=q;var P=e("V9V8");e("/cGC");var Q=function(g){function c(b,c,m,a,d,w,e,l){void 0===e&&(e=0);void 0===l&&(l=!1);var f=g.call(this,b,"grain",["intensity","animatedSeed"],[],c,m,a,d,w,null,e,void 0,null,l)||this;f.intensity=30;f.animated=!1;f.onApplyObservable.add(function(b){b.setFloat("intensity",f.intensity);b.setFloat("animatedSeed",f.animated?Math.random()+1:1)});
return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"GrainPostProcess"};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,b.options,f,b.renderTargetSamplingMode,m.getEngine(),b.reusable)},b,m,d)};Object(d.c)([Object(a.c)()],c.prototype,"intensity",void 0);Object(d.c)([Object(a.c)()],c.prototype,"animated",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.GrainPostProcess"]=Q;e("begm");(function(a){function c(b,c,m,d,g,w,e){void 0===e&&(e=0);return a.call(this,
b,"highlights",null,null,c,m,d,g,w,null,e)||this}Object(d.d)(c,a);c.prototype.getClassName=function(){return"HighlightsPostProcess"};return c})(n.a);var J=e("c7Ru"),D=e("6Fho"),H=e("KKje");e("8dKw");e("aypA");e("LXhj");var R=function(g){function c(b,c,m,a,d,e,l,k,p,r){void 0===k&&(k=0);void 0===p&&(p=!1);void 0===r&&(r=!0);b=g.call(this,b,"motionBlur",["motionStrength","motionScale","screenSize","inverseViewProjection","prevViewProjection"],["velocitySampler"],m,a,d,e,l,"#define GEOMETRY_SUPPORTED\n#define SAMPLES 64.0\n#define OBJECT_BASED",
k,void 0,null,p)||this;b.motionStrength=1;b._motionBlurSamples=32;b._isObjectBased=!0;b._geometryBufferRenderer=null;b._prePassRenderer=null;b._invViewProjection=null;b._previousViewProjection=null;b._forceGeometryBuffer=r;b._forceGeometryBuffer?(b._geometryBufferRenderer=c.enableGeometryBufferRenderer(),b._geometryBufferRenderer&&(b._geometryBufferRenderer.enableVelocity=!0)):(b._prePassRenderer=c.enablePrePassRenderer(),b._prePassRenderer&&(b._prePassRenderer.markAsDirty(),b._prePassEffectConfiguration=
new H.a));b._applyMode();return b}Object(d.d)(c,g);Object.defineProperty(c.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(b){this._motionBlurSamples=b;this._updateEffect()},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"isObjectBased",{get:function(){return this._isObjectBased},set:function(b){this._isObjectBased!==b&&(this._isObjectBased=b,this._applyMode())},enumerable:!1,configurable:!0});c.prototype.getClassName=function(){return"MotionBlurPostProcess"};
c.prototype.excludeSkinnedMesh=function(b){if(b.skeleton){if(this._geometryBufferRenderer)var c=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else if(this._prePassRenderer)c=this._prePassRenderer.excludedSkinnedMesh;else return;c.push(b)}};c.prototype.removeExcludedSkinnedMesh=function(b){if(b.skeleton){if(this._geometryBufferRenderer)var c=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;else if(this._prePassRenderer)c=this._prePassRenderer.excludedSkinnedMesh;else return;
b=c.indexOf(b);-1!==b&&c.splice(b,1)}};c.prototype.dispose=function(b){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]);g.prototype.dispose.call(this,b)};c.prototype._applyMode=function(){var b=this;if(!this._geometryBufferRenderer&&!this._prePassRenderer)return t.a.Warn("Multiple Render Target support needed to compute object based motion blur"),
this.updateEffect();this._updateEffect();this._previousViewProjection=this._invViewProjection=null;this.isObjectBased?(this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=2),this.onApply=function(c){return b._onApplyObjectBased(c)}):(this._invViewProjection=p.a.Identity(),this._previousViewProjection=p.a.Identity(),this._prePassRenderer&&this._prePassEffectConfiguration&&(this._prePassEffectConfiguration.texturesRequired[0]=5),this.onApply=
function(c){return b._onApplyScreenBased(c)})};c.prototype._onApplyObjectBased=function(b){b.setVector2("screenSize",new p.d(this.width,this.height));b.setFloat("motionScale",this._scene.getAnimationRatio());b.setFloat("motionStrength",this.motionStrength);if(this._geometryBufferRenderer){var c=this._geometryBufferRenderer.getTextureIndex(D.a.VELOCITY_TEXTURE_TYPE);b.setTexture("velocitySampler",this._geometryBufferRenderer.getGBuffer().textures[c])}else this._prePassRenderer&&(c=this._prePassRenderer.getIndex(2),
b.setTexture("velocitySampler",this._prePassRenderer.prePassRT.textures[c]))};c.prototype._onApplyScreenBased=function(b){var c=this._scene.getProjectionMatrix().multiply(this._scene.getViewMatrix());c.invertToRef(this._invViewProjection);b.setMatrix("inverseViewProjection",this._invViewProjection);b.setMatrix("prevViewProjection",this._previousViewProjection);this._previousViewProjection=c;b.setVector2("screenSize",new p.d(this.width,this.height));b.setFloat("motionScale",this._scene.getAnimationRatio());
b.setFloat("motionStrength",this.motionStrength);this._geometryBufferRenderer?(c=this._geometryBufferRenderer.getTextureIndex(D.a.DEPTHNORMAL_TEXTURE_TYPE),b.setTexture("depthSampler",this._geometryBufferRenderer.getGBuffer().textures[c])):this._prePassRenderer&&(c=this._prePassRenderer.getIndex(5),b.setTexture("depthSampler",this._prePassRenderer.prePassRT.textures[c]))};c.prototype._updateEffect=function(){if(this._geometryBufferRenderer||this._prePassRenderer){var b=["#define GEOMETRY_SUPPORTED",
"#define SAMPLES "+this._motionBlurSamples.toFixed(1),this._isObjectBased?"#define OBJECT_BASED":"#define SCREEN_BASED"];this.updateEffect(b.join("\n"))}};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,m,b.options,f,b.renderTargetSamplingMode,m.getEngine(),b.reusable,b.textureType,!1)},b,m,d)};Object(d.c)([Object(a.c)()],c.prototype,"motionStrength",void 0);Object(d.c)([Object(a.c)()],c.prototype,"motionBlurSamples",null);Object(d.c)([Object(a.c)()],c.prototype,"isObjectBased",
null);return c}(n.a);h.a.RegisteredTypes["BABYLON.MotionBlurPostProcess"]=R;var S=e("qjwu");e("WnUc");e("PnGI");q=function(g){function c(b,c,m,a,d,e,l,p,r,t){var f=g.call(this,b,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],e,l,p,r,t)||this;f._ownRefractionTexture=!0;f.color=m;f.depth=a;f.colorLevel=d;f.refractionTextureUrl=c;f.onActivateObservable.add(function(b){f._refTexture=f._refTexture||new k.a(c,b.getScene())});f.onApplyObservable.add(function(b){b.setColor3("baseColor",
f.color);b.setFloat("depth",f.depth);b.setFloat("colorLevel",f.colorLevel);b.setTexture("refractionSampler",f._refTexture)});return f}Object(d.d)(c,g);Object.defineProperty(c.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(b){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose();this._refTexture=b;this._ownRefractionTexture=!1},enumerable:!1,configurable:!0});c.prototype.getClassName=function(){return"RefractionPostProcess"};c.prototype.dispose=
function(b){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null);g.prototype.dispose.call(this,b)};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,b.refractionTextureUrl,b.color,b.depth,b.colorLevel,b.options,f,b.renderTargetSamplingMode,m.getEngine(),b.reusable)},b,m,d)};Object(d.c)([Object(a.c)()],c.prototype,"color",void 0);Object(d.c)([Object(a.c)()],c.prototype,"depth",void 0);Object(d.c)([Object(a.c)()],c.prototype,"colorLevel",
void 0);Object(d.c)([Object(a.c)()],c.prototype,"refractionTextureUrl",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.RefractionPostProcess"]=q;var W=e("ps+7"),X=e("M8EM");e("m5Hb");var T=function(g){function c(b,c,m,a,d,e,l,p){void 0===l&&(l=0);void 0===p&&(p=!1);var f=g.call(this,b,"sharpen",["sharpnessAmounts","screenSize"],null,c,m,a,d,e,null,l,void 0,null,p)||this;f.colorAmount=1;f.edgeAmount=.3;f.onApply=function(b){b.setFloat2("screenSize",f.width,f.height);b.setFloat2("sharpnessAmounts",
f.edgeAmount,f.colorAmount)};return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"SharpenPostProcess"};c._Parse=function(b,f,m,d){return a.a.Parse(function(){return new c(b.name,b.options,f,b.renderTargetSamplingMode,m.getEngine(),b.textureType,b.reusable)},b,m,d)};Object(d.c)([Object(a.c)()],c.prototype,"colorAmount",void 0);Object(d.c)([Object(a.c)()],c.prototype,"edgeAmount",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.SharpenPostProcess"]=T;q=function(){function g(c,b){this.engine=
c;this._name=b;this._renderEffects={};this._renderEffectsForIsolatedPass=[];this._cameras=[]}Object.defineProperty(g.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0});Object.defineProperty(g.prototype,"cameras",{get:function(){return this._cameras},enumerable:!1,configurable:!0});g.prototype.getClassName=function(){return"PostProcessRenderPipeline"};Object.defineProperty(g.prototype,"isSupported",{get:function(){for(var c in this._renderEffects)if(this._renderEffects.hasOwnProperty(c)&&
!this._renderEffects[c].isSupported)return!1;return!0},enumerable:!1,configurable:!0});g.prototype.addEffect=function(c){this._renderEffects[c._name]=c};g.prototype._rebuild=function(){};g.prototype._enableEffect=function(c,b){(c=this._renderEffects[c])&&c._enable(x.b.MakeArray(b||this._cameras))};g.prototype._disableEffect=function(c,b){(c=this._renderEffects[c])&&c._disable(x.b.MakeArray(b||this._cameras))};g.prototype._attachCameras=function(c,b){var f=x.b.MakeArray(c||this._cameras);if(f){var m=
[],a;for(a=0;a<f.length;a++){var d=f[a];if(d){var g=d.name;-1===this._cameras.indexOf(d)?this._cameras[g]=d:b&&m.push(a)}}for(a=0;a<m.length;a++)c.splice(m[a],1);for(var e in this._renderEffects)this._renderEffects.hasOwnProperty(e)&&this._renderEffects[e]._attachCameras(f)}};g.prototype._detachCameras=function(c){if(c=x.b.MakeArray(c||this._cameras)){for(var b in this._renderEffects)this._renderEffects.hasOwnProperty(b)&&this._renderEffects[b]._detachCameras(c);for(b=0;b<c.length;b++)this._cameras.splice(this._cameras.indexOf(c[b]),
1)}};g.prototype._update=function(){for(var c in this._renderEffects)this._renderEffects.hasOwnProperty(c)&&this._renderEffects[c]._update();for(c=0;c<this._cameras.length;c++)if(this._cameras[c]){var b=this._cameras[c].name;this._renderEffectsForIsolatedPass[b]&&this._renderEffectsForIsolatedPass[b]._update()}};g.prototype._reset=function(){this._renderEffects={};this._renderEffectsForIsolatedPass=[]};g.prototype._enableMSAAOnFirstPostProcess=function(c){if(1===this.engine.webGLVersion)return!1;
var b=Object.keys(this._renderEffects);0<b.length&&(b=this._renderEffects[b[0]].getPostProcesses())&&(b[0].samples=c);return!0};g.prototype.setPrePassRenderer=function(c){return!1};g.prototype.dispose=function(){};Object(d.c)([Object(a.c)()],g.prototype,"_name",void 0);return g}();var K=e("e2Mr"),L=e("Yap0"),Y=function(){function a(){this._renderPipelines={}}Object.defineProperty(a.prototype,"supportedPipelines",{get:function(){var c=[],b;for(b in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(b)){var f=
this._renderPipelines[b];f.isSupported&&c.push(f)}return c},enumerable:!1,configurable:!0});a.prototype.addPipeline=function(c){this._renderPipelines[c._name]=c};a.prototype.attachCamerasToRenderPipeline=function(c,b,f){void 0===f&&(f=!1);(c=this._renderPipelines[c])&&c._attachCameras(b,f)};a.prototype.detachCamerasFromRenderPipeline=function(c,b){(c=this._renderPipelines[c])&&c._detachCameras(b)};a.prototype.enableEffectInPipeline=function(c,b,f){(c=this._renderPipelines[c])&&c._enableEffect(b,f)};
a.prototype.disableEffectInPipeline=function(c,b,f){(c=this._renderPipelines[c])&&c._disableEffect(b,f)};a.prototype.update=function(){for(var c in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(c)){var b=this._renderPipelines[c];b.isSupported?b._update():(b.dispose(),delete this._renderPipelines[c])}};a.prototype._rebuild=function(){for(var c in this._renderPipelines)this._renderPipelines.hasOwnProperty(c)&&this._renderPipelines[c]._rebuild()};a.prototype.dispose=function(){for(var c in this._renderPipelines)this._renderPipelines.hasOwnProperty(c)&&
this._renderPipelines[c].dispose()};return a}(),I=e("tVVT");Object.defineProperty(I.a.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var a=this._getComponent(L.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER);a||(a=new Z(this),this._addComponent(a));this._postProcessRenderPipelineManager=new Y}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var Z=function(){function a(c){this.name=L.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER;
this.scene=c}a.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(L.a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)};a.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()};a.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()};a.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&
this.scene._postProcessRenderPipelineManager.update()};return a}();I=function(g){function c(b,c,m,a,d){void 0===b&&(b="");void 0===c&&(c=!0);void 0===m&&(m=K.a.LastCreatedScene);void 0===d&&(d=!0);var f=g.call(this,m.getEngine(),b)||this;f._camerasToBeAttached=[];f.SharpenPostProcessId="SharpenPostProcessEffect";f.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect";f.FxaaPostProcessId="FxaaPostProcessEffect";f.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect";f.GrainPostProcessId=
"GrainPostProcessEffect";f._glowLayer=null;f.animations=[];f._imageProcessingConfigurationObserver=null;f._sharpenEnabled=!1;f._bloomEnabled=!1;f._depthOfFieldEnabled=!1;f._depthOfFieldBlurLevel=B.Low;f._fxaaEnabled=!1;f._imageProcessingEnabled=!0;f._bloomScale=.5;f._chromaticAberrationEnabled=!1;f._grainEnabled=!1;f._buildAllowed=!0;f.onBuildObservable=new W.a;f._resizeObserver=null;f._hardwareScaleLevel=1;f._bloomKernel=64;f._bloomWeight=.15;f._bloomThreshold=.9;f._samples=1;f._hasCleared=!1;f._prevPostProcess=
null;f._prevPrevPostProcess=null;f._depthOfFieldSceneObserver=null;f._cameras=a||m.cameras;f._cameras=f._cameras.slice();f._camerasToBeAttached=f._cameras.slice();f._buildAllowed=d;f._scene=m;b=f._scene.getEngine().getCaps();f._hdr=c&&(b.textureHalfFloatRender||b.textureFloatRender);f._hdr?b.textureHalfFloatRender?f._defaultPipelineTextureType=2:b.textureFloatRender&&(f._defaultPipelineTextureType=1):f._defaultPipelineTextureType=0;m.postProcessRenderPipelineManager.addPipeline(f);var e=f._scene.getEngine();
f.sharpen=new T("sharpen",1,null,k.a.BILINEAR_SAMPLINGMODE,e,!1,f._defaultPipelineTextureType,!0);f._sharpenEffect=new u(e,f.SharpenPostProcessId,function(){return f.sharpen},!0);f.depthOfField=new O(f._scene,null,f._depthOfFieldBlurLevel,f._defaultPipelineTextureType,!0);f.bloom=new G(f._scene,f._bloomScale,f._bloomWeight,f.bloomKernel,f._defaultPipelineTextureType,!0);f.chromaticAberration=new y("ChromaticAberration",e.getRenderWidth(),e.getRenderHeight(),1,null,k.a.BILINEAR_SAMPLINGMODE,e,!1,f._defaultPipelineTextureType,
!0);f._chromaticAberrationEffect=new u(e,f.ChromaticAberrationPostProcessId,function(){return f.chromaticAberration},!0);f.grain=new Q("Grain",1,null,k.a.BILINEAR_SAMPLINGMODE,e,!1,f._defaultPipelineTextureType,!0);f._grainEffect=new u(e,f.GrainPostProcessId,function(){return f.grain},!0);f._resizeObserver=e.onResizeObservable.add(function(){f._hardwareScaleLevel=e.getHardwareScalingLevel();f.bloomKernel=f.bloomKernel});f._imageProcessingConfigurationObserver=f._scene.imageProcessingConfiguration.onUpdateParameters.add(function(){f.bloom._downscale._exposure=
f._scene.imageProcessingConfiguration.exposure;f.imageProcessingEnabled!==f._scene.imageProcessingConfiguration.isEnabled&&(f._imageProcessingEnabled=f._scene.imageProcessingConfiguration.isEnabled,f._buildPipeline())});f._buildPipeline();return f}Object(d.d)(c,g);Object.defineProperty(c.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(b){this._sharpenEnabled!==
b&&(this._sharpenEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(b){this._bloomKernel=b;this.bloom.kernel=b/this._hardwareScaleLevel},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(b){this._bloomWeight!==b&&(this._bloomWeight=this.bloom.weight=b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(b){this._bloomThreshold!==b&&(this._bloomThreshold=this.bloom.threshold=b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(b){this._bloomScale!==b&&(this._bloomScale=b,this._rebuildBloom(),this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(b){this._bloomEnabled!==
b&&(this._bloomEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});c.prototype._rebuildBloom=function(){var b=this.bloom;this.bloom=new G(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1);this.bloom.threshold=b.threshold;for(var c=0;c<this._cameras.length;c++)b.disposeEffects(this._cameras[c])};Object.defineProperty(c.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(b){this._depthOfFieldEnabled!==
b&&(this._depthOfFieldEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(b){if(this._depthOfFieldBlurLevel!==b){this._depthOfFieldBlurLevel=b;b=this.depthOfField;this.depthOfField=new O(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1);this.depthOfField.focalLength=b.focalLength;this.depthOfField.focusDistance=b.focusDistance;this.depthOfField.fStop=
b.fStop;this.depthOfField.lensSize=b.lensSize;for(var c=0;c<this._cameras.length;c++)b.disposeEffects(this._cameras[c]);this._buildPipeline()}},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(b){this._fxaaEnabled!==b&&(this._fxaaEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"samples",{get:function(){return this._samples},set:function(b){this._samples!==b&&(this._samples=
b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(b){this._imageProcessingEnabled!==b&&(this._scene.imageProcessingConfiguration.isEnabled=b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"glowLayerEnabled",{get:function(){return null!=this._glowLayer},set:function(b){b&&!this._glowLayer?this._glowLayer=new X.a("",this._scene):!b&&this._glowLayer&&
(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(b){this._chromaticAberrationEnabled!==b&&(this._chromaticAberrationEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"grainEnabled",
{get:function(){return this._grainEnabled},set:function(b){this._grainEnabled!==b&&(this._grainEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});c.prototype.getClassName=function(){return"DefaultRenderingPipeline"};c.prototype.prepare=function(){var b=this._buildAllowed;this._buildAllowed=!0;this._buildPipeline();this._buildAllowed=b};c.prototype._setAutoClearAndTextureSharing=function(b,c){void 0===c&&(c=!1);this._hasCleared?b.autoClear=!1:(b.autoClear=!0,this._scene.autoClear=!1,
this._hasCleared=!0);c||(this._prevPrevPostProcess?b.shareOutputWith(this._prevPrevPostProcess):b.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=b)};c.prototype._buildPipeline=function(){var b=this;if(this._buildAllowed){this._scene.autoClear=!0;var c=this._scene.getEngine();this._disposePostProcesses();null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=
this._camerasToBeAttached.slice());this._reset();this._prevPrevPostProcess=this._prevPostProcess=null;this._hasCleared=!1;if(this.depthOfFieldEnabled){if(1<this._cameras.length){for(var m=0,a=this._cameras;m<a.length;m++){var d=this._scene.enableDepthRenderer(a[m]);d.useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add(function(c){-1<b._cameras.indexOf(c.activeCamera)&&(b.depthOfField.depthTexture=c.enableDepthRenderer(c.activeCamera).getDepthMap())})}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),
d=this._scene.enableDepthRenderer(this._cameras[0]),this.depthOfField.depthTexture=d.getDepthMap();this.depthOfField._isReady()||this.depthOfField._updateEffects();this.addEffect(this.depthOfField);this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],
!0));this._imageProcessingEnabled&&(this.imageProcessing=new J.a("imageProcessing",1,null,k.a.BILINEAR_SAMPLINGMODE,c,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new u(c,this.ImageProcessingPostProcessId,function(){return b.imageProcessing},!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1,this.cameras&&0!==this.cameras.length||(this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.imageProcessing.getEffect()||
this.imageProcessing._updateParameters());this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen));this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain));this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),
this._setAutoClearAndTextureSharing(this.chromaticAberration));this.fxaaEnabled&&(this.fxaa=new P.a("fxaa",1,null,k.a.BILINEAR_SAMPLINGMODE,c,!1,this._defaultPipelineTextureType),this.addEffect(new u(c,this.FxaaPostProcessId,function(){return b.fxaa},!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0));null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras);this._scene.activeCameras&&1<this._scene.activeCameras.length&&(this._scene.autoClear=
!0);!this._enableMSAAOnFirstPostProcess(this.samples)&&1<this.samples&&t.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0");this.onBuildObservable.notifyObservers(this)}};c.prototype._disposePostProcesses=function(b){void 0===b&&(b=!1);for(var c=0;c<this._cameras.length;c++){var m=this._cameras[c];this.imageProcessing&&this.imageProcessing.dispose(m);this.fxaa&&this.fxaa.dispose(m);b&&(this.sharpen&&this.sharpen.dispose(m),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),
this.depthOfField.disposeEffects(m)),this.bloom&&this.bloom.disposeEffects(m),this.chromaticAberration&&this.chromaticAberration.dispose(m),this.grain&&this.grain.dispose(m),this._glowLayer&&this._glowLayer.dispose())}this.fxaa=this.imageProcessing=null;b&&(this._glowLayer=this._grainEffect=this.grain=this._chromaticAberrationEffect=this.chromaticAberration=this.bloom=this.depthOfField=this._sharpenEffect=this.sharpen=null)};c.prototype.addCamera=function(b){this._camerasToBeAttached.push(b);this._buildPipeline()};
c.prototype.removeCamera=function(b){b=this._camerasToBeAttached.indexOf(b);this._camerasToBeAttached.splice(b,1);this._buildPipeline()};c.prototype.dispose=function(){this.onBuildObservable.clear();this._disposePostProcesses(!0);this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras);this._scene.autoClear=!0;this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver);
g.prototype.dispose.call(this)};c.prototype.serialize=function(){var b=a.a.Serialize(this);b.customType="DefaultRenderingPipeline";return b};c.Parse=function(b,f,m){return a.a.Parse(function(){return new c(b._name,b._name._hdr,f)},b,f,m)};Object(d.c)([Object(a.c)()],c.prototype,"sharpenEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"bloomKernel",null);Object(d.c)([Object(a.c)()],c.prototype,"_bloomWeight",void 0);Object(d.c)([Object(a.c)()],c.prototype,"_bloomThreshold",void 0);Object(d.c)([Object(a.c)()],
c.prototype,"_hdr",void 0);Object(d.c)([Object(a.c)()],c.prototype,"bloomWeight",null);Object(d.c)([Object(a.c)()],c.prototype,"bloomThreshold",null);Object(d.c)([Object(a.c)()],c.prototype,"bloomScale",null);Object(d.c)([Object(a.c)()],c.prototype,"bloomEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"depthOfFieldEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"depthOfFieldBlurLevel",null);Object(d.c)([Object(a.c)()],c.prototype,"fxaaEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,
"samples",null);Object(d.c)([Object(a.c)()],c.prototype,"imageProcessingEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"glowLayerEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"chromaticAberrationEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"grainEnabled",null);return c}(q);h.a.RegisteredTypes["BABYLON.DefaultRenderingPipeline"]=I;var M=e("WrCc");e("TRGb");e("jOKY");(function(a){function c(b,c,m,d,g){void 0===d&&(d=1);var f=a.call(this,m.getEngine(),b)||this;f.LensChromaticAberrationEffect=
"LensChromaticAberrationEffect";f.HighlightsEnhancingEffect="HighlightsEnhancingEffect";f.LensDepthOfFieldEffect="LensDepthOfFieldEffect";f._pentagonBokehIsEnabled=!1;f._scene=m;f._depthTexture=m.enableDepthRenderer().getDepthMap();c.grain_texture?f._grainTexture=c.grain_texture:f._createGrainTexture();f._edgeBlur=c.edge_blur?c.edge_blur:0;f._grainAmount=c.grain_amount?c.grain_amount:0;f._chromaticAberration=c.chromatic_aberration?c.chromatic_aberration:0;f._distortion=c.distortion?c.distortion:0;
f._highlightsGain=void 0!==c.dof_gain?c.dof_gain:-1;f._highlightsThreshold=c.dof_threshold?c.dof_threshold:1;f._dofDistance=void 0!==c.dof_focus_distance?c.dof_focus_distance:-1;f._dofAperture=c.dof_aperture?c.dof_aperture:1;f._dofDarken=c.dof_darken?c.dof_darken:0;f._dofPentagon=void 0!==c.dof_pentagon?c.dof_pentagon:!0;f._blurNoise=void 0!==c.blur_noise?c.blur_noise:!0;f._createChromaticAberrationPostProcess(d);f._createHighlightsPostProcess(d);f._createDepthOfFieldPostProcess(d/4);f.addEffect(new u(m.getEngine(),
f.LensChromaticAberrationEffect,function(){return f._chromaticAberrationPostProcess},!0));f.addEffect(new u(m.getEngine(),f.HighlightsEnhancingEffect,function(){return f._highlightsPostProcess},!0));f.addEffect(new u(m.getEngine(),f.LensDepthOfFieldEffect,function(){return f._depthOfFieldPostProcess},!0));-1===f._highlightsGain&&f._disableEffect(f.HighlightsEnhancingEffect,null);m.postProcessRenderPipelineManager.addPipeline(f);g&&m.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(b,
g);return f}Object(d.d)(c,a);c.prototype.getClassName=function(){return"LensRenderingPipeline"};Object.defineProperty(c.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(b){this.setEdgeBlur(b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(b){this.setGrainAmount(b)},enumerable:!1,
configurable:!0});Object.defineProperty(c.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(b){this.setChromaticAberration(b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(b){this.setAperture(b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(b){this.setEdgeDistortion(b)},enumerable:!1,
configurable:!0});Object.defineProperty(c.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(b){this.setFocusDistance(b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(b){this.setDarkenOutOfFocus(b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(b){this._blurNoise=b},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(b){b?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(b){this.setHighlightsGain(b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(b){this.setHighlightsThreshold(b)},
enumerable:!1,configurable:!0});c.prototype.setEdgeBlur=function(b){this._edgeBlur=b};c.prototype.disableEdgeBlur=function(){this._edgeBlur=0};c.prototype.setGrainAmount=function(b){this._grainAmount=b};c.prototype.disableGrain=function(){this._grainAmount=0};c.prototype.setChromaticAberration=function(b){this._chromaticAberration=b};c.prototype.disableChromaticAberration=function(){this._chromaticAberration=0};c.prototype.setEdgeDistortion=function(b){this._distortion=b};c.prototype.disableEdgeDistortion=
function(){this._distortion=0};c.prototype.setFocusDistance=function(b){this._dofDistance=b};c.prototype.disableDepthOfField=function(){this._dofDistance=-1};c.prototype.setAperture=function(b){this._dofAperture=b};c.prototype.setDarkenOutOfFocus=function(b){this._dofDarken=b};c.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n");this._pentagonBokehIsEnabled=!0};c.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1;this._highlightsPostProcess.updateEffect()};
c.prototype.enableNoiseBlur=function(){this._blurNoise=!0};c.prototype.disableNoiseBlur=function(){this._blurNoise=!1};c.prototype.setHighlightsGain=function(b){this._highlightsGain=b};c.prototype.setHighlightsThreshold=function(b){-1===this._highlightsGain&&(this._highlightsGain=1);this._highlightsThreshold=b};c.prototype.disableHighlights=function(){this._highlightsGain=-1};c.prototype.dispose=function(b){void 0===b&&(b=!1);this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,
this._scene.cameras);this._depthOfFieldPostProcess=this._highlightsPostProcess=this._chromaticAberrationPostProcess=null;this._grainTexture.dispose();b&&this._scene.disableDepthRenderer()};c.prototype._createChromaticAberrationPostProcess=function(b){var c=this;this._chromaticAberrationPostProcess=new n.a("LensChromaticAberration","chromaticAberration","chromatic_aberration screen_width screen_height direction radialIntensity centerPosition".split(" "),[],b,null,k.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),
!1);this._chromaticAberrationPostProcess.onApply=function(b){b.setFloat("chromatic_aberration",c._chromaticAberration);b.setFloat("screen_width",c._scene.getEngine().getRenderWidth());b.setFloat("screen_height",c._scene.getEngine().getRenderHeight());b.setFloat("radialIntensity",1);b.setFloat2("direction",17,17);b.setFloat2("centerPosition",.5,.5)}};c.prototype._createHighlightsPostProcess=function(b){var c=this;this._highlightsPostProcess=new n.a("LensHighlights","lensHighlights",["gain","threshold",
"screen_width","screen_height"],[],b,null,k.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":"");this._highlightsPostProcess.onApply=function(b){b.setFloat("gain",c._highlightsGain);b.setFloat("threshold",c._highlightsThreshold);b.setTextureFromPostProcess("textureSampler",c._chromaticAberrationPostProcess);b.setFloat("screen_width",c._scene.getEngine().getRenderWidth());b.setFloat("screen_height",c._scene.getEngine().getRenderHeight())}};c.prototype._createDepthOfFieldPostProcess=
function(b){var c=this;this._depthOfFieldPostProcess=new n.a("LensDepthOfField","depthOfField","grain_amount blur_noise screen_width screen_height distortion dof_enabled screen_distance aperture darken edge_blur highlights near far".split(" "),["depthSampler","grainSampler","highlightsSampler"],b,null,k.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);this._depthOfFieldPostProcess.onApply=function(b){b.setTexture("depthSampler",c._depthTexture);b.setTexture("grainSampler",c._grainTexture);b.setTextureFromPostProcess("textureSampler",
c._highlightsPostProcess);b.setTextureFromPostProcess("highlightsSampler",c._depthOfFieldPostProcess);b.setFloat("grain_amount",c._grainAmount);b.setBool("blur_noise",c._blurNoise);b.setFloat("screen_width",c._scene.getEngine().getRenderWidth());b.setFloat("screen_height",c._scene.getEngine().getRenderHeight());b.setFloat("distortion",c._distortion);b.setBool("dof_enabled",-1!==c._dofDistance);b.setFloat("screen_distance",1/(.1-1/c._dofDistance));b.setFloat("aperture",c._dofAperture);b.setFloat("darken",
c._dofDarken);b.setFloat("edge_blur",c._edgeBlur);b.setBool("highlights",-1!==c._highlightsGain);c._scene.activeCamera&&(b.setFloat("near",c._scene.activeCamera.minZ),b.setFloat("far",c._scene.activeCamera.maxZ))}};c.prototype._createGrainTexture=function(){this._grainTexture=new M.a("LensNoiseTexture",512,this._scene,!1,k.a.BILINEAR_SAMPLINGMODE);this._grainTexture.wrapU=k.a.WRAP_ADDRESSMODE;this._grainTexture.wrapV=k.a.WRAP_ADDRESSMODE;for(var b=this._grainTexture.getContext(),c,a=0;512>a;a++)for(var d=
0;512>d;d++)c=Math.floor(255*(Math.random()*(.58-.42)+.42)),b.fillStyle="rgb("+c+", "+c+", "+c+")",b.fillRect(a,d,1,1);this._grainTexture.update(!1)};return c})(q);var aa=e("PFez");e("6LIj");e("6Lgf");I=function(g){function c(b,c,a,d,e){void 0===e&&(e=!0);var f=g.call(this,c.getEngine(),b)||this;f.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect";f.SSAORenderEffect="SSAORenderEffect";f.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect";f.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect";f.SSAOCombineRenderEffect=
"SSAOCombineRenderEffect";f.totalStrength=1;f.maxZ=100;f.minZAspect=.2;f._samples=8;f._textureSamples=1;f._forceGeometryBuffer=!1;f._expensiveBlur=!0;f.radius=2;f.base=0;f._bits=new Uint32Array(1);f._scene=c;f._ratio=a;f._forceGeometryBuffer=e;if(!f.isSupported)return t.a.Error("SSAO 2 needs WebGL 2 support."),f;e=f._ratio.ssaoRatio||a;a=f._ratio.blurRatio||a;f._forceGeometryBuffer?c.enableGeometryBufferRenderer():f._prePassRenderer=c.enablePrePassRenderer();f._createRandomTexture();f._originalColorPostProcess=
new S.a("SSAOOriginalSceneColor",1,null,k.a.BILINEAR_SAMPLINGMODE,c.getEngine(),!1);f._originalColorPostProcess.samples=f.textureSamples;f._createSSAOPostProcess(1);f._createBlurPostProcess(e,a);f._createSSAOCombinePostProcess(a);f.addEffect(new u(c.getEngine(),f.SSAOOriginalSceneColorEffect,function(){return f._originalColorPostProcess},!0));f.addEffect(new u(c.getEngine(),f.SSAORenderEffect,function(){return f._ssaoPostProcess},!0));f.addEffect(new u(c.getEngine(),f.SSAOBlurHRenderEffect,function(){return f._blurHPostProcess},
!0));f.addEffect(new u(c.getEngine(),f.SSAOBlurVRenderEffect,function(){return f._blurVPostProcess},!0));f.addEffect(new u(c.getEngine(),f.SSAOCombineRenderEffect,function(){return f._ssaoCombinePostProcess},!0));c.postProcessRenderPipelineManager.addPipeline(f);d&&c.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(b,d);return f}Object(d.d)(c,g);Object.defineProperty(c.prototype,"samples",{get:function(){return this._samples},set:function(b){this._samples=b;this._ssaoPostProcess.updateEffect(this._getDefinesForSSAO());
this._sampleSphere=this._generateHemisphere()},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(b){this._textureSamples=b;this._originalColorPostProcess.samples=b;this._blurHPostProcess.samples=b;this._blurVPostProcess.samples=b;this._ssaoPostProcess.samples=b;this._ssaoCombinePostProcess.samples=b},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},
set:function(b){this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(b?"1":"0")+"\n",null,["textureSampler","depthNormalSampler"]);this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE "+(b?"1":"0")+"\n",null,["textureSampler","depthNormalSampler"]);this._expensiveBlur=b},enumerable:!1,configurable:!0});Object.defineProperty(c,"IsSupported",{get:function(){var b=K.a.LastCreatedEngine;
return b?2<=b.webGLVersion:!1},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0});c.prototype.getClassName=function(){return"SSAO2RenderingPipeline"};c.prototype.dispose=function(b){void 0===b&&(b=!1);for(var c=0;c<this._scene.cameras.length;c++){var a=this._scene.cameras[c];this._originalColorPostProcess.dispose(a);this._ssaoPostProcess.dispose(a);this._blurHPostProcess.dispose(a);this._blurVPostProcess.dispose(a);
this._ssaoCombinePostProcess.dispose(a)}this._randomTexture.dispose();b&&this._scene.disableGeometryBufferRenderer();this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras);g.prototype.dispose.call(this)};c.prototype._createBlurPostProcess=function(b,c){var f=this;this._samplerOffsets=[];for(var a=this.expensiveBlur,d=-8;8>d;d++)this._samplerOffsets.push(2*d+.5);this._blurHPostProcess=new n.a("BlurH","ssao2",["outSize","samplerOffsets","near","far",
"radius"],["depthNormalSampler"],b,null,k.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(a?"1":"0")+"\n");this._blurHPostProcess.onApply=function(b){f._scene.activeCamera&&(b.setFloat("outSize",0<f._ssaoCombinePostProcess.width?f._ssaoCombinePostProcess.width:f._originalColorPostProcess.width),b.setFloat("near",f._scene.activeCamera.minZ),b.setFloat("far",f._scene.activeCamera.maxZ),b.setFloat("radius",
f.radius),f._forceGeometryBuffer?b.setTexture("depthNormalSampler",f._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]):b.setTexture("depthNormalSampler",f._prePassRenderer.prePassRT.textures[f._prePassRenderer.getIndex(5)]),b.setArray("samplerOffsets",f._samplerOffsets))};this._blurVPostProcess=new n.a("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthNormalSampler"],c,null,k.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE "+
(a?"1":"0")+"\n");this._blurVPostProcess.onApply=function(b){f._scene.activeCamera&&(b.setFloat("outSize",0<f._ssaoCombinePostProcess.height?f._ssaoCombinePostProcess.height:f._originalColorPostProcess.height),b.setFloat("near",f._scene.activeCamera.minZ),b.setFloat("far",f._scene.activeCamera.maxZ),b.setFloat("radius",f.radius),f._forceGeometryBuffer?b.setTexture("depthNormalSampler",f._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]):b.setTexture("depthNormalSampler",f._prePassRenderer.prePassRT.textures[f._prePassRenderer.getIndex(5)]),
b.setArray("samplerOffsets",f._samplerOffsets))};this._blurHPostProcess.samples=this.textureSamples;this._blurVPostProcess.samples=this.textureSamples};c.prototype._rebuild=function(){g.prototype._rebuild.call(this)};c.prototype._radicalInverse_VdC=function(b){this._bits[0]=b;this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0;this._bits[0]=(this._bits[0]&1431655765)<<1|(this._bits[0]&2863311530)>>>1>>>0;this._bits[0]=(this._bits[0]&858993459)<<2|(this._bits[0]&3435973836)>>>2>>>0;this._bits[0]=
(this._bits[0]&252645135)<<4|(this._bits[0]&4042322160)>>>4>>>0;this._bits[0]=(this._bits[0]&16711935)<<8|(this._bits[0]&4278255360)>>>8>>>0;return 2.3283064365386963E-10*this._bits[0]};c.prototype._hammersley=function(b,c){return[b/c,this._radicalInverse_VdC(b)]};c.prototype._hemisphereSample_uniform=function(b,c){c=2*c*Math.PI;b=1-(.85*b+.15);var f=Math.sqrt(1-b*b);return new p.e(Math.cos(c)*f,Math.sin(c)*f,b)};c.prototype._generateHemisphere=function(){for(var b=this.samples,c=[],a,d=0;d<b;)16>
b?a=this._hemisphereSample_uniform(Math.random(),Math.random()):(a=this._hammersley(d,b),a=this._hemisphereSample_uniform(a[0],a[1])),c.push(a.x,a.y,a.z),d++;return c};c.prototype._getDefinesForSSAO=function(){var b="#define SAMPLES "+this.samples+"\n#define SSAO";this._forceGeometryBuffer&&(b+="\n#define GEOMETRYBUFFER");return b};c.prototype._createSSAOPostProcess=function(b){var c=this;this._sampleSphere=this._generateHemisphere();var a=this._getDefinesForSSAO();this._ssaoPostProcess=new n.a("ssao2",
"ssao2","sampleSphere samplesFactor randTextureTiles totalStrength radius base range projection near far texelSize xViewport yViewport maxZ minZAspect".split(" "),this._forceGeometryBuffer?["randomSampler","depthSampler","normalSampler"]:["randomSampler","depthNormalSampler"],b,null,k.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,a);this._ssaoPostProcess.onApply=function(b){c._scene.activeCamera&&(b.setArray3("sampleSphere",c._sampleSphere),b.setFloat("randTextureTiles",32),b.setFloat("samplesFactor",
1/c.samples),b.setFloat("totalStrength",c.totalStrength),b.setFloat2("texelSize",1/c._ssaoPostProcess.width,1/c._ssaoPostProcess.height),b.setFloat("radius",c.radius),b.setFloat("maxZ",c.maxZ),b.setFloat("minZAspect",c.minZAspect),b.setFloat("base",c.base),b.setFloat("near",c._scene.activeCamera.minZ),b.setFloat("far",c._scene.activeCamera.maxZ),b.setFloat("xViewport",Math.tan(c._scene.activeCamera.fov/2)*c._scene.getEngine().getAspectRatio(c._scene.activeCamera,!0)),b.setFloat("yViewport",Math.tan(c._scene.activeCamera.fov/
2)),b.setMatrix("projection",c._scene.getProjectionMatrix()),c._forceGeometryBuffer?(b.setTexture("depthSampler",c._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]),b.setTexture("normalSampler",c._scene.enableGeometryBufferRenderer().getGBuffer().textures[1])):b.setTexture("depthNormalSampler",c._prePassRenderer.prePassRT.textures[c._prePassRenderer.getIndex(5)]),b.setTexture("randomSampler",c._randomTexture))};this._ssaoPostProcess.samples=this.textureSamples};c.prototype._createSSAOCombinePostProcess=
function(b){var c=this;this._ssaoCombinePostProcess=new n.a("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],b,null,k.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);this._ssaoCombinePostProcess.onApply=function(b){var f=c._scene.activeCamera.viewport;b.setVector4("viewport",p.c.Vector4[0].copyFromFloats(f.x,f.y,f.width,f.height));b.setTextureFromPostProcessOutput("originalColor",c._originalColorPostProcess)};this._ssaoCombinePostProcess.samples=this.textureSamples;this._forceGeometryBuffer||
(this._ssaoCombinePostProcess._prePassEffectConfiguration=new aa.a)};c.prototype._createRandomTexture=function(){this._randomTexture=new M.a("SSAORandomTexture",128,this._scene,!1,k.a.TRILINEAR_SAMPLINGMODE);this._randomTexture.wrapU=k.a.WRAP_ADDRESSMODE;this._randomTexture.wrapV=k.a.WRAP_ADDRESSMODE;for(var b=this._randomTexture.getContext(),c=p.e.Zero(),a=0;128>a;a++)for(var d=0;128>d;d++)c.x=1*Math.random(),c.y=1*Math.random(),c.z=0,c.normalize(),c.scaleInPlace(255),c.x=Math.floor(c.x),c.y=Math.floor(c.y),
b.fillStyle="rgb("+c.x+", "+c.y+", "+c.z+")",b.fillRect(a,d,1,1);this._randomTexture.update(!1)};c.prototype.serialize=function(){var b=a.a.Serialize(this);b.customType="SSAO2RenderingPipeline";return b};c.Parse=function(b,f,d){return a.a.Parse(function(){return new c(b._name,f,b._ratio)},b,f,d)};Object(d.c)([Object(a.c)()],c.prototype,"totalStrength",void 0);Object(d.c)([Object(a.c)()],c.prototype,"maxZ",void 0);Object(d.c)([Object(a.c)()],c.prototype,"minZAspect",void 0);Object(d.c)([Object(a.c)("samples")],
c.prototype,"_samples",void 0);Object(d.c)([Object(a.c)("textureSamples")],c.prototype,"_textureSamples",void 0);Object(d.c)([Object(a.c)()],c.prototype,"_ratio",void 0);Object(d.c)([Object(a.c)("expensiveBlur")],c.prototype,"_expensiveBlur",void 0);Object(d.c)([Object(a.c)()],c.prototype,"radius",void 0);Object(d.c)([Object(a.c)()],c.prototype,"base",void 0);return c}(q);h.a.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"]=I;e("nEx7");(function(g){function c(b,c,a,d){var f=g.call(this,c.getEngine(),
b)||this;f.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect";f.SSAORenderEffect="SSAORenderEffect";f.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect";f.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect";f.SSAOCombineRenderEffect="SSAOCombineRenderEffect";f.totalStrength=1;f.radius=1E-4;f.area=.0075;f.fallOff=1E-6;f.base=.5;f._firstUpdate=!0;f._scene=c;f._createRandomTexture();f._depthTexture=c.enableDepthRenderer().getDepthMap();var m=a.ssaoRatio||a;a=a.combineRatio||a;f._originalColorPostProcess=
new S.a("SSAOOriginalSceneColor",a,null,k.a.BILINEAR_SAMPLINGMODE,c.getEngine(),!1);f._createSSAOPostProcess(m);f._createBlurPostProcess(m);f._createSSAOCombinePostProcess(a);f.addEffect(new u(c.getEngine(),f.SSAOOriginalSceneColorEffect,function(){return f._originalColorPostProcess},!0));f.addEffect(new u(c.getEngine(),f.SSAORenderEffect,function(){return f._ssaoPostProcess},!0));f.addEffect(new u(c.getEngine(),f.SSAOBlurHRenderEffect,function(){return f._blurHPostProcess},!0));f.addEffect(new u(c.getEngine(),
f.SSAOBlurVRenderEffect,function(){return f._blurVPostProcess},!0));f.addEffect(new u(c.getEngine(),f.SSAOCombineRenderEffect,function(){return f._ssaoCombinePostProcess},!0));c.postProcessRenderPipelineManager.addPipeline(f);d&&c.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(b,d);return f}Object(d.d)(c,g);Object.defineProperty(c.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0});c.prototype.getClassName=function(){return"SSAORenderingPipeline"};
c.prototype.dispose=function(b){void 0===b&&(b=!1);for(var c=0;c<this._scene.cameras.length;c++){var a=this._scene.cameras[c];this._originalColorPostProcess.dispose(a);this._ssaoPostProcess.dispose(a);this._blurHPostProcess.dispose(a);this._blurVPostProcess.dispose(a);this._ssaoCombinePostProcess.dispose(a)}this._randomTexture.dispose();b&&this._scene.disableDepthRenderer();this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras);g.prototype.dispose.call(this)};
c.prototype._createBlurPostProcess=function(b){var c=this;this._blurHPostProcess=new l.a("BlurH",new p.d(1,0),16,b,null,k.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,0);this._blurVPostProcess=new l.a("BlurV",new p.d(0,1),16,b,null,k.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,0);this._blurHPostProcess.onActivateObservable.add(function(){var b=c._blurHPostProcess.width/c._scene.getEngine().getRenderWidth();c._blurHPostProcess.kernel=16*b});this._blurVPostProcess.onActivateObservable.add(function(){var b=
c._blurVPostProcess.height/c._scene.getEngine().getRenderHeight();c._blurVPostProcess.kernel=16*b})};c.prototype._rebuild=function(){this._firstUpdate=!0;g.prototype._rebuild.call(this)};c.prototype._createSSAOPostProcess=function(b){var c=this,a=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,
.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new n.a("ssao","ssao","sampleSphere samplesFactor randTextureTiles totalStrength radius area fallOff base range viewport".split(" "),["randomSampler"],b,null,k.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO");this._ssaoPostProcess.onApply=function(b){c._firstUpdate&&(b.setArray3("sampleSphere",a),b.setFloat("samplesFactor",.0625),b.setFloat("randTextureTiles",4));b.setFloat("totalStrength",
c.totalStrength);b.setFloat("radius",c.radius);b.setFloat("area",c.area);b.setFloat("fallOff",c.fallOff);b.setFloat("base",c.base);b.setTexture("textureSampler",c._depthTexture);b.setTexture("randomSampler",c._randomTexture)}};c.prototype._createSSAOCombinePostProcess=function(b){var c=this;this._ssaoCombinePostProcess=new n.a("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],b,null,k.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);this._ssaoCombinePostProcess.onApply=function(b){b.setVector4("viewport",
p.c.Vector4[0].copyFromFloats(0,0,1,1));b.setTextureFromPostProcess("originalColor",c._originalColorPostProcess)}};c.prototype._createRandomTexture=function(){this._randomTexture=new M.a("SSAORandomTexture",512,this._scene,!1,k.a.TRILINEAR_SAMPLINGMODE);this._randomTexture.wrapU=k.a.WRAP_ADDRESSMODE;this._randomTexture.wrapV=k.a.WRAP_ADDRESSMODE;for(var b=this._randomTexture.getContext(),c=p.e.Zero(),a=0;512>a;a++)for(var d=0;512>d;d++)c.x=Math.floor(255*(2*Math.random()+-1)),c.y=Math.floor(255*(2*
Math.random()+-1)),c.z=Math.floor(255*(2*Math.random()+-1)),b.fillStyle="rgb("+c.x+", "+c.y+", "+c.z+")",b.fillRect(a,d,1,1);this._randomTexture.update(!1)};Object(d.c)([Object(a.c)()],c.prototype,"totalStrength",void 0);Object(d.c)([Object(a.c)()],c.prototype,"radius",void 0);Object(d.c)([Object(a.c)()],c.prototype,"area",void 0);Object(d.c)([Object(a.c)()],c.prototype,"fallOff",void 0);Object(d.c)([Object(a.c)()],c.prototype,"base",void 0);return c})(q);var ba=e("sH6m"),ca=e("b7XG");e("BHhL");var U=
function(g){function c(b,c,a,d,e,l,p,k,r,t){void 0===k&&(k=0);void 0===r&&(r=!1);void 0===t&&(t=!0);var f=g.call(this,b,"screenSpaceReflection","projection view threshold reflectionSpecularFalloffExponent strength step roughnessFactor".split(" "),["textureSampler","normalSampler","positionSampler","reflectivitySampler"],a,d,e,l,p,"#define SSR_SUPPORTED\n#define REFLECTION_SAMPLES 64\n#define SMOOTH_STEPS 5\n",k,void 0,null,r)||this;f.threshold=1.2;f.strength=1;f.reflectionSpecularFalloffExponent=
3;f.step=1;f.roughnessFactor=.2;f._forceGeometryBuffer=!1;f._enableSmoothReflections=!1;f._reflectionSamples=64;f._smoothSteps=5;f._forceGeometryBuffer=t;f._forceGeometryBuffer?(b=c.enableGeometryBufferRenderer())&&b.isSupported&&(b.enablePosition=!0,b.enableReflectivity=!0,f._geometryBufferRenderer=b):(f._prePassRenderer=c.enablePrePassRenderer(),f._prePassRenderer.markAsDirty(),f._prePassEffectConfiguration=new ca.a);f._updateEffectDefines();f.onApply=function(b){var a=f._geometryBufferRenderer,
d=f._prePassRenderer;if(d||a){if(a){var g=a.getTextureIndex(D.a.POSITION_TEXTURE_TYPE),m=a.getTextureIndex(D.a.REFLECTIVITY_TEXTURE_TYPE);b.setTexture("normalSampler",a.getGBuffer().textures[1]);b.setTexture("positionSampler",a.getGBuffer().textures[g]);b.setTexture("reflectivitySampler",a.getGBuffer().textures[m])}else g=d.getIndex(1),m=d.getIndex(3),a=d.getIndex(5),b.setTexture("normalSampler",d.prePassRT.textures[a]),b.setTexture("positionSampler",d.prePassRT.textures[g]),b.setTexture("reflectivitySampler",
d.prePassRT.textures[m]);if(g=c.activeCamera)d=g.getViewMatrix(),g=g.getProjectionMatrix(),b.setMatrix("projection",g),b.setMatrix("view",d),b.setFloat("threshold",f.threshold),b.setFloat("reflectionSpecularFalloffExponent",f.reflectionSpecularFalloffExponent),b.setFloat("strength",f.strength),b.setFloat("step",f.step),b.setFloat("roughnessFactor",f.roughnessFactor)}};return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"ScreenSpaceReflectionPostProcess"};Object.defineProperty(c.prototype,
"enableSmoothReflections",{get:function(){return this._enableSmoothReflections},set:function(b){b!==this._enableSmoothReflections&&(this._enableSmoothReflections=b,this._updateEffectDefines())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"reflectionSamples",{get:function(){return this._reflectionSamples},set:function(b){b!==this._reflectionSamples&&(this._reflectionSamples=b,this._updateEffectDefines())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"smoothSteps",
{get:function(){return this._smoothSteps},set:function(b){b!==this._smoothSteps&&(this._smoothSteps=b,this._updateEffectDefines())},enumerable:!1,configurable:!0});c.prototype._updateEffectDefines=function(){var b=[];if(this._geometryBufferRenderer||this._prePassRenderer)b.push("#define SSR_SUPPORTED"),this._prePassRenderer&&b.push("#define PREPASS_LAYOUT");this._enableSmoothReflections&&b.push("#define ENABLE_SMOOTH_REFLECTIONS");b.push("#define REFLECTION_SAMPLES "+(this._reflectionSamples>>0));
b.push("#define SMOOTH_STEPS "+(this._smoothSteps>>0));this.updateEffect(b.join("\n"))};c._Parse=function(b,f,d,g){return a.a.Parse(function(){return new c(b.name,d,b.options,f,b.renderTargetSamplingMode,d.getEngine(),b.textureType,b.reusable)},b,d,g)};Object(d.c)([Object(a.c)()],c.prototype,"threshold",void 0);Object(d.c)([Object(a.c)()],c.prototype,"strength",void 0);Object(d.c)([Object(a.c)()],c.prototype,"reflectionSpecularFalloffExponent",void 0);Object(d.c)([Object(a.c)()],c.prototype,"step",
void 0);Object(d.c)([Object(a.c)()],c.prototype,"roughnessFactor",void 0);Object(d.c)([Object(a.c)()],c.prototype,"enableSmoothReflections",null);Object(d.c)([Object(a.c)()],c.prototype,"reflectionSamples",null);Object(d.c)([Object(a.c)()],c.prototype,"smoothSteps",null);return c}(n.a);h.a.RegisteredTypes["BABYLON.ScreenSpaceReflectionPostProcess"]=U;e("Ikch");q=function(g){function c(b,c,a,d,e){void 0===d&&(d=null);b=g.call(this,c.getEngine(),b)||this;b.downSampleX4PostProcess=null;b.brightPassPostProcess=
null;b.blurHPostProcesses=[];b.blurVPostProcesses=[];b.textureAdderPostProcess=null;b.volumetricLightPostProcess=null;b.volumetricLightSmoothXPostProcess=null;b.volumetricLightSmoothYPostProcess=null;b.volumetricLightMergePostProces=null;b.volumetricLightFinalPostProcess=null;b.luminancePostProcess=null;b.luminanceDownSamplePostProcesses=[];b.hdrPostProcess=null;b.textureAdderFinalPostProcess=null;b.lensFlareFinalPostProcess=null;b.hdrFinalPostProcess=null;b.lensFlarePostProcess=null;b.lensFlareComposePostProcess=
null;b.motionBlurPostProcess=null;b.depthOfFieldPostProcess=null;b.fxaaPostProcess=null;b.screenSpaceReflectionPostProcess=null;b.brightThreshold=1;b.blurWidth=512;b.horizontalBlur=!1;b.lensTexture=null;b.volumetricLightCoefficient=.2;b.volumetricLightPower=4;b.volumetricLightBlurScale=64;b.sourceLight=null;b.hdrMinimumLuminance=1;b.hdrDecreaseRate=.5;b.hdrIncreaseRate=.5;b.lensColorTexture=null;b.lensFlareStrength=20;b.lensFlareGhostDispersal=1.4;b.lensFlareHaloWidth=.7;b.lensFlareDistortionStrength=
16;b.lensFlareBlurWidth=512;b.lensStarTexture=null;b.lensFlareDirtTexture=null;b.depthOfFieldDistance=10;b.depthOfFieldBlurWidth=64;b.animations=[];b._currentDepthOfFieldSource=null;b._fixedExposure=1;b._currentExposure=1;b._hdrAutoExposure=!1;b._hdrCurrentLuminance=1;b._motionStrength=1;b._isObjectBasedMotionBlur=!1;b._camerasToBeAttached=[];b._bloomEnabled=!1;b._depthOfFieldEnabled=!1;b._vlsEnabled=!1;b._lensFlareEnabled=!1;b._hdrEnabled=!1;b._motionBlurEnabled=!1;b._fxaaEnabled=!1;b._screenSpaceReflectionsEnabled=
!1;b._motionBlurSamples=64;b._volumetricLightStepsCount=50;b._samples=1;b._cameras=e||c.cameras;b._cameras=b._cameras.slice();b._camerasToBeAttached=b._cameras.slice();b._scene=c;b._basePostProcess=d;b._ratio=a;b._floatTextureType=c.getEngine().getCaps().textureFloatRender?1:2;c.postProcessRenderPipelineManager.addPipeline(b);b._buildPipeline();return b}Object(d.d)(c,g);Object.defineProperty(c.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(b){this._currentExposure=this._fixedExposure=
b},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(b){this._hdrAutoExposure=b;if(this.hdrPostProcess){var c=["#define HDR"];b&&c.push("#define AUTO_EXPOSURE");this.hdrPostProcess.updateEffect(c.join("\n"))}},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"motionStrength",{get:function(){return this._motionStrength},set:function(b){this._motionStrength=b;this._isObjectBasedMotionBlur&&
this.motionBlurPostProcess&&(this.motionBlurPostProcess.motionStrength=b)},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"objectBasedMotionBlur",{get:function(){return this._isObjectBasedMotionBlur},set:function(b){var c=this._isObjectBasedMotionBlur!==b;this._isObjectBasedMotionBlur=b;c&&this._buildPipeline()},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(b){this._bloomEnabled!==b&&(this._bloomEnabled=
b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(b){this._depthOfFieldEnabled!==b&&(this._depthOfFieldEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(b){this._lensFlareEnabled!==b&&(this._lensFlareEnabled=b,this._buildPipeline())},enumerable:!1,
configurable:!0});Object.defineProperty(c.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(b){this._hdrEnabled!==b&&(this._hdrEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(b){this._vlsEnabled!==b&&(b&&!this._scene.enableGeometryBufferRenderer()?t.a.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline"):
(this._vlsEnabled=b,this._buildPipeline()))},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(b){this._motionBlurEnabled!==b&&(this._motionBlurEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(b){this._fxaaEnabled!==b&&(this._fxaaEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});
Object.defineProperty(c.prototype,"screenSpaceReflectionsEnabled",{get:function(){return this._screenSpaceReflectionsEnabled},set:function(b){this._screenSpaceReflectionsEnabled!==b&&(this._screenSpaceReflectionsEnabled=b,this._buildPipeline())},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(b){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS "+
b.toFixed(1));this._volumetricLightStepsCount=b},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(b){this.motionBlurPostProcess&&(this._isObjectBasedMotionBlur?this.motionBlurPostProcess.motionBlurSamples=b:this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+b.toFixed(1)));this._motionBlurSamples=b},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,
"samples",{get:function(){return this._samples},set:function(b){this._samples!==b&&(this._samples=b,this._buildPipeline())},enumerable:!1,configurable:!0});c.prototype._buildPipeline=function(){var b=this,c=this._ratio,a=this._scene;this._disposePostProcesses();null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice());this._reset();this._screenSpaceReflectionsEnabled&&(this.screenSpaceReflectionPostProcess=
new U("HDRPass",a,c,null,k.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,this._floatTextureType),this.screenSpaceReflectionPostProcess.onApplyObservable.add(function(){b._currentDepthOfFieldSource=b.screenSpaceReflectionPostProcess}),this.addEffect(new u(a.getEngine(),"HDRScreenSpaceReflections",function(){return b.screenSpaceReflectionPostProcess},!0)));this.originalPostProcess=this._basePostProcess?this._basePostProcess:new n.a("HDRPass","standard",[],[],c,null,k.a.BILINEAR_SAMPLINGMODE,a.getEngine(),
!1,"#define PASS_POST_PROCESS",this._floatTextureType);this.originalPostProcess.autoClear=!this.screenSpaceReflectionPostProcess;this.originalPostProcess.onApplyObservable.add(function(){b._currentDepthOfFieldSource=b.originalPostProcess});this.addEffect(new u(a.getEngine(),"HDRPassPostProcess",function(){return b.originalPostProcess},!0));this._bloomEnabled&&(this._createDownSampleX4PostProcess(a,c/4),this._createBrightPassPostProcess(a,c/4),this._createBlurPostProcesses(a,c/4,1),this._createTextureAdderPostProcess(a,
c),this.textureAdderFinalPostProcess=new n.a("HDRDepthOfFieldSource","standard",[],[],c,null,k.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define PASS_POST_PROCESS",0),this.addEffect(new u(a.getEngine(),"HDRBaseDepthOfFieldSource",function(){return b.textureAdderFinalPostProcess},!0)));this._vlsEnabled&&(this._createVolumetricLightPostProcess(a,c),this.volumetricLightFinalPostProcess=new n.a("HDRVLSFinal","standard",[],[],c,null,k.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define PASS_POST_PROCESS",
0),this.addEffect(new u(a.getEngine(),"HDRVLSFinal",function(){return b.volumetricLightFinalPostProcess},!0)));this._lensFlareEnabled&&(this._createLensFlarePostProcess(a,c),this.lensFlareFinalPostProcess=new n.a("HDRPostLensFlareDepthOfFieldSource","standard",[],[],c,null,k.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define PASS_POST_PROCESS",0),this.addEffect(new u(a.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return b.lensFlareFinalPostProcess},!0)));this._hdrEnabled&&(this._createLuminancePostProcesses(a,
this._floatTextureType),this._createHdrPostProcess(a,c),this.hdrFinalPostProcess=new n.a("HDRPostHDReDepthOfFieldSource","standard",[],[],c,null,k.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define PASS_POST_PROCESS",0),this.addEffect(new u(a.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return b.hdrFinalPostProcess},!0)));this._depthOfFieldEnabled&&(this._createBlurPostProcesses(a,c/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(a,c));this._motionBlurEnabled&&this._createMotionBlurPostProcess(a,
c);this._fxaaEnabled&&(this.fxaaPostProcess=new P.a("fxaa",1,null,k.a.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,0),this.addEffect(new u(a.getEngine(),"HDRFxaa",function(){return b.fxaaPostProcess},!0)));null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras);!this._enableMSAAOnFirstPostProcess(this._samples)&&1<this._samples&&t.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")};c.prototype._createDownSampleX4PostProcess=
function(b,c){var f=this,a=Array(32);this.downSampleX4PostProcess=new n.a("HDRDownSampleX4","standard",["dsOffsets"],[],c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define DOWN_SAMPLE_X4",this._floatTextureType);this.downSampleX4PostProcess.onApply=function(b){for(var c=0,d=f.downSampleX4PostProcess.width,g=f.downSampleX4PostProcess.height,e=-2;2>e;e++)for(var m=-2;2>m;m++)a[c]=1/d*(e+.5),a[c+1]=1/g*(m+.5),c+=2;b.setArray2("dsOffsets",a)};this.addEffect(new u(b.getEngine(),"HDRDownSampleX4",
function(){return f.downSampleX4PostProcess},!0))};c.prototype._createBrightPassPostProcess=function(b,c){var f=this,a=Array(8);this.brightPassPostProcess=new n.a("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define BRIGHT_PASS",this._floatTextureType);this.brightPassPostProcess.onApply=function(b){var c=1/f.brightPassPostProcess.width,d=1/f.brightPassPostProcess.height;a[0]=-.5*c;a[1]=.5*d;a[2]=.5*c;a[3]=.5*d;a[4]=-.5*c;a[5]=-.5*
d;a[6]=.5*c;a[7]=-.5*d;b.setArray2("dsOffsets",a);b.setFloat("brightThreshold",f.brightThreshold)};this.addEffect(new u(b.getEngine(),"HDRBrightPass",function(){return f.brightPassPostProcess},!0))};c.prototype._createBlurPostProcesses=function(b,c,a,d){var f=this;void 0===d&&(d="blurWidth");var g=b.getEngine(),e=new l.a("HDRBlurH_"+a,new p.d(1,0),this[d],c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,this._floatTextureType),m=new l.a("HDRBlurV_"+a,new p.d(0,1),this[d],c,null,k.a.BILINEAR_SAMPLINGMODE,
b.getEngine(),!1,this._floatTextureType);e.onActivateObservable.add(function(){var b=e.width/g.getRenderWidth();e.kernel=f[d]*b});m.onActivateObservable.add(function(){var b=m.height/g.getRenderHeight();m.kernel=f.horizontalBlur?64*b:f[d]*b});this.addEffect(new u(b.getEngine(),"HDRBlurH"+a,function(){return e},!0));this.addEffect(new u(b.getEngine(),"HDRBlurV"+a,function(){return m},!0));this.blurHPostProcesses.push(e);this.blurVPostProcesses.push(m)};c.prototype._createTextureAdderPostProcess=function(b,
c){var f=this;this.textureAdderPostProcess=new n.a("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define TEXTURE_ADDER",this._floatTextureType);this.textureAdderPostProcess.onApply=function(b){b.setTextureFromPostProcess("otherSampler",f._vlsEnabled?f._currentDepthOfFieldSource:f.originalPostProcess);b.setTexture("lensSampler",f.lensTexture);b.setFloat("exposure",f._currentExposure);f._currentDepthOfFieldSource=f.textureAdderFinalPostProcess};
this.addEffect(new u(b.getEngine(),"HDRTextureAdder",function(){return f.textureAdderPostProcess},!0))};c.prototype._createVolumetricLightPostProcess=function(b,c){var f=this,a=b.enableGeometryBufferRenderer();a.enablePosition=!0;var d=a.getGBuffer();this.volumetricLightPostProcess=new n.a("HDRVLS","standard","shadowViewProjection cameraPosition sunDirection sunColor scatteringCoefficient scatteringPower depthValues".split(" "),["shadowMapSampler","positionSampler"],c/8,null,k.a.BILINEAR_SAMPLINGMODE,
b.getEngine(),!1,"#define VLS\n#define NB_STEPS "+this._volumetricLightStepsCount.toFixed(1));var g=p.d.Zero();this.volumetricLightPostProcess.onApply=function(b){if(f.sourceLight&&f.sourceLight.getShadowGenerator()&&f._scene.activeCamera){var c=f.sourceLight.getShadowGenerator();b.setTexture("shadowMapSampler",c.getShadowMap());b.setTexture("positionSampler",d.textures[2]);b.setColor3("sunColor",f.sourceLight.diffuse);b.setVector3("sunDirection",f.sourceLight.getShadowDirection());b.setVector3("cameraPosition",
f._scene.activeCamera.globalPosition);b.setMatrix("shadowViewProjection",c.getTransformMatrix());b.setFloat("scatteringCoefficient",f.volumetricLightCoefficient);b.setFloat("scatteringPower",f.volumetricLightPower);g.x=f.sourceLight.getDepthMinZ(f._scene.activeCamera);g.y=f.sourceLight.getDepthMaxZ(f._scene.activeCamera);b.setVector2("depthValues",g)}};this.addEffect(new u(b.getEngine(),"HDRVLS",function(){return f.volumetricLightPostProcess},!0));this._createBlurPostProcesses(b,c/4,0,"volumetricLightBlurScale");
this.volumetricLightMergePostProces=new n.a("HDRVLSMerge","standard",[],["originalSampler"],c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define VLSMERGE");this.volumetricLightMergePostProces.onApply=function(b){b.setTextureFromPostProcess("originalSampler",f._bloomEnabled?f.textureAdderFinalPostProcess:f.originalPostProcess);f._currentDepthOfFieldSource=f.volumetricLightFinalPostProcess};this.addEffect(new u(b.getEngine(),"HDRVLSMerge",function(){return f.volumetricLightMergePostProces},!0))};
c.prototype._createLuminancePostProcesses=function(b,f){var a=this,d=Math.pow(3,c.LuminanceSteps);this.luminancePostProcess=new n.a("HDRLuminance","standard",["lumOffsets"],[],{width:d,height:d},null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define LUMINANCE",f);var g=[];this.luminancePostProcess.onApply=function(b){var c=1/a.luminancePostProcess.width,f=1/a.luminancePostProcess.height;g[0]=-.5*c;g[1]=.5*f;g[2]=.5*c;g[3]=.5*f;g[4]=-.5*c;g[5]=-.5*f;g[6]=.5*c;g[7]=-.5*f;b.setArray2("lumOffsets",
g)};this.addEffect(new u(b.getEngine(),"HDRLuminance",function(){return a.luminancePostProcess},!0));for(var e=c.LuminanceSteps-1;0<=e;e--){d=Math.pow(3,e);var l="#define LUMINANCE_DOWN_SAMPLE\n";0===e&&(l+="#define FINAL_DOWN_SAMPLER");d=new n.a("HDRLuminanceDownSample"+e,"standard",["dsOffsets","halfDestPixelSize"],[],{width:d,height:d},null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,l,f);this.luminanceDownSamplePostProcesses.push(d)}var r=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(c,
f){var d=Array(18);c.onApply=function(b){if(r){for(var g=0,e=-1;2>e;e++)for(var l=-1;2>l;l++)d[g]=e/r.width,d[g+1]=l/r.height,g+=2;b.setArray2("dsOffsets",d);b.setFloat("halfDestPixelSize",.5/r.width);r=f===a.luminanceDownSamplePostProcesses.length-1?a.luminancePostProcess:c}};f===a.luminanceDownSamplePostProcesses.length-1&&(c.onAfterRender=function(){var c=b.getEngine().readPixels(0,0,1,1),f=new p.f(1/16581375,1/65025,1/255,1);a._hdrCurrentLuminance=(c[0]*f.x+c[1]*f.y+c[2]*f.z+c[3]*f.w)/100});a.addEffect(new u(b.getEngine(),
"HDRLuminanceDownSample"+f,function(){return c},!0))})};c.prototype._createHdrPostProcess=function(b,c){var f=this,a=["#define HDR"];this._hdrAutoExposure&&a.push("#define AUTO_EXPOSURE");this.hdrPostProcess=new n.a("HDR","standard",["averageLuminance"],["textureAdderSampler"],c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,a.join("\n"),0);var d=1,g=0,e=0;this.hdrPostProcess.onApply=function(c){c.setTextureFromPostProcess("textureAdderSampler",f._currentDepthOfFieldSource);g+=b.getEngine().getDeltaTime();
if(0>d)d=f._hdrCurrentLuminance;else{var a=(e-g)/1E3;d=f._hdrCurrentLuminance<d+f.hdrDecreaseRate*a?d+f.hdrDecreaseRate*a:f._hdrCurrentLuminance>d-f.hdrIncreaseRate*a?d-f.hdrIncreaseRate*a:f._hdrCurrentLuminance}f.hdrAutoExposure?f._currentExposure=f._fixedExposure/d:(d=ba.a.Clamp(d,f.hdrMinimumLuminance,1E20),c.setFloat("averageLuminance",d));e=g;f._currentDepthOfFieldSource=f.hdrFinalPostProcess};this.addEffect(new u(b.getEngine(),"HDR",function(){return f.hdrPostProcess},!0))};c.prototype._createLensFlarePostProcess=
function(b,c){var f=this;this.lensFlarePostProcess=new n.a("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],c/2,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define LENS_FLARE",0);this.addEffect(new u(b.getEngine(),"HDRLensFlare",function(){return f.lensFlarePostProcess},!0));this._createBlurPostProcesses(b,c/4,2,"lensFlareBlurWidth");this.lensFlareComposePostProcess=new n.a("HDRLensFlareCompose","standard",["lensStarMatrix"],
["otherSampler","lensDirtSampler","lensStarSampler"],c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define LENS_FLARE_COMPOSE",0);this.addEffect(new u(b.getEngine(),"HDRLensFlareCompose",function(){return f.lensFlareComposePostProcess},!0));var a=new p.d(0,0);this.lensFlarePostProcess.onApply=function(b){b.setTextureFromPostProcess("textureSampler",f._bloomEnabled?f.blurHPostProcesses[0]:f.originalPostProcess);b.setTexture("lensColorSampler",f.lensColorTexture);b.setFloat("strength",f.lensFlareStrength);
b.setFloat("ghostDispersal",f.lensFlareGhostDispersal);b.setFloat("haloWidth",f.lensFlareHaloWidth);a.x=f.lensFlarePostProcess.width;a.y=f.lensFlarePostProcess.height;b.setVector2("resolution",a);b.setFloat("distortionStrength",f.lensFlareDistortionStrength)};var d=p.a.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),g=p.a.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(b){if(f._scene.activeCamera){b.setTextureFromPostProcess("otherSampler",f.lensFlarePostProcess);
b.setTexture("lensDirtSampler",f.lensFlareDirtTexture);b.setTexture("lensStarSampler",f.lensStarTexture);var c=f._scene.activeCamera.getViewMatrix().getRow(0),a=f._scene.activeCamera.getViewMatrix().getRow(2);c=p.e.Dot(c.toVector3(),new p.e(1,0,0))+p.e.Dot(a.toVector3(),new p.e(0,0,1));c*=4;c=p.a.FromValues(.5*Math.cos(c),-Math.sin(c),0,0,Math.sin(c),.5*Math.cos(c),0,0,0,0,1,0,0,0,0,1);c=g.multiply(c).multiply(d);b.setMatrix("lensStarMatrix",c);f._currentDepthOfFieldSource=f.lensFlareFinalPostProcess}}};
c.prototype._createDepthOfFieldPostProcess=function(b,c){var f=this;this.depthOfFieldPostProcess=new n.a("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define DEPTH_OF_FIELD",0);this.depthOfFieldPostProcess.onApply=function(b){b.setTextureFromPostProcess("otherSampler",f._currentDepthOfFieldSource);b.setTexture("depthSampler",f._getDepthTexture());b.setFloat("distance",f.depthOfFieldDistance)};this.addEffect(new u(b.getEngine(),
"HDRDepthOfField",function(){return f.depthOfFieldPostProcess},!0))};c.prototype._createMotionBlurPostProcess=function(b,c){var f=this;if(this._isObjectBasedMotionBlur)c=new R("HDRMotionBlur",b,c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,0),c.motionStrength=this.motionStrength,c.motionBlurSamples=this.motionBlurSamples,this.motionBlurPostProcess=c;else{this.motionBlurPostProcess=new n.a("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],
["depthSampler"],c,null,k.a.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+this.motionBlurSamples.toFixed(1),0);var a=0,d=p.a.Identity(),g=p.a.Identity(),e=p.a.Identity(),l=p.d.Zero();this.motionBlurPostProcess.onApply=function(c){e=b.getProjectionMatrix().multiply(b.getViewMatrix());e.invertToRef(g);c.setMatrix("inverseViewProjection",g);c.setMatrix("prevViewProjection",d);d=e;l.x=f.motionBlurPostProcess.width;l.y=f.motionBlurPostProcess.height;c.setVector2("screenSize",
l);a=b.getEngine().getFps()/60;c.setFloat("motionScale",a);c.setFloat("motionStrength",f.motionStrength);c.setTexture("depthSampler",f._getDepthTexture())}}this.addEffect(new u(b.getEngine(),"HDRMotionBlur",function(){return f.motionBlurPostProcess},!0))};c.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()};c.prototype._disposePostProcesses=
function(){for(var b=0;b<this._cameras.length;b++){var c=this._cameras[b];this.originalPostProcess&&this.originalPostProcess.dispose(c);this.screenSpaceReflectionPostProcess&&this.screenSpaceReflectionPostProcess.dispose(c);this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(c);this.brightPassPostProcess&&this.brightPassPostProcess.dispose(c);this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(c);this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(c);
this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(c);this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(c);this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(c);this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(c);this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(c);this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(c);for(var a=
0;a<this.luminanceDownSamplePostProcesses.length;a++)this.luminanceDownSamplePostProcesses[a].dispose(c);this.luminancePostProcess&&this.luminancePostProcess.dispose(c);this.hdrPostProcess&&this.hdrPostProcess.dispose(c);this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(c);this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(c);this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(c);this.fxaaPostProcess&&this.fxaaPostProcess.dispose(c);for(a=0;a<this.blurHPostProcesses.length;a++)this.blurHPostProcesses[a].dispose(c);
for(a=0;a<this.blurVPostProcesses.length;a++)this.blurVPostProcesses[a].dispose(c)}this.screenSpaceReflectionPostProcess=this.fxaaPostProcess=this.motionBlurPostProcess=this.depthOfFieldPostProcess=this.hdrFinalPostProcess=this.hdrPostProcess=this.luminancePostProcess=this.lensFlareComposePostProcess=this.lensFlarePostProcess=this.volumetricLightFinalPostProcess=this.volumetricLightMergePostProces=this.volumetricLightSmoothYPostProcess=this.volumetricLightSmoothXPostProcess=this.volumetricLightPostProcess=
this.textureAdderFinalPostProcess=this.textureAdderPostProcess=this.brightPassPostProcess=this.downSampleX4PostProcess=this.originalPostProcess=null;this.luminanceDownSamplePostProcesses=[];this.blurHPostProcesses=[];this.blurVPostProcesses=[]};c.prototype.dispose=function(){this._disposePostProcesses();this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras);g.prototype.dispose.call(this)};c.prototype.serialize=function(){var b=a.a.Serialize(this);this.sourceLight&&
(b.sourceLightId=this.sourceLight.id);this.screenSpaceReflectionPostProcess&&(b.screenSpaceReflectionPostProcess=a.a.Serialize(this.screenSpaceReflectionPostProcess));b.customType="StandardRenderingPipeline";return b};c.Parse=function(b,f,d){var g=a.a.Parse(function(){return new c(b._name,f,b._ratio)},b,f,d);b.sourceLightId&&(g.sourceLight=f.getLightByID(b.sourceLightId));b.screenSpaceReflectionPostProcess&&a.a.Parse(function(){return g.screenSpaceReflectionPostProcess},b.screenSpaceReflectionPostProcess,
f,d);return g};c.LuminanceSteps=6;Object(d.c)([Object(a.c)()],c.prototype,"brightThreshold",void 0);Object(d.c)([Object(a.c)()],c.prototype,"blurWidth",void 0);Object(d.c)([Object(a.c)()],c.prototype,"horizontalBlur",void 0);Object(d.c)([Object(a.c)()],c.prototype,"exposure",null);Object(d.c)([Object(a.m)("lensTexture")],c.prototype,"lensTexture",void 0);Object(d.c)([Object(a.c)()],c.prototype,"volumetricLightCoefficient",void 0);Object(d.c)([Object(a.c)()],c.prototype,"volumetricLightPower",void 0);
Object(d.c)([Object(a.c)()],c.prototype,"volumetricLightBlurScale",void 0);Object(d.c)([Object(a.c)()],c.prototype,"hdrMinimumLuminance",void 0);Object(d.c)([Object(a.c)()],c.prototype,"hdrDecreaseRate",void 0);Object(d.c)([Object(a.c)()],c.prototype,"hdrIncreaseRate",void 0);Object(d.c)([Object(a.c)()],c.prototype,"hdrAutoExposure",null);Object(d.c)([Object(a.m)("lensColorTexture")],c.prototype,"lensColorTexture",void 0);Object(d.c)([Object(a.c)()],c.prototype,"lensFlareStrength",void 0);Object(d.c)([Object(a.c)()],
c.prototype,"lensFlareGhostDispersal",void 0);Object(d.c)([Object(a.c)()],c.prototype,"lensFlareHaloWidth",void 0);Object(d.c)([Object(a.c)()],c.prototype,"lensFlareDistortionStrength",void 0);Object(d.c)([Object(a.c)()],c.prototype,"lensFlareBlurWidth",void 0);Object(d.c)([Object(a.m)("lensStarTexture")],c.prototype,"lensStarTexture",void 0);Object(d.c)([Object(a.m)("lensFlareDirtTexture")],c.prototype,"lensFlareDirtTexture",void 0);Object(d.c)([Object(a.c)()],c.prototype,"depthOfFieldDistance",
void 0);Object(d.c)([Object(a.c)()],c.prototype,"depthOfFieldBlurWidth",void 0);Object(d.c)([Object(a.c)()],c.prototype,"motionStrength",null);Object(d.c)([Object(a.c)()],c.prototype,"objectBasedMotionBlur",null);Object(d.c)([Object(a.c)()],c.prototype,"_ratio",void 0);Object(d.c)([Object(a.c)()],c.prototype,"BloomEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"DepthOfFieldEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"LensFlareEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,
"HDREnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"VLSEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"MotionBlurEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"fxaaEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"screenSpaceReflectionsEnabled",null);Object(d.c)([Object(a.c)()],c.prototype,"volumetricLightStepsCount",null);Object(d.c)([Object(a.c)()],c.prototype,"motionBlurSamples",null);Object(d.c)([Object(a.c)()],c.prototype,"samples",null);return c}(q);h.a.RegisteredTypes["BABYLON.StandardRenderingPipeline"]=
q;e("hM95");(function(a){function c(b,c,d,g,e,l,k){var f=a.call(this,b,"stereoscopicInterlace",["stepSize"],["camASampler"],1,c[1],e,l,k,g?"#define IS_STEREOSCOPIC_INTERLACED 1":d?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;f._passedProcess=c[0]._rigPostProcess;f._stepSize=new p.d(1/f.width,1/f.height);f.onSizeChangedObservable.add(function(){f._stepSize=new p.d(1/f.width,1/f.height)});f.onApplyObservable.add(function(b){b.setTextureFromPostProcess("camASampler",f._passedProcess);b.setFloat2("stepSize",
f._stepSize.x,f._stepSize.y)});return f}Object(d.d)(c,a);c.prototype.getClassName=function(){return"StereoscopicInterlacePostProcessI"};return c})(n.a);(function(a){function c(b,c,d,g,e,l){var f=a.call(this,b,"stereoscopicInterlace",["stepSize"],["camASampler"],1,c[1],g,e,l,d?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;f._passedProcess=c[0]._rigPostProcess;f._stepSize=new p.d(1/f.width,1/f.height);f.onSizeChangedObservable.add(function(){f._stepSize=new p.d(1/f.width,1/f.height)});f.onApplyObservable.add(function(b){b.setTextureFromPostProcess("camASampler",
f._passedProcess);b.setFloat2("stepSize",f._stepSize.x,f._stepSize.y)});return f}Object(d.d)(c,a);c.prototype.getClassName=function(){return"StereoscopicInterlacePostProcess"};return c})(n.a);e("ckLK");var F;(function(a){a[a.Hable=0]="Hable";a[a.Reinhard=1]="Reinhard";a[a.HejiDawson=2]="HejiDawson";a[a.Photographic=3]="Photographic"})(F||(F={}));(function(a){function c(b,c,d,g,e,l,p){void 0===e&&(e=2);void 0===p&&(p=0);var f=a.call(this,b,"tonemap",["_ExposureAdjustment"],null,1,g,e,l,!0,null,p)||
this;f._operator=c;f.exposureAdjustment=d;b="#define ";f._operator===F.Hable?b+="HABLE_TONEMAPPING":f._operator===F.Reinhard?b+="REINHARD_TONEMAPPING":f._operator===F.HejiDawson?b+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":f._operator===F.Photographic&&(b+="PHOTOGRAPHIC_TONEMAPPING");f.updateEffect(b);f.onApply=function(b){b.setFloat("_ExposureAdjustment",f.exposureAdjustment)};return f}Object(d.d)(c,a);c.prototype.getClassName=function(){return"TonemapPostProcess"};return c})(n.a);var E=e("y4Ty"),da=e("ikaq"),
ea=e("wAMR"),fa=e("cdI9"),ha=e("/eyM"),ia=e("kdvT"),ja=e("srWW");e("NNSw");e("eSPP");e("nZmV");e("A4+n");e("Emrg");var V=e("Xeau"),ka=e("JIAX");q=function(g){function c(b,f,a,d,e,l,r,t,y){void 0===e&&(e=100);void 0===l&&(l=k.a.BILINEAR_SAMPLINGMODE);var m=g.call(this,b,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],f.postProcessRatio||f,a,l,r,t,"#define NUM_SAMPLES "+e)||this;m._screenCoordinates=p.d.Zero();m.customMeshPosition=
p.e.Zero();m.useCustomMeshPosition=!1;m.invert=!0;m.excludedMeshes=[];m.exposure=.3;m.decay=.96815;m.weight=.58767;m.density=.926;y=null===a?y:a.getScene();r=y.getEngine();m._viewPort=(new ka.a(0,0,1,1)).toGlobal(r.getRenderWidth(),r.getRenderHeight());m.mesh=null!==d?d:c.CreateDefaultMesh("VolumetricLightScatteringMesh",y);m._createPass(y,f.passRatio||f);m.onActivate=function(b){m.isSupported||m.dispose(b);m.onActivate=null};m.onApplyObservable.add(function(b){m._updateMeshScreenCoordinates(y);b.setTexture("lightScatteringSampler",
m._volumetricLightScatteringRTT);b.setFloat("exposure",m.exposure);b.setFloat("decay",m.decay);b.setFloat("weight",m.weight);b.setFloat("density",m.density);b.setVector2("meshPositionOnScreen",m._screenCoordinates)});return m}Object(d.d)(c,g);Object.defineProperty(c.prototype,"useDiffuseColor",{get:function(){t.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead");return!1},set:function(b){t.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},
enumerable:!1,configurable:!0});c.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"};c.prototype._isReady=function(b,c){var f=b.getMesh();if(f===this.mesh&&f.material)return f.material.isReady(f);var a=[],d=[E.b.PositionKind],g=b.getMaterial();g&&(g.needAlphaTesting()&&a.push("#define ALPHATEST"),f.isVerticesDataPresent(E.b.UVKind)&&(d.push(E.b.UVKind),a.push("#define UV1")),f.isVerticesDataPresent(E.b.UV2Kind)&&(d.push(E.b.UV2Kind),a.push("#define UV2")));f.useBones&&
f.computeBonesUsingShaders?(d.push(E.b.MatricesIndicesKind),d.push(E.b.MatricesWeightsKind),a.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),a.push("#define BonesPerMesh "+(f.skeleton?f.skeleton.bones.length+1:0))):a.push("#define NUM_BONE_INFLUENCERS 0");c&&(a.push("#define INSTANCES"),ha.a.PushAttributesForInstances(d),b.getRenderingMesh().hasThinInstances&&a.push("#define THIN_INSTANCES"));b=a.join("\n");this._cachedDefines!==b&&(this._cachedDefines=b,this._volumetricLightScatteringPass=
f.getScene().getEngine().createEffect("volumetricLightScatteringPass",d,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],b,void 0,void 0,void 0,{maxSimultaneousMorphTargets:f.numBoneInfluencers}));return this._volumetricLightScatteringPass.isReady()};c.prototype.setCustomMeshPosition=function(b){this.customMeshPosition=b};c.prototype.getCustomMeshPosition=function(){return this.customMeshPosition};c.prototype.dispose=function(b){var c=b.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);
-1!==c&&b.getScene().customRenderTargets.splice(c,1);this._volumetricLightScatteringRTT.dispose();g.prototype.dispose.call(this,b)};c.prototype.getPass=function(){return this._volumetricLightScatteringRTT};c.prototype._meshExcluded=function(b){return 0<this.excludedMeshes.length&&-1!==this.excludedMeshes.indexOf(b)?!0:!1};c.prototype._createPass=function(b,c){var f=this,a=b.getEngine();this._volumetricLightScatteringRTT=new ja.a("volumetricLightScatteringMap",{width:a.getRenderWidth()*c,height:a.getRenderHeight()*
c},b,!1,!0,0);this._volumetricLightScatteringRTT.wrapU=k.a.CLAMP_ADDRESSMODE;this._volumetricLightScatteringRTT.wrapV=k.a.CLAMP_ADDRESSMODE;this._volumetricLightScatteringRTT.renderList=null;this._volumetricLightScatteringRTT.renderParticles=!1;this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;(c=this.getCamera())?c.customRenderTargets.push(this._volumetricLightScatteringRTT):b.customRenderTargets.push(this._volumetricLightScatteringRTT);var d=function(b){var c=b.getRenderingMesh(),a=b.getEffectiveMesh();
if(!f._meshExcluded(c)){a._internalAbstractMeshDataInfo._isActiveIntermediate=!1;var d=b.getMaterial();if(d){var g=c.getScene(),e=g.getEngine();e.setState(d.backFaceCulling);var l=c._getInstancesRenderList(b._id,!!b.getReplacementMesh());if(!l.mustReturn){var p=e.getCaps().instancedArrays&&(null!==l.visibleInstances[b._id]||c.hasThinInstances);if(f._isReady(b,p)){var k=f._volumetricLightScatteringPass;c===f.mesh&&(k=b.effect?b.effect:d.getEffect());e.enableEffect(k);c._bind(b,k,d.fillMode);c===f.mesh?
d.bind(a.getWorldMatrix(),c):(f._volumetricLightScatteringPass.setMatrix("viewProjection",g.getTransformMatrix()),d&&d.needAlphaTesting()&&(d=d.getAlphaTestTexture(),f._volumetricLightScatteringPass.setTexture("diffuseSampler",d),d&&f._volumetricLightScatteringPass.setMatrix("diffuseMatrix",d.getTextureMatrix())),c.useBones&&c.computeBonesUsingShaders&&c.skeleton&&f._volumetricLightScatteringPass.setMatrices("mBones",c.skeleton.getTransformMatrices(c)));c._processRendering(a,b,f._volumetricLightScatteringPass,
fa.a.TriangleFillMode,l,p,function(b,c){return k.setMatrix("world",c)})}}}}},g,e=new V.b(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){g=b.clearColor;b.clearColor=e});this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){b.clearColor=g});this._volumetricLightScatteringRTT.customRenderFunction=function(c,f,a,g){var e=b.getEngine(),l;if(g.length){e.setColorWrite(!1);for(l=0;l<g.length;l++)d(g.data[l]);e.setColorWrite(!0)}for(l=0;l<c.length;l++)d(c.data[l]);
for(l=0;l<f.length;l++)d(f.data[l]);if(a.length){for(l=0;l<a.length;l++)c=a.data[l],(f=c.getBoundingInfo())&&b.activeCamera&&(c._alphaIndex=c.getMesh().alphaIndex,c._distanceToCamera=f.boundingSphere.centerWorld.subtract(b.activeCamera.position).length());a=a.data.slice(0,a.length);a.sort(function(b,c){return b._alphaIndex>c._alphaIndex?1:b._alphaIndex<c._alphaIndex?-1:b._distanceToCamera<c._distanceToCamera?1:b._distanceToCamera>c._distanceToCamera?-1:0});e.setAlphaMode(2);for(l=0;l<a.length;l++)d(a[l]);
e.setAlphaMode(0)}}};c.prototype._updateMeshScreenCoordinates=function(b){b=b.getTransformMatrix();var c=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;b=p.e.Project(c,p.a.Identity(),b,this._viewPort);this._screenCoordinates.x=b.x/this._viewPort.width;this._screenCoordinates.y=b.y/this._viewPort.height;this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)};c.CreateDefaultMesh=
function(b,c){var f=ea.a.CreatePlane(b,1,c);f.billboardMode=da.a.BILLBOARDMODE_ALL;b=new ia.a(b+"Material",c);b.emissiveColor=new V.a(1,1,1);f.material=b;return f};Object(d.c)([Object(a.o)()],c.prototype,"customMeshPosition",void 0);Object(d.c)([Object(a.c)()],c.prototype,"useCustomMeshPosition",void 0);Object(d.c)([Object(a.c)()],c.prototype,"invert",void 0);Object(d.c)([Object(a.k)()],c.prototype,"mesh",void 0);Object(d.c)([Object(a.c)()],c.prototype,"excludedMeshes",void 0);Object(d.c)([Object(a.c)()],
c.prototype,"exposure",void 0);Object(d.c)([Object(a.c)()],c.prototype,"decay",void 0);Object(d.c)([Object(a.c)()],c.prototype,"weight",void 0);Object(d.c)([Object(a.c)()],c.prototype,"density",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.VolumetricLightScatteringPostProcess"]=q;e("DBgT");e("0FRC");e("vaFh");e=function(g){function c(b,c,a,d,e,l,p,k,r){void 0===k&&(k=0);void 0===r&&(r=!1);var f=g.call(this,b,"screenSpaceCurvature",["curvature_ridge","curvature_valley"],["textureSampler","normalSampler"],
a,d,e,l,p,void 0,k,void 0,null,r)||this;f.ridge=1;f.valley=1;f._geometryBufferRenderer=c.enableGeometryBufferRenderer();f._geometryBufferRenderer?f.onApply=function(b){b.setFloat("curvature_ridge",.5/Math.max(f.ridge*f.ridge,1E-4));b.setFloat("curvature_valley",.7/Math.max(f.valley*f.valley,1E-4));var c=f._geometryBufferRenderer.getGBuffer().textures[1];b.setTexture("normalSampler",c)}:t.a.Error("Multiple Render Target support needed for screen space curvature post process. Please use IsSupported test first.");
return f}Object(d.d)(c,g);c.prototype.getClassName=function(){return"ScreenSpaceCurvaturePostProcess"};Object.defineProperty(c,"IsSupported",{get:function(){var b=K.a.LastCreatedEngine;return b?1<b.webGLVersion||b.getCaps().drawBuffersExtension:!1},enumerable:!1,configurable:!0});c._Parse=function(b,f,d,g){return a.a.Parse(function(){return new c(b.name,d,b.options,f,b.renderTargetSamplingMode,d.getEngine(),b.textureType,b.reusable)},b,d,g)};Object(d.c)([Object(a.c)()],c.prototype,"ridge",void 0);
Object(d.c)([Object(a.c)()],c.prototype,"valley",void 0);return c}(n.a);h.a.RegisteredTypes["BABYLON.ScreenSpaceCurvaturePostProcess"]=e},"7uBm":function(h,q,e){e.d(q,"a",function(){return n});var d=e("/SR9"),n=function(){function a(){this._hasHit=!1;this._hitDistance=0;this._hitNormalWorld=d.e.Zero();this._hitPointWorld=d.e.Zero();this._rayFromWorld=d.e.Zero();this._rayToWorld=d.e.Zero()}Object.defineProperty(a.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!1,configurable:!0});
Object.defineProperty(a.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,
"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!1,configurable:!0});a.prototype.setHitData=function(a,e){this._hasHit=!0;this._hitNormalWorld=new d.e(a.x,a.y,a.z);this._hitPointWorld=new d.e(e.x,e.y,e.z)};a.prototype.setHitDistance=function(a){this._hitDistance=a};a.prototype.calculateHitDistance=function(){this._hitDistance=d.e.Distance(this._rayFromWorld,this._hitPointWorld)};a.prototype.reset=function(a,e){void 0===a&&(a=d.e.Zero());void 0===e&&(e=d.e.Zero());this._rayFromWorld=
a;this._rayToWorld=e;this._hasHit=!1;this._hitDistance=0;this._hitNormalWorld=d.e.Zero();this._hitPointWorld=d.e.Zero()};return a}()},AGTA:function(h,q,e){e.d(q,"a",function(){return x});var d=e("oYeq");h=e("OJ6t");var n=e("aCSs");e("3cLf");e("tKhU");q=e("WHS4");var a=e("ADVu"),x=function(e){function h(a,d,g,p,k,h,y,t,u,z,A){void 0===h&&(h=n.a.BILINEAR_SAMPLINGMODE);void 0===u&&(u=0);void 0===z&&(z="");void 0===A&&(A=!1);var l=e.call(this,a,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],
p,k,h,y,t,null,u,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;l.blockCompilation=A;l._packedFloat=!1;l._staticDefines="";l._staticDefines=z;l.direction=d;l.onApplyObservable.add(function(a){l._outputTexture?a.setFloat2("delta",1/l._outputTexture.width*l.direction.x,1/l._outputTexture.height*l.direction.y):a.setFloat2("delta",1/l.width*l.direction.x,1/l.height*l.direction.y)});l.kernel=g;return l}Object(d.d)(h,e);Object.defineProperty(h.prototype,"kernel",{get:function(){return this._idealKernel},
set:function(a){this._idealKernel!==a&&(this._idealKernel=a=Math.max(a,1),this._kernel=this._nearestBestKernel(a),this.blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(a){this._packedFloat!==a&&(this._packedFloat=a,this.blockCompilation||this._updateParameters())},enumerable:!1,configurable:!0});h.prototype.getClassName=function(){return"BlurPostProcess"};h.prototype.updateEffect=
function(a,d,g,e,k,h){this._updateParameters(k,h)};h.prototype._updateParameters=function(a,d){for(var g=this._kernel,l=(g-1)/2,k=[],r=[],y=0,t=0;t<g;t++){var h=this._gaussianWeight(t/(g-1)*2-1);k[t]=t-l;r[t]=h;y+=h}for(t=0;t<r.length;t++)r[t]/=y;g=[];y=[];h=[];for(t=0;t<=l;t+=2){var z=Math.min(t+1,Math.floor(l));if(t===z)h.push({o:k[t],w:r[t]});else{var A=r[t]+r[z]*(z===l?.5:1);z=k[t]+1/(1+r[t]/r[z]);0===z?(h.push({o:k[t],w:r[t]}),h.push({o:k[t+1],w:r[t+1]})):(h.push({o:z,w:A}),h.push({o:-z,w:A}))}}for(t=
0;t<h.length;t++)y[t]=h[t].o,g[t]=h[t].w;k=y;r=g;t=this.getEngine().getCaps().maxVaryingVectors;l=Math.max(t,0)-1;g=Math.min(k.length,l);y=""+this._staticDefines;-1!=this._staticDefines.indexOf("DOF")&&(y+="#define CENTER_WEIGHT "+this._glslFloat(r[g-1])+"\r\n",g--);for(t=0;t<g;t++)y+="#define KERNEL_OFFSET"+t+" "+this._glslFloat(k[t])+"\r\n",y+="#define KERNEL_WEIGHT"+t+" "+this._glslFloat(r[t])+"\r\n";h=0;for(t=l;t<k.length;t++)y+="#define KERNEL_DEP_OFFSET"+h+" "+this._glslFloat(k[t])+"\r\n",y+=
"#define KERNEL_DEP_WEIGHT"+h+" "+this._glslFloat(r[t])+"\r\n",h++;this.packedFloat&&(y+="#define PACKEDFLOAT 1");this.blockCompilation=!1;e.prototype.updateEffect.call(this,y,null,null,{varyingCount:g,depCount:h},a,d)};h.prototype._nearestBestKernel=function(a){a=Math.round(a);for(var d=0,g=[a,a-1,a+1,a-2,a+2];d<g.length;d++){var e=g[d];if(0!==e%2&&0===Math.floor(e/2)%2&&0<e)return Math.max(e,3)}return Math.max(a,3)};h.prototype._gaussianWeight=function(a){var d=1/3;return 1/(Math.sqrt(2*Math.PI)*
d)*Math.exp(-(a*a/(2*d*d)))};h.prototype._glslFloat=function(a,d){void 0===d&&(d=8);return a.toFixed(d).replace(/0+$/,"")};h._Parse=function(d,e,g,p){return a.a.Parse(function(){return new h(d.name,d.direction,d.kernel,d.options,e,d.renderTargetSamplingMode,g.getEngine(),d.reusable,d.textureType,void 0,!1)},d,g,p)};Object(d.c)([Object(a.c)("kernel")],h.prototype,"_kernel",void 0);Object(d.c)([Object(a.c)("packedFloat")],h.prototype,"_packedFloat",void 0);Object(d.c)([Object(a.n)()],h.prototype,"direction",
void 0);return h}(h.a);q.a.RegisteredTypes["BABYLON.BlurPostProcess"]=x},DBgT:function(h,q,e){e.d(q,"a",function(){return x});var d=e("oYeq"),n=e("/SR9"),a=e("aCSs");h=e("OJ6t");e("u4UU");var x=function(e){function h(d,l,g,p){var k=e.call(this,d,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,p.postProcessScaleFactor,l,a.a.BILINEAR_SAMPLINGMODE)||this;k._isRightEye=g;k._distortionFactors=p.distortionK;k._postProcessScaleFactor=p.postProcessScaleFactor;k._lensCenterOffset=
p.lensCenterOffset;k.adaptScaleToCurrentViewport=!0;k.onSizeChangedObservable.add(function(){k._scaleIn=new n.d(2,2/k.aspectRatio);k._scaleFactor=new n.d(1/k._postProcessScaleFactor*.5,1/k._postProcessScaleFactor*.5*k.aspectRatio);k._lensCenter=new n.d(k._isRightEye?.5-.5*k._lensCenterOffset:.5+.5*k._lensCenterOffset,.5)});k.onApplyObservable.add(function(a){a.setFloat2("LensCenter",k._lensCenter.x,k._lensCenter.y);a.setFloat2("Scale",k._scaleFactor.x,k._scaleFactor.y);a.setFloat2("ScaleIn",k._scaleIn.x,
k._scaleIn.y);a.setFloat4("HmdWarpParam",k._distortionFactors[0],k._distortionFactors[1],k._distortionFactors[2],k._distortionFactors[3])});return k}Object(d.d)(h,e);h.prototype.getClassName=function(){return"VRDistortionCorrectionPostProcess"};return h}(h.a)},H9Lp:function(h,q,e){e.d(q,"a",function(){return n});var d=e("oYeq");h=e("OJ6t");e("ypEX");e=e("WHS4");var n=function(a){function e(d,e,r,l,g,p){var k=a.call(this,d,"anaglyph",null,["leftSampler"],e,r[1],l,g,p)||this;k._passedProcess=r[0]._rigPostProcess;
k.onApplyObservable.add(function(a){a.setTextureFromPostProcess("leftSampler",k._passedProcess)});return k}Object(d.d)(e,a);e.prototype.getClassName=function(){return"AnaglyphPostProcess"};return e}(h.a);e.a.RegisteredTypes["BABYLON.AnaglyphPostProcess"]=n},"LVN+":function(h,q,e){e.d(q,"a",function(){return r});var d=e("uyO6"),n=e("mHtN"),a=e("/SR9"),x=e("ikaq");h=e("wAMR");var u=e("4gN4"),v=e("SYzJ");h.a._PhysicsImpostorParser=function(a,d,e){return new r(d,e.physicsImpostor,{mass:e.physicsMass,
friction:e.physicsFriction,restitution:e.physicsRestitution},a)};var r=function(){function e(e,l,k,r){var g=this;void 0===k&&(k={mass:0});this.object=e;this.type=l;this._options=k;this._scene=r;this._pluginData={};this._bodyUpdateRequired=!1;this._onBeforePhysicsStepCallbacks=[];this._onAfterPhysicsStepCallbacks=[];this._onPhysicsCollideCallbacks=[];this._deltaPosition=a.e.Zero();this.soft=this._isDisposed=!1;this.segments=0;this._tmpQuat=new a.b;this._tmpQuat2=new a.b;this.beforeStep=function(){g._physicsEngine&&
(g.object.translate(g._deltaPosition,-1),g._deltaRotationConjugated&&g.object.rotationQuaternion&&g.object.rotationQuaternion.multiplyToRef(g._deltaRotationConjugated,g.object.rotationQuaternion),g.object.computeWorldMatrix(!1),g.object.parent&&g.object.rotationQuaternion?(g.getParentsRotation(),g._tmpQuat.multiplyToRef(g.object.rotationQuaternion,g._tmpQuat)):g._tmpQuat.copyFrom(g.object.rotationQuaternion||new a.b),g._options.disableBidirectionalTransformation||g.object.rotationQuaternion&&g._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(g,
g.object.getAbsolutePosition(),g._tmpQuat),g._onBeforePhysicsStepCallbacks.forEach(function(a){a(g)}))};this.afterStep=function(){g._physicsEngine&&(g._onAfterPhysicsStepCallbacks.forEach(function(a){a(g)}),g._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(g),g.object.parent&&g.object.rotationQuaternion&&(g.getParentsRotation(),g._tmpQuat.conjugateInPlace(),g._tmpQuat.multiplyToRef(g.object.rotationQuaternion,g.object.rotationQuaternion)),g.object.setAbsolutePosition(g.object.position),
g._deltaRotation&&g.object.rotationQuaternion&&g.object.rotationQuaternion.multiplyToRef(g._deltaRotation,g.object.rotationQuaternion),g.object.translate(g._deltaPosition,1))};this.onCollideEvent=null;this.onCollide=function(a){if((g._onPhysicsCollideCallbacks.length||g.onCollideEvent)&&g._physicsEngine){var d=g._physicsEngine.getImpostorWithPhysicsBody(a.body);if(d){if(g.onCollideEvent)g.onCollideEvent(g,d);g._onPhysicsCollideCallbacks.filter(function(a){return-1!==a.otherImpostors.indexOf(d)}).forEach(function(e){e.callback(g,
d,a.point)})}}};this.object?(this.object.parent&&0!==k.mass&&d.a.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&e.getScene&&(this._scene=e.getScene()),this._scene&&(100<this.type&&(this.soft=!0),(this._physicsEngine=this._scene.getPhysicsEngine())?(this.object.rotationQuaternion||(this.object.rotationQuaternion=this.object.rotation?a.b.RotationYawPitchRoll(this.object.rotation.y,
this.object.rotation.x,this.object.rotation.z):new a.b),this._options.mass=void 0===k.mass?0:k.mass,this._options.friction=void 0===k.friction?.2:k.friction,this._options.restitution=void 0===k.restitution?.2:k.restitution,this.soft&&(this._options.mass=0<this._options.mass?this._options.mass:1,this._options.pressure=void 0===k.pressure?200:k.pressure,this._options.stiffness=void 0===k.stiffness?1:k.stiffness,this._options.velocityIterations=void 0===k.velocityIterations?20:k.velocityIterations,this._options.positionIterations=
void 0===k.positionIterations?20:k.positionIterations,this._options.fixedPoints=void 0===k.fixedPoints?0:k.fixedPoints,this._options.margin=void 0===k.margin?0:k.margin,this._options.damping=void 0===k.damping?0:k.damping,this._options.path=void 0===k.path?null:k.path,this._options.shape=void 0===k.shape?null:k.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&d.a.Warn("You must affect impostors to children before affecting impostor to parent.")):
d.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):d.a.Error("No object was provided. A physics object is obligatory")}Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(a){this.setMass(a)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,
"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(a){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,a)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(a){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,
a)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var a=this._physicsEngine.getPhysicsPlugin();return a.setBodyPressure?a.getBodyPressure(this):0},set:function(a){if(this._physicsEngine){var d=this._physicsEngine.getPhysicsPlugin();d.setBodyPressure&&d.setBodyPressure(this,a)}},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var a=this._physicsEngine.getPhysicsPlugin();
return a.getBodyStiffness?a.getBodyStiffness(this):0},set:function(a){if(this._physicsEngine){var d=this._physicsEngine.getPhysicsPlugin();d.setBodyStiffness&&d.setBodyStiffness(this,a)}},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var a=this._physicsEngine.getPhysicsPlugin();return a.getBodyVelocityIterations?a.getBodyVelocityIterations(this):0},set:function(a){if(this._physicsEngine){var d=this._physicsEngine.getPhysicsPlugin();
d.setBodyVelocityIterations&&d.setBodyVelocityIterations(this,a)}},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var a=this._physicsEngine.getPhysicsPlugin();return a.getBodyPositionIterations?a.getBodyPositionIterations(this):0},set:function(a){if(this._physicsEngine){var d=this._physicsEngine.getPhysicsPlugin();d.setBodyPositionIterations&&d.setBodyPositionIterations(this,a)}},enumerable:!1,configurable:!0});
e.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))};e.prototype._getPhysicsParent=function(){return this.object.parent instanceof x.a?this.object.parent.physicsImpostor:null};e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent};e.prototype.setScalingUpdated=
function(){this.forceUpdate()};e.prototype.forceUpdate=function(){this._init();this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()};Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(a){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this);this._physicsBody=a;this.resetUpdateFlags()},enumerable:!1,configurable:!0});
Object.defineProperty(e.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(a){this._parent=a},enumerable:!1,configurable:!0});e.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1};e.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var a=this.object.rotationQuaternion,d=this.object.scaling.clone();this.object.rotationQuaternion=e.IDENTITY_QUATERNION;var l=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);
l&&l.decompose(d,void 0,void 0);d=this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiplyInPlace(d);this.object.rotationQuaternion=a;this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);return d}return e.DEFAULT_OBJECT_SIZE};e.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position};e.prototype.getParam=function(a){return this._options[a]};e.prototype.setParam=function(a,d){this._options[a]=
d;this._bodyUpdateRequired=!0};e.prototype.setMass=function(a){this.getParam("mass")!==a&&this.setParam("mass",a);this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,a)};e.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):a.e.Zero()};e.prototype.setLinearVelocity=function(a){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,a)};e.prototype.getAngularVelocity=function(){return this._physicsEngine?
this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):a.e.Zero()};e.prototype.setAngularVelocity=function(a){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,a)};e.prototype.executeNativeFunction=function(a){this._physicsEngine&&a(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)};e.prototype.registerBeforePhysicsStep=function(a){this._onBeforePhysicsStepCallbacks.push(a)};e.prototype.unregisterBeforePhysicsStep=function(a){a=this._onBeforePhysicsStepCallbacks.indexOf(a);
-1<a?this._onBeforePhysicsStepCallbacks.splice(a,1):d.a.Warn("Function to remove was not found")};e.prototype.registerAfterPhysicsStep=function(a){this._onAfterPhysicsStepCallbacks.push(a)};e.prototype.unregisterAfterPhysicsStep=function(a){a=this._onAfterPhysicsStepCallbacks.indexOf(a);-1<a?this._onAfterPhysicsStepCallbacks.splice(a,1):d.a.Warn("Function to remove was not found")};e.prototype.registerOnPhysicsCollide=function(a,d){this._onPhysicsCollideCallbacks.push({callback:d,otherImpostors:a instanceof
Array?a:[a]})};e.prototype.unregisterOnPhysicsCollide=function(a,e){var g=a instanceof Array?a:[a],l=-1;this._onPhysicsCollideCallbacks.some(function(a,d){return a.callback===e&&a.otherImpostors.length===g.length?((a=a.otherImpostors.every(function(a){return-1<g.indexOf(a)}))&&(l=d),a):!1})?this._onPhysicsCollideCallbacks.splice(l,1):d.a.Warn("Function to remove was not found")};e.prototype.getParentsRotation=function(){var d=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);d;)d.rotationQuaternion?
this._tmpQuat2.copyFrom(d.rotationQuaternion):a.b.RotationYawPitchRollToRef(d.rotation.y,d.rotation.x,d.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),d=d.parent;return this._tmpQuat};e.prototype.applyForce=function(a,d){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,a,d);return this};e.prototype.applyImpulse=function(a,d){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,a,d);return this};e.prototype.createJoint=
function(a,d,e){d=new u.a(d,e);this.addJoint(a,d);return this};e.prototype.addJoint=function(a,d){this._joints.push({otherImpostor:a,joint:d});this._physicsEngine&&this._physicsEngine.addJoint(this,a,d);return this};e.prototype.addAnchor=function(a,d,e,l,r){if(!this._physicsEngine)return this;var g=this._physicsEngine.getPhysicsPlugin();if(!g.appendAnchor)return this;this._physicsEngine&&g.appendAnchor(this,a,d,e,l,r);return this};e.prototype.addHook=function(a,d,e,l){if(!this._physicsEngine)return this;
var g=this._physicsEngine.getPhysicsPlugin();if(!g.appendAnchor)return this;this._physicsEngine&&g.appendHook(this,a,d,e,l);return this};e.prototype.sleep=function(){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this);return this};e.prototype.wakeUp=function(){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this);return this};e.prototype.clone=function(a){return a?new e(a,this.type,this._options,this._scene):null};e.prototype.dispose=function(){var a=
this;this._physicsEngine&&(this._joints.forEach(function(d){a._physicsEngine&&a._physicsEngine.removeJoint(a,d.otherImpostor,d.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)};e.prototype.setDeltaPosition=function(a){this._deltaPosition.copyFrom(a)};e.prototype.setDeltaRotation=function(d){this._deltaRotation||(this._deltaRotation=new a.b);this._deltaRotation.copyFrom(d);this._deltaRotationConjugated=this._deltaRotation.conjugate()};e.prototype.getBoxSizeToRef=
function(a){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,a);return this};e.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0};e.prototype.syncBoneWithImpostor=function(a,d,l,r,h){var g=e._tmpVecs[0],k=this.object;if(k.rotationQuaternion)if(h){var p=e._tmpQuat;k.rotationQuaternion.multiplyToRef(h,p);a.setRotationQuaternion(p,v.c.WORLD,d)}else a.setRotationQuaternion(k.rotationQuaternion,v.c.WORLD,d);
g.x=0;g.y=0;g.z=0;if(l){g.x=l.x;g.y=l.y;g.z=l.z;a.getDirectionToRef(g,d,g);if(void 0===r||null===r)r=l.length();g.x*=r;g.y*=r;g.z*=r}a.getParent()?(g.addInPlace(k.getAbsolutePosition()),a.setAbsolutePosition(g,d)):(d.setAbsolutePosition(k.getAbsolutePosition()),d.position.x-=g.x,d.position.y-=g.y,d.position.z-=g.z)};e.prototype.syncImpostorWithBone=function(a,d,l,r,h,t){var g=this.object;if(g.rotationQuaternion)if(h){var k=e._tmpQuat;a.getRotationQuaternionToRef(v.c.WORLD,d,k);k.multiplyToRef(h,g.rotationQuaternion)}else a.getRotationQuaternionToRef(v.c.WORLD,
d,g.rotationQuaternion);h=e._tmpVecs[0];k=e._tmpVecs[1];t||(t=e._tmpVecs[2],t.x=0,t.y=1,t.z=0);a.getDirectionToRef(t,d,k);a.getAbsolutePositionToRef(d,h);void 0!==r&&null!==r||!l||(r=l.length());void 0!==r&&null!==r&&(h.x+=k.x*r,h.y+=k.y*r,h.z+=k.z*r);g.setAbsolutePosition(h)};e.DEFAULT_OBJECT_SIZE=new a.e(1,1,1);e.IDENTITY_QUATERNION=a.b.Identity();e._tmpVecs=n.a.BuildArray(3,a.e.Zero);e._tmpQuat=a.b.Identity();e.NoImpostor=0;e.SphereImpostor=1;e.BoxImpostor=2;e.PlaneImpostor=3;e.MeshImpostor=4;
e.CapsuleImpostor=6;e.CylinderImpostor=7;e.ParticleImpostor=8;e.HeightmapImpostor=9;e.ConvexHullImpostor=10;e.CustomImpostor=100;e.RopeImpostor=101;e.ClothImpostor=102;e.SoftbodyImpostor=103;return e}()},OJ6t:function(h,q,e){e.d(q,"a",function(){return l});var d=e("oYeq"),n=e("Bfey"),a=e("ps+7"),x=e("/SR9");e("+stD");var u=e("qUIE");e("DvRB");var v=e("ADVu"),r=e("WHS4"),l=function(){function e(d,e,g,l,r,h,z,A,B,u,q,v,J,D,H){void 0===z&&(z=1);void 0===u&&(u=null);void 0===q&&(q=0);void 0===v&&(v="postprocess");
void 0===D&&(D=!1);void 0===H&&(H=5);this.height=this.width=-1;this._outputTexture=this.nodeMaterialSource=null;this.autoClear=!0;this.alphaMode=0;this.animations=[];this.enablePixelPerfectMode=!1;this.forceFullscreenViewport=!0;this.scaleMode=1;this.alwaysForcePOT=!1;this._samples=1;this._reusable=this.adaptScaleToCurrentViewport=!1;this._textures=new n.a(2);this._currentRenderTextureInd=0;this._scaleRatio=new x.d(1,1);this._texelSize=x.d.Zero();this.onActivateObservable=new a.a;this.onSizeChangedObservable=
new a.a;this.onApplyObservable=new a.a;this.onBeforeRenderObservable=new a.a;this.onAfterRenderObservable=new a.a;this.name=d;null!=h?(this._camera=h,this._scene=h.getScene(),h.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):A&&(this._engine=A,this._engine.postProcesses.push(this));this._options=r;this.renderTargetSamplingMode=z?z:1;this._reusable=B||!1;this._textureType=q;this._textureFormat=H;this._samplers=
l||[];this._samplers.push("textureSampler");this._fragmentUrl=e;this._vertexUrl=v;this._parameters=g||[];this._parameters.push("scale");this._indexParameters=J;D||this.updateEffect(u)}Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(a){var d=this;this._samples=Math.min(a,this._engine.getCaps().maxMSAASamples);this._textures.forEach(function(a){a.samples!==d._samples&&d._engine.updateRenderTargetTextureSampleCount(a,d._samples)})},enumerable:!1,configurable:!0});
e.prototype.getEffectName=function(){return this._fragmentUrl};Object.defineProperty(e.prototype,"onActivate",{set:function(a){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver);a&&(this._onActivateObserver=this.onActivateObservable.add(a))},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"onSizeChanged",{set:function(a){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver);this._onSizeChangedObserver=this.onSizeChangedObservable.add(a)},
enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"onApply",{set:function(a){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver);this._onApplyObserver=this.onApplyObservable.add(a)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"onBeforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},enumerable:!1,configurable:!0});
Object.defineProperty(e.prototype,"onAfterRender",{set:function(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(a){this._forcedOutputTexture=a},enumerable:!1,configurable:!0});e.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture=
null};e.prototype.getCamera=function(){return this._camera};Object.defineProperty(e.prototype,"texelSize",{get:function(){if(this._shareOutputWithPostProcess)return this._shareOutputWithPostProcess.texelSize;this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height);return this._texelSize},enumerable:!1,configurable:!0});e.prototype.getClassName=function(){return"PostProcess"};e.prototype.getEngine=function(){return this._engine};
e.prototype.getEffect=function(){return this._effect};e.prototype.shareOutputWith=function(a){this._disposeTextures();this._shareOutputWithPostProcess=a;return this};e.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new n.a(2));this._shareOutputWithPostProcess=null};e.prototype.updateEffect=function(a,d,e,g,l,r,h,A){void 0===a&&(a=null);void 0===d&&(d=null);void 0===e&&(e=null);this._effect=this._engine.createEffect({vertex:null!==h&&void 0!==h?h:this._vertexUrl,fragment:null!==
A&&void 0!==A?A:this._fragmentUrl},["position"],d||this._parameters,e||this._samplers,null!==a?a:"",void 0,l,r,g||this._indexParameters)};e.prototype.isReusable=function(){return this._reusable};e.prototype.markTextureDirty=function(){this.width=-1};e.prototype.activate=function(a,d,e){var g=this;void 0===d&&(d=null);a=a||this._camera;var l=a.getScene(),k=l.getEngine(),r=k.getCaps().maxTextureSize,h=(d?d.width:this._engine.getRenderWidth(!0))*this._options|0;d=(d?d.height:this._engine.getRenderHeight(!0))*
this._options|0;var p=a.parent;!p||p.leftCamera!=a&&p.rightCamera!=a||(h/=2);p=this._options.width||h;var n=this._options.height||d,q=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var v=k.currentViewport;v&&(p*=v.width,n*=v.height)}if(q||this.alwaysForcePOT)this._options.width||(p=k.needPOTTextures?u.a.GetExponentOfTwo(p,r,this.scaleMode):
p),this._options.height||(n=k.needPOTTextures?u.a.GetExponentOfTwo(n,r,this.scaleMode):n);if(this.width!==p||this.height!==n){if(0<this._textures.length){for(k=0;k<this._textures.length;k++)this._engine._releaseTexture(this._textures.data[k]);this._textures.reset()}this.width=p;this.height=n;k={width:this.width,height:this.height};e={generateMipMaps:q,generateDepthBuffer:e||0===a._postProcesses.indexOf(this),generateStencilBuffer:(e||0===a._postProcesses.indexOf(this))&&this._engine.isStencilEnable,
samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._engine.createRenderTargetTexture(k,e));this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(k,e));this._texelSize.copyFromFloats(1/this.width,1/this.height);this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(a){a.samples!==g.samples&&g._engine.updateRenderTargetTextureSampleCount(a,g.samples)})}this._shareOutputWithPostProcess?
e=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(e=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):e=this.inputTexture;this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(h/p,d/n),this._engine.bindFramebuffer(e,0,h,d,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(e,0,void 0,void 0,this.forceFullscreenViewport));this.onActivateObservable.notifyObservers(a);
this.autoClear&&0===this.alphaMode&&this._engine.clear(this.clearColor?this.clearColor:l.clearColor,l._allowPostProcessClearColor,!0,!0);this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2);return e};Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!1,configurable:!0});Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:
this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0});e.prototype.isReady=function(){return this._effect&&this._effect.isReady()};e.prototype.apply=function(){if(!this._effect||!this._effect.isReady())return null;this._engine.enableEffect(this._effect);this._engine.setState(!1);this._engine.setDepthBuffer(!1);this._engine.setDepthWrite(!1);this._engine.setAlphaMode(this.alphaMode);this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,
this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a);this._effect._bindTexture("textureSampler",this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture);this._effect.setVector2("scale",this._scaleRatio);this.onApplyObservable.notifyObservers(this._effect);return this._effect};e.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(0<this._textures.length)for(var a=
0;a<this._textures.length;a++)this._engine._releaseTexture(this._textures.data[a]);this._textures.dispose()}};e.prototype.setPrePassRenderer=function(a){return this._prePassEffectConfiguration?(this._prePassEffectConfiguration=a.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0):!1};e.prototype.dispose=function(a){a=a||this._camera;this._disposeTextures();if(this._scene){var d=this._scene.postProcesses.indexOf(this);-1!==d&&this._scene.postProcesses.splice(d,
1)}d=this._engine.postProcesses.indexOf(this);-1!==d&&this._engine.postProcesses.splice(d,1);a&&(a.detachPostProcess(this),d=a._postProcesses.indexOf(this),0===d&&0<a._postProcesses.length&&(a=this._camera._getFirstPostProcess())&&a.markTextureDirty(),this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear())};e.prototype.serialize=function(){var a=v.a.Serialize(this);a.customType=
"BABYLON."+this.getClassName();a.cameraId=this.getCamera().id;a.reusable=this._reusable;a.options=this._options;a.textureType=this._textureType;return a};e.Parse=function(a,d,e){var g=r.a.GetClass(a.customType);if(!g||!g._Parse)return null;var l=d.getCameraByID(a.cameraId);return l?g._Parse(a,l,d,e):null};Object(d.c)([Object(v.c)()],e.prototype,"uniqueId",void 0);Object(d.c)([Object(v.c)()],e.prototype,"name",void 0);Object(d.c)([Object(v.c)()],e.prototype,"width",void 0);Object(d.c)([Object(v.c)()],
e.prototype,"height",void 0);Object(d.c)([Object(v.c)()],e.prototype,"renderTargetSamplingMode",void 0);Object(d.c)([Object(v.f)()],e.prototype,"clearColor",void 0);Object(d.c)([Object(v.c)()],e.prototype,"autoClear",void 0);Object(d.c)([Object(v.c)()],e.prototype,"alphaMode",void 0);Object(d.c)([Object(v.c)()],e.prototype,"alphaConstants",void 0);Object(d.c)([Object(v.c)()],e.prototype,"enablePixelPerfectMode",void 0);Object(d.c)([Object(v.c)()],e.prototype,"forceFullscreenViewport",void 0);Object(d.c)([Object(v.c)()],
e.prototype,"scaleMode",void 0);Object(d.c)([Object(v.c)()],e.prototype,"alwaysForcePOT",void 0);Object(d.c)([Object(v.c)("samples")],e.prototype,"_samples",void 0);Object(d.c)([Object(v.c)()],e.prototype,"adaptScaleToCurrentViewport",void 0);return e}();r.a.RegisteredTypes["BABYLON.PostProcess"]=l},V9V8:function(h,q,e){e.d(q,"a",function(){return x});var d=e("oYeq"),n=e("aCSs");h=e("OJ6t");e("SMV4");e("q4Q+");q=e("WHS4");var a=e("ADVu"),x=function(e){function h(a,d,g,h,k,u,q){void 0===g&&(g=null);
void 0===q&&(q=0);var l=e.call(this,a,"fxaa",["texelSize"],null,d,g,h||n.a.BILINEAR_SAMPLINGMODE,k,u,null,q,"fxaa",void 0,!0)||this;a=l._getDefines();l.updateEffect(a);l.onApplyObservable.add(function(a){var d=l.texelSize;a.setFloat2("texelSize",d.x,d.y)});return l}Object(d.d)(h,e);h.prototype.getClassName=function(){return"FxaaPostProcess"};h.prototype._getDefines=function(){var a=this.getEngine();return a?(a=a.getGlInfo())&&a.renderer&&-1<a.renderer.toLowerCase().indexOf("mali")?"#define MALI 1\n":
null:null};h._Parse=function(d,e,g,p){return a.a.Parse(function(){return new h(d.name,d.options,e,d.renderTargetSamplingMode,g.getEngine(),d.reusable)},d,g,p)};return h}(h.a);q.a.RegisteredTypes["BABYLON.FxaaPostProcess"]=x},WnUc:function(h,q,e){e.d(q,"a",function(){return a});var d=e("cdI9"),n=e("y4Ty"),a=function(){function a(a){this._vertexBuffers={};this._scene=a}a.prototype._prepareBuffers=function(){if(!this._vertexBuffers[n.b.PositionKind]){var a=[];a.push(1,1);a.push(-1,1);a.push(-1,-1);a.push(1,
-1);this._vertexBuffers[n.b.PositionKind]=new n.b(this._scene.getEngine(),a,n.b.PositionKind,!1,!1,2);this._buildIndexBuffer()}};a.prototype._buildIndexBuffer=function(){var a=[];a.push(0);a.push(1);a.push(2);a.push(0);a.push(2);a.push(3);this._indexBuffer=this._scene.getEngine().createIndexBuffer(a)};a.prototype._rebuild=function(){var a=this._vertexBuffers[n.b.PositionKind];a&&(a._rebuild(),this._buildIndexBuffer())};a.prototype._prepareFrame=function(a,d){void 0===a&&(a=null);void 0===d&&(d=null);
var e=this._scene.activeCamera;if(!e)return!1;d=d||e._postProcesses.filter(function(a){return null!=a});if(!d||0===d.length||!this._scene.postProcessesEnabled)return!1;d[0].activate(e,a,null!==d&&void 0!==d);return!0};a.prototype.directRender=function(a,e,h,l,g,p){void 0===e&&(e=null);void 0===h&&(h=!1);void 0===l&&(l=0);void 0===g&&(g=0);void 0===p&&(p=!1);for(var k=this._scene.getEngine(),r=0;r<a.length;r++){r<a.length-1?a[r+1].activate(this._scene.activeCamera,e):e?k.bindFramebuffer(e,l,void 0,
void 0,h,g):p||k.restoreDefaultFramebuffer();var n=a[r],t=n.apply();t&&(n.onBeforeRenderObservable.notifyObservers(t),this._prepareBuffers(),k.bindBuffers(this._vertexBuffers,this._indexBuffer,t),k.drawElementsType(d.a.TriangleFillMode,0,6),n.onAfterRenderObservable.notifyObservers(t))}k.setDepthBuffer(!0);k.setDepthWrite(!0)};a.prototype._finalizeFrame=function(a,e,h,l,g){void 0===g&&(g=!1);var r=this._scene.activeCamera;if(r&&(l=l||r._postProcesses.filter(function(a){return null!=a}),0!==l.length&&
this._scene.postProcessesEnabled)){for(var k=this._scene.getEngine(),n=0,q=l.length;n<q;n++){var t=l[n];n<q-1?t._outputTexture=l[n+1].activate(r,e):e?(k.bindFramebuffer(e,h,void 0,void 0,g),t._outputTexture=e):(k.restoreDefaultFramebuffer(),t._outputTexture=null);if(a)break;var u=t.apply();u&&(t.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),k.bindBuffers(this._vertexBuffers,this._indexBuffer,u),k.drawElementsType(d.a.TriangleFillMode,0,6),t.onAfterRenderObservable.notifyObservers(u))}k.setDepthBuffer(!0);
k.setDepthWrite(!0);k.setAlphaMode(0)}};a.prototype.dispose=function(){var a=this._vertexBuffers[n.b.PositionKind];a&&(a.dispose(),this._vertexBuffers[n.b.PositionKind]=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)};return a}()},c7Ru:function(h,q,e){e.d(q,"a",function(){return u});var d=e("oYeq"),n=e("ADVu"),a=e("stmW");h=e("OJ6t");var x=e("e2Mr");e("Ohe1");e("+stD");var u=function(e){function h(a,d,h,k,r,n,t,q){void 0===h&&(h=null);void 0===
t&&(t=0);var g=e.call(this,a,"imageProcessing",[],[],d,h,k,r,n,null,t,"postprocess",null,!0)||this;g._fromLinearSpace=!0;g._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1};q?(q.applyByPostProcess=!0,g._attachImageProcessingConfiguration(q,!0),g.fromLinearSpace=
!1):(g._attachImageProcessingConfiguration(null,!0),g.imageProcessingConfiguration.applyByPostProcess=!0);g.onApply=function(a){g.imageProcessingConfiguration.bind(a,g.aspectRatio)};return g}Object(d.d)(h,e);Object.defineProperty(h.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(a){a.applyByPostProcess=!0;this._attachImageProcessingConfiguration(a)},enumerable:!1,configurable:!0});h.prototype._attachImageProcessingConfiguration=function(d,
e){var g=this;void 0===e&&(e=!1);if(d!==this._imageProcessingConfiguration){this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver);if(d)this._imageProcessingConfiguration=d;else{d=null;d=this.getEngine();var l=this.getCamera();l?d=l.getScene():d&&d.scenes?(d=d.scenes,d=d[d.length-1]):d=x.a.LastCreatedScene;this._imageProcessingConfiguration=d?d.imageProcessingConfiguration:new a.a}this._imageProcessingConfiguration&&
(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){g._updateParameters()}));e||this._updateParameters()}};Object.defineProperty(h.prototype,"isSupported",{get:function(){var a=this.getEffect();return!a||a.isSupported},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(a){this.imageProcessingConfiguration.colorCurves=a},enumerable:!1,configurable:!0});
Object.defineProperty(h.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(a){this.imageProcessingConfiguration.colorCurvesEnabled=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(a){this.imageProcessingConfiguration.colorGradingTexture=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,
"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(a){this.imageProcessingConfiguration.colorGradingEnabled=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(a){this.imageProcessingConfiguration.exposure=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},
set:function(a){this._imageProcessingConfiguration.toneMappingEnabled=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(a){this._imageProcessingConfiguration.toneMappingType=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(a){this.imageProcessingConfiguration.contrast=
a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(a){this.imageProcessingConfiguration.vignetteStretch=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(a){this.imageProcessingConfiguration.vignetteCentreX=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,
"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(a){this.imageProcessingConfiguration.vignetteCentreY=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(a){this.imageProcessingConfiguration.vignetteWeight=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},
set:function(a){this.imageProcessingConfiguration.vignetteColor=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(a){this.imageProcessingConfiguration.vignetteCameraFov=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(a){this.imageProcessingConfiguration.vignetteBlendMode=
a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(a){this.imageProcessingConfiguration.vignetteEnabled=a},enumerable:!1,configurable:!0});Object.defineProperty(h.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(a){this._fromLinearSpace!==a&&(this._fromLinearSpace=a,this._updateParameters())},enumerable:!1,configurable:!0});h.prototype.getClassName=
function(){return"ImageProcessingPostProcess"};h.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace;this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var d="";for(e in this._defines)this._defines[e]&&(d+="#define "+e+";\r\n");var e=["textureSampler"];var h=["scale"];a.a&&(a.a.PrepareSamplers(e,this._defines),a.a.PrepareUniforms(h,this._defines));this.updateEffect(d,h,e)};h.prototype.dispose=function(a){e.prototype.dispose.call(this,a);this._imageProcessingConfiguration&&
this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver);this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)};Object(d.c)([Object(n.c)()],h.prototype,"_fromLinearSpace",void 0);return h}(h.a)},"e/hQ":function(h,q,e){var d=e("uyO6"),n=e("ps+7");h=e("ikaq");var a=e("Yap0");q=e("tVVT");var x=e("3kgD"),u=e("4gN4");q.a.prototype.getPhysicsEngine=function(){return this._physicsEngine};q.a.prototype.enablePhysics=
function(e,l){void 0===e&&(e=null);if(this._physicsEngine)return!0;var g=this._getComponent(a.a.NAME_PHYSICSENGINE);g||(g=new v(this),this._addComponent(g));try{return this._physicsEngine=new x.a(e,l),this._physicsTimeAccumulator=0,!0}catch(p){return d.a.Error(p.message),!1}};q.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)};q.a.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine};q.a.prototype.deleteCompoundImpostor=
function(a){a=a.parts[0].mesh;a.physicsImpostor&&(a.physicsImpostor.dispose(),a.physicsImpostor=null)};q.a.prototype._advancePhysicsEngineStep=function(a){if(this._physicsEngine){var d=this._physicsEngine.getSubTimeStep();if(0<d)for(this._physicsTimeAccumulator+=a;this._physicsTimeAccumulator>d;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(d/1E3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=d;else this.onBeforePhysicsObservable.notifyObservers(this),
this._physicsEngine._step(a/1E3),this.onAfterPhysicsObservable.notifyObservers(this)}};Object.defineProperty(h.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(a){var d=this;this._physicsImpostor!==a&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=a)&&(this._disposePhysicsObserver=this.onDisposeObservable.add(function(){d.physicsImpostor&&(d.physicsImpostor.dispose(),d.physicsImpostor=null)}))},
enumerable:!0,configurable:!0});h.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor};h.a.prototype.applyImpulse=function(a,d){if(!this.physicsImpostor)return this;this.physicsImpostor.applyImpulse(a,d);return this};h.a.prototype.setPhysicsLinkWith=function(a,d,e,h){if(!this.physicsImpostor||!a.physicsImpostor)return this;this.physicsImpostor.createJoint(a.physicsImpostor,u.a.HingeJoint,{mainPivot:d,connectedPivot:e,nativeParams:h});return this};var v=function(){function d(d){var e=
this;this.name=a.a.NAME_PHYSICSENGINE;this.scene=d;this.scene.onBeforePhysicsObservable=new n.a;this.scene.onAfterPhysicsObservable=new n.a;this.scene.getDeterministicFrameTime=function(){return e.scene._physicsEngine?1E3*e.scene._physicsEngine.getTimeStep():1E3/60}}d.prototype.register=function(){};d.prototype.rebuild=function(){};d.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear();this.scene.onAfterPhysicsObservable.clear();this.scene._physicsEngine&&this.scene.disablePhysicsEngine()};
return d}()},eFYt:function(h,q,e){e.d(q,"a",function(){return x});var d=e("oYeq"),n=e("aCSs");h=e("OJ6t");var a=e("uyO6");e("Ohe1");e("t/fV");e("+stD");var x=function(e){function h(d,h,g,p,k,q,u,t){void 0===p&&(p=null);void 0===t&&(t=0);var l=e.call(this,d,"subSurfaceScattering",["texelSize","viewportSize","metersPerUnit"],"diffusionS diffusionD filterRadii irradianceSampler depthSampler albedoSampler".split(" "),g,p,k||n.a.BILINEAR_SAMPLINGMODE,q,u,null,t,"postprocess",void 0,!0)||this;l._scene=
h;l.updateEffect();l.onApplyObservable.add(function(d){if(h.prePassRenderer&&h.subSurfaceConfiguration){var e=l.texelSize;d.setFloat("metersPerUnit",h.subSurfaceConfiguration.metersPerUnit);d.setFloat2("texelSize",e.x,e.y);d.setTexture("irradianceSampler",h.prePassRenderer.prePassRT.textures[h.prePassRenderer.getIndex(0)]);d.setTexture("depthSampler",h.prePassRenderer.prePassRT.textures[h.prePassRenderer.getIndex(5)]);d.setTexture("albedoSampler",h.prePassRenderer.prePassRT.textures[h.prePassRenderer.getIndex(6)]);
d.setFloat2("viewportSize",Math.tan(h.activeCamera.fov/2)*h.getEngine().getAspectRatio(h.activeCamera,!0),Math.tan(h.activeCamera.fov/2));d.setArray3("diffusionS",h.subSurfaceConfiguration.ssDiffusionS);d.setArray("diffusionD",h.subSurfaceConfiguration.ssDiffusionD);d.setArray("filterRadii",h.subSurfaceConfiguration.ssFilterRadii)}else a.a.Error("PrePass and subsurface configuration needs to be enabled for subsurface scattering.")});return l}Object(d.d)(h,e);h.prototype.getClassName=function(){return"SubSurfaceScatteringPostProcess"};
return h}(h.a)},qjwu:function(h,q,e){e.d(q,"a",function(){return x});var d=e("oYeq");h=e("OJ6t");q=e("qUIE");e("inTN");e("A0xq");var n=e("WHS4"),a=e("ADVu"),x=function(e){function h(a,d,g,h,k,n,q,t){void 0===g&&(g=null);void 0===q&&(q=0);void 0===t&&(t=!1);return e.call(this,a,"pass",null,null,d,g,h,k,n,void 0,q,void 0,null,t)||this}Object(d.d)(h,e);h.prototype.getClassName=function(){return"PassPostProcess"};h._Parse=function(d,e,g,n){return a.a.Parse(function(){return new h(d.name,d.options,e,d.renderTargetSamplingMode,
g.getEngine(),d.reusable)},d,g,n)};return h}(h.a);n.a.RegisteredTypes["BABYLON.PassPostProcess"]=x;(function(e){function h(a,d,g,h,k,n,q,t){void 0===g&&(g=null);void 0===q&&(q=0);void 0===t&&(t=!1);a=e.call(this,a,"passCube",null,null,d,g,h,k,n,"#define POSITIVEX",q,void 0,null,t)||this;a._face=0;return a}Object(d.d)(h,e);Object.defineProperty(h.prototype,"face",{get:function(){return this._face},set:function(a){if(!(0>a||5<a))switch(this._face=a,this._face){case 0:this.updateEffect("#define POSITIVEX");
break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0});h.prototype.getClassName=function(){return"PassCubePostProcess"};h._Parse=function(d,e,g,n){return a.a.Parse(function(){return new h(d.name,d.options,e,d.renderTargetSamplingMode,g.getEngine(),d.reusable)},d,
g,n)};return h})(h.a);q.a._RescalePostProcessFactory=function(a){return new x("rescale",1,null,2,a,!1,0)}},xVzz:function(h,q,e){var d=e("oYeq"),n=e("uyO6"),a=e("/SR9"),x=e("H22S"),u=e("5xLc"),v=e("2/Cc");(function(){function a(a){this._scene=a;(this._physicsEngine=this._scene.getPhysicsEngine())||n.a.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}a.prototype.applyRadialExplosionImpulse=function(a,d,e,g){if(!this._physicsEngine)return n.a.Warn("Physics engine not enabled. Please enable the physics before you call this method."),
null;var h=this._physicsEngine.getImpostors();if(0===h.length)return null;"number"===typeof d&&(d=new k,d.radius=d,d.strength=e||d.strength,d.falloff=g||d.falloff);var l=new r(this._scene,d),p=[];h.forEach(function(d){var e=l.getImpostorHitData(d,a);e&&(d.applyImpulse(e.force,e.contactPoint),p.push({impostor:d,hitData:e}))});l.triggerAffectedImpostorsCallback(p);l.dispose(!1);return l};a.prototype.applyRadialExplosionForce=function(a,d,e,g){if(!this._physicsEngine)return n.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),
null;var h=this._physicsEngine.getImpostors();if(0===h.length)return null;"number"===typeof d&&(d=new k,d.radius=d,d.strength=e||d.strength,d.falloff=g||d.falloff);var l=new r(this._scene,d),p=[];h.forEach(function(d){var e=l.getImpostorHitData(d,a);e&&(d.applyForce(e.force,e.contactPoint),p.push({impostor:d,hitData:e}))});l.triggerAffectedImpostorsCallback(p);l.dispose(!1);return l};a.prototype.gravitationalField=function(a,d,e,g){if(!this._physicsEngine)return n.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),
null;if(0===this._physicsEngine.getImpostors().length)return null;"number"===typeof d&&(d=new k,d.radius=d,d.strength=e||d.strength,d.falloff=g||d.falloff);a=new l(this,this._scene,a,d);a.dispose(!1);return a};a.prototype.updraft=function(a,d,e,h,k){if(!this._physicsEngine)return n.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"===typeof d&&(d=new G,d.radius=d,d.strength=e||
d.strength,d.height=h||d.height,d.updraftMode=k||d.updraftMode);a=new g(this._scene,a,d);a.dispose(!1);return a};a.prototype.vortex=function(a,d,e,g){if(!this._physicsEngine)return n.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"===typeof d&&(d=new y,d.radius=d,d.strength=e||d.strength,d.height=g||d.height);a=new p(this._scene,a,d);a.dispose(!1);return a};return a})();var r=
function(){function e(a,e){this._scene=a;this._options=e;this._dataFetched=!1;this._options=Object(d.a)(Object(d.a)({},new k),this._options)}e.prototype.getData=function(){this._dataFetched=!0;return{sphere:this._sphere}};e.prototype.getImpostorHitData=function(d,e){if(0===d.mass||!this._intersectsWithSphere(d,e,this._options.radius)||"Mesh"!==d.object.getClassName()&&"InstancedMesh"!==d.object.getClassName())return null;var g=d.getObjectCenter().subtract(e);d=(new v.a(e,g,this._options.radius)).intersectsMesh(d.object).pickedPoint;
if(!d)return null;e=a.e.Distance(e,d);if(e>this._options.radius)return null;var h=this._options.falloff===t.Constant?this._options.strength:this._options.strength*(1-e/this._options.radius);return{force:g.multiplyByFloats(h,h,h),contactPoint:d,distanceFromOrigin:e}};e.prototype.triggerAffectedImpostorsCallback=function(a){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(a)};e.prototype.dispose=function(a){var d=this;void 0===a&&(a=!0);a?this._sphere.dispose():setTimeout(function(){d._dataFetched||
d._sphere.dispose()},0)};e.prototype._prepareSphere=function(){this._sphere||(this._sphere=x.a.CreateSphere("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)};e.prototype._intersectsWithSphere=function(d,e,g){d=d.object;this._prepareSphere();this._sphere.position=e;this._sphere.scaling=new a.e(2*g,2*g,2*g);this._sphere._updateBoundingInfo();this._sphere.computeWorldMatrix(!0);return this._sphere.intersectsMesh(d,!0)};return e}(),l=function(){function a(a,e,
g,h){this._physicsHelper=a;this._scene=e;this._origin=g;this._options=h;this._dataFetched=!1;this._options=Object(d.a)(Object(d.a)({},new k),this._options);this._tickCallback=this._tick.bind(this);this._options.strength*=-1}a.prototype.getData=function(){this._dataFetched=!0;return{sphere:this._sphere}};a.prototype.enable=function(){this._tickCallback.call(this);this._scene.registerBeforeRender(this._tickCallback)};a.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)};
a.prototype.dispose=function(a){var d=this;void 0===a&&(a=!0);a?this._sphere.dispose():setTimeout(function(){d._dataFetched||d._sphere.dispose()},0)};a.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var a=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);a&&(this._sphere=a.getData().sphere.clone("radialExplosionEventSphereClone"))}};return a}(),g=function(){function e(e,g,h){this._scene=e;this._origin=
g;this._options=h;this._originTop=a.e.Zero();this._originDirection=a.e.Zero();this._cylinderPosition=a.e.Zero();this._dataFetched=!1;this._physicsEngine=this._scene.getPhysicsEngine();this._options=Object(d.a)(Object(d.a)({},new G),this._options);this._origin.addToRef(new a.e(0,this._options.height/2,0),this._cylinderPosition);this._origin.addToRef(new a.e(0,this._options.height,0),this._originTop);this._options.updraftMode===C.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize());
this._tickCallback=this._tick.bind(this);this._prepareCylinder()}e.prototype.getData=function(){this._dataFetched=!0;return{cylinder:this._cylinder}};e.prototype.enable=function(){this._tickCallback.call(this);this._scene.registerBeforeRender(this._tickCallback)};e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)};e.prototype.dispose=function(a){var d=this;void 0===a&&(a=!0);this._cylinder&&(a?this._cylinder.dispose():setTimeout(function(){d._dataFetched||d._cylinder.dispose()},
0))};e.prototype.getImpostorHitData=function(d){if(0===d.mass||!this._intersectsWithCylinder(d))return null;d=d.getObjectCenter();var e=this._options.updraftMode===C.Perpendicular?this._originDirection:d.subtract(this._originTop),g=a.e.Distance(this._origin,d),h=-1*this._options.strength;return{force:e.multiplyByFloats(h,h,h),contactPoint:d,distanceFromOrigin:g}};e.prototype._tick=function(){var a=this;this._physicsEngine.getImpostors().forEach(function(d){var e=a.getImpostorHitData(d);e&&d.applyForce(e.force,
e.contactPoint)})};e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=u.a.CreateCylinder("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)};e.prototype._intersectsWithCylinder=function(a){a=a.object;this._cylinder.position=this._cylinderPosition;return this._cylinder.intersectsMesh(a,!0)};return e}(),p=function(){function e(e,g,h){this._scene=e;this._origin=g;this._options=h;this._originTop=a.e.Zero();
this._cylinderPosition=a.e.Zero();this._dataFetched=!1;this._physicsEngine=this._scene.getPhysicsEngine();this._options=Object(d.a)(Object(d.a)({},new y),this._options);this._origin.addToRef(new a.e(0,this._options.height/2,0),this._cylinderPosition);this._origin.addToRef(new a.e(0,this._options.height,0),this._originTop);this._tickCallback=this._tick.bind(this);this._prepareCylinder()}e.prototype.getData=function(){this._dataFetched=!0;return{cylinder:this._cylinder}};e.prototype.enable=function(){this._tickCallback.call(this);
this._scene.registerBeforeRender(this._tickCallback)};e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)};e.prototype.dispose=function(a){var d=this;void 0===a&&(a=!0);a?this._cylinder.dispose():setTimeout(function(){d._dataFetched||d._cylinder.dispose()},0)};e.prototype.getImpostorHitData=function(d){if(0===d.mass||!this._intersectsWithCylinder(d)||"Mesh"!==d.object.getClassName()&&"InstancedMesh"!==d.object.getClassName())return null;var e=d.getObjectCenter(),
g=new a.e(this._origin.x,e.y,this._origin.z),h=e.subtract(g);d=(new v.a(g,h,this._options.radius)).intersectsMesh(d.object);h=d.pickedPoint;if(!h)return null;d=d.distance/this._options.radius;h=h.normalize();d>this._options.centripetalForceThreshold&&(h=h.negate());if(d>this._options.centripetalForceThreshold){g=h.x*this._options.centripetalForceMultiplier;var k=h.y*this._options.updraftForceMultiplier;h=h.z*this._options.centripetalForceMultiplier}else{var l=a.e.Cross(g,e).normalize();g=(l.x+h.x)*
this._options.centrifugalForceMultiplier;k=this._originTop.y*this._options.updraftForceMultiplier;h=(l.z+h.z)*this._options.centrifugalForceMultiplier}g=new a.e(g,k,h);g=g.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength);return{force:g,contactPoint:e,distanceFromOrigin:d}};e.prototype._tick=function(){var a=this;this._physicsEngine.getImpostors().forEach(function(d){var e=a.getImpostorHitData(d);e&&d.applyForce(e.force,e.contactPoint)})};e.prototype._prepareCylinder=
function(){this._cylinder||(this._cylinder=u.a.CreateCylinder("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)};e.prototype._intersectsWithCylinder=function(a){a=a.object;this._cylinder.position=this._cylinderPosition;return this._cylinder.intersectsMesh(a,!0)};return e}(),k=function(){return function(){this.radius=5;this.strength=10;this.falloff=t.Constant;this.sphere={segments:32,diameter:1}}}(),G=function(){return function(){this.radius=
5;this.height=this.strength=10;this.updraftMode=C.Center}}(),y=function(){return function(){this.radius=5;this.height=this.strength=10;this.centripetalForceThreshold=.7;this.centripetalForceMultiplier=5;this.centrifugalForceMultiplier=.5;this.updraftForceMultiplier=.02}}(),t;(function(a){a[a.Constant=0]="Constant";a[a.Linear=1]="Linear"})(t||(t={}));var C;(function(a){a[a.Center=0]="Center";a[a.Perpendicular=1]="Perpendicular"})(C||(C={}))}}]);
